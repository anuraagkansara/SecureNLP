In O
November O
2014 O
, O
the O
experts O
of O
the O
G O
DATA O
SecurityLabs O
published O
an O
article O
about O
ComRAT O
, O
the O
Agent O
. O
BTZ O
successor O
. O
 
We O
explained O
that O
this O
case O
is O
linked O
to O
the O
Uroburos O
rootkit O
. O
 
We O
assume O
that O
the O
actor O
behind O
these O
campaigns O
uses O
several O
different O
malware O
strains O
is O
order O
to O
compromise O
the O
targeted O
infrastructure O
: O
Uroburos O
, O
a O
rootkit O
; O
Agent O
. O
BTZ O
/ O
ComRAT O
, O
remote O
administration O
tools O
or O
Linux O
malware O
and O
maybe O
even O
more O
. O
 
We O
decided O
to O
have O
an O
even O
closer O
look O
at O
Agent O
. O
BTZ O
and O
ComRAT O
and O
therefore O
analyzed O
the O
evolution O
of O
this O
RAT O
, O
covering O
seven O
years O
of O
development O
. O
 
Here O
is O
a O
table O
with O
the O
minimal O
information O
about O
46 O
different O
samples O
. O
 
Thanks O
to O
the O
versioning O
, O
we O
can O
deduce O
that O
the O
compilation O
dates O
we O
saw O
and O
currently O
see O
actually O
seem O
to O
be O
legit O
– O
except O
for O
the O
last O
known O
version O
, O
in O
which O
the O
author O
modified O
the O
compilation O
date O
in O
order O
to O
make O
the O
analysis O
more O
complex O
. O
 
We O
can O
see O
that O
this O
malware O
was O
really O
active O
in O
2007 O
and O
2008 O
. O
 
New O
versions O
declined O
in O
frequency O
in O
2009 O
and O
only O
one O
new O
sample O
was O
identified O
in O
2010 O
. O
 
We O
did O
not O
encounter O
any O
new O
sample O
from O
2011 O
, O
but O
the O
malware O
appeared O
back O
in O
2012 O
, O
with O
a O
new O
major O
version O
. O
 
To O
describe O
the O
evolution O
of O
the O
development O
, O
we O
decided O
to O
compare O
ten O
major O
versions O
. O
 
The O
following O
chapter O
will O
present O
the O
main O
differences O
between O
the O
versions O
mentioned O
above O
. O
 
Here O
is O
the O
resemblance O
ratio O
for O
each O
version O
, O
comparing O
direct O
neighbor O
versions O
only O
, O
created O
using O
BinDiff O
. O
 
The O
biggest O
code O
update O
has O
occurred O
between O
version O
2.14.1 O
and O
version O
3.00 O
. O
 
The O
gap O
matches O
the O
absence O
of O
samples O
during O
two O
years O
and O
this O
fundamental O
modification O
is O
what O
we O
call O
the O
death O
of O
Agent O
. O
BTZ O
and O
the O
birth O
of O
ComRAT O
. O
 
Differences O
between O
version O
Ch O
1.0 O
( O
2007 O
- O
06 O
) O
to O
Ch O
1.5 O
( O
2008 O
- O
03 O
) O
The O
analyzed O
samples O
are O
. O
 
We O
did O
not O
identify O
strong O
modification O
between O
the O
two O
samples O
. O
 
However O
, O
we O
can O
notice O
the O
following O
. O
 
Differences O
between O
version O
Ch O
1.5 O
( O
2008 O
- O
03 O
) O
and O
Ch O
2.03 O
( O
2008 O
- O
05 O
) O
The O
analyzed O
samples O
are O
. O
 
In O
version O
2.03 O
of O
Agent O
. O
BTZ O
, O
the O
authors O
changed O
the O
following O
. O
 
They O
added O
obfuscation O
in O
order O
to O
hide O
sensitive O
strings O
; O
The O
communication O
protocol O
was O
modified O
in O
order O
to O
include O
the O
flag O
" O
< O
CHCMD O
> O
" O
we O
assume O
that O
" O
CH O
" O
has O
the O
same O
meaning O
than O
" O
Ch O
" O
before O
the O
version O
number O
and O
" O
CMD O
" O
is O
the O
abbreviation O
for O
command O
; O
From O
now O
on O
, O
the B-Entity
malware I-Entity
supports O
" O
runas O
" O
in O
order O
to O
execute B-Action
commands B-Entity
as B-Modifier
administrator B-Entity
. O
 
This O
command O
was O
implemented O
by O
Microsoft O
in O
Windows O
Vista O
in O
2007 O
. O
 
We O
assume O
that O
the O
author O
implemented O
this O
feature O
because O
several O
targets O
switched O
to O
this O
version O
of O
Windows O
in O
2008 O
. O
 
According O
to O
an O
article O
, O
version O
1.5 O
was O
used O
against O
the O
US O
Pentagon O
. O
 
We O
assume O
that O
the O
string O
obfuscation O
was O
performed O
in O
order O
to O
bypass O
security O
measures O
being O
capable O
of O
detecting O
an O
intrusion O
. O
 
Differences O
between O
version O
Ch O
2.03 O
( O
2008 O
- O
05 O
) O
and O
Ch O
2.11 O
( O
2009 O
- O
09 O
) O
The O
analyzed O
samples O
are O
. O
 
The O
codes O
of O
these O
two O
versions O
are O
extremely O
similar O
to O
each O
other O
, O
we O
can O
only O
notice O
small O
changes O
. O
 
Differences O
between O
version O
Ch O
2.11 O
( O
2009 O
- O
09 O
) O
and O
Ch O
2.14.1 O
( O
2010 O
- O
02 O
) O
The O
analyzed O
samples O
are O
. O
 
These O
codes O
are O
really O
similar O
to O
each O
other O
, O
too O
. O
 
We O
can O
notice O
only O
two O
changes O
. O
 
The O
four O
exported O
libraries O
show O
that O
the O
malware O
has O
started O
to O
support O
the O
OLE O
Component O
Object O
Model O
( O
COM O
) O
. O
 
This O
version O
is O
the O
first O
version O
able O
to O
be O
registered O
as O
a O
COM O
object O
. O
 
Three O
of O
the O
four O
functions O
are O
empty O
. O
 
The O
fourth O
one O
executes O
the O
malware O
. O
 
Differences O
between O
version O
2.14.1 O
( O
2010 O
- O
02 O
) O
and O
Ch O
3.00 O
( O
2012 O
- O
01 O
) O
The O
analyzed O
samples O
are O
. O
 
These O
codes O
really O
differ O
from O
each O
other O
, O
even O
if O
some O
parts O
of O
version O
2.14.1 O
were O
retained O
. O
 
Moreover O
, O
the O
developers O
changed O
the O
compiler O
; O
they O
switched O
from O
Visual O
Studio O
6.0 O
to O
Visual O
Studio O
9.0/10.0 O
, O
which O
is O
a O
strong O
indicator O
for O
the O
huge O
differences O
. O
Version O
3.00 O
is O
what O
the O
G O
DATA O
SecurityLabs O
experts O
call O
ComRAT O
. O
 
We O
can O
say O
that O
version O
2.14.1 O
is O
the O
last O
version O
of O
Agent O
. O
BTZ O
. O
 
Here O
are O
the O
main O
differences O
between O
Agent O
. O
BTZ O
and O
ComRAT O
. O
 
On O
several O
3.00 O
samples O
, O
the O
author O
forgot O
to O
remove O
the O
compilation O
path O
, O
here O
are O
some O
examples O
. O
 
Thanks O
to O
these O
compilation O
paths O
, O
we O
assume O
that O
the O
original O
name O
of O
the O
RAT O
is O
" O
Chinch O
" O
, O
which O
leads O
us O
to O
the O
assumption O
that O
the O
" O
CH O
" O
characters O
in O
the O
version O
name O
and O
in O
the O
flag O
" O
< O
CHCMD O
> O
" O
stands O
for O
" O
Chinch O
" O
. O
 
In O
English O
, O
chinch O
is O
the O
word O
for O
a O
small O
North O
American O
bug O
, O
Blissus O
leucopterus O
. O
 
This O
word O
is O
derived O
from O
the O
Spanish O
word O
chinche O
, O
meaning O
pest O
. O
 
Differences O
between O
version O
3.00 O
( O
2012 O
- O
01 O
) O
and O
Ch O
3.10 O
( O
2012 O
- O
12 O
) O
The O
analyzed O
samples O
are O
. O
 
The O
codes O
are O
similar O
to O
each O
other O
, O
but O
the O
authors O
added O
several O
features O
. O
 
The O
last O
new O
feature O
is O
really O
interesting O
: O
if O
the O
compromised O
targets O
block O
a O
specific O
command O
and O
control O
server O
, O
the O
malware O
will O
continue O
to O
work O
, O
thanks O
to O
two O
alternative O
command O
and O
control O
servers O
. O
 
Differences O
between O
version O
3.10 O
( O
2012 O
- O
12 O
) O
and O
Ch O
3.20 O
( O
2013 O
- O
06 O
) O
The O
analyzed O
samples O
are O
. O
 
The O
major O
new O
feature O
in O
the O
version O
is O
the O
new O
exports O
function O
called O
InstallW O
( O
) O
. O
 
This O
exported O
function O
is O
used O
by O
the B-Entity
dropper I-Entity
to O
add B-Action
persistence B-Entity
in B-Modifier
the O
registry B-Entity
and O
to O
drop B-Action
a O
second B-Entity
file I-Entity
( O
as O
explained O
in O
our O
previous O
article O
) O
. O
 
Version O
3.20 O
uses O
the O
following O
CLSID O
in O
order O
to O
hijack O
COM O
object O
: O
B196B286-BAB4- O
101A O
- O
B69C-00AA00341D07 O
. O
 
This O
object O
is O
the O
IConnectionPoint O
interface O
. O
 
The O
CLSID O
was O
only O
used O
in O
this O
version O
. O
 
We O
assume O
that O
the O
performed O
COM O
object O
hijacking O
generates O
some O
trouble O
on O
the O
infected O
system O
, O
that O
's O
why O
the O
author O
changed O
related O
things O
in O
the O
next O
version O
. O
 
Furthermore O
, O
the O
CLSID O
was O
stored O
in O
plain O
text O
within O
the O
sample O
. O
 
Differences O
between O
version O
Ch O
3.20 O
( O
2013 O
- O
06 O
) O
and O
Ch O
3.25 O
( O
2014 O
- O
02 O
) O
The O
analyzed O
samples O
are O
. O
 
In O
the O
3.25 O
version O
, O
the O
author O
switched O
to O
the O
CLSID O
: O
42aedc87 O
- O
2188 O
- O
41fd O
- O
b9a3 O
- O
0c966feabec1 O
as O
described O
in O
our O
article O
. O
 
Furthermore O
, O
the O
strings O
in O
the O
sample O
are O
obfuscated O
. O
 
The O
main O
new O
feature O
is O
the O
obfuscation O
– O
almost O
all O
strings O
are O
obfuscated O
and O
the O
XML O
pattern O
is O
not O
written O
in O
plain O
text O
anymore O
. O
 
Differences O
between O
version O
Ch O
3.25 O
( O
2014 O
- O
02 O
) O
and O
Ch O
3.26 O
( O
2013 O
- O
01 O
; O
date O
has O
been O
modified O
) O
The O
analyzed O
samples O
are O
. O
 
The O
version O
3.26 O
is O
the O
latest O
known O
version O
. O
 
In O
this O
version O
. O
 
This O
analysis O
shows O
us O
seven O
years O
of O
the O
evolution O
of O
a O
Remote O
Administration O
Tool O
, O
used O
by O
a O
group O
which O
targeted O
extremely O
sensitive O
entities O
, O
such O
as O
the O
US O
Pentagon O
in O
2008 O
or O
the O
Belgium O
Ministry O
of O
Foreign O
Affairs O
in O
2014 O
as O
well O
as O
the O
Finnish O
Ministry O
of O
Foreign O
Affairs O
. O
 
Except O
for O
version O
3.00 O
, O
the O
modifications O
made O
are O
rather O
marginal O
. O
 
We O
can O
see O
that O
the O
authors O
adapted O
features O
to O
the O
Windows O
versions O
, O
patched O
bugs O
, O
added O
obfuscation O
etc O
… O
The O
biggest O
update O
was O
performed O
to O
version O
3.00 O
, O
after O
two O
years O
of O
silence O
. O
 
Visibly O
, O
this O
RAT O
was O
used O
alongside O
the O
Uroburos O
rootkit O
. O
 
Nevertheless O
, O
it O
is O
not O
entirely O
clear O
how O
and O
when O
the O
attackers O
choose O
to O
use O
the O
RAT O
or O
the O
rootkit O
or O
whether O
both O
are O
used O
in O
parallel O
. O
 
Taking O
everything O
into O
consideration O
, O
G O
DATA O
SecurityLabs O
experts O
are O
sure O
that O
the O
group O
behind O
Uroburos O
/ O
Agent O
. O
BTZ O
/ O
ComRAT O
/ O
Linux O
tool/ O
… O
will O
remain O
an O
active O
player O
in O
the O
malware O
and O
APT O
field O
. O
 
The O
newest O
revelations O
made O
and O
connections O
drawn O
let O
us O
believe O
that O
there O
is O
even O
more O
to O
come O
. O
 
